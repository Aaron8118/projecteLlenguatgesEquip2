/*! jQuery v3.7.0 -ajax,-ajax/jsonp,-ajax/load,-ajax/script,-ajax/var/location,-ajax/var/nonce,-ajax/var/rquery,-ajax/xhr,-manipulation/_evalUrl,-deprecated/ajax-event-alias,-effects,-effects/animatedSelector,-effects/Tween | (c) OpenJS Foundation and other contributors | jquery.org/license */
!function(e,t){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e)}:t(e)}("undefined"!=typeof window?window:this,function(ie,e){"use strict";var oe=[],r=Object.getPrototypeOf,ae=oe.slice,g=oe.flat?function(e){return oe.flat.call(e)}:function(e){return oe.concat.apply([],e)},s=oe.push,se=oe.indexOf,n={},i=n.toString,ue=n.hasOwnProperty,o=ue.toString,a=o.call(Object),le={},v=function(e){return"function"==typeof e&&"number"!=typeof e.nodeType&&"function"!=typeof e.item},y=function(e){return null!=e&&e===e.window},m=ie.document,u={type:!0,src:!0,nonce:!0,noModule:!0};function b(e,t,n){var r,i,o=(n=n||m).createElement("script");if(o.text=e,t)for(r in u)(i=t[r]||t.getAttribute&&t.getAttribute(r))&&o.setAttribute(r,i);n.head.appendChild(o).parentNode.removeChild(o)}function x(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?n[i.call(e)]||"object":typeof e}var t="3.7.0 -ajax,-ajax/jsonp,-ajax/load,-ajax/script,-ajax/var/location,-ajax/var/nonce,-ajax/var/rquery,-ajax/xhr,-manipulation/_evalUrl,-deprecated/ajax-event-alias,-effects,-effects/animatedSelector,-effects/Tween",l=/HTML$/i,ce=function(e,t){return new ce.fn.init(e,t)};function c(e){var t=!!e&&"length"in e&&e.length,n=x(e);return!v(e)&&!y(e)&&("array"===n||0===t||"number"==typeof t&&0<t&&t-1 in e)}function fe(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()}ce.fn=ce.prototype={jquery:t,constructor:ce,length:0,toArray:function(){return ae.call(this)},get:function(e){return null==e?ae.call(this):e<0?this[e+this.length]:this[e]},pushStack:function(e){var t=ce.merge(this.constructor(),e);return t.prevObject=this,t},each:function(e){return ce.each(this,e)},map:function(n){return this.pushStack(ce.map(this,function(e,t){return n.call(e,t,e)}))},slice:function(){return this.pushStack(ae.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(ce.grep(this,function(e,t){return(t+1)%2}))},odd:function(){return this.pushStack(ce.grep(this,function(e,t){return t%2}))},eq:function(e){var t=this.length,n=+e+(e<0?t:0);return this.pushStack(0<=n&&n<t?[this[n]]:[])},end:function(){return this.prevObject||this.constructor()},push:s,sort:oe.sort,splice:oe.splice},ce.extend=ce.fn.extend=function(){var e,t,n,r,i,o,a=arguments[0]||{},s=1,u=arguments.length,l=!1;for("boolean"==typeof a&&(l=a,a=arguments[s]||{},s++),"object"==typeof a||v(a)||(a={}),s===u&&(a=this,s--);s<u;s++)if(null!=(e=arguments[s]))for(t in e)r=e[t],"__proto__"!==t&&a!==r&&(l&&r&&(ce.isPlainObject(r)||(i=Array.isArray(r)))?(n=a[t],o=i&&!Array.isArray(n)?[]:i||ce.isPlainObject(n)?n:{},i=!1,a[t]=ce.extend(l,o,r)):void 0!==r&&(a[t]=r));return a},ce.extend({expando:"jQuery"+(t+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isPlainObject:function(e){var t,n;return!(!e||"[object Object]"!==i.call(e))&&(!(t=r(e))||"function"==typeof(n=ue.call(t,"constructor")&&t.constructor)&&o.call(n)===a)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},globalEval:function(e,t,n){b(e,{nonce:t&&t.nonce},n)},each:function(e,t){var n,r=0;if(c(e)){for(n=e.length;r<n;r++)if(!1===t.call(e[r],r,e[r]))break}else for(r in e)if(!1===t.call(e[r],r,e[r]))break;return e},text:function(e){var t,n="",r=0,i=e.nodeType;if(i){if(1===i||9===i||11===i)return e.textContent;if(3===i||4===i)return e.nodeValue}else while(t=e[r++])n+=ce.text(t);return n},makeArray:function(e,t){var n=t||[];return null!=e&&(c(Object(e))?ce.merge(n,"string"==typeof e?[e]:e):s.call(n,e)),n},inArray:function(e,t,n){return null==t?-1:se.call(t,e,n)},isXMLDoc:function(e){var t=e&&e.namespaceURI,n=e&&(e.ownerDocument||e).documentElement;return!l.test(t||n&&n.nodeName||"HTML")},merge:function(e,t){for(var n=+t.length,r=0,i=e.length;r<n;r++)e[i++]=t[r];return e.length=i,e},grep:function(e,t,n){for(var r=[],i=0,o=e.length,a=!n;i<o;i++)!t(e[i],i)!==a&&r.push(e[i]);return r},map:function(e,t,n){var r,i,o=0,a=[];if(c(e))for(r=e.length;o<r;o++)null!=(i=t(e[o],o,n))&&a.push(i);else for(o in e)null!=(i=t(e[o],o,n))&&a.push(i);return g(a)},guid:1,support:le}),"function"==typeof Symbol&&(ce.fn[Symbol.iterator]=oe[Symbol.iterator]),ce.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(e,t){n["[object "+t+"]"]=t.toLowerCase()});var de=oe.pop,pe=oe.sort,he=oe.splice,ge="[\\x20\\t\\r\\n\\f]",ve=new RegExp("^"+ge+"+|((?:^|[^\\\\])(?:\\\\.)*)"+ge+"+$","g");ce.contains=function(e,t){var n=t&&t.parentNode;return e===n||!(!n||1!==n.nodeType||!(e.contains?e.contains(n):e.compareDocumentPosition&&16&e.compareDocumentPosition(n)))};var f=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\x80-\uFFFF\w-]/g;function d(e,t){return t?"\0"===e?"\ufffd":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e}ce.escapeSelector=function(e){return(e+"").replace(f,d)};var ye=m,me=s;!function(){var e,x,w,o,a,T,r,C,p,i,E=me,k=ce.expando,S=0,n=0,s=W(),c=W(),u=W(),h=W(),l=function(e,t){return e===t&&(a=!0),0},f="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",t="(?:\\\\[\\da-fA-F]{1,6}"+ge+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",d="\\["+ge+"*("+t+")(?:"+ge+"*([*^$|!~]?=)"+ge+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+t+"))|)"+ge+"*\\]",g=":("+t+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+d+")*)|.*)\\)|)",v=new RegExp(ge+"+","g"),y=new RegExp("^"+ge+"*,"+ge+"*"),m=new RegExp("^"+ge+"*([>+~]|"+ge+")"+ge+"*"),b=new RegExp(ge+"|>"),A=new RegExp(g),D=new RegExp("^"+t+"$"),N={ID:new RegExp("^#("+t+")"),CLASS:new RegExp("^\\.("+t+")"),TAG:new RegExp("^("+t+"|[*])"),ATTR:new RegExp("^"+d),PSEUDO:new RegExp("^"+g),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+ge+"*(even|odd|(([+-]|)(\\d*)n|)"+ge+"*(?:([+-]|)"+ge+"*(\\d+)|))"+ge+"*\\)|)","i"),bool:new RegExp("^(?:"+f+")$","i"),needsContext:new RegExp("^"+ge+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+ge+"*((?:-\\d)?\\d*)"+ge+"*\\)|)(?=[^-]|$)","i")},L=/^(?:input|select|textarea|button)$/i,j=/^h\d$/i,O=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,P=/[+~]/,H=new RegExp("\\\\[\\da-fA-F]{1,6}"+ge+"?|\\\\([^\\r\\n\\f])","g"),q=function(e,t){var n="0x"+e.slice(1)-65536;return t||(n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320))},R=function(){V()},M=K(function(e){return!0===e.disabled&&fe(e,"fieldset")},{dir:"parentNode",next:"legend"});try{E.apply(oe=ae.call(ye.childNodes),ye.childNodes),oe[ye.childNodes.length].nodeType}catch(e){E={apply:function(e,t){me.apply(e,ae.call(t))},call:function(e){me.apply(e,ae.call(arguments,1))}}}function I(t,e,n,r){var i,o,a,s,u,l,c,f=e&&e.ownerDocument,d=e?e.nodeType:9;if(n=n||[],"string"!=typeof t||!t||1!==d&&9!==d&&11!==d)return n;if(!r&&(V(e),e=e||T,C)){if(11!==d&&(u=O.exec(t)))if(i=u[1]){if(9===d){if(!(a=e.getElementById(i)))return n;if(a.id===i)return E.call(n,a),n}else if(f&&(a=f.getElementById(i))&&I.contains(e,a)&&a.id===i)return E.call(n,a),n}else{if(u[2])return E.apply(n,e.getElementsByTagName(t)),n;if((i=u[3])&&e.getElementsByClassName)return E.apply(n,e.getElementsByClassName(i)),n}if(!(h[t+" "]||p&&p.test(t))){if(c=t,f=e,1===d&&(b.test(t)||m.test(t))){(f=P.test(t)&&X(e.parentNode)||e)==e&&le.scope||((s=e.getAttribute("id"))?s=ce.escapeSelector(s):e.setAttribute("id",s=k)),o=(l=Y(t)).length;while(o--)l[o]=(s?"#"+s:":scope")+" "+G(l[o]);c=l.join(",")}try{return E.apply(n,f.querySelectorAll(c)),n}catch(e){h(t,!0)}finally{s===k&&e.removeAttribute("id")}}}return re(t.replace(ve,"$1"),e,n,r)}function W(){var r=[];return function e(t,n){return r.push(t+" ")>x.cacheLength&&delete e[r.shift()],e[t+" "]=n}}function B(e){return e[k]=!0,e}function F(e){var t=T.createElement("fieldset");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function $(t){return function(e){return fe(e,"input")&&e.type===t}}function _(t){return function(e){return(fe(e,"input")||fe(e,"button"))&&e.type===t}}function z(t){return function(e){return"form"in e?e.parentNode&&!1===e.disabled?"label"in e?"label"in e.parentNode?e.parentNode.disabled===t:e.disabled===t:e.isDisabled===t||e.isDisabled!==!t&&M(e)===t:e.disabled===t:"label"in e&&e.disabled===t}}function U(a){return B(function(o){return o=+o,B(function(e,t){var n,r=a([],e.length,o),i=r.length;while(i--)e[n=r[i]]&&(e[n]=!(t[n]=e[n]))})})}function X(e){return e&&"undefined"!=typeof e.getElementsByTagName&&e}function V(e){var t,n=e?e.ownerDocument||e:ye;return n!=T&&9===n.nodeType&&n.documentElement&&(r=(T=n).documentElement,C=!ce.isXMLDoc(T),i=r.matches||r.webkitMatchesSelector||r.msMatchesSelector,ye!=T&&(t=T.defaultView)&&t.top!==t&&t.addEventListener("unload",R),le.getById=F(function(e){return r.appendChild(e).id=ce.expando,!T.getElementsByName||!T.getElementsByName(ce.expando).length}),le.disconnectedMatch=F(function(e){return i.call(e,"*")}),le.scope=F(function(){return T.querySelectorAll(":scope")}),le.cssHas=F(function(){try{return T.querySelector(":has(*,:jqfake)"),!1}catch(e){return!0}}),le.getById?(x.filter.ID=function(e){var t=e.replace(H,q);return function(e){return e.getAttribute("id")===t}},x.find.ID=function(e,t){if("undefined"!=typeof t.getElementById&&C){var n=t.getElementById(e);return n?[n]:[]}}):(x.filter.ID=function(e){var n=e.replace(H,q);return function(e){var t="undefined"!=typeof e.getAttributeNode&&e.getAttributeNode("id");return t&&t.value===n}},x.find.ID=function(e,t){if("undefined"!=typeof t.getElementById&&C){var n,r,i,o=t.getElementById(e);if(o){if((n=o.getAttributeNode("id"))&&n.value===e)return[o];i=t.getElementsByName(e),r=0;while(o=i[r++])if((n=o.getAttributeNode("id"))&&n.value===e)return[o]}return[]}}),x.find.TAG=function(e,t){return"undefined"!=typeof t.getElementsByTagName?t.getElementsByTagName(e):t.querySelectorAll(e)},x.find.CLASS=function(e,t){if("undefined"!=typeof t.getElementsByClassName&&C)return t.getElementsByClassName(e)},p=[],F(function(e){var t;r.appendChild(e).innerHTML="<a id='"+k+"' href='' disabled='disabled'></a><select id='"+k+"-\r\\' disabled='disabled'><option selected=''></option></select>",e.querySelectorAll("[selected]").length||p.push("\\["+ge+"*(?:value|"+f+")"),e.querySelectorAll("[id~="+k+"-]").length||p.push("~="),e.querySelectorAll("a#"+k+"+*").length||p.push(".#.+[+~]"),e.querySelectorAll(":checked").length||p.push(":checked"),(t=T.createElement("input")).setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),r.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&p.push(":enabled",":disabled"),(t=T.createElement("input")).setAttribute("name",""),e.appendChild(t),e.querySelectorAll("[name='']").length||p.push("\\["+ge+"*name"+ge+"*="+ge+"*(?:''|\"\")")}),le.cssHas||p.push(":has"),p=p.length&&new RegExp(p.join("|")),l=function(e,t){if(e===t)return a=!0,0;var n=!e.compareDocumentPosition-!t.compareDocumentPosition;return n||(1&(n=(e.ownerDocument||e)==(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!le.sortDetached&&t.compareDocumentPosition(e)===n?e===T||e.ownerDocument==ye&&I.contains(ye,e)?-1:t===T||t.ownerDocument==ye&&I.contains(ye,t)?1:o?se.call(o,e)-se.call(o,t):0:4&n?-1:1)}),T}for(e in I.matches=function(e,t){return I(e,null,null,t)},I.matchesSelector=function(e,t){if(V(e),C&&!h[t+" "]&&(!p||!p.test(t)))try{var n=i.call(e,t);if(n||le.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(e){h(t,!0)}return 0<I(t,T,null,[e]).length},I.contains=function(e,t){return(e.ownerDocument||e)!=T&&V(e),ce.contains(e,t)},I.attr=function(e,t){(e.ownerDocument||e)!=T&&V(e);var n=x.attrHandle[t.toLowerCase()],r=n&&ue.call(x.attrHandle,t.toLowerCase())?n(e,t,!C):void 0;return void 0!==r?r:e.getAttribute(t)},I.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},ce.uniqueSort=function(e){var t,n=[],r=0,i=0;if(a=!le.sortStable,o=!le.sortStable&&ae.call(e,0),pe.call(e,l),a){while(t=e[i++])t===e[i]&&(r=n.push(i));while(r--)he.call(e,n[r],1)}return o=null,e},ce.fn.uniqueSort=function(){return this.pushStack(ce.uniqueSort(ae.apply(this)))},(x=ce.expr={cacheLength:50,createPseudo:B,match:N,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(H,q),e[3]=(e[3]||e[4]||e[5]||"").replace(H,q),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||I.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&I.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return N.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&A.test(n)&&(t=Y(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(H,q).toLowerCase();return"*"===e?function(){return!0}:function(e){return fe(e,t)}},CLASS:function(e){var t=s[e+" "];return t||(t=new RegExp("(^|"+ge+")"+e+"("+ge+"|$)"))&&s(e,function(e){return t.test("string"==typeof e.className&&e.className||"undefined"!=typeof e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(n,r,i){return function(e){var t=I.attr(e,n);return null==t?"!="===r:!r||(t+="","="===r?t===i:"!="===r?t!==i:"^="===r?i&&0===t.indexOf(i):"*="===r?i&&-1<t.indexOf(i):"$="===r?i&&t.slice(-i.length)===i:"~="===r?-1<(" "+t.replace(v," ")+" ").indexOf(i):"|="===r&&(t===i||t.slice(0,i.length+1)===i+"-"))}},CHILD:function(p,e,t,h,g){var v="nth"!==p.slice(0,3),y="last"!==p.slice(-4),m="of-type"===e;return 1===h&&0===g?function(e){return!!e.parentNode}:function(e,t,n){var r,i,o,a,s,u=v!==y?"nextSibling":"previousSibling",l=e.parentNode,c=m&&e.nodeName.toLowerCase(),f=!n&&!m,d=!1;if(l){if(v){while(u){o=e;while(o=o[u])if(m?fe(o,c):1===o.nodeType)return!1;s=u="only"===p&&!s&&"nextSibling"}return!0}if(s=[y?l.firstChild:l.lastChild],y&&f){d=(a=(r=(i=l[k]||(l[k]={}))[p]||[])[0]===S&&r[1])&&r[2],o=a&&l.childNodes[a];while(o=++a&&o&&o[u]||(d=a=0)||s.pop())if(1===o.nodeType&&++d&&o===e){i[p]=[S,a,d];break}}else if(f&&(d=a=(r=(i=e[k]||(e[k]={}))[p]||[])[0]===S&&r[1]),!1===d)while(o=++a&&o&&o[u]||(d=a=0)||s.pop())if((m?fe(o,c):1===o.nodeType)&&++d&&(f&&((i=o[k]||(o[k]={}))[p]=[S,d]),o===e))break;return(d-=g)===h||d%h==0&&0<=d/h}}},PSEUDO:function(e,o){var t,a=x.pseudos[e]||x.setFilters[e.toLowerCase()]||I.error("unsupported pseudo: "+e);return a[k]?a(o):1<a.length?(t=[e,e,"",o],x.setFilters.hasOwnProperty(e.toLowerCase())?B(function(e,t){var n,r=a(e,o),i=r.length;while(i--)e[n=se.call(e,r[i])]=!(t[n]=r[i])}):function(e){return a(e,0,t)}):a}},pseudos:{not:B(function(e){var r=[],i=[],s=ne(e.replace(ve,"$1"));return s[k]?B(function(e,t,n,r){var i,o=s(e,null,r,[]),a=e.length;while(a--)(i=o[a])&&(e[a]=!(t[a]=i))}):function(e,t,n){return r[0]=e,s(r,null,n,i),r[0]=null,!i.pop()}}),has:B(function(t){return function(e){return 0<I(t,e).length}}),contains:B(function(t){return t=t.replace(H,q),function(e){return-1<(e.textContent||ce.text(e)).indexOf(t)}}),lang:B(function(n){return D.test(n||"")||I.error("unsupported lang: "+n),n=n.replace(H,q).toLowerCase(),function(e){var t;do{if(t=C?e.lang:e.getAttribute("xml:lang")||e.getAttribute("lang"))return(t=t.toLowerCase())===n||0===t.indexOf(n+"-")}while((e=e.parentNode)&&1===e.nodeType);return!1}}),target:function(e){var t=ie.location&&ie.location.hash;return t&&t.slice(1)===e.id},root:function(e){return e===r},focus:function(e){return e===function(){try{return T.activeElement}catch(e){}}()&&T.hasFocus()&&!!(e.type||e.href||~e.tabIndex)},enabled:z(!1),disabled:z(!0),checked:function(e){return fe(e,"input")&&!!e.checked||fe(e,"option")&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!x.pseudos.empty(e)},header:function(e){return j.test(e.nodeName)},input:function(e){return L.test(e.nodeName)},button:function(e){return fe(e,"input")&&"button"===e.type||fe(e,"button")},text:function(e){var t;return fe(e,"input")&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:U(function(){return[0]}),last:U(function(e,t){return[t-1]}),eq:U(function(e,t,n){return[n<0?n+t:n]}),even:U(function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e}),odd:U(function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e}),lt:U(function(e,t,n){var r;for(r=n<0?n+t:t<n?t:n;0<=--r;)e.push(r);return e}),gt:U(function(e,t,n){for(var r=n<0?n+t:n;++r<t;)e.push(r);return e})}}).pseudos.nth=x.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})x.pseudos[e]=$(e);for(e in{submit:!0,reset:!0})x.pseudos[e]=_(e);function Q(){}function Y(e,t){var n,r,i,o,a,s,u,l=c[e+" "];if(l)return t?0:l.slice(0);a=e,s=[],u=x.preFilter;while(a){for(o in n&&!(r=y.exec(a))||(r&&(a=a.slice(r[0].length)||a),s.push(i=[])),n=!1,(r=m.exec(a))&&(n=r.shift(),i.push({value:n,type:r[0].replace(ve," ")}),a=a.slice(n.length)),x.filter)!(r=N[o].exec(a))||u[o]&&!(r=u[o](r))||(n=r.shift(),i.push({value:n,type:o,matches:r}),a=a.slice(n.length));if(!n)break}return t?a.length:a?I.error(e):c(e,s).slice(0)}function G(e){for(var t=0,n=e.length,r="";t<n;t++)r+=e[t].value;return r}function K(a,e,t){var s=e.dir,u=e.next,l=u||s,c=t&&"parentNode"===l,f=n++;return e.first?function(e,t,n){while(e=e[s])if(1===e.nodeType||c)return a(e,t,n);return!1}:function(e,t,n){var r,i,o=[S,f];if(n){while(e=e[s])if((1===e.nodeType||c)&&a(e,t,n))return!0}else while(e=e[s])if(1===e.nodeType||c)if(i=e[k]||(e[k]={}),u&&fe(e,u))e=e[s]||e;else{if((r=i[l])&&r[0]===S&&r[1]===f)return o[2]=r[2];if((i[l]=o)[2]=a(e,t,n))return!0}return!1}}function J(i){return 1<i.length?function(e,t,n){var r=i.length;while(r--)if(!i[r](e,t,n))return!1;return!0}:i[0]}function Z(e,t,n,r,i){for(var o,a=[],s=0,u=e.length,l=null!=t;s<u;s++)(o=e[s])&&(n&&!n(o,r,i)||(a.push(o),l&&t.push(s)));return a}function ee(p,h,g,v,y,e){return v&&!v[k]&&(v=ee(v)),y&&!y[k]&&(y=ee(y,e)),B(function(e,t,n,r){var i,o,a,s,u=[],l=[],c=t.length,f=e||function(e,t,n){for(var r=0,i=t.length;r<i;r++)I(e,t[r],n);return n}(h||"*",n.nodeType?[n]:n,[]),d=!p||!e&&h?f:Z(f,u,p,n,r);if(g?g(d,s=y||(e?p:c||v)?[]:t,n,r):s=d,v){i=Z(s,l),v(i,[],n,r),o=i.length;while(o--)(a=i[o])&&(s[l[o]]=!(d[l[o]]=a))}if(e){if(y||p){if(y){i=[],o=s.length;while(o--)(a=s[o])&&i.push(d[o]=a);y(null,s=[],i,r)}o=s.length;while(o--)(a=s[o])&&-1<(i=y?se.call(e,a):u[o])&&(e[i]=!(t[i]=a))}}else s=Z(s===t?s.splice(c,s.length):s),y?y(null,t,s,r):E.apply(t,s)})}function te(e){for(var i,t,n,r=e.length,o=x.relative[e[0].type],a=o||x.relative[" "],s=o?1:0,u=K(function(e){return e===i},a,!0),l=K(function(e){return-1<se.call(i,e)},a,!0),c=[function(e,t,n){var r=!o&&(n||t!=w)||((i=t).nodeType?u(e,t,n):l(e,t,n));return i=null,r}];s<r;s++)if(t=x.relative[e[s].type])c=[K(J(c),t)];else{if((t=x.filter[e[s].type].apply(null,e[s].matches))[k]){for(n=++s;n<r;n++)if(x.relative[e[n].type])break;return ee(1<s&&J(c),1<s&&G(e.slice(0,s-1).concat({value:" "===e[s-2].type?"*":""})).replace(ve,"$1"),t,s<n&&te(e.slice(s,n)),n<r&&te(e=e.slice(n)),n<r&&G(e))}c.push(t)}return J(c)}function ne(e,t){var n,v,y,m,b,r,i=[],o=[],a=u[e+" "];if(!a){t||(t=Y(e)),n=t.length;while(n--)(a=te(t[n]))[k]?i.push(a):o.push(a);(a=u(e,(v=o,m=0<(y=i).length,b=0<v.length,r=function(e,t,n,r,i){var o,a,s,u=0,l="0",c=e&&[],f=[],d=w,p=e||b&&x.find.TAG("*",i),h=S+=null==d?1:Math.random()||.1,g=p.length;for(i&&(w=t==T||t||i);l!==g&&null!=(o=p[l]);l++){if(b&&o){a=0,t||o.ownerDocument==T||(V(o),n=!C);while(s=v[a++])if(s(o,t||T,n)){E.call(r,o);break}i&&(S=h)}m&&((o=!s&&o)&&u--,e&&c.push(o))}if(u+=l,m&&l!==u){a=0;while(s=y[a++])s(c,f,t,n);if(e){if(0<u)while(l--)c[l]||f[l]||(f[l]=de.call(r));f=Z(f)}E.apply(r,f),i&&!e&&0<f.length&&1<u+y.length&&ce.uniqueSort(r)}return i&&(S=h,w=d),c},m?B(r):r))).selector=e}return a}function re(e,t,n,r){var i,o,a,s,u,l="function"==typeof e&&e,c=!r&&Y(e=l.selector||e);if(n=n||[],1===c.length){if(2<(o=c[0]=c[0].slice(0)).length&&"ID"===(a=o[0]).type&&9===t.nodeType&&C&&x.relative[o[1].type]){if(!(t=(x.find.ID(a.matches[0].replace(H,q),t)||[])[0]))return n;l&&(t=t.parentNode),e=e.slice(o.shift().value.length)}i=N.needsContext.test(e)?0:o.length;while(i--){if(a=o[i],x.relative[s=a.type])break;if((u=x.find[s])&&(r=u(a.matches[0].replace(H,q),P.test(o[0].type)&&X(t.parentNode)||t))){if(o.splice(i,1),!(e=r.length&&G(o)))return E.apply(n,r),n;break}}}return(l||ne(e,c))(r,t,!C,n,!t||P.test(e)&&X(t.parentNode)||t),n}Q.prototype=x.filters=x.pseudos,x.setFilters=new Q,le.sortStable=k.split("").sort(l).join("")===k,V(),le.sortDetached=F(function(e){return 1&e.compareDocumentPosition(T.createElement("fieldset"))}),ce.find=I,ce.expr[":"]=ce.expr.pseudos,ce.unique=ce.uniqueSort,I.compile=ne,I.select=re,I.setDocument=V,I.escape=ce.escapeSelector,I.getText=ce.text,I.isXML=ce.isXMLDoc,I.selectors=ce.expr,I.support=ce.support,I.uniqueSort=ce.uniqueSort}();var p=function(e,t,n){var r=[],i=void 0!==n;while((e=e[t])&&9!==e.nodeType)if(1===e.nodeType){if(i&&ce(e).is(n))break;r.push(e)}return r},h=function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n},w=ce.expr.match.needsContext,T=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function C(e,n,r){return v(n)?ce.grep(e,function(e,t){return!!n.call(e,t,e)!==r}):n.nodeType?ce.grep(e,function(e){return e===n!==r}):"string"!=typeof n?ce.grep(e,function(e){return-1<se.call(n,e)!==r}):ce.filter(n,e,r)}ce.filter=function(e,t,n){var r=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===r.nodeType?ce.find.matchesSelector(r,e)?[r]:[]:ce.find.matches(e,ce.grep(t,function(e){return 1===e.nodeType}))},ce.fn.extend({find:function(e){var t,n,r=this.length,i=this;if("string"!=typeof e)return this.pushStack(ce(e).filter(function(){for(t=0;t<r;t++)if(ce.contains(i[t],this))return!0}));for(n=this.pushStack([]),t=0;t<r;t++)ce.find(e,i[t],n);return 1<r?ce.uniqueSort(n):n},filter:function(e){return this.pushStack(C(this,e||[],!1))},not:function(e){return this.pushStack(C(this,e||[],!0))},is:function(e){return!!C(this,"string"==typeof e&&w.test(e)?ce(e):e||[],!1).length}});var E,k=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(ce.fn.init=function(e,t,n){var r,i;if(!e)return this;if(n=n||E,"string"==typeof e){if(!(r="<"===e[0]&&">"===e[e.length-1]&&3<=e.length?[null,e,null]:k.exec(e))||!r[1]&&t)return!t||t.jquery?(t||n).find(e):this.constructor(t).find(e);if(r[1]){if(t=t instanceof ce?t[0]:t,ce.merge(this,ce.parseHTML(r[1],t&&t.nodeType?t.ownerDocument||t:m,!0)),T.test(r[1])&&ce.isPlainObject(t))for(r in t)v(this[r])?this[r](t[r]):this.attr(r,t[r]);return this}return(i=m.getElementById(r[2]))&&(this[0]=i,this.length=1),this}return e.nodeType?(this[0]=e,this.length=1,this):v(e)?void 0!==n.ready?n.ready(e):e(ce):ce.makeArray(e,this)}).prototype=ce.fn,E=ce(m);var S=/^(?:parents|prev(?:Until|All))/,A={children:!0,contents:!0,next:!0,prev:!0};function D(e,t){while((e=e[t])&&1!==e.nodeType);return e}ce.fn.extend({has:function(e){var t=ce(e,this),n=t.length;return this.filter(function(){for(var e=0;e<n;e++)if(ce.contains(this,t[e]))return!0})},closest:function(e,t){var n,r=0,i=this.length,o=[],a="string"!=typeof e&&ce(e);if(!w.test(e))for(;r<i;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(a?-1<a.index(n):1===n.nodeType&&ce.find.matchesSelector(n,e))){o.push(n);break}return this.pushStack(1<o.length?ce.uniqueSort(o):o)},index:function(e){return e?"string"==typeof e?se.call(ce(e),this[0]):se.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(ce.uniqueSort(ce.merge(this.get(),ce(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),ce.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return p(e,"parentNode")},parentsUntil:function(e,t,n){return p(e,"parentNode",n)},next:function(e){return D(e,"nextSibling")},prev:function(e){return D(e,"previousSibling")},nextAll:function(e){return p(e,"nextSibling")},prevAll:function(e){return p(e,"previousSibling")},nextUntil:function(e,t,n){return p(e,"nextSibling",n)},prevUntil:function(e,t,n){return p(e,"previousSibling",n)},siblings:function(e){return h((e.parentNode||{}).firstChild,e)},children:function(e){return h(e.firstChild)},contents:function(e){return null!=e.contentDocument&&r(e.contentDocument)?e.contentDocument:(fe(e,"template")&&(e=e.content||e),ce.merge([],e.childNodes))}},function(r,i){ce.fn[r]=function(e,t){var n=ce.map(this,i,e);return"Until"!==r.slice(-5)&&(t=e),t&&"string"==typeof t&&(n=ce.filter(t,n)),1<this.length&&(A[r]||ce.uniqueSort(n),S.test(r)&&n.reverse()),this.pushStack(n)}});var N=/[^\x20\t\r\n\f]+/g;function L(e){return e}function j(e){throw e}function O(e,t,n,r){var i;try{e&&v(i=e.promise)?i.call(e).done(t).fail(n):e&&v(i=e.then)?i.call(e,t,n):t.apply(void 0,[e].slice(r))}catch(e){n.apply(void 0,[e])}}ce.Callbacks=function(r){var e,n;r="string"==typeof r?(e=r,n={},ce.each(e.match(N)||[],function(e,t){n[t]=!0}),n):ce.extend({},r);var i,t,o,a,s=[],u=[],l=-1,c=function(){for(a=a||r.once,o=i=!0;u.length;l=-1){t=u.shift();while(++l<s.length)!1===s[l].apply(t[0],t[1])&&r.stopOnFalse&&(l=s.length,t=!1)}r.memory||(t=!1),i=!1,a&&(s=t?[]:"")},f={add:function(){return s&&(t&&!i&&(l=s.length-1,u.push(t)),function n(e){ce.each(e,function(e,t){v(t)?r.unique&&f.has(t)||s.push(t):t&&t.length&&"string"!==x(t)&&n(t)})}(arguments),t&&!i&&c()),this},remove:function(){return ce.each(arguments,function(e,t){var n;while(-1<(n=ce.inArray(t,s,n)))s.splice(n,1),n<=l&&l--}),this},has:function(e){return e?-1<ce.inArray(e,s):0<s.length},empty:function(){return s&&(s=[]),this},disable:function(){return a=u=[],s=t="",this},disabled:function(){return!s},lock:function(){return a=u=[],t||i||(s=t=""),this},locked:function(){return!!a},fireWith:function(e,t){return a||(t=[e,(t=t||[]).slice?t.slice():t],u.push(t),i||c()),this},fire:function(){return f.fireWith(this,arguments),this},fired:function(){return!!o}};return f},ce.extend({Deferred:function(e){var o=[["notify","progress",ce.Callbacks("memory"),ce.Callbacks("memory"),2],["resolve","done",ce.Callbacks("once memory"),ce.Callbacks("once memory"),0,"resolved"],["reject","fail",ce.Callbacks("once memory"),ce.Callbacks("once memory"),1,"rejected"]],i="pending",a={state:function(){return i},always:function(){return s.done(arguments).fail(arguments),this},"catch":function(e){return a.then(null,e)},pipe:function(){var i=arguments;return ce.Deferred(function(r){ce.each(o,function(e,t){var n=v(i[t[4]])&&i[t[4]];s[t[1]](function(){var e=n&&n.apply(this,arguments);e&&v(e.promise)?e.promise().progress(r.notify).done(r.resolve).fail(r.reject):r[t[0]+"With"](this,n?[e]:arguments)})}),i=null}).promise()},then:function(t,n,r){var u=0;function l(i,o,a,s){return function(){var n=this,r=arguments,e=function(){var e,t;if(!(i<u)){if((e=a.apply(n,r))===o.promise())throw new TypeError("Thenable self-resolution");t=e&&("object"==typeof e||"function"==typeof e)&&e.then,v(t)?s?t.call(e,l(u,o,L,s),l(u,o,j,s)):(u++,t.call(e,l(u,o,L,s),l(u,o,j,s),l(u,o,L,o.notifyWith))):(a!==L&&(n=void 0,r=[e]),(s||o.resolveWith)(n,r))}},t=s?e:function(){try{e()}catch(e){ce.Deferred.exceptionHook&&ce.Deferred.exceptionHook(e,t.error),u<=i+1&&(a!==j&&(n=void 0,r=[e]),o.rejectWith(n,r))}};i?t():(ce.Deferred.getErrorHook?t.error=ce.Deferred.getErrorHook():ce.Deferred.getStackHook&&(t.error=ce.Deferred.getStackHook()),ie.setTimeout(t))}}return ce.Deferred(function(e){o[0][3].add(l(0,e,v(r)?r:L,e.notifyWith)),o[1][3].add(l(0,e,v(t)?t:L)),o[2][3].add(l(0,e,v(n)?n:j))}).promise()},promise:function(e){return null!=e?ce.extend(e,a):a}},s={};return ce.each(o,function(e,t){var n=t[2],r=t[5];a[t[1]]=n.add,r&&n.add(function(){i=r},o[3-e][2].disable,o[3-e][3].disable,o[0][2].lock,o[0][3].lock),n.add(t[3].fire),s[t[0]]=function(){return s[t[0]+"With"](this===s?void 0:this,arguments),this},s[t[0]+"With"]=n.fireWith}),a.promise(s),e&&e.call(s,s),s},when:function(e){var n=arguments.length,t=n,r=Array(t),i=ae.call(arguments),o=ce.Deferred(),a=function(t){return function(e){r[t]=this,i[t]=1<arguments.length?ae.call(arguments):e,--n||o.resolveWith(r,i)}};if(n<=1&&(O(e,o.done(a(t)).resolve,o.reject,!n),"pending"===o.state()||v(i[t]&&i[t].then)))return o.then();while(t--)O(i[t],a(t),o.reject);return o.promise()}});var P=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;ce.Deferred.exceptionHook=function(e,t){ie.console&&ie.console.warn&&e&&P.test(e.name)&&ie.console.warn("jQuery.Deferred exception: "+e.message,e.stack,t)},ce.readyException=function(e){ie.setTimeout(function(){throw e})};var H=ce.Deferred();function q(){m.removeEventListener("DOMContentLoaded",q),ie.removeEventListener("load",q),ce.ready()}ce.fn.ready=function(e){return H.then(e)["catch"](function(e){ce.readyException(e)}),this},ce.extend({isReady:!1,readyWait:1,ready:function(e){(!0===e?--ce.readyWait:ce.isReady)||(ce.isReady=!0)!==e&&0<--ce.readyWait||H.resolveWith(m,[ce])}}),ce.ready.then=H.then,"complete"===m.readyState||"loading"!==m.readyState&&!m.documentElement.doScroll?ie.setTimeout(ce.ready):(m.addEventListener("DOMContentLoaded",q),ie.addEventListener("load",q));var R=function(e,t,n,r,i,o,a){var s=0,u=e.length,l=null==n;if("object"===x(n))for(s in i=!0,n)R(e,t,s,n[s],!0,o,a);else if(void 0!==r&&(i=!0,v(r)||(a=!0),l&&(a?(t.call(e,r),t=null):(l=t,t=function(e,t,n){return l.call(ce(e),n)})),t))for(;s<u;s++)t(e[s],n,a?r:r.call(e[s],s,t(e[s],n)));return i?e:l?t.call(e):u?t(e[0],n):o},M=/^-ms-/,I=/-([a-z])/g;function W(e,t){return t.toUpperCase()}function B(e){return e.replace(M,"ms-").replace(I,W)}var F=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};function $(){this.expando=ce.expando+$.uid++}$.uid=1,$.prototype={cache:function(e){var t=e[this.expando];return t||(t={},F(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,n){var r,i=this.cache(e);if("string"==typeof t)i[B(t)]=n;else for(r in t)i[B(r)]=t[r];return i},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][B(t)]},access:function(e,t,n){return void 0===t||t&&"string"==typeof t&&void 0===n?this.get(e,t):(this.set(e,t,n),void 0!==n?n:t)},remove:function(e,t){var n,r=e[this.expando];if(void 0!==r){if(void 0!==t){n=(t=Array.isArray(t)?t.map(B):(t=B(t))in r?[t]:t.match(N)||[]).length;while(n--)delete r[t[n]]}(void 0===t||ce.isEmptyObject(r))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var t=e[this.expando];return void 0!==t&&!ce.isEmptyObject(t)}};var _=new $,z=new $,U=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,X=/[A-Z]/g;function V(e,t,n){var r,i;if(void 0===n&&1===e.nodeType)if(r="data-"+t.replace(X,"-$&").toLowerCase(),"string"==typeof(n=e.getAttribute(r))){try{n="true"===(i=n)||"false"!==i&&("null"===i?null:i===+i+""?+i:U.test(i)?JSON.parse(i):i)}catch(e){}z.set(e,t,n)}else n=void 0;return n}ce.extend({hasData:function(e){return z.hasData(e)||_.hasData(e)},data:function(e,t,n){return z.access(e,t,n)},removeData:function(e,t){z.remove(e,t)},_data:function(e,t,n){return _.access(e,t,n)},_removeData:function(e,t){_.remove(e,t)}}),ce.fn.extend({data:function(n,e){var t,r,i,o=this[0],a=o&&o.attributes;if(void 0===n){if(this.length&&(i=z.get(o),1===o.nodeType&&!_.get(o,"hasDataAttrs"))){t=a.length;while(t--)a[t]&&0===(r=a[t].name).indexOf("data-")&&(r=B(r.slice(5)),V(o,r,i[r]));_.set(o,"hasDataAttrs",!0)}return i}return"object"==typeof n?this.each(function(){z.set(this,n)}):R(this,function(e){var t;if(o&&void 0===e)return void 0!==(t=z.get(o,n))?t:void 0!==(t=V(o,n))?t:void 0;this.each(function(){z.set(this,n,e)})},null,e,1<arguments.length,null,!0)},removeData:function(e){return this.each(function(){z.remove(this,e)})}}),ce.extend({queue:function(e,t,n){var r;if(e)return t=(t||"fx")+"queue",r=_.get(e,t),n&&(!r||Array.isArray(n)?r=_.access(e,t,ce.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){t=t||"fx";var n=ce.queue(e,t),r=n.length,i=n.shift(),o=ce._queueHooks(e,t);"inprogress"===i&&(i=n.shift(),r--),i&&("fx"===t&&n.unshift("inprogress"),delete o.stop,i.call(e,function(){ce.dequeue(e,t)},o)),!r&&o&&o.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return _.get(e,n)||_.access(e,n,{empty:ce.Callbacks("once memory").add(function(){_.remove(e,[t+"queue",n])})})}}),ce.fn.extend({queue:function(t,n){var e=2;return"string"!=typeof t&&(n=t,t="fx",e--),arguments.length<e?ce.queue(this[0],t):void 0===n?this:this.each(function(){var e=ce.queue(this,t,n);ce._queueHooks(this,t),"fx"===t&&"inprogress"!==e[0]&&ce.dequeue(this,t)})},dequeue:function(e){return this.each(function(){ce.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var n,r=1,i=ce.Deferred(),o=this,a=this.length,s=function(){--r||i.resolveWith(o,[o])};"string"!=typeof e&&(t=e,e=void 0),e=e||"fx";while(a--)(n=_.get(o[a],e+"queueHooks"))&&n.empty&&(r++,n.empty.add(s));return s(),i.promise(t)}});var Q=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,Y=new RegExp("^(?:([+-])=|)("+Q+")([a-z%]*)$","i"),G=["Top","Right","Bottom","Left"],K=m.documentElement,J=function(e){return ce.contains(e.ownerDocument,e)},Z={composed:!0};K.getRootNode&&(J=function(e){return ce.contains(e.ownerDocument,e)||e.getRootNode(Z)===e.ownerDocument});var ee=function(e,t){return"none"===(e=t||e).style.display||""===e.style.display&&J(e)&&"none"===ce.css(e,"display")};var te={};function ne(e,t){for(var n,r,i,o,a,s,u,l=[],c=0,f=e.length;c<f;c++)(r=e[c]).style&&(n=r.style.display,t?("none"===n&&(l[c]=_.get(r,"display")||null,l[c]||(r.style.display="")),""===r.style.display&&ee(r)&&(l[c]=(u=a=o=void 0,a=(i=r).ownerDocument,s=i.nodeName,(u=te[s])||(o=a.body.appendChild(a.createElement(s)),u=ce.css(o,"display"),o.parentNode.removeChild(o),"none"===u&&(u="block"),te[s]=u)))):"none"!==n&&(l[c]="none",_.set(r,"display",n)));for(c=0;c<f;c++)null!=l[c]&&(e[c].style.display=l[c]);return e}ce.fn.extend({show:function(){return ne(this,!0)},hide:function(){return ne(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){ee(this)?ce(this).show():ce(this).hide()})}});var re,be,xe=/^(?:checkbox|radio)$/i,we=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,Te=/^$|^module$|\/(?:java|ecma)script/i;re=m.createDocumentFragment().appendChild(m.createElement("div")),(be=m.createElement("input")).setAttribute("type","radio"),be.setAttribute("checked","checked"),be.setAttribute("name","t"),re.appendChild(be),le.checkClone=re.cloneNode(!0).cloneNode(!0).lastChild.checked,re.innerHTML="<textarea>x</textarea>",le.noCloneChecked=!!re.cloneNode(!0).lastChild.defaultValue,re.innerHTML="<option></option>",le.option=!!re.lastChild;var Ce={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function Ee(e,t){var n;return n="undefined"!=typeof e.getElementsByTagName?e.getElementsByTagName(t||"*"):"undefined"!=typeof e.querySelectorAll?e.querySelectorAll(t||"*"):[],void 0===t||t&&fe(e,t)?ce.merge([e],n):n}function ke(e,t){for(var n=0,r=e.length;n<r;n++)_.set(e[n],"globalEval",!t||_.get(t[n],"globalEval"))}Ce.tbody=Ce.tfoot=Ce.colgroup=Ce.caption=Ce.thead,Ce.th=Ce.td,le.option||(Ce.optgroup=Ce.option=[1,"<select multiple='multiple'>","</select>"]);var Se=/<|&#?\w+;/;function Ae(e,t,n,r,i){for(var o,a,s,u,l,c,f=t.createDocumentFragment(),d=[],p=0,h=e.length;p<h;p++)if((o=e[p])||0===o)if("object"===x(o))ce.merge(d,o.nodeType?[o]:o);else if(Se.test(o)){a=a||f.appendChild(t.createElement("div")),s=(we.exec(o)||["",""])[1].toLowerCase(),u=Ce[s]||Ce._default,a.innerHTML=u[1]+ce.htmlPrefilter(o)+u[2],c=u[0];while(c--)a=a.lastChild;ce.merge(d,a.childNodes),(a=f.firstChild).textContent=""}else d.push(t.createTextNode(o));f.textContent="",p=0;while(o=d[p++])if(r&&-1<ce.inArray(o,r))i&&i.push(o);else if(l=J(o),a=Ee(f.appendChild(o),"script"),l&&ke(a),n){c=0;while(o=a[c++])Te.test(o.type||"")&&n.push(o)}return f}var De=/^([^.]*)(?:\.(.+)|)/;function Ne(){return!0}function Le(){return!1}function je(e,t,n,r,i,o){var a,s;if("object"==typeof t){for(s in"string"!=typeof n&&(r=r||n,n=void 0),t)je(e,s,n,r,t[s],o);return e}if(null==r&&null==i?(i=n,r=n=void 0):null==i&&("string"==typeof n?(i=r,r=void 0):(i=r,r=n,n=void 0)),!1===i)i=Le;else if(!i)return e;return 1===o&&(a=i,(i=function(e){return ce().off(e),a.apply(this,arguments)}).guid=a.guid||(a.guid=ce.guid++)),e.each(function(){ce.event.add(this,t,i,r,n)})}function Oe(e,r,t){t?(_.set(e,r,!1),ce.event.add(e,r,{namespace:!1,handler:function(e){var t,n=_.get(this,r);if(1&e.isTrigger&&this[r]){if(n)(ce.event.special[r]||{}).delegateType&&e.stopPropagation();else if(n=ae.call(arguments),_.set(this,r,n),this[r](),t=_.get(this,r),_.set(this,r,!1),n!==t)return e.stopImmediatePropagation(),e.preventDefault(),t}else n&&(_.set(this,r,ce.event.trigger(n[0],n.slice(1),this)),e.stopPropagation(),e.isImmediatePropagationStopped=Ne)}})):void 0===_.get(e,r)&&ce.event.add(e,r,Ne)}ce.event={global:{},add:function(t,e,n,r,i){var o,a,s,u,l,c,f,d,p,h,g,v=_.get(t);if(F(t)){n.handler&&(n=(o=n).handler,i=o.selector),i&&ce.find.matchesSelector(K,i),n.guid||(n.guid=ce.guid++),(u=v.events)||(u=v.events=Object.create(null)),(a=v.handle)||(a=v.handle=function(e){return"undefined"!=typeof ce&&ce.event.triggered!==e.type?ce.event.dispatch.apply(t,arguments):void 0}),l=(e=(e||"").match(N)||[""]).length;while(l--)p=g=(s=De.exec(e[l])||[])[1],h=(s[2]||"").split(".").sort(),p&&(f=ce.event.special[p]||{},p=(i?f.delegateType:f.bindType)||p,f=ce.event.special[p]||{},c=ce.extend({type:p,origType:g,data:r,handler:n,guid:n.guid,selector:i,needsContext:i&&ce.expr.match.needsContext.test(i),namespace:h.join(".")},o),(d=u[p])||((d=u[p]=[]).delegateCount=0,f.setup&&!1!==f.setup.call(t,r,h,a)||t.addEventListener&&t.addEventListener(p,a)),f.add&&(f.add.call(t,c),c.handler.guid||(c.handler.guid=n.guid)),i?d.splice(d.delegateCount++,0,c):d.push(c),ce.event.global[p]=!0)}},remove:function(e,t,n,r,i){var o,a,s,u,l,c,f,d,p,h,g,v=_.hasData(e)&&_.get(e);if(v&&(u=v.events)){l=(t=(t||"").match(N)||[""]).length;while(l--)if(p=g=(s=De.exec(t[l])||[])[1],h=(s[2]||"").split(".").sort(),p){f=ce.event.special[p]||{},d=u[p=(r?f.delegateType:f.bindType)||p]||[],s=s[2]&&new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=o=d.length;while(o--)c=d[o],!i&&g!==c.origType||n&&n.guid!==c.guid||s&&!s.test(c.namespace)||r&&r!==c.selector&&("**"!==r||!c.selector)||(d.splice(o,1),c.selector&&d.delegateCount--,f.remove&&f.remove.call(e,c));a&&!d.length&&(f.teardown&&!1!==f.teardown.call(e,h,v.handle)||ce.removeEvent(e,p,v.handle),delete u[p])}else for(p in u)ce.event.remove(e,p+t[l],n,r,!0);ce.isEmptyObject(u)&&_.remove(e,"handle events")}},dispatch:function(e){var t,n,r,i,o,a,s=new Array(arguments.length),u=ce.event.fix(e),l=(_.get(this,"events")||Object.create(null))[u.type]||[],c=ce.event.special[u.type]||{};for(s[0]=u,t=1;t<arguments.length;t++)s[t]=arguments[t];if(u.delegateTarget=this,!c.preDispatch||!1!==c.preDispatch.call(this,u)){a=ce.event.handlers.call(this,u,l),t=0;while((i=a[t++])&&!u.isPropagationStopped()){u.currentTarget=i.elem,n=0;while((o=i.handlers[n++])&&!u.isImmediatePropagationStopped())u.rnamespace&&!1!==o.namespace&&!u.rnamespace.test(o.namespace)||(u.handleObj=o,u.data=o.data,void 0!==(r=((ce.event.special[o.origType]||{}).handle||o.handler).apply(i.elem,s))&&!1===(u.result=r)&&(u.preventDefault(),u.stopPropagation()))}return c.postDispatch&&c.postDispatch.call(this,u),u.result}},handlers:function(e,t){var n,r,i,o,a,s=[],u=t.delegateCount,l=e.target;if(u&&l.nodeType&&!("click"===e.type&&1<=e.button))for(;l!==this;l=l.parentNode||this)if(1===l.nodeType&&("click"!==e.type||!0!==l.disabled)){for(o=[],a={},n=0;n<u;n++)void 0===a[i=(r=t[n]).selector+" "]&&(a[i]=r.needsContext?-1<ce(i,this).index(l):ce.find(i,this,null,[l]).length),a[i]&&o.push(r);o.length&&s.push({elem:l,handlers:o})}return l=this,u<t.length&&s.push({elem:l,handlers:t.slice(u)}),s},addProp:function(t,e){Object.defineProperty(ce.Event.prototype,t,{enumerable:!0,configurable:!0,get:v(e)?function(){if(this.originalEvent)return e(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[t]},set:function(e){Object.defineProperty(this,t,{enumerable:!0,configurable:!0,writable:!0,value:e})}})},fix:function(e){return e[ce.expando]?e:new ce.Event(e)},special:{load:{noBubble:!0},click:{setup:function(e){var t=this||e;return xe.test(t.type)&&t.click&&fe(t,"input")&&Oe(t,"click",!0),!1},trigger:function(e){var t=this||e;return xe.test(t.type)&&t.click&&fe(t,"input")&&Oe(t,"click"),!0},_default:function(e){var t=e.target;return xe.test(t.type)&&t.click&&fe(t,"input")&&_.get(t,"click")||fe(t,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},ce.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n)},ce.Event=function(e,t){if(!(this instanceof ce.Event))return new ce.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?Ne:Le,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&ce.extend(this,t),this.timeStamp=e&&e.timeStamp||Date.now(),this[ce.expando]=!0},ce.Event.prototype={constructor:ce.Event,isDefaultPrevented:Le,isPropagationStopped:Le,isImmediatePropagationStopped:Le,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=Ne,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=Ne,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=Ne,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},ce.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,"char":!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},ce.event.addProp),ce.each({focus:"focusin",blur:"focusout"},function(r,i){function o(e){if(m.documentMode){var t=_.get(this,"handle"),n=ce.event.fix(e);n.type="focusin"===e.type?"focus":"blur",n.isSimulated=!0,t(e),n.target===n.currentTarget&&t(n)}else ce.event.simulate(i,e.target,ce.event.fix(e))}ce.event.special[r]={setup:function(){var e;if(Oe(this,r,!0),!m.documentMode)return!1;(e=_.get(this,i))||this.addEventListener(i,o),_.set(this,i,(e||0)+1)},trigger:function(){return Oe(this,r),!0},teardown:function(){var e;if(!m.documentMode)return!1;(e=_.get(this,i)-1)?_.set(this,i,e):(this.removeEventListener(i,o),_.remove(this,i))},_default:function(e){return _.get(e.target,r)},delegateType:i},ce.event.special[i]={setup:function(){var e=this.ownerDocument||this.document||this,t=m.documentMode?this:e,n=_.get(t,i);n||(m.documentMode?this.addEventListener(i,o):e.addEventListener(r,o,!0)),_.set(t,i,(n||0)+1)},teardown:function(){var e=this.ownerDocument||this.document||this,t=m.documentMode?this:e,n=_.get(t,i)-1;n?_.set(t,i,n):(m.documentMode?this.removeEventListener(i,o):e.removeEventListener(r,o,!0),_.remove(t,i))}}}),ce.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,i){ce.event.special[e]={delegateType:i,bindType:i,handle:function(e){var t,n=e.relatedTarget,r=e.handleObj;return n&&(n===this||ce.contains(this,n))||(e.type=r.origType,t=r.handler.apply(this,arguments),e.type=i),t}}}),ce.fn.extend({on:function(e,t,n,r){return je(this,e,t,n,r)},one:function(e,t,n,r){return je(this,e,t,n,r,1)},off:function(e,t,n){var r,i;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,ce(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"==typeof e){for(i in e)this.off(i,t,e[i]);return this}return!1!==t&&"function"!=typeof t||(n=t,t=void 0),!1===n&&(n=Le),this.each(function(){ce.event.remove(this,e,n,t)})}});var Pe=/<script|<style|<link/i,He=/checked\s*(?:[^=]|=\s*.checked.)/i,qe=/^\s*<!\[CDATA\[|\]\]>\s*$/g;function Re(e,t){return fe(e,"table")&&fe(11!==t.nodeType?t:t.firstChild,"tr")&&ce(e).children("tbody")[0]||e}function Me(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function Ie(e){return"true/"===(e.type||"").slice(0,5)?e.type=e.type.slice(5):e.removeAttribute("type"),e}function We(e,t){var n,r,i,o,a,s;if(1===t.nodeType){if(_.hasData(e)&&(s=_.get(e).events))for(i in _.remove(t,"handle events"),s)for(n=0,r=s[i].length;n<r;n++)ce.event.add(t,i,s[i][n]);z.hasData(e)&&(o=z.access(e),a=ce.extend({},o),z.set(t,a))}}function Be(n,r,i,o){r=g(r);var e,t,a,s,u,l,c=0,f=n.length,d=f-1,p=r[0],h=v(p);if(h||1<f&&"string"==typeof p&&!le.checkClone&&He.test(p))return n.each(function(e){var t=n.eq(e);h&&(r[0]=p.call(this,e,t.html())),Be(t,r,i,o)});if(f&&(t=(e=Ae(r,n[0].ownerDocument,!1,n,o)).firstChild,1===e.childNodes.length&&(e=t),t||o)){for(s=(a=ce.map(Ee(e,"script"),Me)).length;c<f;c++)u=e,c!==d&&(u=ce.clone(u,!0,!0),s&&ce.merge(a,Ee(u,"script"))),i.call(n[c],u,c);if(s)for(l=a[a.length-1].ownerDocument,ce.map(a,Ie),c=0;c<s;c++)u=a[c],Te.test(u.type||"")&&!_.access(u,"globalEval")&&ce.contains(l,u)&&(u.src&&"module"!==(u.type||"").toLowerCase()?ce._evalUrl&&!u.noModule&&ce._evalUrl(u.src,{nonce:u.nonce||u.getAttribute("nonce")},l):b(u.textContent.replace(qe,""),u,l))}return n}function Fe(e,t,n){for(var r,i=t?ce.filter(t,e):e,o=0;null!=(r=i[o]);o++)n||1!==r.nodeType||ce.cleanData(Ee(r)),r.parentNode&&(n&&J(r)&&ke(Ee(r,"script")),r.parentNode.removeChild(r));return e}ce.extend({htmlPrefilter:function(e){return e},clone:function(e,t,n){var r,i,o,a,s,u,l,c=e.cloneNode(!0),f=J(e);if(!(le.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||ce.isXMLDoc(e)))for(a=Ee(c),r=0,i=(o=Ee(e)).length;r<i;r++)s=o[r],u=a[r],void 0,"input"===(l=u.nodeName.toLowerCase())&&xe.test(s.type)?u.checked=s.checked:"input"!==l&&"textarea"!==l||(u.defaultValue=s.defaultValue);if(t)if(n)for(o=o||Ee(e),a=a||Ee(c),r=0,i=o.length;r<i;r++)We(o[r],a[r]);else We(e,c);return 0<(a=Ee(c,"script")).length&&ke(a,!f&&Ee(e,"script")),c},cleanData:function(e){for(var t,n,r,i=ce.event.special,o=0;void 0!==(n=e[o]);o++)if(F(n)){if(t=n[_.expando]){if(t.events)for(r in t.events)i[r]?ce.event.remove(n,r):ce.removeEvent(n,r,t.handle);n[_.expando]=void 0}n[z.expando]&&(n[z.expando]=void 0)}}}),ce.fn.extend({detach:function(e){return Fe(this,e,!0)},remove:function(e){return Fe(this,e)},text:function(e){return R(this,function(e){return void 0===e?ce.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)})},null,e,arguments.length)},append:function(){return Be(this,arguments,function(e){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||Re(this,e).appendChild(e)})},prepend:function(){return Be(this,arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=Re(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return Be(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return Be(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(ce.cleanData(Ee(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return ce.clone(this,e,t)})},html:function(e){return R(this,function(e){var t=this[0]||{},n=0,r=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!Pe.test(e)&&!Ce[(we.exec(e)||["",""])[1].toLowerCase()]){e=ce.htmlPrefilter(e);try{for(;n<r;n++)1===(t=this[n]||{}).nodeType&&(ce.cleanData(Ee(t,!1)),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var n=[];return Be(this,arguments,function(e){var t=this.parentNode;ce.inArray(this,n)<0&&(ce.cleanData(Ee(this)),t&&t.replaceChild(e,this))},n)}}),ce.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,a){ce.fn[e]=function(e){for(var t,n=[],r=ce(e),i=r.length-1,o=0;o<=i;o++)t=o===i?this:this.clone(!0),ce(r[o])[a](t),s.apply(n,t.get());return this.pushStack(n)}});var $e=new RegExp("^("+Q+")(?!px)[a-z%]+$","i"),_e=/^--/,ze=function(e){var t=e.ownerDocument.defaultView;return t&&t.opener||(t=ie),t.getComputedStyle(e)},Ue=function(e,t,n){var r,i,o={};for(i in t)o[i]=e.style[i],e.style[i]=t[i];for(i in r=n.call(e),t)e.style[i]=o[i];return r},Xe=new RegExp(G.join("|"),"i");function Ve(e,t,n){var r,i,o,a,s=_e.test(t),u=e.style;return(n=n||ze(e))&&(a=n.getPropertyValue(t)||n[t],s&&a&&(a=a.replace(ve,"$1")||void 0),""!==a||J(e)||(a=ce.style(e,t)),!le.pixelBoxStyles()&&$e.test(a)&&Xe.test(t)&&(r=u.width,i=u.minWidth,o=u.maxWidth,u.minWidth=u.maxWidth=u.width=a,a=n.width,u.width=r,u.minWidth=i,u.maxWidth=o)),void 0!==a?a+"":a}function Qe(e,t){return{get:function(){if(!e())return(this.get=t).apply(this,arguments);delete this.get}}}!function(){function e(){if(l){u.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",l.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",K.appendChild(u).appendChild(l);var e=ie.getComputedStyle(l);n="1%"!==e.top,s=12===t(e.marginLeft),l.style.right="60%",o=36===t(e.right),r=36===t(e.width),l.style.position="absolute",i=12===t(l.offsetWidth/3),K.removeChild(u),l=null}}function t(e){return Math.round(parseFloat(e))}var n,r,i,o,a,s,u=m.createElement("div"),l=m.createElement("div");l.style&&(l.style.backgroundClip="content-box",l.cloneNode(!0).style.backgroundClip="",le.clearCloneStyle="content-box"===l.style.backgroundClip,ce.extend(le,{boxSizingReliable:function(){return e(),r},pixelBoxStyles:function(){return e(),o},pixelPosition:function(){return e(),n},reliableMarginLeft:function(){return e(),s},scrollboxSize:function(){return e(),i},reliableTrDimensions:function(){var e,t,n,r;return null==a&&(e=m.createElement("table"),t=m.createElement("tr"),n=m.createElement("div"),e.style.cssText="position:absolute;left:-11111px;border-collapse:separate",t.style.cssText="border:1px solid",t.style.height="1px",n.style.height="9px",n.style.display="block",K.appendChild(e).appendChild(t).appendChild(n),r=ie.getComputedStyle(t),a=parseInt(r.height,10)+parseInt(r.borderTopWidth,10)+parseInt(r.borderBottomWidth,10)===t.offsetHeight,K.removeChild(e)),a}}))}();var Ye=["Webkit","Moz","ms"],Ge=m.createElement("div").style,Ke={};function Je(e){var t=ce.cssProps[e]||Ke[e];return t||(e in Ge?e:Ke[e]=function(e){var t=e[0].toUpperCase()+e.slice(1),n=Ye.length;while(n--)if((e=Ye[n]+t)in Ge)return e}(e)||e)}var Ze,et,tt=/^(none|table(?!-c[ea]).+)/,nt={position:"absolute",visibility:"hidden",display:"block"},rt={letterSpacing:"0",fontWeight:"400"};function it(e,t,n){var r=Y.exec(t);return r?Math.max(0,r[2]-(n||0))+(r[3]||"px"):t}function ot(e,t,n,r,i,o){var a="width"===t?1:0,s=0,u=0,l=0;if(n===(r?"border":"content"))return 0;for(;a<4;a+=2)"margin"===n&&(l+=ce.css(e,n+G[a],!0,i)),r?("content"===n&&(u-=ce.css(e,"padding"+G[a],!0,i)),"margin"!==n&&(u-=ce.css(e,"border"+G[a]+"Width",!0,i))):(u+=ce.css(e,"padding"+G[a],!0,i),"padding"!==n?u+=ce.css(e,"border"+G[a]+"Width",!0,i):s+=ce.css(e,"border"+G[a]+"Width",!0,i));return!r&&0<=o&&(u+=Math.max(0,Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-o-u-s-.5))||0),u+l}function at(e,t,n){var r=ze(e),i=(!le.boxSizingReliable()||n)&&"border-box"===ce.css(e,"boxSizing",!1,r),o=i,a=Ve(e,t,r),s="offset"+t[0].toUpperCase()+t.slice(1);if($e.test(a)){if(!n)return a;a="auto"}return(!le.boxSizingReliable()&&i||!le.reliableTrDimensions()&&fe(e,"tr")||"auto"===a||!parseFloat(a)&&"inline"===ce.css(e,"display",!1,r))&&e.getClientRects().length&&(i="border-box"===ce.css(e,"boxSizing",!1,r),(o=s in e)&&(a=e[s])),(a=parseFloat(a)||0)+ot(e,t,n||(i?"border":"content"),o,r,a)+"px"}ce.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Ve(e,"opacity");return""===n?"1":n}}}},cssNumber:{animationIterationCount:!0,aspectRatio:!0,borderImageSlice:!0,columnCount:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,scale:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeMiterlimit:!0,strokeOpacity:!0},cssProps:{},style:function(e,t,n,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var i,o,a,s=B(t),u=_e.test(t),l=e.style;if(u||(t=Je(s)),a=ce.cssHooks[t]||ce.cssHooks[s],void 0===n)return a&&"get"in a&&void 0!==(i=a.get(e,!1,r))?i:l[t];"string"===(o=typeof n)&&(i=Y.exec(n))&&i[1]&&(n=function(e,t,n,r){var i,o,a=20,s=r?function(){return r.cur()}:function(){return ce.css(e,t,"")},u=s(),l=n&&n[3]||(ce.cssNumber[t]?"":"px"),c=e.nodeType&&(ce.cssNumber[t]||"px"!==l&&+u)&&Y.exec(ce.css(e,t));if(c&&c[3]!==l){u/=2,l=l||c[3],c=+u||1;while(a--)ce.style(e,t,c+l),(1-o)*(1-(o=s()/u||.5))<=0&&(a=0),c/=o;c*=2,ce.style(e,t,c+l),n=n||[]}return n&&(c=+c||+u||0,i=n[1]?c+(n[1]+1)*n[2]:+n[2],r&&(r.unit=l,r.start=c,r.end=i)),i}(e,t,i),o="number"),null!=n&&n==n&&("number"!==o||u||(n+=i&&i[3]||(ce.cssNumber[s]?"":"px")),le.clearCloneStyle||""!==n||0!==t.indexOf("background")||(l[t]="inherit"),a&&"set"in a&&void 0===(n=a.set(e,n,r))||(u?l.setProperty(t,n):l[t]=n))}},css:function(e,t,n,r){var i,o,a,s=B(t);return _e.test(t)||(t=Je(s)),(a=ce.cssHooks[t]||ce.cssHooks[s])&&"get"in a&&(i=a.get(e,!0,n)),void 0===i&&(i=Ve(e,t,r)),"normal"===i&&t in rt&&(i=rt[t]),""===n||n?(o=parseFloat(i),!0===n||isFinite(o)?o||0:i):i}}),ce.each(["height","width"],function(e,u){ce.cssHooks[u]={get:function(e,t,n){if(t)return!tt.test(ce.css(e,"display"))||e.getClientRects().length&&e.getBoundingClientRect().width?at(e,u,n):Ue(e,nt,function(){return at(e,u,n)})},set:function(e,t,n){var r,i=ze(e),o=!le.scrollboxSize()&&"absolute"===i.position,a=(o||n)&&"border-box"===ce.css(e,"boxSizing",!1,i),s=n?ot(e,u,n,a,i):0;return a&&o&&(s-=Math.ceil(e["offset"+u[0].toUpperCase()+u.slice(1)]-parseFloat(i[u])-ot(e,u,"border",!1,i)-.5)),s&&(r=Y.exec(t))&&"px"!==(r[3]||"px")&&(e.style[u]=t,t=ce.css(e,u)),it(0,t,s)}}}),ce.cssHooks.marginLeft=Qe(le.reliableMarginLeft,function(e,t){if(t)return(parseFloat(Ve(e,"marginLeft"))||e.getBoundingClientRect().left-Ue(e,{marginLeft:0},function(){return e.getBoundingClientRect().left}))+"px"}),ce.each({margin:"",padding:"",border:"Width"},function(i,o){ce.cssHooks[i+o]={expand:function(e){for(var t=0,n={},r="string"==typeof e?e.split(" "):[e];t<4;t++)n[i+G[t]+o]=r[t]||r[t-2]||r[0];return n}},"margin"!==i&&(ce.cssHooks[i+o].set=it)}),ce.fn.extend({css:function(e,t){return R(this,function(e,t,n){var r,i,o={},a=0;if(Array.isArray(t)){for(r=ze(e),i=t.length;a<i;a++)o[t[a]]=ce.css(e,t[a],!1,r);return o}return void 0!==n?ce.style(e,t,n):ce.css(e,t)},e,t,1<arguments.length)}}),ce.fn.delay=function(r,e){return r=ce.fx&&ce.fx.speeds[r]||r,e=e||"fx",this.queue(e,function(e,t){var n=ie.setTimeout(e,r);t.stop=function(){ie.clearTimeout(n)}})},Ze=m.createElement("input"),et=m.createElement("select").appendChild(m.createElement("option")),Ze.type="checkbox",le.checkOn=""!==Ze.value,le.optSelected=et.selected,(Ze=m.createElement("input")).value="t",Ze.type="radio",le.radioValue="t"===Ze.value;var st,ut=ce.expr.attrHandle;ce.fn.extend({attr:function(e,t){return R(this,ce.attr,e,t,1<arguments.length)},removeAttr:function(e){return this.each(function(){ce.removeAttr(this,e)})}}),ce.extend({attr:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return"undefined"==typeof e.getAttribute?ce.prop(e,t,n):(1===o&&ce.isXMLDoc(e)||(i=ce.attrHooks[t.toLowerCase()]||(ce.expr.match.bool.test(t)?st:void 0)),void 0!==n?null===n?void ce.removeAttr(e,t):i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:(e.setAttribute(t,n+""),n):i&&"get"in i&&null!==(r=i.get(e,t))?r:null==(r=ce.find.attr(e,t))?void 0:r)},attrHooks:{type:{set:function(e,t){if(!le.radioValue&&"radio"===t&&fe(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},removeAttr:function(e,t){var n,r=0,i=t&&t.match(N);if(i&&1===e.nodeType)while(n=i[r++])e.removeAttribute(n)}}),st={set:function(e,t,n){return!1===t?ce.removeAttr(e,n):e.setAttribute(n,n),n}},ce.each(ce.expr.match.bool.source.match(/\w+/g),function(e,t){var a=ut[t]||ce.find.attr;ut[t]=function(e,t,n){var r,i,o=t.toLowerCase();return n||(i=ut[o],ut[o]=r,r=null!=a(e,t,n)?o:null,ut[o]=i),r}});var lt=/^(?:input|select|textarea|button)$/i,ct=/^(?:a|area)$/i;function ft(e){return(e.match(N)||[]).join(" ")}function dt(e){return e.getAttribute&&e.getAttribute("class")||""}function pt(e){return Array.isArray(e)?e:"string"==typeof e&&e.match(N)||[]}ce.fn.extend({prop:function(e,t){return R(this,ce.prop,e,t,1<arguments.length)},removeProp:function(e){return this.each(function(){delete this[ce.propFix[e]||e]})}}),ce.extend({prop:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return 1===o&&ce.isXMLDoc(e)||(t=ce.propFix[t]||t,i=ce.propHooks[t]),void 0!==n?i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:e[t]=n:i&&"get"in i&&null!==(r=i.get(e,t))?r:e[t]},propHooks:{tabIndex:{get:function(e){var t=ce.find.attr(e,"tabindex");return t?parseInt(t,10):lt.test(e.nodeName)||ct.test(e.nodeName)&&e.href?0:-1}}},propFix:{"for":"htmlFor","class":"className"}}),le.optSelected||(ce.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(e){var t=e.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),ce.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){ce.propFix[this.toLowerCase()]=this}),ce.fn.extend({addClass:function(t){var e,n,r,i,o,a;return v(t)?this.each(function(e){ce(this).addClass(t.call(this,e,dt(this)))}):(e=pt(t)).length?this.each(function(){if(r=dt(this),n=1===this.nodeType&&" "+ft(r)+" "){for(o=0;o<e.length;o++)i=e[o],n.indexOf(" "+i+" ")<0&&(n+=i+" ");a=ft(n),r!==a&&this.setAttribute("class",a)}}):this},removeClass:function(t){var e,n,r,i,o,a;return v(t)?this.each(function(e){ce(this).removeClass(t.call(this,e,dt(this)))}):arguments.length?(e=pt(t)).length?this.each(function(){if(r=dt(this),n=1===this.nodeType&&" "+ft(r)+" "){for(o=0;o<e.length;o++){i=e[o];while(-1<n.indexOf(" "+i+" "))n=n.replace(" "+i+" "," ")}a=ft(n),r!==a&&this.setAttribute("class",a)}}):this:this.attr("class","")},toggleClass:function(t,n){var e,r,i,o,a=typeof t,s="string"===a||Array.isArray(t);return v(t)?this.each(function(e){ce(this).toggleClass(t.call(this,e,dt(this),n),n)}):"boolean"==typeof n&&s?n?this.addClass(t):this.removeClass(t):(e=pt(t),this.each(function(){if(s)for(o=ce(this),i=0;i<e.length;i++)r=e[i],o.hasClass(r)?o.removeClass(r):o.addClass(r);else void 0!==t&&"boolean"!==a||((r=dt(this))&&_.set(this,"__className__",r),this.setAttribute&&this.setAttribute("class",r||!1===t?"":_.get(this,"__className__")||""))}))},hasClass:function(e){var t,n,r=0;t=" "+e+" ";while(n=this[r++])if(1===n.nodeType&&-1<(" "+ft(dt(n))+" ").indexOf(t))return!0;return!1}});var ht=/\r/g;ce.fn.extend({val:function(n){var r,e,i,t=this[0];return arguments.length?(i=v(n),this.each(function(e){var t;1===this.nodeType&&(null==(t=i?n.call(this,e,ce(this).val()):n)?t="":"number"==typeof t?t+="":Array.isArray(t)&&(t=ce.map(t,function(e){return null==e?"":e+""})),(r=ce.valHooks[this.type]||ce.valHooks[this.nodeName.toLowerCase()])&&"set"in r&&void 0!==r.set(this,t,"value")||(this.value=t))})):t?(r=ce.valHooks[t.type]||ce.valHooks[t.nodeName.toLowerCase()])&&"get"in r&&void 0!==(e=r.get(t,"value"))?e:"string"==typeof(e=t.value)?e.replace(ht,""):null==e?"":e:void 0}}),ce.extend({valHooks:{option:{get:function(e){var t=ce.find.attr(e,"value");return null!=t?t:ft(ce.text(e))}},select:{get:function(e){var t,n,r,i=e.options,o=e.selectedIndex,a="select-one"===e.type,s=a?null:[],u=a?o+1:i.length;for(r=o<0?u:a?o:0;r<u;r++)if(((n=i[r]).selected||r===o)&&!n.disabled&&(!n.parentNode.disabled||!fe(n.parentNode,"optgroup"))){if(t=ce(n).val(),a)return t;s.push(t)}return s},set:function(e,t){var n,r,i=e.options,o=ce.makeArray(t),a=i.length;while(a--)((r=i[a]).selected=-1<ce.inArray(ce.valHooks.option.get(r),o))&&(n=!0);return n||(e.selectedIndex=-1),o}}}}),ce.each(["radio","checkbox"],function(){ce.valHooks[this]={set:function(e,t){if(Array.isArray(t))return e.checked=-1<ce.inArray(ce(e).val(),t)}},le.checkOn||(ce.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})}),ce.parseXML=function(e){var t,n;if(!e||"string"!=typeof e)return null;try{t=(new ie.DOMParser).parseFromString(e,"text/xml")}catch(e){}return n=t&&t.getElementsByTagName("parsererror")[0],t&&!n||ce.error("Invalid XML: "+(n?ce.map(n.childNodes,function(e){return e.textContent}).join("\n"):e)),t};var gt=/^(?:focusinfocus|focusoutblur)$/,vt=function(e){e.stopPropagation()};ce.extend(ce.event,{trigger:function(e,t,n,r){var i,o,a,s,u,l,c,f,d=[n||m],p=ue.call(e,"type")?e.type:e,h=ue.call(e,"namespace")?e.namespace.split("."):[];if(o=f=a=n=n||m,3!==n.nodeType&&8!==n.nodeType&&!gt.test(p+ce.event.triggered)&&(-1<p.indexOf(".")&&(p=(h=p.split(".")).shift(),h.sort()),u=p.indexOf(":")<0&&"on"+p,(e=e[ce.expando]?e:new ce.Event(p,"object"==typeof e&&e)).isTrigger=r?2:3,e.namespace=h.join("."),e.rnamespace=e.namespace?new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=n),t=null==t?[e]:ce.makeArray(t,[e]),c=ce.event.special[p]||{},r||!c.trigger||!1!==c.trigger.apply(n,t))){if(!r&&!c.noBubble&&!y(n)){for(s=c.delegateType||p,gt.test(s+p)||(o=o.parentNode);o;o=o.parentNode)d.push(o),a=o;a===(n.ownerDocument||m)&&d.push(a.defaultView||a.parentWindow||ie)}i=0;while((o=d[i++])&&!e.isPropagationStopped())f=o,e.type=1<i?s:c.bindType||p,(l=(_.get(o,"events")||Object.create(null))[e.type]&&_.get(o,"handle"))&&l.apply(o,t),(l=u&&o[u])&&l.apply&&F(o)&&(e.result=l.apply(o,t),!1===e.result&&e.preventDefault());return e.type=p,r||e.isDefaultPrevented()||c._default&&!1!==c._default.apply(d.pop(),t)||!F(n)||u&&v(n[p])&&!y(n)&&((a=n[u])&&(n[u]=null),ce.event.triggered=p,e.isPropagationStopped()&&f.addEventListener(p,vt),n[p](),e.isPropagationStopped()&&f.removeEventListener(p,vt),ce.event.triggered=void 0,a&&(n[u]=a)),e.result}},simulate:function(e,t,n){var r=ce.extend(new ce.Event,n,{type:e,isSimulated:!0});ce.event.trigger(r,null,t)}}),ce.fn.extend({trigger:function(e,t){return this.each(function(){ce.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];if(n)return ce.event.trigger(e,t,n,!0)}});var yt,mt=/\[\]$/,bt=/\r?\n/g,xt=/^(?:submit|button|image|reset|file)$/i,wt=/^(?:input|select|textarea|keygen)/i;function Tt(n,e,r,i){var t;if(Array.isArray(e))ce.each(e,function(e,t){r||mt.test(n)?i(n,t):Tt(n+"["+("object"==typeof t&&null!=t?e:"")+"]",t,r,i)});else if(r||"object"!==x(e))i(n,e);else for(t in e)Tt(n+"["+t+"]",e[t],r,i)}ce.param=function(e,t){var n,r=[],i=function(e,t){var n=v(t)?t():t;r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==n?"":n)};if(null==e)return"";if(Array.isArray(e)||e.jquery&&!ce.isPlainObject(e))ce.each(e,function(){i(this.name,this.value)});else for(n in e)Tt(n,e[n],t,i);return r.join("&")},ce.fn.extend({serialize:function(){return ce.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=ce.prop(this,"elements");return e?ce.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!ce(this).is(":disabled")&&wt.test(this.nodeName)&&!xt.test(e)&&(this.checked||!xe.test(e))}).map(function(e,t){var n=ce(this).val();return null==n?null:Array.isArray(n)?ce.map(n,function(e){return{name:t.name,value:e.replace(bt,"\r\n")}}):{name:t.name,value:n.replace(bt,"\r\n")}}).get()}}),ce.fn.extend({wrapAll:function(e){var t;return this[0]&&(v(e)&&(e=e.call(this[0])),t=ce(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstElementChild)e=e.firstElementChild;return e}).append(this)),this},wrapInner:function(n){return v(n)?this.each(function(e){ce(this).wrapInner(n.call(this,e))}):this.each(function(){var e=ce(this),t=e.contents();t.length?t.wrapAll(n):e.append(n)})},wrap:function(t){var n=v(t);return this.each(function(e){ce(this).wrapAll(n?t.call(this,e):t)})},unwrap:function(e){return this.parent(e).not("body").each(function(){ce(this).replaceWith(this.childNodes)}),this}}),ce.expr.pseudos.hidden=function(e){return!ce.expr.pseudos.visible(e)},ce.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},le.createHTMLDocument=((yt=m.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===yt.childNodes.length),ce.parseHTML=function(e,t,n){return"string"!=typeof e?[]:("boolean"==typeof t&&(n=t,t=!1),t||(le.createHTMLDocument?((r=(t=m.implementation.createHTMLDocument("")).createElement("base")).href=m.location.href,t.head.appendChild(r)):t=m),o=!n&&[],(i=T.exec(e))?[t.createElement(i[1])]:(i=Ae([e],t,o),o&&o.length&&ce(o).remove(),ce.merge([],i.childNodes)));var r,i,o},ce.offset={setOffset:function(e,t,n){var r,i,o,a,s,u,l=ce.css(e,"position"),c=ce(e),f={};"static"===l&&(e.style.position="relative"),s=c.offset(),o=ce.css(e,"top"),u=ce.css(e,"left"),("absolute"===l||"fixed"===l)&&-1<(o+u).indexOf("auto")?(a=(r=c.position()).top,i=r.left):(a=parseFloat(o)||0,i=parseFloat(u)||0),v(t)&&(t=t.call(e,n,ce.extend({},s))),null!=t.top&&(f.top=t.top-s.top+a),null!=t.left&&(f.left=t.left-s.left+i),"using"in t?t.using.call(e,f):c.css(f)}},ce.fn.extend({offset:function(t){if(arguments.length)return void 0===t?this:this.each(function(e){ce.offset.setOffset(this,t,e)});var e,n,r=this[0];return r?r.getClientRects().length?(e=r.getBoundingClientRect(),n=r.ownerDocument.defaultView,{top:e.top+n.pageYOffset,left:e.left+n.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var e,t,n,r=this[0],i={top:0,left:0};if("fixed"===ce.css(r,"position"))t=r.getBoundingClientRect();else{t=this.offset(),n=r.ownerDocument,e=r.offsetParent||n.documentElement;while(e&&(e===n.body||e===n.documentElement)&&"static"===ce.css(e,"position"))e=e.parentNode;e&&e!==r&&1===e.nodeType&&((i=ce(e).offset()).top+=ce.css(e,"borderTopWidth",!0),i.left+=ce.css(e,"borderLeftWidth",!0))}return{top:t.top-i.top-ce.css(r,"marginTop",!0),left:t.left-i.left-ce.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var e=this.offsetParent;while(e&&"static"===ce.css(e,"position"))e=e.offsetParent;return e||K})}}),ce.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(t,i){var o="pageYOffset"===i;ce.fn[t]=function(e){return R(this,function(e,t,n){var r;if(y(e)?r=e:9===e.nodeType&&(r=e.defaultView),void 0===n)return r?r[i]:e[t];r?r.scrollTo(o?r.pageXOffset:n,o?n:r.pageYOffset):e[t]=n},t,e,arguments.length)}}),ce.each(["top","left"],function(e,n){ce.cssHooks[n]=Qe(le.pixelPosition,function(e,t){if(t)return t=Ve(e,n),$e.test(t)?ce(e).position()[n]+"px":t})}),ce.each({Height:"height",Width:"width"},function(a,s){ce.each({padding:"inner"+a,content:s,"":"outer"+a},function(r,o){ce.fn[o]=function(e,t){var n=arguments.length&&(r||"boolean"!=typeof e),i=r||(!0===e||!0===t?"margin":"border");return R(this,function(e,t,n){var r;return y(e)?0===o.indexOf("outer")?e["inner"+a]:e.document.documentElement["client"+a]:9===e.nodeType?(r=e.documentElement,Math.max(e.body["scroll"+a],r["scroll"+a],e.body["offset"+a],r["offset"+a],r["client"+a])):void 0===n?ce.css(e,t,i):ce.style(e,t,n,i)},s,n?e:void 0,n)}})}),ce.fn.extend({bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)},hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),ce.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(e,n){ce.fn[n]=function(e,t){return 0<arguments.length?this.on(n,null,e,t):this.trigger(n)}});var Ct=/^[\s\uFEFF\xA0]+|([^\s\uFEFF\xA0])[\s\uFEFF\xA0]+$/g;ce.proxy=function(e,t){var n,r,i;if("string"==typeof t&&(n=e[t],t=e,e=n),v(e))return r=ae.call(arguments,2),(i=function(){return e.apply(t||this,r.concat(ae.call(arguments)))}).guid=e.guid=e.guid||ce.guid++,i},ce.holdReady=function(e){e?ce.readyWait++:ce.ready(!0)},ce.isArray=Array.isArray,ce.parseJSON=JSON.parse,ce.nodeName=fe,ce.isFunction=v,ce.isWindow=y,ce.camelCase=B,ce.type=x,ce.now=Date.now,ce.isNumeric=function(e){var t=ce.type(e);return("number"===t||"string"===t)&&!isNaN(e-parseFloat(e))},ce.trim=function(e){return null==e?"":(e+"").replace(Ct,"$1")},"function"==typeof define&&define.amd&&define("jquery",[],function(){return ce});var Et=ie.jQuery,kt=ie.$;return ce.noConflict=function(e){return ie.$===ce&&(ie.$=kt),e&&ie.jQuery===ce&&(ie.jQuery=Et),ce},"undefined"==typeof e&&(ie.jQuery=ie.$=ce),ce});

(()=>{var e={253:e=>{var t;self,t=()=>(()=>{"use strict";var e={57:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},66:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getAuthToken=t.isLoggedIn=t.getGamertag=void 0,t.buildMsaLogoutUrl=f,t.getLoginUrl=function(e,t,n){const r=new URL(`/${e}/login`,window.location.origin);t&&(r.search=new URLSearchParams([["return_url",t]]).toString());const o=new URLSearchParams([["state",n?"signup":"login"],["cobrandId","8058f65d-ce06-4c30-9559-473c9275a65d"],["tid","896928775"],["ru",r.toString()],["aid","1142970254"],["as","1"]]);return n&&o.append("signup","1"),`https://sisu.xboxlive.com/connect/XboxLive/?${o.toString()}`},t.logout=async function(e,t){let n;window.localStorage&&null!==window.localStorage&&(n=window.localStorage.getItem("LoginType")),C();const r=await g(),i=r.getActiveAccount();if(i){const n=e??"prod",a={account:i,mainWindowRedirectUri:o.msaAuthRedirectDomain[n],postLogoutRedirectUri:t??k(n)};r.logoutPopup(a)}else if("MSA"!==n&&void 0!==n)window.location.href="/";else{const e=window,t=f(e.sharedEnvConfig,e.msaUtilsConfig);window.location.href=t}},t.trySilentLogin=async function(e,t){return await w(e,!0,t)},t.login=async function(e,t){return await w(e,!1,t)},t.refreshXboxRPTokens=I,t.refreshMCToken=T,t.refreshBearerToken=A;const r=n(352),o=n(604),i=n(190),a=n(201),s=n(736),c=n(453),l=n(330),u=n(784);let d,h=null;async function g(){return d||(h||(h=a.createStandardPublicClientApplication(o.msalConfig)),d=await h),d}function p(e,t,n){const r=function(e){let t;return e&&"undefined"!==e.environmentName&&""!==e.environmentName&&(t=e.environmentName),t}(n);let o;if(t)o=new URL(t),r&&o.searchParams.set("env",r);else{const e=window.location.pathname.split("/");o=new URL(window.location.origin+"/"+e[1])}const i=new URL(`${e}signout`);return i.searchParams.set("state","logout"),i.searchParams.set("ru",o.toString()),i}function f(e,t){let n,r,o;return e?(n=new URL(e["endpoint.msaOAuthUrl"]),o=p(e["endpoint.xboxOAuthUrl"],e["url.xboxLogoutReturnUrl"],t)):(n=new URL("https://login.live.com/oauth20_logout.srf"),o=p("https://sisu.xboxlive.com/connect/oauth/XboxLive/","",t)),r=t&&t.xboxMSAClientId?t.xboxMSAClientId:"ca634a9a-f102-4033-b081-3a4393a6f65d",n.searchParams.set("client_id",r),n.searchParams.set("redirect_uri",o.toString()),n.toString()}const m="session_username",y=e=>{let t=null;const n=document.cookie.split("; ").filter(t=>t.startsWith(`${e}=`));return n.length>=1&&(t=n[0].split("=")[1]),t};t.getGamertag=()=>{const e=y(m),t=localStorage.getItem(m);return e||t};const v=e=>{switch(e){case r.MinecraftAuthToken.Bearer:{const t=y(e),n=window.localStorage.getItem(e);return t||n}case r.MinecraftAuthToken.MCToken:try{const e=window.localStorage.getItem(r.MinecraftAuthToken.MCToken),t=v(r.MinecraftAuthToken.PlayFab);if(null!==e&&null!==t){const{mcToken:n,playFabXBL:o}=JSON.parse(e);if(t===o)return n.replaceAll(`${r.MinecraftAuthToken.MCToken} `,"")}}catch(e){console.error(e)}break;case r.MinecraftAuthToken.PlayFab:case r.MinecraftAuthToken.Xbox:case r.MinecraftAuthToken.Realms:case r.MinecraftAuthToken.Marketplace:case r.MinecraftAuthToken.MCServices:return window.localStorage.getItem(e)}return null};t.isLoggedIn=()=>{const e=window.localStorage.getItem(r.MinecraftAuthToken.Expiration);if(!e)return!1;if(new Date>new Date(e))return!1;if(!(0,t.getGamertag)())return!1;const n=v(r.MinecraftAuthToken.MCToken);if(!n)return!1;try{const{exp:e}=JSON.parse(atob(n.split(".")[1]));if(e<(new Date).getTime()/1e3)return!1}catch{return!1}return!0};const C=()=>{window.localStorage&&null!==window.localStorage&&(Object.entries(r.MinecraftAuthToken).forEach(e=>{window.localStorage.removeItem(e[1])}),window.localStorage.removeItem("LoginType"),window.localStorage.removeItem("IsNewProfileEnabled"),window.localStorage.removeItem("flights"),window.localStorage.removeItem(m)),[r.MinecraftAuthToken.Bearer,r.MinecraftAuthToken.Access,m].forEach(function(e){document.cookie=`${e}=; expires=${new Date(0).toUTCString()}; domain=.minecraft.net; path=/`})};async function w(e,t,n){const r=await async function(e,t){const n=await g(),r=n.getAllAccounts();let i={redirectUri:k(e),scopes:o.msalScopes};if(0===r.length){const r={scopes:o.msalScopes,prompt:"none"};try{const e=await n.ssoSilent(r);return n.setActiveAccount(e.account),e.accessToken}catch(e){if(!t)return await S(i)}}else if(1===r.length)try{const e=await n.acquireTokenSilent({scopes:o.msalScopes,account:r[0]});return n.setActiveAccount(e.account),e.accessToken}catch(e){if(!t)return await S(i)}else if(!t)return i={...i,prompt:"select_account"},await S(i);return null}(e,t);if(!r)return!1;const i=(await async function(e,t){const n={Properties:{AuthMethod:"RPS",SiteName:"user.auth.xboxlive.com",RpsTicket:`d=${e}`},RelyingParty:"http://auth.xboxlive.com",TokenType:"JWT"},r=new URL("https://user.auth.xboxlive.com/user/authenticate"),{data:o,error:i}=await(0,s.postRequest)({application:t,url:r.toString(),headers:{"Content-Type":"application/json"},name:"GetXboxUserToken",payload:JSON.stringify(n)});return!i&&o?o:null}(r,n))?.Token;return!!i&&!!await I(i,n,e)&&!(await Promise.allSettled([T(e,n),A(e,n)])).some(e=>"rejected"===e.status||!e.value)}async function I(e,t,n){const i=[];for(const[r]of Object.entries(o.RelyingPartyURLs))i.push(b(e,r,t,n));const a=await Promise.allSettled(i);let s=new Date;return s.setDate(s.getDate()+365),!a.some(e=>"rejected"===e.status||!e.value.tokenData)&&(a.forEach(e=>{if("fulfilled"===e.status){const{rp:t,tokenData:n}=e.value;if(n){"XboxLive"==t&&localStorage.setItem(m,n.DisplayClaims.xui[0].gtg),localStorage.setItem(o.RelyingPartyLocalStorageKeys[t],`XBL3.0 x=${n.DisplayClaims.xui[0].uhs};${n.Token}`);const e=new Date(n.NotAfter);(!s||e<s)&&(s=e)}}}),localStorage.setItem(r.MinecraftAuthToken.Expiration,s.toISOString()),!0)}async function T(e,t){const n=v(r.MinecraftAuthToken.PlayFab),a=await(0,i.getDiscoverableService)("auth",e),u=new URL("/api/v1.0/session/start",a).toString();if(n){const i=await async function(e,t,n,r){const o={device:{applicationType:"MinecraftPE",gameVersion:"1.21.7",id:(0,l.v4)(),memory:"1024",platform:(0,c.getPlatform)(navigator.userAgent),storePlatform:"uwp.store",type:(0,c.getPlatform)(navigator.userAgent),treatmentOverrides:[],playFabTitleId:n},user:{tokenType:"Xbox",token:e}},{data:i,error:a}=await(0,s.postRequest)({application:r,url:t,headers:{"Content-Type":"application/json","x-xbl-contract-version":"2"},name:"GetPlayFabAuth",payload:JSON.stringify(o)});return!a&&i?i.result.authorizationHeader:null}(n,u,"prod"===e?o.ProdPlayfabTitleId:o.PPEPlayfabTitleId,t);if(i)return localStorage.setItem(r.MinecraftAuthToken.MCToken,JSON.stringify({mcToken:i,playFabXBL:n})),!0}return!1}async function A(e,t){const n=v(r.MinecraftAuthToken.MCServices);if(n){const o=await async function(e,t,n){const r=new URL("authentication/login_with_xbox","prod"==t?"https://api.minecraftservices.com/":"https://api-staging.minecraftservices.com/"),o={ensureensureLegacyEnabled:!0,platform:"WEB",identityToken:e},{data:i,error:a}=await(0,s.postRequest)({url:r.toString(),payload:JSON.stringify(o),name:"LoginWithXbox",application:n});return!a&&i?i.access_token:null}(n,e,t);if(o)return localStorage.setItem(r.MinecraftAuthToken.Bearer,o),!0}return!1}function k(e){return new URL("/auth/msa/blank.html",o.msaAuthRedirectDomain[e]).toString()}async function S(e){const t=await g();try{const n=await t.acquireTokenPopup(e);return t.setActiveAccount(n.account),n.accessToken}catch(e){return(0,u.trackMSAAuthError)(e),null}}async function b(e,t,n,r,i="RETAIL"){let a=o.RelyingPartyURLs[t];"prod"!==r&&"BedrockRealms"===t&&(a=o.PPEBedrockRealmsRelyingPartyUrl);const c={RelyingParty:a,TokenType:"JWT",Properties:{SandboxId:i,UserTokens:[e]}},l=new URL("https://xsts.auth.xboxlive.com/xsts/authorize"),{data:u,error:d}=await(0,s.postRequest)({application:n,url:l.toString(),headers:{"Content-Type":"application/json"},name:`GetXboxRPToken_${t}`,payload:JSON.stringify(c)});let h;return!d&&u&&(h=u),{rp:t,tokenData:h}}t.getAuthToken=e=>(0,t.isLoggedIn)()?v(e):(C(),null)},107:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.DISABLE_ALL_FLIGHTS_PARAM=t.DISABLE_FLIGHTS_URL_PARAM=t.ENABLE_FLIGHTS_URL_PARAM=t.Category=void 0,function(e){e.Marketplace="Marketplace",e.Game="Game",e.News="News",e.Community="Community",e.Support="Support"}(n||(t.Category=n={})),t.ENABLE_FLIGHTS_URL_PARAM="enableflights",t.DISABLE_FLIGHTS_URL_PARAM="disableflights",t.DISABLE_ALL_FLIGHTS_PARAM="disableallflights"},148:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FallbackDiscoverableServices=void 0,t.FallbackDiscoverableServices={auth:"https://authorization.franchise.minecraft-services.net",entitlements:"https://entitlements.mktpl.minecraft-services.net",realms_frontend_bedrock_legacy:"https://bedrock.frontendlegacy.realms.minecraft-services.net",realms_frontend_java_legacy:"https://java.frontendlegacy.realms.minecraft-services.net",store:"https://store.mktpl.minecraft-services.net",persona:"https://persona-secondary.franchise.minecraft-services.net"}},184:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},190:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getDiscoverableService=async function(e,t){if("local"===t)return"https://local.minecraft.net";if(!i[e]){const n="prod"===t?"https://client.discovery.minecraft-services.net":"https://client.stage-b4c666a2.discovery.minecraft-services.net";a||(a=(0,r.getRequest)({url:new URL("/api/v1.0/discovery/web/builds/1.0.0.0",n).toString(),name:"GetDiscoverableServices",application:""}));const{data:o,error:s}=await a;if(o&&!s)try{Object.keys(i).forEach(e=>{const n=e;let r=o.result.serviceEnvironments[n][t].serviceUri;r||"dev"!==t||(r=o.result.serviceEnvironments[n].stage.serviceUri),i[n]=r})}catch(e){}}return i[e]||o.FallbackDiscoverableServices[e]};const r=n(736),o=n(148),i={auth:null,store:null,realms_frontend_bedrock_legacy:null,realms_frontend_java_legacy:null,entitlements:null,persona:null};let a=null},201:(e,t)=>{const n={LIBRARY_NAME:"MSAL.JS",SKU:"msal.js.common",DEFAULT_AUTHORITY:"https://login.microsoftonline.com/common/",DEFAULT_AUTHORITY_HOST:"login.microsoftonline.com",DEFAULT_COMMON_TENANT:"common",ADFS:"adfs",DSTS:"dstsv2",AAD_INSTANCE_DISCOVERY_ENDPT:"https://login.microsoftonline.com/common/discovery/instance?api-version=1.1&authorization_endpoint=",CIAM_AUTH_URL:".ciamlogin.com",AAD_TENANT_DOMAIN_SUFFIX:".onmicrosoft.com",RESOURCE_DELIM:"|",NO_ACCOUNT:"NO_ACCOUNT",CLAIMS:"claims",CONSUMER_UTID:"9188040d-6c67-4c5b-b112-36a304b66dad",OPENID_SCOPE:"openid",PROFILE_SCOPE:"profile",OFFLINE_ACCESS_SCOPE:"offline_access",EMAIL_SCOPE:"email",CODE_GRANT_TYPE:"authorization_code",RT_GRANT_TYPE:"refresh_token",S256_CODE_CHALLENGE_METHOD:"S256",URL_FORM_CONTENT_TYPE:"application/x-www-form-urlencoded;charset=utf-8",AUTHORIZATION_PENDING:"authorization_pending",NOT_DEFINED:"not_defined",EMPTY_STRING:"",NOT_APPLICABLE:"N/A",NOT_AVAILABLE:"Not Available",FORWARD_SLASH:"/",IMDS_ENDPOINT:"http://169.254.169.254/metadata/instance/compute/location",IMDS_VERSION:"2020-06-01",IMDS_TIMEOUT:2e3,AZURE_REGION_AUTO_DISCOVER_FLAG:"TryAutoDetect",REGIONAL_AUTH_PUBLIC_CLOUD_SUFFIX:"login.microsoft.com",KNOWN_PUBLIC_CLOUDS:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"],SHR_NONCE_VALIDITY:240,INVALID_INSTANCE:"invalid_instance"},r="POST",o=[n.OPENID_SCOPE,n.PROFILE_SCOPE,n.OFFLINE_ACCESS_SCOPE],i=[...o,n.EMAIL_SCOPE],a="Content-Type",s="Retry-After",c="X-AnchorMailbox",l="x-ms-request-id",u="x-ms-httpver",d="active-account-filters",h="common",g="organizations",p="consumers",f="access_token",m={LOGIN:"login",SELECT_ACCOUNT:"select_account",CONSENT:"consent",NONE:"none",CREATE:"create",NO_SESSION:"no_session"},y="code",v={QUERY:"query",FRAGMENT:"fragment"},C="Generic",w={ID_TOKEN:"IdToken",ACCESS_TOKEN:"AccessToken",ACCESS_TOKEN_WITH_AUTH_SCHEME:"AccessToken_With_AuthScheme",REFRESH_TOKEN:"RefreshToken"},I="appmetadata",T="1",A="authority-metadata",k="config",S="cache",b="network",R="hardcoded_values",E={SCHEMA_VERSION:5,MAX_LAST_HEADER_BYTES:330,MAX_CACHED_ERRORS:50,CACHE_KEY:"server-telemetry",CATEGORY_SEPARATOR:"|",VALUE_SEPARATOR:",",OVERFLOW_TRUE:"1",OVERFLOW_FALSE:"0",UNKNOWN_ERROR:"unknown_error"},P={BEARER:"Bearer",POP:"pop",SSH:"ssh-cert"},_="throttling",M={Jwt:"JWT",Jwk:"JWK",Pop:"pop"},O="unexpected_error",N="post_request_failed";var q=Object.freeze({__proto__:null,postRequestFailed:N,unexpectedError:O});const L={[O]:"Unexpected error in authentication.",[N]:"Post request failed from the network, could be a 4xx/5xx or a network unavailability. Please check the exact error code for details."},x={unexpectedError:{code:O,desc:L[O]},postRequestFailed:{code:N,desc:L[N]}};class U extends Error{constructor(e,t,r){super(t?`${e}: ${t}`:e),Object.setPrototypeOf(this,U.prototype),this.errorCode=e||n.EMPTY_STRING,this.errorMessage=t||n.EMPTY_STRING,this.subError=r||n.EMPTY_STRING,this.name="AuthError"}setCorrelationId(e){this.correlationId=e}}function D(e,t){return new U(e,t?`${L[e]} ${t}`:L[e])}const B="client_info_decoding_error",H="client_info_empty_error",F="token_parsing_error",z="null_or_empty_token",K="endpoints_resolution_error",$="network_error",G="openid_config_error",j="hash_not_deserialized",W="invalid_state",V="state_mismatch",Q="state_not_found",J="nonce_mismatch",Y="auth_time_not_found",X="max_age_transpired",Z="multiple_matching_tokens",ee="multiple_matching_accounts",te="multiple_matching_appMetadata",ne="request_cannot_be_made",re="cannot_remove_empty_scope",oe="cannot_append_scopeset",ie="empty_input_scopeset",ae="device_code_polling_cancelled",se="device_code_expired",ce="device_code_unknown_error",le="no_account_in_silent_request",ue="invalid_cache_record",de="invalid_cache_environment",he="no_account_found",ge="no_crypto_object",pe="unexpected_credential_type",fe="invalid_assertion",me="invalid_client_credential",ye="token_refresh_required",ve="user_timeout_reached",Ce="token_claims_cnf_required_for_signedjwt",we="authorization_code_missing_from_server_response",Ie="binding_key_not_removed",Te="end_session_endpoint_not_supported",Ae="key_id_missing",ke="no_network_connectivity",Se="user_canceled",be="missing_tenant_id_error",Re="method_not_implemented",Ee="nested_app_auth_bridge_disabled";var Pe=Object.freeze({__proto__:null,authTimeNotFound:Y,authorizationCodeMissingFromServerResponse:we,bindingKeyNotRemoved:Ie,cannotAppendScopeSet:oe,cannotRemoveEmptyScope:re,clientInfoDecodingError:B,clientInfoEmptyError:H,deviceCodeExpired:se,deviceCodePollingCancelled:ae,deviceCodeUnknownError:ce,emptyInputScopeSet:ie,endSessionEndpointNotSupported:Te,endpointResolutionError:K,hashNotDeserialized:j,invalidAssertion:fe,invalidCacheEnvironment:de,invalidCacheRecord:ue,invalidClientCredential:me,invalidState:W,keyIdMissing:Ae,maxAgeTranspired:X,methodNotImplemented:Re,missingTenantIdError:be,multipleMatchingAccounts:ee,multipleMatchingAppMetadata:te,multipleMatchingTokens:Z,nestedAppAuthBridgeDisabled:Ee,networkError:$,noAccountFound:he,noAccountInSilentRequest:le,noCryptoObject:ge,noNetworkConnectivity:ke,nonceMismatch:J,nullOrEmptyToken:z,openIdConfigError:G,requestCannotBeMade:ne,stateMismatch:V,stateNotFound:Q,tokenClaimsCnfRequiredForSignedJwt:Ce,tokenParsingError:F,tokenRefreshRequired:ye,unexpectedCredentialType:pe,userCanceled:Se,userTimeoutReached:ve});const _e={[B]:"The client info could not be parsed/decoded correctly",[H]:"The client info was empty",[F]:"Token cannot be parsed",[z]:"The token is null or empty",[K]:"Endpoints cannot be resolved",[$]:"Network request failed",[G]:"Could not retrieve endpoints. Check your authority and verify the .well-known/openid-configuration endpoint returns the required endpoints.",[j]:"The hash parameters could not be deserialized",[W]:"State was not the expected format",[V]:"State mismatch error",[Q]:"State not found",[J]:"Nonce mismatch error",[Y]:"Max Age was requested and the ID token is missing the auth_time variable. auth_time is an optional claim and is not enabled by default - it must be enabled. See https://aka.ms/msaljs/optional-claims for more information.",[X]:"Max Age is set to 0, or too much time has elapsed since the last end-user authentication.",[Z]:"The cache contains multiple tokens satisfying the requirements. Call AcquireToken again providing more requirements such as authority or account.",[ee]:"The cache contains multiple accounts satisfying the given parameters. Please pass more info to obtain the correct account",[te]:"The cache contains multiple appMetadata satisfying the given parameters. Please pass more info to obtain the correct appMetadata",[ne]:"Token request cannot be made without authorization code or refresh token.",[re]:"Cannot remove null or empty scope from ScopeSet",[oe]:"Cannot append ScopeSet",[ie]:"Empty input ScopeSet cannot be processed",[ae]:"Caller has cancelled token endpoint polling during device code flow by setting DeviceCodeRequest.cancel = true.",[se]:"Device code is expired.",[ce]:"Device code stopped polling for unknown reasons.",[le]:"Please pass an account object, silent flow is not supported without account information",[ue]:"Cache record object was null or undefined.",[de]:"Invalid environment when attempting to create cache entry",[he]:"No account found in cache for given key.",[ge]:"No crypto object detected.",[pe]:"Unexpected credential type.",[fe]:"Client assertion must meet requirements described in https://tools.ietf.org/html/rfc7515",[me]:"Client credential (secret, certificate, or assertion) must not be empty when creating a confidential client. An application should at most have one credential",[ye]:"Cannot return token from cache because it must be refreshed. This may be due to one of the following reasons: forceRefresh parameter is set to true, claims have been requested, there is no cached access token or it is expired.",[ve]:"User defined timeout for device code polling reached",[Ce]:"Cannot generate a POP jwt if the token_claims are not populated",[we]:"Server response does not contain an authorization code to proceed",[Ie]:"Could not remove the credential's binding key from storage.",[Te]:"The provided authority does not support logout",[Ae]:"A keyId value is missing from the requested bound token's cache record and is required to match the token to it's stored binding key.",[ke]:"No network connectivity. Check your internet connection.",[Se]:"User cancelled the flow.",[be]:"A tenant id - not common, organizations, or consumers - must be specified when using the client_credentials flow.",[Re]:"This method has not been implemented",[Ee]:"The nested app auth bridge is disabled"},Me={clientInfoDecodingError:{code:B,desc:_e[B]},clientInfoEmptyError:{code:H,desc:_e[H]},tokenParsingError:{code:F,desc:_e[F]},nullOrEmptyToken:{code:z,desc:_e[z]},endpointResolutionError:{code:K,desc:_e[K]},networkError:{code:$,desc:_e[$]},unableToGetOpenidConfigError:{code:G,desc:_e[G]},hashNotDeserialized:{code:j,desc:_e[j]},invalidStateError:{code:W,desc:_e[W]},stateMismatchError:{code:V,desc:_e[V]},stateNotFoundError:{code:Q,desc:_e[Q]},nonceMismatchError:{code:J,desc:_e[J]},authTimeNotFoundError:{code:Y,desc:_e[Y]},maxAgeTranspired:{code:X,desc:_e[X]},multipleMatchingTokens:{code:Z,desc:_e[Z]},multipleMatchingAccounts:{code:ee,desc:_e[ee]},multipleMatchingAppMetadata:{code:te,desc:_e[te]},tokenRequestCannotBeMade:{code:ne,desc:_e[ne]},removeEmptyScopeError:{code:re,desc:_e[re]},appendScopeSetError:{code:oe,desc:_e[oe]},emptyInputScopeSetError:{code:ie,desc:_e[ie]},DeviceCodePollingCancelled:{code:ae,desc:_e[ae]},DeviceCodeExpired:{code:se,desc:_e[se]},DeviceCodeUnknownError:{code:ce,desc:_e[ce]},NoAccountInSilentRequest:{code:le,desc:_e[le]},invalidCacheRecord:{code:ue,desc:_e[ue]},invalidCacheEnvironment:{code:de,desc:_e[de]},noAccountFound:{code:he,desc:_e[he]},noCryptoObj:{code:ge,desc:_e[ge]},unexpectedCredentialType:{code:pe,desc:_e[pe]},invalidAssertion:{code:fe,desc:_e[fe]},invalidClientCredential:{code:me,desc:_e[me]},tokenRefreshRequired:{code:ye,desc:_e[ye]},userTimeoutReached:{code:ve,desc:_e[ve]},tokenClaimsRequired:{code:Ce,desc:_e[Ce]},noAuthorizationCodeFromServer:{code:we,desc:_e[we]},bindingKeyNotRemovedError:{code:Ie,desc:_e[Ie]},logoutNotSupported:{code:Te,desc:_e[Te]},keyIdMissing:{code:Ae,desc:_e[Ae]},noNetworkConnectivity:{code:ke,desc:_e[ke]},userCanceledError:{code:Se,desc:_e[Se]},missingTenantIdError:{code:be,desc:_e[be]},nestedAppAuthBridgeDisabled:{code:Ee,desc:_e[Ee]}};class Oe extends U{constructor(e,t){super(e,t?`${_e[e]}: ${t}`:_e[e]),this.name="ClientAuthError",Object.setPrototypeOf(this,Oe.prototype)}}function Ne(e,t){return new Oe(e,t)}const qe={createNewGuid:()=>{throw Ne(Re)},base64Decode:()=>{throw Ne(Re)},base64Encode:()=>{throw Ne(Re)},base64UrlEncode:()=>{throw Ne(Re)},encodeKid:()=>{throw Ne(Re)},async getPublicKeyThumbprint(){throw Ne(Re)},async removeTokenBindingKey(){throw Ne(Re)},async clearKeystore(){throw Ne(Re)},async signJwt(){throw Ne(Re)},async hashString(){throw Ne(Re)}};var Le;t.LogLevel=void 0,(Le=t.LogLevel||(t.LogLevel={}))[Le.Error=0]="Error",Le[Le.Warning=1]="Warning",Le[Le.Info=2]="Info",Le[Le.Verbose=3]="Verbose",Le[Le.Trace=4]="Trace";class xe{constructor(e,r,o){this.level=t.LogLevel.Info;const i=e||xe.createDefaultLoggerOptions();this.localCallback=i.loggerCallback||(()=>{}),this.piiLoggingEnabled=i.piiLoggingEnabled||!1,this.level="number"==typeof i.logLevel?i.logLevel:t.LogLevel.Info,this.correlationId=i.correlationId||n.EMPTY_STRING,this.packageName=r||n.EMPTY_STRING,this.packageVersion=o||n.EMPTY_STRING}static createDefaultLoggerOptions(){return{loggerCallback:()=>{},piiLoggingEnabled:!1,logLevel:t.LogLevel.Info}}clone(e,t,n){return new xe({loggerCallback:this.localCallback,piiLoggingEnabled:this.piiLoggingEnabled,logLevel:this.level,correlationId:n||this.correlationId},e,t)}logMessage(e,n){if(n.logLevel>this.level||!this.piiLoggingEnabled&&n.containsPii)return;const r=`[${(new Date).toUTCString()}] : [${n.correlationId||this.correlationId||""}] : ${this.packageName}@${this.packageVersion} : ${t.LogLevel[n.logLevel]} - ${e}`;this.executeCallback(n.logLevel,r,n.containsPii||!1)}executeCallback(e,t,n){this.localCallback&&this.localCallback(e,t,n)}error(e,r){this.logMessage(e,{logLevel:t.LogLevel.Error,containsPii:!1,correlationId:r||n.EMPTY_STRING})}errorPii(e,r){this.logMessage(e,{logLevel:t.LogLevel.Error,containsPii:!0,correlationId:r||n.EMPTY_STRING})}warning(e,r){this.logMessage(e,{logLevel:t.LogLevel.Warning,containsPii:!1,correlationId:r||n.EMPTY_STRING})}warningPii(e,r){this.logMessage(e,{logLevel:t.LogLevel.Warning,containsPii:!0,correlationId:r||n.EMPTY_STRING})}info(e,r){this.logMessage(e,{logLevel:t.LogLevel.Info,containsPii:!1,correlationId:r||n.EMPTY_STRING})}infoPii(e,r){this.logMessage(e,{logLevel:t.LogLevel.Info,containsPii:!0,correlationId:r||n.EMPTY_STRING})}verbose(e,r){this.logMessage(e,{logLevel:t.LogLevel.Verbose,containsPii:!1,correlationId:r||n.EMPTY_STRING})}verbosePii(e,r){this.logMessage(e,{logLevel:t.LogLevel.Verbose,containsPii:!0,correlationId:r||n.EMPTY_STRING})}trace(e,r){this.logMessage(e,{logLevel:t.LogLevel.Trace,containsPii:!1,correlationId:r||n.EMPTY_STRING})}tracePii(e,r){this.logMessage(e,{logLevel:t.LogLevel.Trace,containsPii:!0,correlationId:r||n.EMPTY_STRING})}isPiiLoggingEnabled(){return this.piiLoggingEnabled||!1}}const Ue="@azure/msal-common",De="15.13.1",Be={None:"none",AzurePublic:"https://login.microsoftonline.com",AzurePpe:"https://login.windows-ppe.net",AzureChina:"https://login.chinacloudapi.cn",AzureGermany:"https://login.microsoftonline.de",AzureUsGovernment:"https://login.microsoftonline.us"},He="redirect_uri_empty",Fe="claims_request_parsing_error",ze="authority_uri_insecure",Ke="url_parse_error",$e="empty_url_error",Ge="empty_input_scopes_error",je="invalid_claims",We="token_request_empty",Ve="logout_request_empty",Qe="invalid_code_challenge_method",Je="pkce_params_missing",Ye="invalid_cloud_discovery_metadata",Xe="invalid_authority_metadata",Ze="untrusted_authority",et="missing_ssh_jwk",tt="missing_ssh_kid",nt="missing_nonce_authentication_header",rt="invalid_authentication_header",ot="cannot_set_OIDCOptions",it="cannot_allow_platform_broker",at="authority_mismatch",st="invalid_request_method_for_EAR",ct="invalid_authorize_post_body_parameters";var lt=Object.freeze({__proto__:null,authorityMismatch:at,authorityUriInsecure:ze,cannotAllowPlatformBroker:it,cannotSetOIDCOptions:ot,claimsRequestParsingError:Fe,emptyInputScopesError:Ge,invalidAuthenticationHeader:rt,invalidAuthorityMetadata:Xe,invalidAuthorizePostBodyParameters:ct,invalidClaims:je,invalidCloudDiscoveryMetadata:Ye,invalidCodeChallengeMethod:Qe,invalidRequestMethodForEAR:st,logoutRequestEmpty:Ve,missingNonceAuthenticationHeader:nt,missingSshJwk:et,missingSshKid:tt,pkceParamsMissing:Je,redirectUriEmpty:He,tokenRequestEmpty:We,untrustedAuthority:Ze,urlEmptyError:$e,urlParseError:Ke});const ut={[He]:"A redirect URI is required for all calls, and none has been set.",[Fe]:"Could not parse the given claims request object.",[ze]:"Authority URIs must use https.  Please see here for valid authority configuration options: https://docs.microsoft.com/en-us/azure/active-directory/develop/msal-js-initializing-client-applications#configuration-options",[Ke]:"URL could not be parsed into appropriate segments.",[$e]:"URL was empty or null.",[Ge]:"Scopes cannot be passed as null, undefined or empty array because they are required to obtain an access token.",[je]:"Given claims parameter must be a stringified JSON object.",[We]:"Token request was empty and not found in cache.",[Ve]:"The logout request was null or undefined.",[Qe]:'code_challenge_method passed is invalid. Valid values are "plain" and "S256".',[Je]:"Both params: code_challenge and code_challenge_method are to be passed if to be sent in the request",[Ye]:"Invalid cloudDiscoveryMetadata provided. Must be a stringified JSON object containing tenant_discovery_endpoint and metadata fields",[Xe]:"Invalid authorityMetadata provided. Must by a stringified JSON object containing authorization_endpoint, token_endpoint, issuer fields.",[Ze]:"The provided authority is not a trusted authority. Please include this authority in the knownAuthorities config parameter.",[et]:"Missing sshJwk in SSH certificate request. A stringified JSON Web Key is required when using the SSH authentication scheme.",[tt]:"Missing sshKid in SSH certificate request. A string that uniquely identifies the public SSH key is required when using the SSH authentication scheme.",[nt]:"Unable to find an authentication header containing server nonce. Either the Authentication-Info or WWW-Authenticate headers must be present in order to obtain a server nonce.",[rt]:"Invalid authentication header provided",[ot]:"Cannot set OIDCOptions parameter. Please change the protocol mode to OIDC or use a non-Microsoft authority.",[it]:"Cannot set allowPlatformBroker parameter to true when not in AAD protocol mode.",[at]:"Authority mismatch error. Authority provided in login request or PublicClientApplication config does not match the environment of the provided account. Please use a matching account or make an interactive request to login to this authority.",[ct]:"Invalid authorize post body parameters provided. If you are using authorizePostBodyParameters, the request method must be POST. Please check the request method and parameters.",[st]:"Invalid request method for EAR protocol mode. The request method cannot be GET when using EAR protocol mode. Please change the request method to POST."},dt={redirectUriNotSet:{code:He,desc:ut[He]},claimsRequestParsingError:{code:Fe,desc:ut[Fe]},authorityUriInsecure:{code:ze,desc:ut[ze]},urlParseError:{code:Ke,desc:ut[Ke]},urlEmptyError:{code:$e,desc:ut[$e]},emptyScopesError:{code:Ge,desc:ut[Ge]},invalidClaimsRequest:{code:je,desc:ut[je]},tokenRequestEmptyError:{code:We,desc:ut[We]},logoutRequestEmptyError:{code:Ve,desc:ut[Ve]},invalidCodeChallengeMethod:{code:Qe,desc:ut[Qe]},invalidCodeChallengeParams:{code:Je,desc:ut[Je]},invalidCloudDiscoveryMetadata:{code:Ye,desc:ut[Ye]},invalidAuthorityMetadata:{code:Xe,desc:ut[Xe]},untrustedAuthority:{code:Ze,desc:ut[Ze]},missingSshJwk:{code:et,desc:ut[et]},missingSshKid:{code:tt,desc:ut[tt]},missingNonceAuthenticationHeader:{code:nt,desc:ut[nt]},invalidAuthenticationHeader:{code:rt,desc:ut[rt]},cannotSetOIDCOptions:{code:ot,desc:ut[ot]},cannotAllowPlatformBroker:{code:it,desc:ut[it]},authorityMismatch:{code:at,desc:ut[at]},invalidAuthorizePostBodyParameters:{code:ct,desc:ut[ct]},invalidRequestMethodForEAR:{code:st,desc:ut[st]}};class ht extends U{constructor(e){super(e,ut[e]),this.name="ClientConfigurationError",Object.setPrototypeOf(this,ht.prototype)}}function gt(e){return new ht(e)}class pt{static isEmptyObj(e){if(e)try{const t=JSON.parse(e);return 0===Object.keys(t).length}catch(e){}return!0}static startsWith(e,t){return 0===e.indexOf(t)}static endsWith(e,t){return e.length>=t.length&&e.lastIndexOf(t)===e.length-t.length}static queryStringToObject(e){const t={},n=e.split("&"),r=e=>decodeURIComponent(e.replace(/\+/g," "));return n.forEach(e=>{if(e.trim()){const[n,o]=e.split(/=(.+)/g,2);n&&o&&(t[r(n)]=r(o))}}),t}static trimArrayEntries(e){return e.map(e=>e.trim())}static removeEmptyStringsFromArray(e){return e.filter(e=>!!e)}static jsonParseHelper(e){try{return JSON.parse(e)}catch(e){return null}}static matchPattern(e,t){return new RegExp(e.replace(/\\/g,"\\\\").replace(/\*/g,"[^ ]*").replace(/\?/g,"\\?")).test(t)}}class ft{constructor(e){const t=e?pt.trimArrayEntries([...e]):[],n=t?pt.removeEmptyStringsFromArray(t):[];if(!n||!n.length)throw gt(Ge);this.scopes=new Set,n.forEach(e=>this.scopes.add(e))}static fromString(e){const t=(e||n.EMPTY_STRING).split(" ");return new ft(t)}static createSearchScopes(e){const t=e&&e.length>0?e:[...o],r=new ft(t);return r.containsOnlyOIDCScopes()?r.removeScope(n.OFFLINE_ACCESS_SCOPE):r.removeOIDCScopes(),r}containsScope(e){const t=this.printScopesLowerCase().split(" "),n=new ft(t);return!!e&&n.scopes.has(e.toLowerCase())}containsScopeSet(e){return!(!e||e.scopes.size<=0)&&this.scopes.size>=e.scopes.size&&e.asArray().every(e=>this.containsScope(e))}containsOnlyOIDCScopes(){let e=0;return i.forEach(t=>{this.containsScope(t)&&(e+=1)}),this.scopes.size===e}appendScope(e){e&&this.scopes.add(e.trim())}appendScopes(e){try{e.forEach(e=>this.appendScope(e))}catch(e){throw Ne(oe)}}removeScope(e){if(!e)throw Ne(re);this.scopes.delete(e.trim())}removeOIDCScopes(){i.forEach(e=>{this.scopes.delete(e)})}unionScopeSets(e){if(!e)throw Ne(ie);const t=new Set;return e.scopes.forEach(e=>t.add(e.toLowerCase())),this.scopes.forEach(e=>t.add(e.toLowerCase())),t}intersectingScopeSets(e){if(!e)throw Ne(ie);e.containsOnlyOIDCScopes()||e.removeOIDCScopes();const t=this.unionScopeSets(e),n=e.getScopeCount(),r=this.getScopeCount();return t.size<r+n}getScopeCount(){return this.scopes.size}asArray(){const e=[];return this.scopes.forEach(t=>e.push(t)),e}printScopes(){return this.scopes?this.asArray().join(" "):n.EMPTY_STRING}printScopesLowerCase(){return this.printScopes().toLowerCase()}}function mt(e,t){if(!e)throw Ne(H);try{const n=t(e);return JSON.parse(n)}catch(e){throw Ne(B)}}function yt(e){if(!e)throw Ne(B);const t=e.split(".",2);return{uid:t[0],utid:t.length<2?n.EMPTY_STRING:t[1]}}function vt(e,t){return!!e&&!!t&&e===t.split(".")[1]}function Ct(e,t,n,r){if(r){const{oid:t,sub:n,tid:o,name:i,tfp:a,acr:s,preferred_username:c,upn:l,login_hint:u}=r,d=o||a||s||"";return{tenantId:d,localAccountId:t||n||"",name:i,username:c||l||"",loginHint:u,isHomeTenant:vt(d,e)}}return{tenantId:n,localAccountId:t,username:"",isHomeTenant:vt(n,e)}}function wt(e,t,n,r){let o=e;if(t){const{isHomeTenant:n,...r}=t;o={...e,...r}}if(n){const{isHomeTenant:t,...i}=Ct(e.homeAccountId,e.localAccountId,e.tenantId,n);return o={...o,...i,idTokenClaims:n,idToken:r},o}return o}function It(e){return e&&(e.tid||e.tfp||e.acr)||null}const Tt={AAD:"AAD",OIDC:"OIDC",EAR:"EAR"};class At{static getAccountInfo(e){return{homeAccountId:e.homeAccountId,environment:e.environment,tenantId:e.realm,username:e.username,localAccountId:e.localAccountId,loginHint:e.loginHint,name:e.name,nativeAccountId:e.nativeAccountId,authorityType:e.authorityType,tenantProfiles:new Map((e.tenantProfiles||[]).map(e=>[e.tenantId,e])),dataBoundary:e.dataBoundary}}isSingleTenant(){return!this.tenantProfiles}static createAccount(e,t,n){const r=new At;let o;1===t.authorityType?r.authorityType="ADFS":t.protocolMode===Tt.OIDC?r.authorityType=C:r.authorityType="MSSTS",e.clientInfo&&n&&(o=mt(e.clientInfo,n),o.xms_tdbr&&(r.dataBoundary="EU"===o.xms_tdbr?"EU":"None")),r.clientInfo=e.clientInfo,r.homeAccountId=e.homeAccountId,r.nativeAccountId=e.nativeAccountId;const i=e.environment||t&&t.getPreferredCache();if(!i)throw Ne(de);r.environment=i,r.realm=o?.utid||It(e.idTokenClaims)||"",r.localAccountId=o?.uid||e.idTokenClaims?.oid||e.idTokenClaims?.sub||"";const a=e.idTokenClaims?.preferred_username||e.idTokenClaims?.upn,s=e.idTokenClaims?.emails?e.idTokenClaims.emails[0]:null;if(r.username=a||s||"",r.loginHint=e.idTokenClaims?.login_hint,r.name=e.idTokenClaims?.name||"",r.cloudGraphHostName=e.cloudGraphHostName,r.msGraphHost=e.msGraphHost,e.tenantProfiles)r.tenantProfiles=e.tenantProfiles;else{const t=Ct(e.homeAccountId,r.localAccountId,r.realm,e.idTokenClaims);r.tenantProfiles=[t]}return r}static createFromAccountInfo(e,t,n){const r=new At;return r.authorityType=e.authorityType||C,r.homeAccountId=e.homeAccountId,r.localAccountId=e.localAccountId,r.nativeAccountId=e.nativeAccountId,r.realm=e.tenantId,r.environment=e.environment,r.username=e.username,r.name=e.name,r.loginHint=e.loginHint,r.cloudGraphHostName=t,r.msGraphHost=n,r.tenantProfiles=Array.from(e.tenantProfiles?.values()||[]),r.dataBoundary=e.dataBoundary,r}static generateHomeAccountId(e,t,n,r,o){if(1!==t&&2!==t){if(e)try{const t=mt(e,r.base64Decode);if(t.uid&&t.utid)return`${t.uid}.${t.utid}`}catch(e){}n.warning("No client info in response")}return o?.sub||""}static isAccountEntity(e){return!!e&&e.hasOwnProperty("homeAccountId")&&e.hasOwnProperty("environment")&&e.hasOwnProperty("realm")&&e.hasOwnProperty("localAccountId")&&e.hasOwnProperty("username")&&e.hasOwnProperty("authorityType")}static accountInfoIsEqual(e,t,n){if(!e||!t)return!1;let r=!0;if(n){const n=e.idTokenClaims||{},o=t.idTokenClaims||{};r=n.iat===o.iat&&n.nonce===o.nonce}return e.homeAccountId===t.homeAccountId&&e.localAccountId===t.localAccountId&&e.username===t.username&&e.tenantId===t.tenantId&&e.loginHint===t.loginHint&&e.environment===t.environment&&e.nativeAccountId===t.nativeAccountId&&r}}function kt(e,t){const n=function(e){if(!e)throw Ne(z);const t=/^([^\.\s]*)\.([^\.\s]+)\.([^\.\s]*)$/.exec(e);if(!t||t.length<4)throw Ne(F);return t[2]}(e);try{const e=t(n);return JSON.parse(e)}catch(e){throw Ne(F)}}function St(e){if(!e.signin_state)return!1;const t=["kmsi","dvc_dmjd"];return e.signin_state.some(e=>t.includes(e.trim().toLowerCase()))}function bt(e,t){if(0===t||Date.now()-3e5>e+t)throw Ne(X)}function Rt(e){if(!e)return e;let t=e.toLowerCase();return pt.endsWith(t,"?")?t=t.slice(0,-1):pt.endsWith(t,"?/")&&(t=t.slice(0,-2)),pt.endsWith(t,"/")||(t+="/"),t}function Et(e){return e.startsWith("#/")?e.substring(2):e.startsWith("#")||e.startsWith("?")?e.substring(1):e}function Pt(e){if(!e||e.indexOf("=")<0)return null;try{const t=Et(e),n=Object.fromEntries(new URLSearchParams(t));if(n.code||n.ear_jwe||n.error||n.error_description||n.state)return n}catch(e){throw Ne(j)}return null}function _t(e,t=!0,n){const r=new Array;return e.forEach((e,o)=>{!t&&n&&o in n?r.push(`${o}=${e}`):r.push(`${o}=${encodeURIComponent(e)}`)}),r.join("&")}function Mt(e){if(!e)return e;const t=e.split("#")[0];try{const e=new URL(t);return Rt(e.origin+e.pathname+e.search)}catch(e){return Rt(t)}}class Ot{get urlString(){return this._urlString}constructor(e){if(this._urlString=e,!this._urlString)throw gt($e);e.includes("#")||(this._urlString=Ot.canonicalizeUri(e))}static canonicalizeUri(e){if(e){let t=e.toLowerCase();return pt.endsWith(t,"?")?t=t.slice(0,-1):pt.endsWith(t,"?/")&&(t=t.slice(0,-2)),pt.endsWith(t,"/")||(t+="/"),t}return e}validateAsUri(){let e;try{e=this.getUrlComponents()}catch(e){throw gt(Ke)}if(!e.HostNameAndPort||!e.PathSegments)throw gt(Ke);if(!e.Protocol||"https:"!==e.Protocol.toLowerCase())throw gt(ze)}static appendQueryString(e,t){return t?e.indexOf("?")<0?`${e}?${t}`:`${e}&${t}`:e}static removeHashFromUrl(e){return Ot.canonicalizeUri(e.split("#")[0])}replaceTenantPath(e){const t=this.getUrlComponents(),n=t.PathSegments;return!e||0===n.length||n[0]!==h&&n[0]!==g||(n[0]=e),Ot.constructAuthorityUriFromObject(t)}getUrlComponents(){const e=RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?"),t=this.urlString.match(e);if(!t)throw gt(Ke);const n={Protocol:t[1],HostNameAndPort:t[4],AbsolutePath:t[5],QueryString:t[7]};let r=n.AbsolutePath.split("/");return r=r.filter(e=>e&&e.length>0),n.PathSegments=r,n.QueryString&&n.QueryString.endsWith("/")&&(n.QueryString=n.QueryString.substring(0,n.QueryString.length-1)),n}static getDomainFromUrl(e){const t=RegExp("^([^:/?#]+://)?([^/?#]*)"),n=e.match(t);if(!n)throw gt(Ke);return n[2]}static getAbsoluteUrl(e,t){if(e[0]===n.FORWARD_SLASH){const n=new Ot(t).getUrlComponents();return n.Protocol+"//"+n.HostNameAndPort+e}return e}static constructAuthorityUriFromObject(e){return new Ot(e.Protocol+"//"+e.HostNameAndPort+"/"+e.PathSegments.join("/"))}static hashContainsKnownProperties(e){return!!Pt(e)}}const Nt={"login.microsoftonline.com":{token_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.microsoftonline.com/{tenantid}/discovery/v2.0/keys",issuer:"https://login.microsoftonline.com/{tenantid}/v2.0",authorization_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/logout"},"login.chinacloudapi.cn":{token_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.chinacloudapi.cn/{tenantid}/discovery/v2.0/keys",issuer:"https://login.partner.microsoftonline.cn/{tenantid}/v2.0",authorization_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/logout"},"login.microsoftonline.us":{token_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.microsoftonline.us/{tenantid}/discovery/v2.0/keys",issuer:"https://login.microsoftonline.us/{tenantid}/v2.0",authorization_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/logout"}},qt={metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]},Lt=new Set;function xt(e,t,n,r){if(r?.trace(`getAliasesFromMetadata called with source: ${n}`),e&&t){const o=Ut(t,e);if(o)return r?.trace(`getAliasesFromMetadata: found cloud discovery metadata in ${n}, returning aliases`),o.aliases;r?.trace(`getAliasesFromMetadata: did not find cloud discovery metadata in ${n}`)}return null}function Ut(e,t){for(let n=0;n<e.length;n++){const r=e[n];if(r.aliases.includes(t))return r}return null}qt.metadata.forEach(e=>{e.aliases.forEach(e=>{Lt.add(e)})});const Dt="cache_quota_exceeded",Bt="cache_error_unknown",Ht={[Dt]:"Exceeded cache storage capacity.",[Bt]:"Unexpected error occurred when using cache storage."};class Ft extends U{constructor(e,t){const n=t||(Ht[e]?Ht[e]:Ht[Bt]);super(`${e}: ${n}`),Object.setPrototypeOf(this,Ft.prototype),this.name="CacheError",this.errorCode=e,this.errorMessage=n}}function zt(e){return e instanceof Error?"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name||e.message.includes("exceeded the quota")?new Ft(Dt):new Ft(e.name,e.message):new Ft(Bt)}class Kt{constructor(e,t,n,r,o){this.clientId=e,this.cryptoImpl=t,this.commonLogger=n.clone(Ue,De),this.staticAuthorityOptions=o,this.performanceClient=r}getAllAccounts(e,t){return this.buildTenantProfiles(this.getAccountsFilteredBy(e,t),t,e)}getAccountInfoFilteredBy(e,t){if(0===Object.keys(e).length||Object.values(e).every(e=>!e))return this.commonLogger.warning("getAccountInfoFilteredBy: Account filter is empty or invalid, returning null"),null;const n=this.getAllAccounts(e,t);return n.length>1?n.sort(e=>e.idTokenClaims?-1:1)[0]:1===n.length?n[0]:null}getBaseAccountInfo(e,t){const n=this.getAccountsFilteredBy(e,t);return n.length>0?At.getAccountInfo(n[0]):null}buildTenantProfiles(e,t,n){return e.flatMap(e=>this.getTenantProfilesFromAccountEntity(e,t,n?.tenantId,n))}getTenantedAccountInfoByFilter(e,t,n,r,o){let i,a=null;if(o&&!this.tenantProfileMatchesFilter(n,o))return null;const s=this.getIdToken(e,r,t,n.tenantId);return s&&(i=kt(s.secret,this.cryptoImpl.base64Decode),!this.idTokenClaimsMatchTenantProfileFilter(i,o))?null:(a=wt(e,n,i,s?.secret),a)}getTenantProfilesFromAccountEntity(e,t,n,r){const o=At.getAccountInfo(e);let i=o.tenantProfiles||new Map;const a=this.getTokenKeys();if(n){const e=i.get(n);if(!e)return[];i=new Map([[n,e]])}const s=[];return i.forEach(e=>{const n=this.getTenantedAccountInfoByFilter(o,a,e,t,r);n&&s.push(n)}),s}tenantProfileMatchesFilter(e,t){return!(t.localAccountId&&!this.matchLocalAccountIdFromTenantProfile(e,t.localAccountId)||t.name&&e.name!==t.name||void 0!==t.isHomeTenant&&e.isHomeTenant!==t.isHomeTenant)}idTokenClaimsMatchTenantProfileFilter(e,t){if(t){if(t.localAccountId&&!this.matchLocalAccountIdFromTokenClaims(e,t.localAccountId))return!1;if(t.loginHint&&!this.matchLoginHintFromTokenClaims(e,t.loginHint))return!1;if(t.username&&!this.matchUsername(e.preferred_username,t.username))return!1;if(t.name&&!this.matchName(e,t.name))return!1;if(t.sid&&!this.matchSid(e,t.sid))return!1}return!0}async saveCacheRecord(e,t,n,r){if(!e)throw Ne(ue);try{e.account&&await this.setAccount(e.account,t,n),e.idToken&&!1!==r?.idToken&&await this.setIdTokenCredential(e.idToken,t,n),e.accessToken&&!1!==r?.accessToken&&await this.saveAccessToken(e.accessToken,t,n),e.refreshToken&&!1!==r?.refreshToken&&await this.setRefreshTokenCredential(e.refreshToken,t,n),e.appMetadata&&this.setAppMetadata(e.appMetadata,t)}catch(e){throw this.commonLogger?.error("CacheManager.saveCacheRecord: failed"),e instanceof U?e:zt(e)}}async saveAccessToken(e,t,n){const r={clientId:e.clientId,credentialType:e.credentialType,environment:e.environment,homeAccountId:e.homeAccountId,realm:e.realm,tokenType:e.tokenType,requestedClaimsHash:e.requestedClaimsHash},o=this.getTokenKeys(),i=ft.fromString(e.target);o.accessToken.forEach(e=>{if(!this.accessTokenKeyMatchesFilter(e,r,!1))return;const n=this.getAccessTokenCredential(e,t);n&&this.credentialMatchesFilter(n,r)&&ft.fromString(n.target).intersectingScopeSets(i)&&this.removeAccessToken(e,t)}),await this.setAccessTokenCredential(e,t,n)}getAccountsFilteredBy(e,t){const n=this.getAccountKeys(),r=[];return n.forEach(n=>{const o=this.getAccount(n,t);if(!o)return;if(e.homeAccountId&&!this.matchHomeAccountId(o,e.homeAccountId))return;if(e.username&&!this.matchUsername(o.username,e.username))return;if(e.environment&&!this.matchEnvironment(o,e.environment))return;if(e.realm&&!this.matchRealm(o,e.realm))return;if(e.nativeAccountId&&!this.matchNativeAccountId(o,e.nativeAccountId))return;if(e.authorityType&&!this.matchAuthorityType(o,e.authorityType))return;const i={localAccountId:e?.localAccountId,name:e?.name},a=o.tenantProfiles?.filter(e=>this.tenantProfileMatchesFilter(e,i));a&&0===a.length||r.push(o)}),r}credentialMatchesFilter(e,t){if(t.clientId&&!this.matchClientId(e,t.clientId))return!1;if(t.userAssertionHash&&!this.matchUserAssertionHash(e,t.userAssertionHash))return!1;if("string"==typeof t.homeAccountId&&!this.matchHomeAccountId(e,t.homeAccountId))return!1;if(t.environment&&!this.matchEnvironment(e,t.environment))return!1;if(t.realm&&!this.matchRealm(e,t.realm))return!1;if(t.credentialType&&!this.matchCredentialType(e,t.credentialType))return!1;if(t.familyId&&!this.matchFamilyId(e,t.familyId))return!1;if(t.target&&!this.matchTarget(e,t.target))return!1;if((t.requestedClaimsHash||e.requestedClaimsHash)&&e.requestedClaimsHash!==t.requestedClaimsHash)return!1;if(e.credentialType===w.ACCESS_TOKEN_WITH_AUTH_SCHEME){if(t.tokenType&&!this.matchTokenType(e,t.tokenType))return!1;if(t.tokenType===P.SSH&&t.keyId&&!this.matchKeyId(e,t.keyId))return!1}return!0}getAppMetadataFilteredBy(e){const t=this.getKeys(),n={};return t.forEach(t=>{if(!this.isAppMetadata(t))return;const r=this.getAppMetadata(t);r&&(e.environment&&!this.matchEnvironment(r,e.environment)||e.clientId&&!this.matchClientId(r,e.clientId)||(n[t]=r))}),n}getAuthorityMetadataByAlias(e){const t=this.getAuthorityMetadataKeys();let n=null;return t.forEach(t=>{if(!this.isAuthorityMetadata(t)||-1===t.indexOf(this.clientId))return;const r=this.getAuthorityMetadata(t);r&&-1!==r.aliases.indexOf(e)&&(n=r)}),n}removeAllAccounts(e){this.getAllAccounts({},e).forEach(t=>{this.removeAccount(t,e)})}removeAccount(e,t){this.removeAccountContext(e,t),this.getAccountKeys().filter(t=>t.includes(e.homeAccountId)&&t.includes(e.environment)).forEach(e=>{this.removeItem(e,t),this.performanceClient.incrementFields({accountsRemoved:1},t)})}removeAccountContext(e,t){const n=this.getTokenKeys(),r=t=>t.includes(e.homeAccountId)&&t.includes(e.environment);n.idToken.filter(r).forEach(e=>{this.removeIdToken(e,t)}),n.accessToken.filter(r).forEach(e=>{this.removeAccessToken(e,t)}),n.refreshToken.filter(r).forEach(e=>{this.removeRefreshToken(e,t)})}removeAccessToken(e,t){const n=this.getAccessTokenCredential(e,t);if(this.removeItem(e,t),this.performanceClient.incrementFields({accessTokensRemoved:1},t),!n||n.credentialType.toLowerCase()!==w.ACCESS_TOKEN_WITH_AUTH_SCHEME.toLowerCase()||n.tokenType!==P.POP)return;const r=n.keyId;r&&this.cryptoImpl.removeTokenBindingKey(r).catch(()=>{this.commonLogger.error(`Failed to remove token binding key ${r}`,t),this.performanceClient?.incrementFields({removeTokenBindingKeyFailure:1},t)})}removeAppMetadata(e){return this.getKeys().forEach(t=>{this.isAppMetadata(t)&&this.removeItem(t,e)}),!0}getIdToken(e,t,n,r,o){this.commonLogger.trace("CacheManager - getIdToken called");const i={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:w.ID_TOKEN,clientId:this.clientId,realm:r},a=this.getIdTokensByFilter(i,t,n),s=a.size;if(s<1)return this.commonLogger.info("CacheManager:getIdToken - No token found"),null;if(s>1){let n=a;if(!r){const t=new Map;a.forEach((n,r)=>{n.realm===e.tenantId&&t.set(r,n)});const r=t.size;if(r<1)return this.commonLogger.info("CacheManager:getIdToken - Multiple ID tokens found for account but none match account entity tenant id, returning first result"),a.values().next().value;if(1===r)return this.commonLogger.info("CacheManager:getIdToken - Multiple ID tokens found for account, defaulting to home tenant profile"),t.values().next().value;n=t}return this.commonLogger.info("CacheManager:getIdToken - Multiple matching ID tokens found, clearing them"),n.forEach((e,n)=>{this.removeIdToken(n,t)}),o&&t&&o.addFields({multiMatchedID:a.size},t),null}return this.commonLogger.info("CacheManager:getIdToken - Returning ID token"),a.values().next().value}getIdTokensByFilter(e,t,n){const r=n&&n.idToken||this.getTokenKeys().idToken,o=new Map;return r.forEach(n=>{if(!this.idTokenKeyMatchesFilter(n,{clientId:this.clientId,...e}))return;const r=this.getIdTokenCredential(n,t);r&&this.credentialMatchesFilter(r,e)&&o.set(n,r)}),o}idTokenKeyMatchesFilter(e,t){const n=e.toLowerCase();return!(t.clientId&&-1===n.indexOf(t.clientId.toLowerCase())||t.homeAccountId&&-1===n.indexOf(t.homeAccountId.toLowerCase()))}removeIdToken(e,t){this.removeItem(e,t)}removeRefreshToken(e,t){this.removeItem(e,t)}getAccessToken(e,t,n,r){const o=t.correlationId;this.commonLogger.trace("CacheManager - getAccessToken called",o);const i=ft.createSearchScopes(t.scopes),a=t.authenticationScheme||P.BEARER,s=a&&a.toLowerCase()!==P.BEARER.toLowerCase()?w.ACCESS_TOKEN_WITH_AUTH_SCHEME:w.ACCESS_TOKEN,c={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:s,clientId:this.clientId,realm:r||e.tenantId,target:i,tokenType:a,keyId:t.sshKid,requestedClaimsHash:t.requestedClaimsHash},l=n&&n.accessToken||this.getTokenKeys().accessToken,u=[];l.forEach(e=>{if(this.accessTokenKeyMatchesFilter(e,c,!0)){const t=this.getAccessTokenCredential(e,o);t&&this.credentialMatchesFilter(t,c)&&u.push(t)}});const d=u.length;return d<1?(this.commonLogger.info("CacheManager:getAccessToken - No token found",o),null):d>1?(this.commonLogger.info("CacheManager:getAccessToken - Multiple access tokens found, clearing them",o),u.forEach(e=>{this.removeAccessToken(this.generateCredentialKey(e),o)}),this.performanceClient.addFields({multiMatchedAT:u.length},o),null):(this.commonLogger.info("CacheManager:getAccessToken - Returning access token",o),u[0])}accessTokenKeyMatchesFilter(e,t,n){const r=e.toLowerCase();if(t.clientId&&-1===r.indexOf(t.clientId.toLowerCase()))return!1;if(t.homeAccountId&&-1===r.indexOf(t.homeAccountId.toLowerCase()))return!1;if(t.realm&&-1===r.indexOf(t.realm.toLowerCase()))return!1;if(t.requestedClaimsHash&&-1===r.indexOf(t.requestedClaimsHash.toLowerCase()))return!1;if(t.target){const e=t.target.asArray();for(let t=0;t<e.length;t++){if(n&&!r.includes(e[t].toLowerCase()))return!1;if(!n&&r.includes(e[t].toLowerCase()))return!0}}return!0}getAccessTokensByFilter(e,t){const n=this.getTokenKeys(),r=[];return n.accessToken.forEach(n=>{if(!this.accessTokenKeyMatchesFilter(n,e,!0))return;const o=this.getAccessTokenCredential(n,t);o&&this.credentialMatchesFilter(o,e)&&r.push(o)}),r}getRefreshToken(e,t,n,r,o){this.commonLogger.trace("CacheManager - getRefreshToken called");const i=t?T:void 0,a={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:w.REFRESH_TOKEN,clientId:this.clientId,familyId:i},s=r&&r.refreshToken||this.getTokenKeys().refreshToken,c=[];s.forEach(e=>{if(this.refreshTokenKeyMatchesFilter(e,a)){const t=this.getRefreshTokenCredential(e,n);t&&this.credentialMatchesFilter(t,a)&&c.push(t)}});const l=c.length;return l<1?(this.commonLogger.info("CacheManager:getRefreshToken - No refresh token found."),null):(l>1&&o&&n&&o.addFields({multiMatchedRT:l},n),this.commonLogger.info("CacheManager:getRefreshToken - returning refresh token"),c[0])}refreshTokenKeyMatchesFilter(e,t){const n=e.toLowerCase();return!(t.familyId&&-1===n.indexOf(t.familyId.toLowerCase())||!t.familyId&&t.clientId&&-1===n.indexOf(t.clientId.toLowerCase())||t.homeAccountId&&-1===n.indexOf(t.homeAccountId.toLowerCase()))}readAppMetadataFromCache(e){const t={environment:e,clientId:this.clientId},n=this.getAppMetadataFilteredBy(t),r=Object.keys(n).map(e=>n[e]),o=r.length;if(o<1)return null;if(o>1)throw Ne(te);return r[0]}isAppMetadataFOCI(e){const t=this.readAppMetadataFromCache(e);return!(!t||t.familyId!==T)}matchHomeAccountId(e,t){return!("string"!=typeof e.homeAccountId||t!==e.homeAccountId)}matchLocalAccountIdFromTokenClaims(e,t){return t===(e.oid||e.sub)}matchLocalAccountIdFromTenantProfile(e,t){return e.localAccountId===t}matchName(e,t){return!(t.toLowerCase()!==e.name?.toLowerCase())}matchUsername(e,t){return!(!e||"string"!=typeof e||t?.toLowerCase()!==e.toLowerCase())}matchUserAssertionHash(e,t){return!(!e.userAssertionHash||t!==e.userAssertionHash)}matchEnvironment(e,t){if(this.staticAuthorityOptions){const n=function(e,t){let n;const r=e.canonicalAuthority;if(r){const o=new Ot(r).getUrlComponents().HostNameAndPort;n=xt(o,e.cloudDiscoveryMetadata?.metadata,k,t)||xt(o,qt.metadata,R,t)||e.knownAuthorities}return n||[]}(this.staticAuthorityOptions,this.commonLogger);if(n.includes(t)&&n.includes(e.environment))return!0}const n=this.getAuthorityMetadataByAlias(t);return!!(n&&n.aliases.indexOf(e.environment)>-1)}matchCredentialType(e,t){return e.credentialType&&t.toLowerCase()===e.credentialType.toLowerCase()}matchClientId(e,t){return!(!e.clientId||t!==e.clientId)}matchFamilyId(e,t){return!(!e.familyId||t!==e.familyId)}matchRealm(e,t){return!(e.realm?.toLowerCase()!==t.toLowerCase())}matchNativeAccountId(e,t){return!(!e.nativeAccountId||t!==e.nativeAccountId)}matchLoginHintFromTokenClaims(e,t){return e.login_hint===t||e.preferred_username===t||e.upn===t}matchSid(e,t){return e.sid===t}matchAuthorityType(e,t){return!(!e.authorityType||t.toLowerCase()!==e.authorityType.toLowerCase())}matchTarget(e,t){return!(e.credentialType!==w.ACCESS_TOKEN&&e.credentialType!==w.ACCESS_TOKEN_WITH_AUTH_SCHEME||!e.target)&&ft.fromString(e.target).containsScopeSet(t)}matchTokenType(e,t){return!(!e.tokenType||e.tokenType!==t)}matchKeyId(e,t){return!(!e.keyId||e.keyId!==t)}isAppMetadata(e){return-1!==e.indexOf(I)}isAuthorityMetadata(e){return-1!==e.indexOf(A)}generateAuthorityMetadataCacheKey(e){return`${A}-${this.clientId}-${e}`}static toObject(e,t){for(const n in t)e[n]=t[n];return e}}class $t extends Kt{async setAccount(){throw Ne(Re)}getAccount(){throw Ne(Re)}async setIdTokenCredential(){throw Ne(Re)}getIdTokenCredential(){throw Ne(Re)}async setAccessTokenCredential(){throw Ne(Re)}getAccessTokenCredential(){throw Ne(Re)}async setRefreshTokenCredential(){throw Ne(Re)}getRefreshTokenCredential(){throw Ne(Re)}setAppMetadata(){throw Ne(Re)}getAppMetadata(){throw Ne(Re)}setServerTelemetry(){throw Ne(Re)}getServerTelemetry(){throw Ne(Re)}setAuthorityMetadata(){throw Ne(Re)}getAuthorityMetadata(){throw Ne(Re)}getAuthorityMetadataKeys(){throw Ne(Re)}setThrottlingCache(){throw Ne(Re)}getThrottlingCache(){throw Ne(Re)}removeItem(){throw Ne(Re)}getKeys(){throw Ne(Re)}getAccountKeys(){throw Ne(Re)}getTokenKeys(){throw Ne(Re)}generateCredentialKey(){throw Ne(Re)}generateAccountKey(){throw Ne(Re)}}const Gt={AcquireTokenByCode:"acquireTokenByCode",AcquireTokenByRefreshToken:"acquireTokenByRefreshToken",AcquireTokenSilent:"acquireTokenSilent",AcquireTokenSilentAsync:"acquireTokenSilentAsync",AcquireTokenPopup:"acquireTokenPopup",AcquireTokenPreRedirect:"acquireTokenPreRedirect",AcquireTokenRedirect:"acquireTokenRedirect",CryptoOptsGetPublicKeyThumbprint:"cryptoOptsGetPublicKeyThumbprint",CryptoOptsSignJwt:"cryptoOptsSignJwt",SilentCacheClientAcquireToken:"silentCacheClientAcquireToken",SilentIframeClientAcquireToken:"silentIframeClientAcquireToken",AwaitConcurrentIframe:"awaitConcurrentIframe",SilentRefreshClientAcquireToken:"silentRefreshClientAcquireToken",SsoSilent:"ssoSilent",StandardInteractionClientGetDiscoveredAuthority:"standardInteractionClientGetDiscoveredAuthority",FetchAccountIdWithNativeBroker:"fetchAccountIdWithNativeBroker",NativeInteractionClientAcquireToken:"nativeInteractionClientAcquireToken",BaseClientCreateTokenRequestHeaders:"baseClientCreateTokenRequestHeaders",NetworkClientSendPostRequestAsync:"networkClientSendPostRequestAsync",RefreshTokenClientExecutePostToTokenEndpoint:"refreshTokenClientExecutePostToTokenEndpoint",AuthorizationCodeClientExecutePostToTokenEndpoint:"authorizationCodeClientExecutePostToTokenEndpoint",BrokerHandhshake:"brokerHandshake",AcquireTokenByRefreshTokenInBroker:"acquireTokenByRefreshTokenInBroker",AcquireTokenByBroker:"acquireTokenByBroker",RefreshTokenClientExecuteTokenRequest:"refreshTokenClientExecuteTokenRequest",RefreshTokenClientAcquireToken:"refreshTokenClientAcquireToken",RefreshTokenClientAcquireTokenWithCachedRefreshToken:"refreshTokenClientAcquireTokenWithCachedRefreshToken",RefreshTokenClientAcquireTokenByRefreshToken:"refreshTokenClientAcquireTokenByRefreshToken",RefreshTokenClientCreateTokenRequestBody:"refreshTokenClientCreateTokenRequestBody",AcquireTokenFromCache:"acquireTokenFromCache",SilentFlowClientAcquireCachedToken:"silentFlowClientAcquireCachedToken",SilentFlowClientGenerateResultFromCacheRecord:"silentFlowClientGenerateResultFromCacheRecord",AcquireTokenBySilentIframe:"acquireTokenBySilentIframe",InitializeBaseRequest:"initializeBaseRequest",InitializeSilentRequest:"initializeSilentRequest",InitializeClientApplication:"initializeClientApplication",InitializeCache:"initializeCache",SilentIframeClientTokenHelper:"silentIframeClientTokenHelper",SilentHandlerInitiateAuthRequest:"silentHandlerInitiateAuthRequest",SilentHandlerMonitorIframeForHash:"silentHandlerMonitorIframeForHash",SilentHandlerLoadFrame:"silentHandlerLoadFrame",SilentHandlerLoadFrameSync:"silentHandlerLoadFrameSync",StandardInteractionClientCreateAuthCodeClient:"standardInteractionClientCreateAuthCodeClient",StandardInteractionClientGetClientConfiguration:"standardInteractionClientGetClientConfiguration",StandardInteractionClientInitializeAuthorizationRequest:"standardInteractionClientInitializeAuthorizationRequest",GetAuthCodeUrl:"getAuthCodeUrl",GetStandardParams:"getStandardParams",HandleCodeResponseFromServer:"handleCodeResponseFromServer",HandleCodeResponse:"handleCodeResponse",HandleResponseEar:"handleResponseEar",HandleResponsePlatformBroker:"handleResponsePlatformBroker",HandleResponseCode:"handleResponseCode",UpdateTokenEndpointAuthority:"updateTokenEndpointAuthority",AuthClientAcquireToken:"authClientAcquireToken",AuthClientExecuteTokenRequest:"authClientExecuteTokenRequest",AuthClientCreateTokenRequestBody:"authClientCreateTokenRequestBody",PopTokenGenerateCnf:"popTokenGenerateCnf",PopTokenGenerateKid:"popTokenGenerateKid",HandleServerTokenResponse:"handleServerTokenResponse",DeserializeResponse:"deserializeResponse",AuthorityFactoryCreateDiscoveredInstance:"authorityFactoryCreateDiscoveredInstance",AuthorityResolveEndpointsAsync:"authorityResolveEndpointsAsync",AuthorityResolveEndpointsFromLocalSources:"authorityResolveEndpointsFromLocalSources",AuthorityGetCloudDiscoveryMetadataFromNetwork:"authorityGetCloudDiscoveryMetadataFromNetwork",AuthorityUpdateCloudDiscoveryMetadata:"authorityUpdateCloudDiscoveryMetadata",AuthorityGetEndpointMetadataFromNetwork:"authorityGetEndpointMetadataFromNetwork",AuthorityUpdateEndpointMetadata:"authorityUpdateEndpointMetadata",AuthorityUpdateMetadataWithRegionalInformation:"authorityUpdateMetadataWithRegionalInformation",RegionDiscoveryDetectRegion:"regionDiscoveryDetectRegion",RegionDiscoveryGetRegionFromIMDS:"regionDiscoveryGetRegionFromIMDS",RegionDiscoveryGetCurrentVersion:"regionDiscoveryGetCurrentVersion",AcquireTokenByCodeAsync:"acquireTokenByCodeAsync",GetEndpointMetadataFromNetwork:"getEndpointMetadataFromNetwork",GetCloudDiscoveryMetadataFromNetworkMeasurement:"getCloudDiscoveryMetadataFromNetworkMeasurement",HandleRedirectPromiseMeasurement:"handleRedirectPromise",HandleNativeRedirectPromiseMeasurement:"handleNativeRedirectPromise",UpdateCloudDiscoveryMetadataMeasurement:"updateCloudDiscoveryMetadataMeasurement",UsernamePasswordClientAcquireToken:"usernamePasswordClientAcquireToken",NativeMessageHandlerHandshake:"nativeMessageHandlerHandshake",NativeGenerateAuthResult:"nativeGenerateAuthResult",RemoveHiddenIframe:"removeHiddenIframe",ClearTokensAndKeysWithClaims:"clearTokensAndKeysWithClaims",CacheManagerGetRefreshToken:"cacheManagerGetRefreshToken",ImportExistingCache:"importExistingCache",SetUserData:"setUserData",LocalStorageUpdated:"localStorageUpdated",GeneratePkceCodes:"generatePkceCodes",GenerateCodeVerifier:"generateCodeVerifier",GenerateCodeChallengeFromVerifier:"generateCodeChallengeFromVerifier",Sha256Digest:"sha256Digest",GetRandomValues:"getRandomValues",GenerateHKDF:"generateHKDF",GenerateBaseKey:"generateBaseKey",Base64Decode:"base64Decode",UrlEncodeArr:"urlEncodeArr",Encrypt:"encrypt",Decrypt:"decrypt",GenerateEarKey:"generateEarKey",DecryptEarResponse:"decryptEarResponse"},jt=new Map([[Gt.AcquireTokenByCode,"ATByCode"],[Gt.AcquireTokenByRefreshToken,"ATByRT"],[Gt.AcquireTokenSilent,"ATS"],[Gt.AcquireTokenSilentAsync,"ATSAsync"],[Gt.AcquireTokenPopup,"ATPopup"],[Gt.AcquireTokenRedirect,"ATRedirect"],[Gt.CryptoOptsGetPublicKeyThumbprint,"CryptoGetPKThumb"],[Gt.CryptoOptsSignJwt,"CryptoSignJwt"],[Gt.SilentCacheClientAcquireToken,"SltCacheClientAT"],[Gt.SilentIframeClientAcquireToken,"SltIframeClientAT"],[Gt.SilentRefreshClientAcquireToken,"SltRClientAT"],[Gt.SsoSilent,"SsoSlt"],[Gt.StandardInteractionClientGetDiscoveredAuthority,"StdIntClientGetDiscAuth"],[Gt.FetchAccountIdWithNativeBroker,"FetchAccIdWithNtvBroker"],[Gt.NativeInteractionClientAcquireToken,"NtvIntClientAT"],[Gt.BaseClientCreateTokenRequestHeaders,"BaseClientCreateTReqHead"],[Gt.NetworkClientSendPostRequestAsync,"NetClientSendPost"],[Gt.RefreshTokenClientExecutePostToTokenEndpoint,"RTClientExecPost"],[Gt.AuthorizationCodeClientExecutePostToTokenEndpoint,"AuthCodeClientExecPost"],[Gt.BrokerHandhshake,"BrokerHandshake"],[Gt.AcquireTokenByRefreshTokenInBroker,"ATByRTInBroker"],[Gt.AcquireTokenByBroker,"ATByBroker"],[Gt.RefreshTokenClientExecuteTokenRequest,"RTClientExecTReq"],[Gt.RefreshTokenClientAcquireToken,"RTClientAT"],[Gt.RefreshTokenClientAcquireTokenWithCachedRefreshToken,"RTClientATWithCachedRT"],[Gt.RefreshTokenClientAcquireTokenByRefreshToken,"RTClientATByRT"],[Gt.RefreshTokenClientCreateTokenRequestBody,"RTClientCreateTReqBody"],[Gt.AcquireTokenFromCache,"ATFromCache"],[Gt.SilentFlowClientAcquireCachedToken,"SltFlowClientATCached"],[Gt.SilentFlowClientGenerateResultFromCacheRecord,"SltFlowClientGenResFromCache"],[Gt.AcquireTokenBySilentIframe,"ATBySltIframe"],[Gt.InitializeBaseRequest,"InitBaseReq"],[Gt.InitializeSilentRequest,"InitSltReq"],[Gt.InitializeClientApplication,"InitClientApplication"],[Gt.InitializeCache,"InitCache"],[Gt.ImportExistingCache,"importCache"],[Gt.SetUserData,"setUserData"],[Gt.LocalStorageUpdated,"localStorageUpdated"],[Gt.SilentIframeClientTokenHelper,"SIClientTHelper"],[Gt.SilentHandlerInitiateAuthRequest,"SHandlerInitAuthReq"],[Gt.SilentHandlerMonitorIframeForHash,"SltHandlerMonitorIframeForHash"],[Gt.SilentHandlerLoadFrame,"SHandlerLoadFrame"],[Gt.SilentHandlerLoadFrameSync,"SHandlerLoadFrameSync"],[Gt.StandardInteractionClientCreateAuthCodeClient,"StdIntClientCreateAuthCodeClient"],[Gt.StandardInteractionClientGetClientConfiguration,"StdIntClientGetClientConf"],[Gt.StandardInteractionClientInitializeAuthorizationRequest,"StdIntClientInitAuthReq"],[Gt.GetAuthCodeUrl,"GetAuthCodeUrl"],[Gt.HandleCodeResponseFromServer,"HandleCodeResFromServer"],[Gt.HandleCodeResponse,"HandleCodeResp"],[Gt.HandleResponseEar,"HandleRespEar"],[Gt.HandleResponseCode,"HandleRespCode"],[Gt.HandleResponsePlatformBroker,"HandleRespPlatBroker"],[Gt.UpdateTokenEndpointAuthority,"UpdTEndpointAuth"],[Gt.AuthClientAcquireToken,"AuthClientAT"],[Gt.AuthClientExecuteTokenRequest,"AuthClientExecTReq"],[Gt.AuthClientCreateTokenRequestBody,"AuthClientCreateTReqBody"],[Gt.PopTokenGenerateCnf,"PopTGenCnf"],[Gt.PopTokenGenerateKid,"PopTGenKid"],[Gt.HandleServerTokenResponse,"HandleServerTRes"],[Gt.DeserializeResponse,"DeserializeRes"],[Gt.AuthorityFactoryCreateDiscoveredInstance,"AuthFactCreateDiscInst"],[Gt.AuthorityResolveEndpointsAsync,"AuthResolveEndpointsAsync"],[Gt.AuthorityResolveEndpointsFromLocalSources,"AuthResolveEndpointsFromLocal"],[Gt.AuthorityGetCloudDiscoveryMetadataFromNetwork,"AuthGetCDMetaFromNet"],[Gt.AuthorityUpdateCloudDiscoveryMetadata,"AuthUpdCDMeta"],[Gt.AuthorityGetEndpointMetadataFromNetwork,"AuthUpdCDMetaFromNet"],[Gt.AuthorityUpdateEndpointMetadata,"AuthUpdEndpointMeta"],[Gt.AuthorityUpdateMetadataWithRegionalInformation,"AuthUpdMetaWithRegInfo"],[Gt.RegionDiscoveryDetectRegion,"RegDiscDetectReg"],[Gt.RegionDiscoveryGetRegionFromIMDS,"RegDiscGetRegFromIMDS"],[Gt.RegionDiscoveryGetCurrentVersion,"RegDiscGetCurrentVer"],[Gt.AcquireTokenByCodeAsync,"ATByCodeAsync"],[Gt.GetEndpointMetadataFromNetwork,"GetEndpointMetaFromNet"],[Gt.GetCloudDiscoveryMetadataFromNetworkMeasurement,"GetCDMetaFromNet"],[Gt.HandleRedirectPromiseMeasurement,"HandleRedirectPromise"],[Gt.HandleNativeRedirectPromiseMeasurement,"HandleNtvRedirectPromise"],[Gt.UpdateCloudDiscoveryMetadataMeasurement,"UpdateCDMeta"],[Gt.UsernamePasswordClientAcquireToken,"UserPassClientAT"],[Gt.NativeMessageHandlerHandshake,"NtvMsgHandlerHandshake"],[Gt.NativeGenerateAuthResult,"NtvGenAuthRes"],[Gt.RemoveHiddenIframe,"RemoveHiddenIframe"],[Gt.ClearTokensAndKeysWithClaims,"ClearTAndKeysWithClaims"],[Gt.CacheManagerGetRefreshToken,"CacheManagerGetRT"],[Gt.GeneratePkceCodes,"GenPkceCodes"],[Gt.GenerateCodeVerifier,"GenCodeVerifier"],[Gt.GenerateCodeChallengeFromVerifier,"GenCodeChallengeFromVerifier"],[Gt.Sha256Digest,"Sha256Digest"],[Gt.GetRandomValues,"GetRandomValues"],[Gt.GenerateHKDF,"genHKDF"],[Gt.GenerateBaseKey,"genBaseKey"],[Gt.Base64Decode,"b64Decode"],[Gt.UrlEncodeArr,"urlEncArr"],[Gt.Encrypt,"encrypt"],[Gt.Decrypt,"decrypt"],[Gt.GenerateEarKey,"genEarKey"],[Gt.DecryptEarResponse,"decryptEarResp"]]),Wt=new Set(["accessTokenSize","durationMs","idTokenSize","matsSilentStatus","matsHttpStatus","refreshTokenSize","queuedTimeMs","startTimeMs","status","multiMatchedAT","multiMatchedID","multiMatchedRT","unencryptedCacheCount","encryptedCacheExpiredCount","oldAccountCount","oldAccessCount","oldIdCount","oldRefreshCount","currAccountCount","currAccessCount","currIdCount","currRefreshCount","expiredCacheRemovedCount","upgradedCacheCount"]);class Vt{startMeasurement(){}endMeasurement(){}flushMeasurement(){return null}}class Qt{generateId(){return"callback-id"}startMeasurement(e,t){return{end:()=>null,discard:()=>{},add:()=>{},increment:()=>{},event:{eventId:this.generateId(),status:1,authority:"",libraryName:"",libraryVersion:"",clientId:"",name:e,startTimeMs:Date.now(),correlationId:t||""},measurement:new Vt}}startPerformanceMeasurement(){return new Vt}calculateQueuedTime(){return 0}addQueueMeasurement(){}setPreQueueTime(){}endMeasurement(){return null}discardMeasurements(){}removePerformanceCallback(){return!0}addPerformanceCallback(){return""}emitEvents(){}addFields(){}incrementFields(){}cacheEventByCorrelationId(){}}const Jt={tokenRenewalOffsetSeconds:300,preventCorsPreflight:!1},Yt={loggerCallback:()=>{},piiLoggingEnabled:!1,logLevel:t.LogLevel.Info,correlationId:n.EMPTY_STRING},Xt={claimsBasedCachingEnabled:!1},Zt={async sendGetRequestAsync(){throw Ne(Re)},async sendPostRequestAsync(){throw Ne(Re)}},en={sku:n.SKU,version:De,cpu:n.EMPTY_STRING,os:n.EMPTY_STRING},tn={clientSecret:n.EMPTY_STRING,clientAssertion:void 0},nn={azureCloudInstance:Be.None,tenant:`${n.DEFAULT_COMMON_TENANT}`},rn={application:{appName:"",appVersion:""}};function on(e){return e.authOptions.authority.options.protocolMode===Tt.OIDC}const an="home_account_id",sn="UPN",cn="client_id",ln="redirect_uri",un="token_type",dn="req_cnf",hn="return_spa_code",gn="x-client-xtra-sku",pn="brk_client_id",fn="brk_redirect_uri",mn="instance_aware";function yn(e,t,n){if(!t)return;const r=e.get(cn);r&&e.has(pn)&&n?.addFields({embeddedClientId:r,embeddedRedirectUri:e.get(ln)},t)}function vn(e,t){e.set("response_type",t)}function Cn(e,t,n=!0,r=o){!n||r.includes("openid")||t.includes("openid")||r.push("openid");const i=n?[...t||[],...r]:t||[],a=new ft(i);e.set("scope",a.printScopes())}function wn(e,t){e.set(cn,t)}function In(e,t){e.set(ln,t)}function Tn(e,t){e.set("login_hint",t)}function An(e,t){e.set(c,`UPN:${t}`)}function kn(e,t){e.set(c,`Oid:${t.uid}@${t.utid}`)}function Sn(e,t){e.set("sid",t)}function bn(e,t,n){const r=Bn(t,n);try{JSON.parse(r)}catch(e){throw gt(je)}e.set("claims",r)}function Rn(e,t){e.set("client-request-id",t)}function En(e,t){e.set("x-client-SKU",t.sku),e.set("x-client-VER",t.version),t.os&&e.set("x-client-OS",t.os),t.cpu&&e.set("x-client-CPU",t.cpu)}function Pn(e,t){t?.appName&&e.set("x-app-name",t.appName),t?.appVersion&&e.set("x-app-ver",t.appVersion)}function _n(e,t){t&&e.set("state",t)}function Mn(e,t,n){if(!t||!n)throw gt(Je);e.set("code_challenge",t),e.set("code_challenge_method",n)}function On(e,t){e.set("client_secret",t)}function Nn(e,t){t&&e.set("client_assertion",t)}function qn(e,t){t&&e.set("client_assertion_type",t)}function Ln(e,t){e.set("grant_type",t)}function xn(e){e.set("client_info","1")}function Un(e){e.has(mn)||e.set(mn,"true")}function Dn(e,t){Object.entries(t).forEach(([t,n])=>{!e.has(t)&&n&&e.set(t,n)})}function Bn(e,t){let n;if(e)try{n=JSON.parse(e)}catch(e){throw gt(je)}else n={};return t&&t.length>0&&(n.hasOwnProperty(f)||(n[f]={}),n[f].xms_cc={values:t}),JSON.stringify(n)}function Hn(e,t){t&&(e.set(un,P.POP),e.set(dn,t))}function Fn(e,t){t&&(e.set(un,P.SSH),e.set(dn,t))}function zn(e,t){e.set("x-client-current-telemetry",t.generateCurrentRequestHeaderValue()),e.set("x-client-last-telemetry",t.generateLastRequestHeaderValue())}function Kn(e){e.set("x-ms-lib-capability","retry-after, h429")}function $n(e,t,n){e.has(pn)||e.set(pn,t),e.has(fn)||e.set(fn,n)}const Gn=(e,t,n,r,o)=>(...i)=>{n.trace(`Executing function ${t}`);const a=r?.startMeasurement(t,o);if(o){const e=t+"CallCount";r?.incrementFields({[e]:1},o)}try{const r=e(...i);return a?.end({success:!0}),n.trace(`Returning result from ${t}`),r}catch(e){n.trace(`Error occurred in ${t}`);try{n.trace(JSON.stringify(e))}catch(e){n.trace("Unable to print error message.")}throw a?.end({success:!1},e),e}},jn=(e,t,n,r,o)=>(...i)=>{n.trace(`Executing function ${t}`);const a=r?.startMeasurement(t,o);if(o){const e=t+"CallCount";r?.incrementFields({[e]:1},o)}return r?.setPreQueueTime(t,o),e(...i).then(e=>(n.trace(`Returning result from ${t}`),a?.end({success:!0}),e)).catch(e=>{n.trace(`Error occurred in ${t}`);try{n.trace(JSON.stringify(e))}catch(e){n.trace("Unable to print error message.")}throw a?.end({success:!1},e),e})};class Wn{constructor(e,t,n,r){this.networkInterface=e,this.logger=t,this.performanceClient=n,this.correlationId=r}async detectRegion(e,t){this.performanceClient?.addQueueMeasurement(Gt.RegionDiscoveryDetectRegion,this.correlationId);let r=e;if(r)t.region_source="3";else{const o=Wn.IMDS_OPTIONS;try{const e=await jn(this.getRegionFromIMDS.bind(this),Gt.RegionDiscoveryGetRegionFromIMDS,this.logger,this.performanceClient,this.correlationId)(n.IMDS_VERSION,o);if(200===e.status&&(r=e.body,t.region_source="4"),400===e.status){const e=await jn(this.getCurrentVersion.bind(this),Gt.RegionDiscoveryGetCurrentVersion,this.logger,this.performanceClient,this.correlationId)(o);if(!e)return t.region_source="1",null;const n=await jn(this.getRegionFromIMDS.bind(this),Gt.RegionDiscoveryGetRegionFromIMDS,this.logger,this.performanceClient,this.correlationId)(e,o);200===n.status&&(r=n.body,t.region_source="4")}}catch(e){return t.region_source="1",null}}return r||(t.region_source="1"),r||null}async getRegionFromIMDS(e,t){return this.performanceClient?.addQueueMeasurement(Gt.RegionDiscoveryGetRegionFromIMDS,this.correlationId),this.networkInterface.sendGetRequestAsync(`${n.IMDS_ENDPOINT}?api-version=${e}&format=text`,t,n.IMDS_TIMEOUT)}async getCurrentVersion(e){this.performanceClient?.addQueueMeasurement(Gt.RegionDiscoveryGetCurrentVersion,this.correlationId);try{const t=await this.networkInterface.sendGetRequestAsync(`${n.IMDS_ENDPOINT}?format=json`,e);return 400===t.status&&t.body&&t.body["newest-versions"]&&t.body["newest-versions"].length>0?t.body["newest-versions"][0]:null}catch(e){return null}}}function Vn(){return Math.round((new Date).getTime()/1e3)}function Qn(e){return e.getTime()/1e3}function Jn(e){return e?new Date(1e3*Number(e)):new Date}function Yn(e,t){const n=Number(e)||0;return Vn()+t>n}function Xn(e,t){const n=Number(e)+24*t*60*60*1e3;return Date.now()>n}function Zn(e){return Number(e)>Vn()}function er(e,t,n,r,o){return{credentialType:w.ID_TOKEN,homeAccountId:e,environment:t,clientId:r,secret:n,realm:o,lastUpdatedAt:Date.now().toString()}}function tr(e,t,n,r,o,i,a,s,c,l,u,d,h,g,p){const f={homeAccountId:e,credentialType:w.ACCESS_TOKEN,secret:n,cachedAt:Vn().toString(),expiresOn:a.toString(),extendedExpiresOn:s.toString(),environment:t,clientId:r,realm:o,target:i,tokenType:u||P.BEARER,lastUpdatedAt:Date.now().toString()};if(d&&(f.userAssertionHash=d),l&&(f.refreshOn=l.toString()),g&&(f.requestedClaims=g,f.requestedClaimsHash=p),f.tokenType?.toLowerCase()!==P.BEARER.toLowerCase())switch(f.credentialType=w.ACCESS_TOKEN_WITH_AUTH_SCHEME,f.tokenType){case P.POP:const e=kt(n,c);if(!e?.cnf?.kid)throw Ne(Ce);f.keyId=e.cnf.kid;break;case P.SSH:f.keyId=h}return f}function nr(e,t,n,r,o,i,a){const s={credentialType:w.REFRESH_TOKEN,homeAccountId:e,environment:t,clientId:r,secret:n,lastUpdatedAt:Date.now().toString()};return i&&(s.userAssertionHash=i),o&&(s.familyId=o),a&&(s.expiresOn=a.toString()),s}function rr(e){return e.hasOwnProperty("homeAccountId")&&e.hasOwnProperty("environment")&&e.hasOwnProperty("credentialType")&&e.hasOwnProperty("clientId")&&e.hasOwnProperty("secret")}function or(e){return!!e&&rr(e)&&e.hasOwnProperty("realm")&&e.hasOwnProperty("target")&&(e.credentialType===w.ACCESS_TOKEN||e.credentialType===w.ACCESS_TOKEN_WITH_AUTH_SCHEME)}function ir(e){return!!e&&rr(e)&&e.credentialType===w.REFRESH_TOKEN}function ar(){return Vn()+86400}function sr(e,t,n){e.authorization_endpoint=t.authorization_endpoint,e.token_endpoint=t.token_endpoint,e.end_session_endpoint=t.end_session_endpoint,e.issuer=t.issuer,e.endpointsFromNetwork=n,e.jwks_uri=t.jwks_uri}function cr(e,t,n){e.aliases=t.aliases,e.preferred_cache=t.preferred_cache,e.preferred_network=t.preferred_network,e.aliasesFromNetwork=n}function lr(e){return e.expiresAt<=Vn()}Wn.IMDS_OPTIONS={headers:{Metadata:"true"}};class ur{constructor(e,t,n,r,o,i,a,s){this.canonicalAuthority=e,this._canonicalAuthority.validateAsUri(),this.networkInterface=t,this.cacheManager=n,this.authorityOptions=r,this.regionDiscoveryMetadata={region_used:void 0,region_source:void 0,region_outcome:void 0},this.logger=o,this.performanceClient=a,this.correlationId=i,this.managedIdentity=s||!1,this.regionDiscovery=new Wn(t,this.logger,this.performanceClient,this.correlationId)}getAuthorityType(e){if(e.HostNameAndPort.endsWith(n.CIAM_AUTH_URL))return 3;const t=e.PathSegments;if(t.length)switch(t[0].toLowerCase()){case n.ADFS:return 1;case n.DSTS:return 2}return 0}get authorityType(){return this.getAuthorityType(this.canonicalAuthorityUrlComponents)}get protocolMode(){return this.authorityOptions.protocolMode}get options(){return this.authorityOptions}get canonicalAuthority(){return this._canonicalAuthority.urlString}set canonicalAuthority(e){this._canonicalAuthority=new Ot(e),this._canonicalAuthority.validateAsUri(),this._canonicalAuthorityUrlComponents=null}get canonicalAuthorityUrlComponents(){return this._canonicalAuthorityUrlComponents||(this._canonicalAuthorityUrlComponents=this._canonicalAuthority.getUrlComponents()),this._canonicalAuthorityUrlComponents}get hostnameAndPort(){return this.canonicalAuthorityUrlComponents.HostNameAndPort.toLowerCase()}get tenant(){return this.canonicalAuthorityUrlComponents.PathSegments[0]}get authorizationEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.authorization_endpoint);throw Ne(K)}get tokenEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.token_endpoint);throw Ne(K)}get deviceCodeEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.token_endpoint.replace("/token","/devicecode"));throw Ne(K)}get endSessionEndpoint(){if(this.discoveryComplete()){if(!this.metadata.end_session_endpoint)throw Ne(Te);return this.replacePath(this.metadata.end_session_endpoint)}throw Ne(K)}get selfSignedJwtAudience(){if(this.discoveryComplete())return this.replacePath(this.metadata.issuer);throw Ne(K)}get jwksUri(){if(this.discoveryComplete())return this.replacePath(this.metadata.jwks_uri);throw Ne(K)}canReplaceTenant(e){return 1===e.PathSegments.length&&!ur.reservedTenantDomains.has(e.PathSegments[0])&&0===this.getAuthorityType(e)&&this.protocolMode!==Tt.OIDC}replaceTenant(e){return e.replace(/{tenant}|{tenantid}/g,this.tenant)}replacePath(e){let t=e;const n=new Ot(this.metadata.canonical_authority).getUrlComponents(),r=n.PathSegments;return this.canonicalAuthorityUrlComponents.PathSegments.forEach((e,o)=>{let i=r[o];if(0===o&&this.canReplaceTenant(n)){const e=new Ot(this.metadata.authorization_endpoint).getUrlComponents().PathSegments[0];i!==e&&(this.logger.verbose(`Replacing tenant domain name ${i} with id ${e}`),i=e)}e!==i&&(t=t.replace(`/${i}/`,`/${e}/`))}),this.replaceTenant(t)}get defaultOpenIdConfigurationEndpoint(){const e=this.hostnameAndPort;return this.canonicalAuthority.endsWith("v2.0/")||1===this.authorityType||this.protocolMode===Tt.OIDC&&!this.isAliasOfKnownMicrosoftAuthority(e)?`${this.canonicalAuthority}.well-known/openid-configuration`:`${this.canonicalAuthority}v2.0/.well-known/openid-configuration`}discoveryComplete(){return!!this.metadata}async resolveEndpointsAsync(){this.performanceClient?.addQueueMeasurement(Gt.AuthorityResolveEndpointsAsync,this.correlationId);const e=this.getCurrentMetadataEntity(),t=await jn(this.updateCloudDiscoveryMetadata.bind(this),Gt.AuthorityUpdateCloudDiscoveryMetadata,this.logger,this.performanceClient,this.correlationId)(e);this.canonicalAuthority=this.canonicalAuthority.replace(this.hostnameAndPort,e.preferred_network);const n=await jn(this.updateEndpointMetadata.bind(this),Gt.AuthorityUpdateEndpointMetadata,this.logger,this.performanceClient,this.correlationId)(e);this.updateCachedMetadata(e,t,{source:n}),this.performanceClient?.addFields({cloudDiscoverySource:t,authorityEndpointSource:n},this.correlationId)}getCurrentMetadataEntity(){let e=this.cacheManager.getAuthorityMetadataByAlias(this.hostnameAndPort);return e||(e={aliases:[],preferred_cache:this.hostnameAndPort,preferred_network:this.hostnameAndPort,canonical_authority:this.canonicalAuthority,authorization_endpoint:"",token_endpoint:"",end_session_endpoint:"",issuer:"",aliasesFromNetwork:!1,endpointsFromNetwork:!1,expiresAt:ar(),jwks_uri:""}),e}updateCachedMetadata(e,t,n){t!==S&&n?.source!==S&&(e.expiresAt=ar(),e.canonical_authority=this.canonicalAuthority);const r=this.cacheManager.generateAuthorityMetadataCacheKey(e.preferred_cache);this.cacheManager.setAuthorityMetadata(r,e),this.metadata=e}async updateEndpointMetadata(e){this.performanceClient?.addQueueMeasurement(Gt.AuthorityUpdateEndpointMetadata,this.correlationId);const t=this.updateEndpointMetadataFromLocalSources(e);if(t)return t.source===R&&this.authorityOptions.azureRegionConfiguration?.azureRegion&&t.metadata&&(sr(e,await jn(this.updateMetadataWithRegionalInformation.bind(this),Gt.AuthorityUpdateMetadataWithRegionalInformation,this.logger,this.performanceClient,this.correlationId)(t.metadata),!1),e.canonical_authority=this.canonicalAuthority),t.source;let n=await jn(this.getEndpointMetadataFromNetwork.bind(this),Gt.AuthorityGetEndpointMetadataFromNetwork,this.logger,this.performanceClient,this.correlationId)();if(n)return this.authorityOptions.azureRegionConfiguration?.azureRegion&&(n=await jn(this.updateMetadataWithRegionalInformation.bind(this),Gt.AuthorityUpdateMetadataWithRegionalInformation,this.logger,this.performanceClient,this.correlationId)(n)),sr(e,n,!0),b;throw Ne(G,this.defaultOpenIdConfigurationEndpoint)}updateEndpointMetadataFromLocalSources(e){this.logger.verbose("Attempting to get endpoint metadata from authority configuration");const t=this.getEndpointMetadataFromConfig();if(t)return this.logger.verbose("Found endpoint metadata in authority configuration"),sr(e,t,!1),{source:k};if(this.logger.verbose("Did not find endpoint metadata in the config... Attempting to get endpoint metadata from the hardcoded values."),this.authorityOptions.skipAuthorityMetadataCache)this.logger.verbose("Skipping hardcoded metadata cache since skipAuthorityMetadataCache is set to true. Attempting to get endpoint metadata from the network metadata cache.");else{const t=this.getEndpointMetadataFromHardcodedValues();if(t)return sr(e,t,!1),{source:R,metadata:t};this.logger.verbose("Did not find endpoint metadata in hardcoded values... Attempting to get endpoint metadata from the network metadata cache.")}const n=lr(e);return this.isAuthoritySameType(e)&&e.endpointsFromNetwork&&!n?(this.logger.verbose("Found endpoint metadata in the cache."),{source:S}):(n&&this.logger.verbose("The metadata entity is expired."),null)}isAuthoritySameType(e){return new Ot(e.canonical_authority).getUrlComponents().PathSegments.length===this.canonicalAuthorityUrlComponents.PathSegments.length}getEndpointMetadataFromConfig(){if(this.authorityOptions.authorityMetadata)try{return JSON.parse(this.authorityOptions.authorityMetadata)}catch(e){throw gt(Xe)}return null}async getEndpointMetadataFromNetwork(){this.performanceClient?.addQueueMeasurement(Gt.AuthorityGetEndpointMetadataFromNetwork,this.correlationId);const e={},t=this.defaultOpenIdConfigurationEndpoint;this.logger.verbose(`Authority.getEndpointMetadataFromNetwork: attempting to retrieve OAuth endpoints from ${t}`);try{const n=await this.networkInterface.sendGetRequestAsync(t,e),r=function(e){return e.hasOwnProperty("authorization_endpoint")&&e.hasOwnProperty("token_endpoint")&&e.hasOwnProperty("issuer")&&e.hasOwnProperty("jwks_uri")}(n.body);return r?n.body:(this.logger.verbose("Authority.getEndpointMetadataFromNetwork: could not parse response as OpenID configuration"),null)}catch(e){return this.logger.verbose(`Authority.getEndpointMetadataFromNetwork: ${e}`),null}}getEndpointMetadataFromHardcodedValues(){return this.hostnameAndPort in Nt?Nt[this.hostnameAndPort]:null}async updateMetadataWithRegionalInformation(e){this.performanceClient?.addQueueMeasurement(Gt.AuthorityUpdateMetadataWithRegionalInformation,this.correlationId);const t=this.authorityOptions.azureRegionConfiguration?.azureRegion;if(t){if(t!==n.AZURE_REGION_AUTO_DISCOVER_FLAG)return this.regionDiscoveryMetadata.region_outcome="2",this.regionDiscoveryMetadata.region_used=t,ur.replaceWithRegionalInformation(e,t);const r=await jn(this.regionDiscovery.detectRegion.bind(this.regionDiscovery),Gt.RegionDiscoveryDetectRegion,this.logger,this.performanceClient,this.correlationId)(this.authorityOptions.azureRegionConfiguration?.environmentRegion,this.regionDiscoveryMetadata);if(r)return this.regionDiscoveryMetadata.region_outcome="4",this.regionDiscoveryMetadata.region_used=r,ur.replaceWithRegionalInformation(e,r);this.regionDiscoveryMetadata.region_outcome="5"}return e}async updateCloudDiscoveryMetadata(e){this.performanceClient?.addQueueMeasurement(Gt.AuthorityUpdateCloudDiscoveryMetadata,this.correlationId);const t=this.updateCloudDiscoveryMetadataFromLocalSources(e);if(t)return t;const n=await jn(this.getCloudDiscoveryMetadataFromNetwork.bind(this),Gt.AuthorityGetCloudDiscoveryMetadataFromNetwork,this.logger,this.performanceClient,this.correlationId)();if(n)return cr(e,n,!0),b;throw gt(Ze)}updateCloudDiscoveryMetadataFromLocalSources(e){this.logger.verbose("Attempting to get cloud discovery metadata  from authority configuration"),this.logger.verbosePii(`Known Authorities: ${this.authorityOptions.knownAuthorities||n.NOT_APPLICABLE}`),this.logger.verbosePii(`Authority Metadata: ${this.authorityOptions.authorityMetadata||n.NOT_APPLICABLE}`),this.logger.verbosePii(`Canonical Authority: ${e.canonical_authority||n.NOT_APPLICABLE}`);const t=this.getCloudDiscoveryMetadataFromConfig();if(t)return this.logger.verbose("Found cloud discovery metadata in authority configuration"),cr(e,t,!1),k;if(this.logger.verbose("Did not find cloud discovery metadata in the config... Attempting to get cloud discovery metadata from the hardcoded values."),this.options.skipAuthorityMetadataCache)this.logger.verbose("Skipping hardcoded cloud discovery metadata cache since skipAuthorityMetadataCache is set to true. Attempting to get cloud discovery metadata from the network metadata cache.");else{const t=(r=this.hostnameAndPort,Ut(qt.metadata,r));if(t)return this.logger.verbose("Found cloud discovery metadata from hardcoded values."),cr(e,t,!1),R;this.logger.verbose("Did not find cloud discovery metadata in hardcoded values... Attempting to get cloud discovery metadata from the network metadata cache.")}var r;const o=lr(e);return this.isAuthoritySameType(e)&&e.aliasesFromNetwork&&!o?(this.logger.verbose("Found cloud discovery metadata in the cache."),S):(o&&this.logger.verbose("The metadata entity is expired."),null)}getCloudDiscoveryMetadataFromConfig(){if(3===this.authorityType)return this.logger.verbose("CIAM authorities do not support cloud discovery metadata, generate the aliases from authority host."),ur.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort);if(this.authorityOptions.cloudDiscoveryMetadata){this.logger.verbose("The cloud discovery metadata has been provided as a network response, in the config.");try{this.logger.verbose("Attempting to parse the cloud discovery metadata.");const e=Ut(JSON.parse(this.authorityOptions.cloudDiscoveryMetadata).metadata,this.hostnameAndPort);if(this.logger.verbose("Parsed the cloud discovery metadata."),e)return this.logger.verbose("There is returnable metadata attached to the parsed cloud discovery metadata."),e;this.logger.verbose("There is no metadata attached to the parsed cloud discovery metadata.")}catch(e){throw this.logger.verbose("Unable to parse the cloud discovery metadata. Throwing Invalid Cloud Discovery Metadata Error."),gt(Ye)}}return this.isInKnownAuthorities()?(this.logger.verbose("The host is included in knownAuthorities. Creating new cloud discovery metadata from the host."),ur.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort)):null}async getCloudDiscoveryMetadataFromNetwork(){this.performanceClient?.addQueueMeasurement(Gt.AuthorityGetCloudDiscoveryMetadataFromNetwork,this.correlationId);const e=`${n.AAD_INSTANCE_DISCOVERY_ENDPT}${this.canonicalAuthority}oauth2/v2.0/authorize`,t={};let r=null;try{const o=await this.networkInterface.sendGetRequestAsync(e,t);let i,a;if(function(e){return e.hasOwnProperty("tenant_discovery_endpoint")&&e.hasOwnProperty("metadata")}(o.body))i=o.body,a=i.metadata,this.logger.verbosePii(`tenant_discovery_endpoint is: ${i.tenant_discovery_endpoint}`);else{if(!function(e){return e.hasOwnProperty("error")&&e.hasOwnProperty("error_description")}(o.body))return this.logger.error("AAD did not return a CloudInstanceDiscoveryResponse or CloudInstanceDiscoveryErrorResponse"),null;if(this.logger.warning(`A CloudInstanceDiscoveryErrorResponse was returned. The cloud instance discovery network request's status code is: ${o.status}`),i=o.body,i.error===n.INVALID_INSTANCE)return this.logger.error("The CloudInstanceDiscoveryErrorResponse error is invalid_instance."),null;this.logger.warning(`The CloudInstanceDiscoveryErrorResponse error is ${i.error}`),this.logger.warning(`The CloudInstanceDiscoveryErrorResponse error description is ${i.error_description}`),this.logger.warning("Setting the value of the CloudInstanceDiscoveryMetadata (returned from the network) to []"),a=[]}this.logger.verbose("Attempting to find a match between the developer's authority and the CloudInstanceDiscoveryMetadata returned from the network request."),r=Ut(a,this.hostnameAndPort)}catch(e){if(e instanceof U)this.logger.error(`There was a network error while attempting to get the cloud discovery instance metadata.\nError: ${e.errorCode}\nError Description: ${e.errorMessage}`);else{const t=e;this.logger.error(`A non-MSALJS error was thrown while attempting to get the cloud instance discovery metadata.\nError: ${t.name}\nError Description: ${t.message}`)}return null}return r||(this.logger.warning("The developer's authority was not found within the CloudInstanceDiscoveryMetadata returned from the network request."),this.logger.verbose("Creating custom Authority for custom domain scenario."),r=ur.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort)),r}isInKnownAuthorities(){return this.authorityOptions.knownAuthorities.filter(e=>e&&Ot.getDomainFromUrl(e).toLowerCase()===this.hostnameAndPort).length>0}static generateAuthority(e,t){let r;if(t&&t.azureCloudInstance!==Be.None){const e=t.tenant?t.tenant:n.DEFAULT_COMMON_TENANT;r=`${t.azureCloudInstance}/${e}/`}return r||e}static createCloudDiscoveryMetadataFromHost(e){return{preferred_network:e,preferred_cache:e,aliases:[e]}}getPreferredCache(){if(this.managedIdentity)return n.DEFAULT_AUTHORITY_HOST;if(this.discoveryComplete())return this.metadata.preferred_cache;throw Ne(K)}isAlias(e){return this.metadata.aliases.indexOf(e)>-1}isAliasOfKnownMicrosoftAuthority(e){return Lt.has(e)}static isPublicCloudAuthority(e){return n.KNOWN_PUBLIC_CLOUDS.indexOf(e)>=0}static buildRegionalAuthorityString(e,t,r){const o=new Ot(e);o.validateAsUri();const i=o.getUrlComponents();let a=`${t}.${i.HostNameAndPort}`;this.isPublicCloudAuthority(i.HostNameAndPort)&&(a=`${t}.${n.REGIONAL_AUTH_PUBLIC_CLOUD_SUFFIX}`);const s=Ot.constructAuthorityUriFromObject({...o.getUrlComponents(),HostNameAndPort:a}).urlString;return r?`${s}?${r}`:s}static replaceWithRegionalInformation(e,t){const n={...e};return n.authorization_endpoint=ur.buildRegionalAuthorityString(n.authorization_endpoint,t),n.token_endpoint=ur.buildRegionalAuthorityString(n.token_endpoint,t),n.end_session_endpoint&&(n.end_session_endpoint=ur.buildRegionalAuthorityString(n.end_session_endpoint,t)),n}static transformCIAMAuthority(e){let t=e;const r=new Ot(e).getUrlComponents();return 0===r.PathSegments.length&&r.HostNameAndPort.endsWith(n.CIAM_AUTH_URL)&&(t=`${t}${r.HostNameAndPort.split(".")[0]}${n.AAD_TENANT_DOMAIN_SUFFIX}`),t}}function dr(e){return e.endsWith(n.FORWARD_SLASH)?e:`${e}${n.FORWARD_SLASH}`}function hr(e){const t=e.cloudDiscoveryMetadata;let n;if(t)try{n=JSON.parse(t)}catch(e){throw gt(Ye)}return{canonicalAuthority:e.authority?dr(e.authority):void 0,knownAuthorities:e.knownAuthorities,cloudDiscoveryMetadata:n}}async function gr(e,t,n,r,o,i,a){a?.addQueueMeasurement(Gt.AuthorityFactoryCreateDiscoveredInstance,i);const s=ur.transformCIAMAuthority(dr(e)),c=new ur(s,t,n,r,o,i,a);try{return await jn(c.resolveEndpointsAsync.bind(c),Gt.AuthorityResolveEndpointsAsync,o,a,i)(),c}catch(e){throw Ne(K)}}ur.reservedTenantDomains=new Set(["{tenant}","{tenantid}",h,p,g]);class pr extends U{constructor(e,t,n,r,o){super(e,t,n),this.name="ServerError",this.errorNo=r,this.status=o,Object.setPrototypeOf(this,pr.prototype)}}function fr(e,t,n){return{clientId:e,authority:t.authority,scopes:t.scopes,homeAccountIdentifier:n,claims:t.claims,authenticationScheme:t.authenticationScheme,resourceRequestMethod:t.resourceRequestMethod,resourceRequestUri:t.resourceRequestUri,shrClaims:t.shrClaims,sshKid:t.sshKid,embeddedClientId:t.embeddedClientId||t.tokenBodyParameters?.clientId}}class mr{static generateThrottlingStorageKey(e){return`${_}.${JSON.stringify(e)}`}static preProcess(e,t,r){const o=mr.generateThrottlingStorageKey(t),i=e.getThrottlingCache(o);if(i){if(i.throttleTime<Date.now())return void e.removeItem(o,r);throw new pr(i.errorCodes?.join(" ")||n.EMPTY_STRING,i.errorMessage,i.subError)}}static postProcess(e,t,n,r){if(mr.checkResponseStatus(n)||mr.checkResponseForRetryAfter(n)){const o={throttleTime:mr.calculateThrottleTime(parseInt(n.headers[s])),error:n.body.error,errorCodes:n.body.error_codes,errorMessage:n.body.error_description,subError:n.body.suberror};e.setThrottlingCache(mr.generateThrottlingStorageKey(t),o,r)}}static checkResponseStatus(e){return 429===e.status||e.status>=500&&e.status<600}static checkResponseForRetryAfter(e){return!!e.headers&&e.headers.hasOwnProperty(s)&&(e.status<200||e.status>=300)}static calculateThrottleTime(e){const t=e<=0?0:e,n=Date.now()/1e3;return Math.floor(1e3*Math.min(n+(t||60),n+3600))}static removeThrottle(e,t,n,r){const o=fr(t,n,r),i=this.generateThrottlingStorageKey(o);e.removeItem(i,n.correlationId)}}class yr extends U{constructor(e,t,n){super(e.errorCode,e.errorMessage,e.subError),Object.setPrototypeOf(this,yr.prototype),this.name="NetworkError",this.error=e,this.httpStatus=t,this.responseHeaders=n}}function vr(e,t,n,r){return e.errorMessage=`${e.errorMessage}, additionalErrorInfo: error.name:${r?.name}, error.message:${r?.message}`,new yr(e,t,n)}class Cr{constructor(e,t){this.config=function({authOptions:e,systemOptions:t,loggerOptions:n,cacheOptions:r,storageInterface:o,networkInterface:i,cryptoInterface:a,clientCredentials:s,libraryInfo:c,telemetry:l,serverTelemetryManager:u,persistencePlugin:d,serializableCache:h}){const g={...Yt,...n};return{authOptions:(p=e,{clientCapabilities:[],azureCloudOptions:nn,skipAuthorityMetadataCache:!1,instanceAware:!1,encodeExtraQueryParams:!1,...p}),systemOptions:{...Jt,...t},loggerOptions:g,cacheOptions:{...Xt,...r},storageInterface:o||new $t(e.clientId,qe,new xe(g),new Qt),networkInterface:i||Zt,cryptoInterface:a||qe,clientCredentials:s||tn,libraryInfo:{...en,...c},telemetry:{...rn,...l},serverTelemetryManager:u||null,persistencePlugin:d||null,serializableCache:h||null};var p}(e),this.logger=new xe(this.config.loggerOptions,Ue,De),this.cryptoUtils=this.config.cryptoInterface,this.cacheManager=this.config.storageInterface,this.networkClient=this.config.networkInterface,this.serverTelemetryManager=this.config.serverTelemetryManager,this.authority=this.config.authOptions.authority,this.performanceClient=t}createTokenRequestHeaders(e){const t={};if(t[a]=n.URL_FORM_CONTENT_TYPE,!this.config.systemOptions.preventCorsPreflight&&e)switch(e.type){case an:try{const n=yt(e.credential);t[c]=`Oid:${n.uid}@${n.utid}`}catch(e){this.logger.verbose("Could not parse home account ID for CCS Header: "+e)}break;case sn:t[c]=`UPN: ${e.credential}`}return t}async executePostToTokenEndpoint(e,t,n,r,o,i){i&&this.performanceClient?.addQueueMeasurement(i,o);const a=await this.sendPostRequest(r,e,{body:t,headers:n},o);return this.config.serverTelemetryManager&&a.status<500&&429!==a.status&&this.config.serverTelemetryManager.clearTelemetryCache(),a}async sendPostRequest(e,t,n,r){let o;mr.preProcess(this.cacheManager,e,r);try{o=await jn(this.networkClient.sendPostRequestAsync.bind(this.networkClient),Gt.NetworkClientSendPostRequestAsync,this.logger,this.performanceClient,r)(t,n);const e=o.headers||{};this.performanceClient?.addFields({refreshTokenSize:o.body.refresh_token?.length||0,httpVerToken:e[u]||"",requestId:e[l]||""},r)}catch(e){if(e instanceof yr){const t=e.responseHeaders;throw t&&this.performanceClient?.addFields({httpVerToken:t[u]||"",requestId:t[l]||"",contentTypeHeader:t[a]||void 0,contentLengthHeader:t["Content-Length"]||void 0,httpStatus:e.httpStatus},r),e.error}throw e instanceof U?e:Ne($)}return mr.postProcess(this.cacheManager,e,o,r),o}async updateAuthority(e,t){this.performanceClient?.addQueueMeasurement(Gt.UpdateTokenEndpointAuthority,t);const n=`https://${e}/${this.authority.tenant}/`,r=await gr(n,this.networkClient,this.cacheManager,this.authority.options,this.logger,t,this.performanceClient);this.authority=r}createTokenQueryParameters(e){const t=new Map;return e.embeddedClientId&&$n(t,this.config.authOptions.clientId,this.config.authOptions.redirectUri),e.tokenQueryParameters&&Dn(t,e.tokenQueryParameters),Rn(t,e.correlationId),yn(t,e.correlationId,this.performanceClient),_t(t)}}const wr="no_tokens_found",Ir="native_account_unavailable",Tr="refresh_token_expired",Ar="ux_not_allowed",kr="interaction_required",Sr="consent_required",br="login_required",Rr="bad_token";var Er=Object.freeze({__proto__:null,badToken:Rr,consentRequired:Sr,interactionRequired:kr,loginRequired:br,nativeAccountUnavailable:Ir,noTokensFound:wr,refreshTokenExpired:Tr,uxNotAllowed:Ar});const Pr=[kr,Sr,br,Rr,Ar],_r=["message_only","additional_action","basic_action","user_password_expired","consent_required","bad_token"],Mr={[wr]:"No refresh token found in the cache. Please sign-in.",[Ir]:"The requested account is not available in the native broker. It may have been deleted or logged out. Please sign-in again using an interactive API.",[Tr]:"Refresh token has expired.",[Rr]:"Identity provider returned bad_token due to an expired or invalid refresh token. Please invoke an interactive API to resolve.",[Ar]:"`canShowUI` flag in Edge was set to false. User interaction required on web page. Please invoke an interactive API to resolve."},Or={noTokensFoundError:{code:wr,desc:Mr[wr]},native_account_unavailable:{code:Ir,desc:Mr[Ir]},bad_token:{code:Rr,desc:Mr[Rr]}};class Nr extends U{constructor(e,t,r,o,i,a,s,c){super(e,t,r),Object.setPrototypeOf(this,Nr.prototype),this.timestamp=o||n.EMPTY_STRING,this.traceId=i||n.EMPTY_STRING,this.correlationId=a||n.EMPTY_STRING,this.claims=s||n.EMPTY_STRING,this.name="InteractionRequiredAuthError",this.errorNo=c}}function qr(e,t,n){const r=!!e&&Pr.indexOf(e)>-1,o=!!n&&_r.indexOf(n)>-1,i=!!t&&Pr.some(e=>t.indexOf(e)>-1);return r||i||o}function Lr(e){return new Nr(e,Mr[e])}class xr{static setRequestState(e,t,r){const o=xr.generateLibraryState(e,r);return t?`${o}${n.RESOURCE_DELIM}${t}`:o}static generateLibraryState(e,t){if(!e)throw Ne(ge);const n={id:e.createNewGuid()};t&&(n.meta=t);const r=JSON.stringify(n);return e.base64Encode(r)}static parseRequestState(e,t){if(!e)throw Ne(ge);if(!t)throw Ne(W);try{const r=t.split(n.RESOURCE_DELIM),o=r[0],i=r.length>1?r.slice(1).join(n.RESOURCE_DELIM):n.EMPTY_STRING,a=e.base64Decode(o),s=JSON.parse(a);return{userRequestState:i||n.EMPTY_STRING,libraryState:s}}catch(e){throw Ne(W)}}}class Ur{constructor(e,t){this.cryptoUtils=e,this.performanceClient=t}async generateCnf(e,t){this.performanceClient?.addQueueMeasurement(Gt.PopTokenGenerateCnf,e.correlationId);const n=await jn(this.generateKid.bind(this),Gt.PopTokenGenerateCnf,t,this.performanceClient,e.correlationId)(e),r=this.cryptoUtils.base64UrlEncode(JSON.stringify(n));return{kid:n.kid,reqCnfString:r}}async generateKid(e){return this.performanceClient?.addQueueMeasurement(Gt.PopTokenGenerateKid,e.correlationId),{kid:await this.cryptoUtils.getPublicKeyThumbprint(e),xms_ksl:"sw"}}async signPopToken(e,t,n){return this.signPayload(e,t,n)}async signPayload(e,t,n,r){const{resourceRequestMethod:o,resourceRequestUri:i,shrClaims:a,shrNonce:s,shrOptions:c}=n,l=i?new Ot(i):void 0,u=l?.getUrlComponents();return this.cryptoUtils.signJwt({at:e,ts:Vn(),m:o?.toUpperCase(),u:u?.HostNameAndPort,nonce:s||this.cryptoUtils.createNewGuid(),p:u?.AbsolutePath,q:u?.QueryString?[[],u.QueryString]:void 0,client_claims:a||void 0,...r},t,c,n.correlationId)}}class Dr{constructor(e,t){this.cache=e,this.hasChanged=t}get cacheHasChanged(){return this.hasChanged}get tokenCache(){return this.cache}}class Br{constructor(e,t,n,r,o,i,a){this.clientId=e,this.cacheStorage=t,this.cryptoObj=n,this.logger=r,this.serializableCache=o,this.persistencePlugin=i,this.performanceClient=a}validateTokenResponse(e,t){if(e.error||e.error_description||e.suberror){const r=`Error(s): ${e.error_codes||n.NOT_AVAILABLE} - Timestamp: ${e.timestamp||n.NOT_AVAILABLE} - Description: ${e.error_description||n.NOT_AVAILABLE} - Correlation ID: ${e.correlation_id||n.NOT_AVAILABLE} - Trace ID: ${e.trace_id||n.NOT_AVAILABLE}`,o=e.error_codes?.length?e.error_codes[0]:void 0,i=new pr(e.error,r,e.suberror,o,e.status);if(t&&e.status&&e.status>=500&&e.status<=599)return void this.logger.warning(`executeTokenRequest:validateTokenResponse - AAD is currently unavailable and the access token is unable to be refreshed.\n${i}`);if(t&&e.status&&e.status>=400&&e.status<=499)return void this.logger.warning(`executeTokenRequest:validateTokenResponse - AAD is currently available but is unable to refresh the access token.\n${i}`);if(qr(e.error,e.error_description,e.suberror))throw new Nr(e.error,e.error_description,e.suberror,e.timestamp||n.EMPTY_STRING,e.trace_id||n.EMPTY_STRING,e.correlation_id||n.EMPTY_STRING,e.claims||n.EMPTY_STRING,o);throw i}}async handleServerTokenResponse(e,t,r,o,i,a,s,c,l){let u,d;if(this.performanceClient?.addQueueMeasurement(Gt.HandleServerTokenResponse,e.correlation_id),e.id_token){if(u=kt(e.id_token||n.EMPTY_STRING,this.cryptoObj.base64Decode),i&&i.nonce&&u.nonce!==i.nonce)throw Ne(J);if(o.maxAge||0===o.maxAge){const e=u.auth_time;if(!e)throw Ne(Y);bt(e,o.maxAge)}}this.homeAccountIdentifier=At.generateHomeAccountId(e.client_info||n.EMPTY_STRING,t.authorityType,this.logger,this.cryptoObj,u),i&&i.state&&(d=xr.parseRequestState(this.cryptoObj,i.state)),e.key_id=e.key_id||o.sshKid||void 0;const h=this.generateCacheRecord(e,t,r,o,u,a,i);let g;try{if(this.persistencePlugin&&this.serializableCache&&(this.logger.verbose("Persistence enabled, calling beforeCacheAccess"),g=new Dr(this.serializableCache,!0),await this.persistencePlugin.beforeCacheAccess(g)),s&&!c&&h.account){const e=this.cacheStorage.generateAccountKey(At.getAccountInfo(h.account));if(!this.cacheStorage.getAccount(e,o.correlationId))return this.logger.warning("Account used to refresh tokens not in persistence, refreshed tokens will not be stored in the cache"),await Br.generateAuthenticationResult(this.cryptoObj,t,h,!1,o,u,d,void 0,l)}await this.cacheStorage.saveCacheRecord(h,o.correlationId,St(u||{}),o.storeInCache)}finally{this.persistencePlugin&&this.serializableCache&&g&&(this.logger.verbose("Persistence enabled, calling afterCacheAccess"),await this.persistencePlugin.afterCacheAccess(g))}return Br.generateAuthenticationResult(this.cryptoObj,t,h,!1,o,u,d,e,l)}generateCacheRecord(e,t,n,r,o,i,a){const s=t.getPreferredCache();if(!s)throw Ne(de);const c=It(o);let l,u;e.id_token&&o&&(l=er(this.homeAccountIdentifier,s,e.id_token,this.clientId,c||""),u=Hr(this.cacheStorage,t,this.homeAccountIdentifier,this.cryptoObj.base64Decode,r.correlationId,o,e.client_info,s,c,a,void 0,this.logger));let d=null;if(e.access_token){const o=e.scope?ft.fromString(e.scope):new ft(r.scopes||[]),a=("string"==typeof e.expires_in?parseInt(e.expires_in,10):e.expires_in)||0,l=("string"==typeof e.ext_expires_in?parseInt(e.ext_expires_in,10):e.ext_expires_in)||0,u=("string"==typeof e.refresh_in?parseInt(e.refresh_in,10):e.refresh_in)||void 0,h=n+a,g=h+l,p=u&&u>0?n+u:void 0;d=tr(this.homeAccountIdentifier,s,e.access_token,this.clientId,c||t.tenant||"",o.printScopes(),h,g,this.cryptoObj.base64Decode,p,e.token_type,i,e.key_id,r.claims,r.requestedClaimsHash)}let h=null;if(e.refresh_token){let t;e.refresh_token_expires_in&&(t=n+("string"==typeof e.refresh_token_expires_in?parseInt(e.refresh_token_expires_in,10):e.refresh_token_expires_in)),h=nr(this.homeAccountIdentifier,s,e.refresh_token,this.clientId,e.foci,i,t)}let g=null;return e.foci&&(g={clientId:this.clientId,environment:s,familyId:e.foci}),{account:u,idToken:l,accessToken:d,refreshToken:h,appMetadata:g}}static async generateAuthenticationResult(e,t,r,o,i,a,s,c,l){let u,d,h=n.EMPTY_STRING,g=[],p=null,f=n.EMPTY_STRING;if(r.accessToken){if(r.accessToken.tokenType!==P.POP||i.popKid)h=r.accessToken.secret;else{const t=new Ur(e),{secret:n,keyId:o}=r.accessToken;if(!o)throw Ne(Ae);h=await t.signPopToken(n,o,i)}g=ft.fromString(r.accessToken.target).asArray(),p=Jn(r.accessToken.expiresOn),u=Jn(r.accessToken.extendedExpiresOn),r.accessToken.refreshOn&&(d=Jn(r.accessToken.refreshOn))}r.appMetadata&&(f=r.appMetadata.familyId===T?T:"");const m=a?.oid||a?.sub||"",y=a?.tid||"";c?.spa_accountid&&r.account&&(r.account.nativeAccountId=c?.spa_accountid);const v=r.account?wt(At.getAccountInfo(r.account),void 0,a,r.idToken?.secret):null;return{authority:t.canonicalAuthority,uniqueId:m,tenantId:y,scopes:g,account:v,idToken:r?.idToken?.secret||"",idTokenClaims:a||{},accessToken:h,fromCache:o,expiresOn:p,extExpiresOn:u,refreshOn:d,correlationId:i.correlationId,requestId:l||n.EMPTY_STRING,familyId:f,tokenType:r.accessToken?.tokenType||n.EMPTY_STRING,state:s?s.userRequestState:n.EMPTY_STRING,cloudGraphHostName:r.account?.cloudGraphHostName||n.EMPTY_STRING,msGraphHost:r.account?.msGraphHost||n.EMPTY_STRING,code:c?.spa_code,fromNativeBroker:!1}}}function Hr(e,t,n,r,o,i,a,s,c,l,u,d){d?.verbose("setCachedAccount called");const h=e.getAccountKeys().find(e=>e.startsWith(n));let g=null;h&&(g=e.getAccount(h,o));const p=g||At.createAccount({homeAccountId:n,idTokenClaims:i,clientInfo:a,environment:s,cloudGraphHostName:l?.cloud_graph_host_name,msGraphHost:l?.msgraph_host,nativeAccountId:u},t,r),f=p.tenantProfiles||[],m=c||p.realm;if(m&&!f.find(e=>e.tenantId===m)){const e=Ct(n,p.localAccountId,m,i);f.push(e)}return p.tenantProfiles=f,p}async function Fr(e,t,n){return"string"==typeof e?e:e({clientId:t,tokenEndpoint:n})}class zr extends Cr{constructor(e,t){super(e,t),this.includeRedirectUri=!0,this.oidcDefaultScopes=this.config.authOptions.authority.options.OIDCOptions?.defaultScopes}async acquireToken(e,t){if(this.performanceClient?.addQueueMeasurement(Gt.AuthClientAcquireToken,e.correlationId),!e.code)throw Ne(ne);const n=Vn(),r=await jn(this.executeTokenRequest.bind(this),Gt.AuthClientExecuteTokenRequest,this.logger,this.performanceClient,e.correlationId)(this.authority,e),o=r.headers?.[l],i=new Br(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.config.serializableCache,this.config.persistencePlugin,this.performanceClient);return i.validateTokenResponse(r.body),jn(i.handleServerTokenResponse.bind(i),Gt.HandleServerTokenResponse,this.logger,this.performanceClient,e.correlationId)(r.body,this.authority,n,e,t,void 0,void 0,void 0,o)}getLogoutUri(e){if(!e)throw gt(Ve);const t=this.createLogoutUrlQueryString(e);return Ot.appendQueryString(this.authority.endSessionEndpoint,t)}async executeTokenRequest(e,t){this.performanceClient?.addQueueMeasurement(Gt.AuthClientExecuteTokenRequest,t.correlationId);const n=this.createTokenQueryParameters(t),r=Ot.appendQueryString(e.tokenEndpoint,n),o=await jn(this.createTokenRequestBody.bind(this),Gt.AuthClientCreateTokenRequestBody,this.logger,this.performanceClient,t.correlationId)(t);let i;if(t.clientInfo)try{const e=mt(t.clientInfo,this.cryptoUtils.base64Decode);i={credential:`${e.uid}.${e.utid}`,type:an}}catch(e){this.logger.verbose("Could not parse client info for CCS Header: "+e)}const a=this.createTokenRequestHeaders(i||t.ccsCredential),s=fr(this.config.authOptions.clientId,t);return jn(this.executePostToTokenEndpoint.bind(this),Gt.AuthorizationCodeClientExecutePostToTokenEndpoint,this.logger,this.performanceClient,t.correlationId)(r,o,a,s,t.correlationId,Gt.AuthorizationCodeClientExecutePostToTokenEndpoint)}async createTokenRequestBody(e){this.performanceClient?.addQueueMeasurement(Gt.AuthClientCreateTokenRequestBody,e.correlationId);const t=new Map;if(wn(t,e.embeddedClientId||e.tokenBodyParameters?.[cn]||this.config.authOptions.clientId),this.includeRedirectUri)In(t,e.redirectUri);else if(!e.redirectUri)throw gt(He);if(Cn(t,e.scopes,!0,this.oidcDefaultScopes),function(e,t){e.set("code",t)}(t,e.code),En(t,this.config.libraryInfo),Pn(t,this.config.telemetry.application),Kn(t),this.serverTelemetryManager&&!on(this.config)&&zn(t,this.serverTelemetryManager),e.codeVerifier&&function(e,t){e.set("code_verifier",t)}(t,e.codeVerifier),this.config.clientCredentials.clientSecret&&On(t,this.config.clientCredentials.clientSecret),this.config.clientCredentials.clientAssertion){const n=this.config.clientCredentials.clientAssertion;Nn(t,await Fr(n.assertion,this.config.authOptions.clientId,e.resourceRequestUri)),qn(t,n.assertionType)}if(Ln(t,"authorization_code"),xn(t),e.authenticationScheme===P.POP){const n=new Ur(this.cryptoUtils,this.performanceClient);let r;r=e.popKid?this.cryptoUtils.encodeKid(e.popKid):(await jn(n.generateCnf.bind(n),Gt.PopTokenGenerateCnf,this.logger,this.performanceClient,e.correlationId)(e,this.logger)).reqCnfString,Hn(t,r)}else if(e.authenticationScheme===P.SSH){if(!e.sshJwk)throw gt(et);Fn(t,e.sshJwk)}let n;if((!pt.isEmptyObj(e.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&bn(t,e.claims,this.config.authOptions.clientCapabilities),e.clientInfo)try{const t=mt(e.clientInfo,this.cryptoUtils.base64Decode);n={credential:`${t.uid}.${t.utid}`,type:an}}catch(e){this.logger.verbose("Could not parse client info for CCS Header: "+e)}else n=e.ccsCredential;if(this.config.systemOptions.preventCorsPreflight&&n)switch(n.type){case an:try{kn(t,yt(n.credential))}catch(e){this.logger.verbose("Could not parse home account ID for CCS Header: "+e)}break;case sn:An(t,n.credential)}return e.embeddedClientId&&$n(t,this.config.authOptions.clientId,this.config.authOptions.redirectUri),e.tokenBodyParameters&&Dn(t,e.tokenBodyParameters),!e.enableSpaAuthorizationCode||e.tokenBodyParameters&&e.tokenBodyParameters[hn]||Dn(t,{[hn]:"1"}),yn(t,e.correlationId,this.performanceClient),_t(t)}createLogoutUrlQueryString(e){const t=new Map;return e.postLogoutRedirectUri&&function(e,t){e.set("post_logout_redirect_uri",t)}(t,e.postLogoutRedirectUri),e.correlationId&&Rn(t,e.correlationId),e.idTokenHint&&function(e,t){e.set("id_token_hint",t)}(t,e.idTokenHint),e.state&&_n(t,e.state),e.logoutHint&&function(e,t){e.set("logout_hint",t)}(t,e.logoutHint),e.extraQueryParameters&&Dn(t,e.extraQueryParameters),this.config.authOptions.instanceAware&&Un(t),_t(t,this.config.authOptions.encodeExtraQueryParams,e.extraQueryParameters)}}class Kr extends Cr{constructor(e,t){super(e,t)}async acquireToken(e){this.performanceClient?.addQueueMeasurement(Gt.RefreshTokenClientAcquireToken,e.correlationId);const t=Vn(),n=await jn(this.executeTokenRequest.bind(this),Gt.RefreshTokenClientExecuteTokenRequest,this.logger,this.performanceClient,e.correlationId)(e,this.authority),r=n.headers?.[l],o=new Br(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.config.serializableCache,this.config.persistencePlugin);return o.validateTokenResponse(n.body),jn(o.handleServerTokenResponse.bind(o),Gt.HandleServerTokenResponse,this.logger,this.performanceClient,e.correlationId)(n.body,this.authority,t,e,void 0,void 0,!0,e.forceCache,r)}async acquireTokenByRefreshToken(e){if(!e)throw gt(We);if(this.performanceClient?.addQueueMeasurement(Gt.RefreshTokenClientAcquireTokenByRefreshToken,e.correlationId),!e.account)throw Ne(le);if(this.cacheManager.isAppMetadataFOCI(e.account.environment))try{return await jn(this.acquireTokenWithCachedRefreshToken.bind(this),Gt.RefreshTokenClientAcquireTokenWithCachedRefreshToken,this.logger,this.performanceClient,e.correlationId)(e,!0)}catch(t){const n=t instanceof Nr&&t.errorCode===wr,r=t instanceof pr&&"invalid_grant"===t.errorCode&&"client_mismatch"===t.subError;if(n||r)return jn(this.acquireTokenWithCachedRefreshToken.bind(this),Gt.RefreshTokenClientAcquireTokenWithCachedRefreshToken,this.logger,this.performanceClient,e.correlationId)(e,!1);throw t}return jn(this.acquireTokenWithCachedRefreshToken.bind(this),Gt.RefreshTokenClientAcquireTokenWithCachedRefreshToken,this.logger,this.performanceClient,e.correlationId)(e,!1)}async acquireTokenWithCachedRefreshToken(e,t){this.performanceClient?.addQueueMeasurement(Gt.RefreshTokenClientAcquireTokenWithCachedRefreshToken,e.correlationId);const n=Gn(this.cacheManager.getRefreshToken.bind(this.cacheManager),Gt.CacheManagerGetRefreshToken,this.logger,this.performanceClient,e.correlationId)(e.account,t,e.correlationId,void 0,this.performanceClient);if(!n)throw Lr(wr);if(n.expiresOn&&Yn(n.expiresOn,e.refreshTokenExpirationOffsetSeconds||300))throw this.performanceClient?.addFields({rtExpiresOnMs:Number(n.expiresOn)},e.correlationId),Lr(Tr);const r={...e,refreshToken:n.secret,authenticationScheme:e.authenticationScheme||P.BEARER,ccsCredential:{credential:e.account.homeAccountId,type:an}};try{return await jn(this.acquireToken.bind(this),Gt.RefreshTokenClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(r)}catch(t){if(t instanceof Nr&&(this.performanceClient?.addFields({rtExpiresOnMs:Number(n.expiresOn)},e.correlationId),t.subError===Rr)){this.logger.verbose("acquireTokenWithRefreshToken: bad refresh token, removing from cache");const t=this.cacheManager.generateCredentialKey(n);this.cacheManager.removeRefreshToken(t,e.correlationId)}throw t}}async executeTokenRequest(e,t){this.performanceClient?.addQueueMeasurement(Gt.RefreshTokenClientExecuteTokenRequest,e.correlationId);const n=this.createTokenQueryParameters(e),r=Ot.appendQueryString(t.tokenEndpoint,n),o=await jn(this.createTokenRequestBody.bind(this),Gt.RefreshTokenClientCreateTokenRequestBody,this.logger,this.performanceClient,e.correlationId)(e),i=this.createTokenRequestHeaders(e.ccsCredential),a=fr(this.config.authOptions.clientId,e);return jn(this.executePostToTokenEndpoint.bind(this),Gt.RefreshTokenClientExecutePostToTokenEndpoint,this.logger,this.performanceClient,e.correlationId)(r,o,i,a,e.correlationId,Gt.RefreshTokenClientExecutePostToTokenEndpoint)}async createTokenRequestBody(e){this.performanceClient?.addQueueMeasurement(Gt.RefreshTokenClientCreateTokenRequestBody,e.correlationId);const t=new Map;if(wn(t,e.embeddedClientId||e.tokenBodyParameters?.[cn]||this.config.authOptions.clientId),e.redirectUri&&In(t,e.redirectUri),Cn(t,e.scopes,!0,this.config.authOptions.authority.options.OIDCOptions?.defaultScopes),Ln(t,"refresh_token"),xn(t),En(t,this.config.libraryInfo),Pn(t,this.config.telemetry.application),Kn(t),this.serverTelemetryManager&&!on(this.config)&&zn(t,this.serverTelemetryManager),function(e,t){e.set("refresh_token",t)}(t,e.refreshToken),this.config.clientCredentials.clientSecret&&On(t,this.config.clientCredentials.clientSecret),this.config.clientCredentials.clientAssertion){const n=this.config.clientCredentials.clientAssertion;Nn(t,await Fr(n.assertion,this.config.authOptions.clientId,e.resourceRequestUri)),qn(t,n.assertionType)}if(e.authenticationScheme===P.POP){const n=new Ur(this.cryptoUtils,this.performanceClient);let r;r=e.popKid?this.cryptoUtils.encodeKid(e.popKid):(await jn(n.generateCnf.bind(n),Gt.PopTokenGenerateCnf,this.logger,this.performanceClient,e.correlationId)(e,this.logger)).reqCnfString,Hn(t,r)}else if(e.authenticationScheme===P.SSH){if(!e.sshJwk)throw gt(et);Fn(t,e.sshJwk)}if((!pt.isEmptyObj(e.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&bn(t,e.claims,this.config.authOptions.clientCapabilities),this.config.systemOptions.preventCorsPreflight&&e.ccsCredential)switch(e.ccsCredential.type){case an:try{kn(t,yt(e.ccsCredential.credential))}catch(e){this.logger.verbose("Could not parse home account ID for CCS Header: "+e)}break;case sn:An(t,e.ccsCredential.credential)}return e.embeddedClientId&&$n(t,this.config.authOptions.clientId,this.config.authOptions.redirectUri),e.tokenBodyParameters&&Dn(t,e.tokenBodyParameters),yn(t,e.correlationId,this.performanceClient),_t(t)}}class $r extends Cr{constructor(e,t){super(e,t)}async acquireCachedToken(e){this.performanceClient?.addQueueMeasurement(Gt.SilentFlowClientAcquireCachedToken,e.correlationId);let t="0";if(e.forceRefresh||!this.config.cacheOptions.claimsBasedCachingEnabled&&!pt.isEmptyObj(e.claims))throw this.setCacheOutcome("1",e.correlationId),Ne(ye);if(!e.account)throw Ne(le);const n=e.account.tenantId||function(e){const t=new Ot(e).getUrlComponents(),n=t.PathSegments.slice(-1)[0]?.toLowerCase();switch(n){case h:case g:case p:return;default:return n}}(e.authority),r=this.cacheManager.getTokenKeys(),o=this.cacheManager.getAccessToken(e.account,e,r,n);if(!o)throw this.setCacheOutcome("2",e.correlationId),Ne(ye);if(Zn(o.cachedAt)||Yn(o.expiresOn,this.config.systemOptions.tokenRenewalOffsetSeconds))throw this.setCacheOutcome("3",e.correlationId),Ne(ye);o.refreshOn&&Yn(o.refreshOn,0)&&(t="4");const i=e.authority||this.authority.getPreferredCache(),a={account:this.cacheManager.getAccount(this.cacheManager.generateAccountKey(e.account),e.correlationId),accessToken:o,idToken:this.cacheManager.getIdToken(e.account,e.correlationId,r,n,this.performanceClient),refreshToken:null,appMetadata:this.cacheManager.readAppMetadataFromCache(i)};return this.setCacheOutcome(t,e.correlationId),this.config.serverTelemetryManager&&this.config.serverTelemetryManager.incrementCacheHits(),[await jn(this.generateResultFromCacheRecord.bind(this),Gt.SilentFlowClientGenerateResultFromCacheRecord,this.logger,this.performanceClient,e.correlationId)(a,e),t]}setCacheOutcome(e,t){this.serverTelemetryManager?.setCacheOutcome(e),this.performanceClient?.addFields({cacheOutcome:e},t),"0"!==e&&this.logger.info(`Token refresh is required due to cache outcome: ${e}`)}async generateResultFromCacheRecord(e,t){let n;if(this.performanceClient?.addQueueMeasurement(Gt.SilentFlowClientGenerateResultFromCacheRecord,t.correlationId),e.idToken&&(n=kt(e.idToken.secret,this.config.cryptoInterface.base64Decode)),t.maxAge||0===t.maxAge){const e=n?.auth_time;if(!e)throw Ne(Y);bt(e,t.maxAge)}return Br.generateAuthenticationResult(this.cryptoUtils,this.authority,e,!0,t,n)}}const Gr={sendGetRequestAsync:()=>Promise.reject(Ne(Re)),sendPostRequestAsync:()=>Promise.reject(Ne(Re))};function jr(e,t,n,r){const o=_t(t,n,r);return Ot.appendQueryString(e.authorizationEndpoint,o)}function Wr(e,t){if(!e.state||!t)throw e.state?Ne(Q,"Cached State"):Ne(Q,"Server State");let n,r;try{n=decodeURIComponent(e.state)}catch(t){throw Ne(W,e.state)}try{r=decodeURIComponent(t)}catch(t){throw Ne(W,e.state)}if(n!==r)throw Ne(V);if(e.error||e.error_description||e.suberror){const t=function(e){const t=e.error_uri?.lastIndexOf("code=");return t&&t>=0?e.error_uri?.substring(t+5):void 0}(e);if(qr(e.error,e.error_description,e.suberror))throw new Nr(e.error||"",e.error_description,e.suberror,e.timestamp||"",e.trace_id||"",e.correlation_id||"",e.claims||"",t);throw new pr(e.error||"",e.error_description,e.suberror,t)}}class Vr{constructor(e,t){this.cacheOutcome="0",this.cacheManager=t,this.apiId=e.apiId,this.correlationId=e.correlationId,this.wrapperSKU=e.wrapperSKU||n.EMPTY_STRING,this.wrapperVer=e.wrapperVer||n.EMPTY_STRING,this.telemetryCacheKey=E.CACHE_KEY+"-"+e.clientId}generateCurrentRequestHeaderValue(){const e=`${this.apiId}${E.VALUE_SEPARATOR}${this.cacheOutcome}`,t=[this.wrapperSKU,this.wrapperVer],n=this.getNativeBrokerErrorCode();n?.length&&t.push(`broker_error=${n}`);const r=t.join(E.VALUE_SEPARATOR),o=[e,this.getRegionDiscoveryFields()].join(E.VALUE_SEPARATOR);return[E.SCHEMA_VERSION,o,r].join(E.CATEGORY_SEPARATOR)}generateLastRequestHeaderValue(){const e=this.getLastRequests(),t=Vr.maxErrorsToSend(e),n=e.failedRequests.slice(0,2*t).join(E.VALUE_SEPARATOR),r=e.errors.slice(0,t).join(E.VALUE_SEPARATOR),o=e.errors.length,i=[o,t<o?E.OVERFLOW_TRUE:E.OVERFLOW_FALSE].join(E.VALUE_SEPARATOR);return[E.SCHEMA_VERSION,e.cacheHits,n,r,i].join(E.CATEGORY_SEPARATOR)}cacheFailedRequest(e){const t=this.getLastRequests();t.errors.length>=E.MAX_CACHED_ERRORS&&(t.failedRequests.shift(),t.failedRequests.shift(),t.errors.shift()),t.failedRequests.push(this.apiId,this.correlationId),e instanceof Error&&e&&e.toString()?e instanceof U?e.subError?t.errors.push(e.subError):e.errorCode?t.errors.push(e.errorCode):t.errors.push(e.toString()):t.errors.push(e.toString()):t.errors.push(E.UNKNOWN_ERROR),this.cacheManager.setServerTelemetry(this.telemetryCacheKey,t,this.correlationId)}incrementCacheHits(){const e=this.getLastRequests();return e.cacheHits+=1,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,e,this.correlationId),e.cacheHits}getLastRequests(){return this.cacheManager.getServerTelemetry(this.telemetryCacheKey)||{failedRequests:[],errors:[],cacheHits:0}}clearTelemetryCache(){const e=this.getLastRequests(),t=Vr.maxErrorsToSend(e);if(t===e.errors.length)this.cacheManager.removeItem(this.telemetryCacheKey,this.correlationId);else{const n={failedRequests:e.failedRequests.slice(2*t),errors:e.errors.slice(t),cacheHits:0};this.cacheManager.setServerTelemetry(this.telemetryCacheKey,n,this.correlationId)}}static maxErrorsToSend(e){let t,r=0,o=0;const i=e.errors.length;for(t=0;t<i;t++){const i=e.failedRequests[2*t]||n.EMPTY_STRING,a=e.failedRequests[2*t+1]||n.EMPTY_STRING,s=e.errors[t]||n.EMPTY_STRING;if(o+=i.toString().length+a.toString().length+s.length+3,!(o<E.MAX_LAST_HEADER_BYTES))break;r+=1}return r}getRegionDiscoveryFields(){const e=[];return e.push(this.regionUsed||n.EMPTY_STRING),e.push(this.regionSource||n.EMPTY_STRING),e.push(this.regionOutcome||n.EMPTY_STRING),e.join(",")}updateRegionDiscoveryMetadata(e){this.regionUsed=e.region_used,this.regionSource=e.region_source,this.regionOutcome=e.region_outcome}setCacheOutcome(e){this.cacheOutcome=e}setNativeBrokerErrorCode(e){const t=this.getLastRequests();t.nativeBrokerErrorCode=e,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,t,this.correlationId)}getNativeBrokerErrorCode(){return this.getLastRequests().nativeBrokerErrorCode}clearNativeBrokerErrorCode(){const e=this.getLastRequests();delete e.nativeBrokerErrorCode,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,e,this.correlationId)}static makeExtraSkuString(e){return function(e){const{skus:t,libraryName:n,libraryVersion:r,extensionName:o,extensionVersion:i}=e,a=new Map([[0,[n,r]],[2,[o,i]]]);let s=[];if(t?.length){if(s=t.split(","),s.length<4)return t}else s=Array.from({length:4},()=>"|");return a.forEach((e,t)=>{2===e.length&&e[0]?.length&&e[1]?.length&&function(e){const{skuArr:t,index:n,skuName:r,skuVersion:o}=e;n>=t.length||(t[n]=[r,o].join("|"))}({skuArr:s,index:t,skuName:e[0],skuVersion:e[1]})}),s.join(",")}(e)}}const Qr="missing_kid_error",Jr="missing_alg_error",Yr={[Qr]:"The JOSE Header for the requested JWT, JWS or JWK object requires a keyId to be configured as the 'kid' header claim. No 'kid' value was provided.",[Jr]:"The JOSE Header for the requested JWT, JWS or JWK object requires an algorithm to be specified as the 'alg' header claim. No 'alg' value was provided."};class Xr extends U{constructor(e,t){super(e,t),this.name="JoseHeaderError",Object.setPrototypeOf(this,Xr.prototype)}}function Zr(e){return new Xr(e,Yr[e])}class eo{constructor(e){this.typ=e.typ,this.alg=e.alg,this.kid=e.kid}static getShrHeaderString(e){if(!e.kid)throw Zr(Qr);if(!e.alg)throw Zr(Jr);const t=new eo({typ:e.typ||M.Pop,kid:e.kid,alg:e.alg});return JSON.stringify(t)}}function to(e){const t=e.lastIndexOf(" ")+1;if(t<1)return e;const n=e.substring(t);let r=n.lastIndexOf("/");return r=r<0?n.lastIndexOf("\\"):r,r>=0?(e.substring(0,t)+"("+n.substring(r+1)+(")"===n.charAt(n.length-1)?"":")")).trimStart():e.trimStart()}class no{constructor(e,t,n,r,o,i,a,s){this.authority=t,this.libraryName=r,this.libraryVersion=o,this.applicationTelemetry=i,this.clientId=e,this.logger=n,this.callbacks=new Map,this.eventsByCorrelationId=new Map,this.eventStack=new Map,this.queueMeasurements=new Map,this.preQueueTimeByCorrelationId=new Map,this.intFields=a||new Set;for(const e of Wt)this.intFields.add(e);this.abbreviations=s||new Map;for(const[e,t]of jt)this.abbreviations.set(e,t)}startPerformanceMeasurement(e,t){return{}}getPreQueueTime(e,t){const n=this.preQueueTimeByCorrelationId.get(t);if(n){if(n.name===e)return n.time;this.logger.trace(`PerformanceClient.getPreQueueTime: no pre-queue time found for ${e}, unable to add queue measurement`)}else this.logger.trace(`PerformanceClient.getPreQueueTime: no pre-queue times found for correlationId: ${t}, unable to add queue measurement`)}calculateQueuedTime(e,t){return e<1?(this.logger.trace(`PerformanceClient: preQueueTime should be a positive integer and not ${e}`),0):t<1?(this.logger.trace(`PerformanceClient: currentTime should be a positive integer and not ${t}`),0):t<e?(this.logger.trace("PerformanceClient: currentTime is less than preQueueTime, check how time is being retrieved"),0):t-e}addQueueMeasurement(e,t,n,r){if(!t)return void this.logger.trace(`PerformanceClient.addQueueMeasurement: correlationId not provided for ${e}, cannot add queue measurement`);if(0===n)this.logger.trace(`PerformanceClient.addQueueMeasurement: queue time provided for ${e} is ${n}`);else if(!n)return void this.logger.trace(`PerformanceClient.addQueueMeasurement: no queue time provided for ${e}`);const o={eventName:e,queueTime:r?0:n,manuallyCompleted:r},i=this.queueMeasurements.get(t);if(i)i.push(o),this.queueMeasurements.set(t,i);else{this.logger.trace(`PerformanceClient.addQueueMeasurement: adding correlationId ${t} to queue measurements`);const e=[o];this.queueMeasurements.set(t,e)}this.preQueueTimeByCorrelationId.delete(t)}startMeasurement(e,t){const n=t||this.generateId();t||this.logger.info(`PerformanceClient: No correlation id provided for ${e}, generating`,n),this.logger.trace(`PerformanceClient: Performance measurement started for ${e}`,n);const r={eventId:this.generateId(),status:1,authority:this.authority,libraryName:this.libraryName,libraryVersion:this.libraryVersion,clientId:this.clientId,name:e,startTimeMs:Date.now(),correlationId:n,appName:this.applicationTelemetry?.appName,appVersion:this.applicationTelemetry?.appVersion};var o,i,a;return this.cacheEventByCorrelationId(r),o=r,i=this.abbreviations,(a=this.eventStack.get(n))&&a.push({name:i.get(o.name)||o.name}),{end:(e,t,n)=>this.endMeasurement({...r,...e},t,n),discard:()=>this.discardMeasurements(r.correlationId),add:e=>this.addFields(e,r.correlationId),increment:e=>this.incrementFields(e,r.correlationId),event:r,measurement:new Vt}}endMeasurement(e,t,n){const r=this.eventsByCorrelationId.get(e.correlationId);if(!r)return this.logger.trace(`PerformanceClient: Measurement not found for ${e.eventId}`,e.correlationId),null;const o=e.eventId===r.eventId;let i={totalQueueTime:0,totalQueueCount:0,manuallyCompletedCount:0};e.durationMs=Math.round(e.durationMs||this.getDurationMs(e.startTimeMs));const a=JSON.stringify(function(e,t,n,r){if(!n?.length)return;const o=e=>e.length?e[e.length-1]:void 0,i=t.get(e.name)||e.name,a=o(n);if(a?.name!==i)return;const s=n?.pop();if(!s)return;const c=r instanceof U?r.errorCode:r instanceof Error?r.name:void 0,l=r instanceof U?r.subError:void 0;c&&s.childErr!==c&&(s.err=c,l&&(s.subErr=l)),delete s.name,delete s.childErr;const u={...s,dur:e.durationMs};e.success||(u.fail=1);const d=o(n);if(!d)return{[i]:u};let h;if(c&&(d.childErr=c),d[i]){const e=Object.keys(d).filter(e=>e.startsWith(i)).length;h=`${i}_${e+1}`}else h=i;return d[h]=u,d}(e,this.abbreviations,this.eventStack.get(r.correlationId),t));if(o?(i=this.getQueueInfo(e.correlationId),this.discardMeasurements(r.correlationId)):r.incompleteSubMeasurements?.delete(e.eventId),this.logger.trace(`PerformanceClient: Performance measurement ended for ${e.name}: ${e.durationMs} ms`,e.correlationId),t&&function(e,t,n,r=5){if(e instanceof Error)return e instanceof U?(n.errorCode=e.errorCode,n.subErrorCode=e.subError,void((e instanceof pr||e instanceof Nr)&&(n.serverErrorNo=e.errorNo))):void(e instanceof Ft?n.errorCode=e.errorCode:n.errorStack?.length?t.trace("PerformanceClient.addErrorStack: Stack already exist",n.correlationId):e.stack?.length?(e.stack&&(n.errorStack=function(e,t){if(t<0)return[];const n=e.split("\n")||[],r=[],o=n[0];o.startsWith("TypeError: Cannot read property")||o.startsWith("TypeError: Cannot read properties of")||o.startsWith("TypeError: Cannot set property")||o.startsWith("TypeError: Cannot set properties of")||o.endsWith("is not a function")?r.push(to(o)):(o.startsWith("SyntaxError")||o.startsWith("TypeError"))&&r.push(to(o.replace(/['].*[']|["].*["]/g,"<redacted>")));for(let e=1;e<n.length&&!(r.length>=t);e++){const t=n[e];r.push(to(t))}return r}(e.stack,r)),n.errorName=e.name):t.trace("PerformanceClient.addErrorStack: Input stack is empty",n.correlationId));t.trace("PerformanceClient.addErrorStack: Input error is not instance of Error",n.correlationId)}(t,this.logger,r),!o)return r[e.name+"DurationMs"]=Math.floor(e.durationMs),{...r};o&&!t&&(r.errorCode||r.subErrorCode)&&(this.logger.trace(`PerformanceClient: Remove error and sub-error codes for root event ${e.name} as intermediate error was successfully handled`,e.correlationId),r.errorCode=void 0,r.subErrorCode=void 0);let s={...r,...e},c=0;return s.incompleteSubMeasurements?.forEach(t=>{this.logger.trace(`PerformanceClient: Incomplete submeasurement ${t.name} found for ${e.name}`,s.correlationId),c++}),s.incompleteSubMeasurements=void 0,s={...s,queuedTimeMs:i.totalQueueTime,queuedCount:i.totalQueueCount,queuedManuallyCompletedCount:i.manuallyCompletedCount,status:2,incompleteSubsCount:c,context:a},n&&(s.accountType=function(e){const t=e?.idTokenClaims;return t?.tfp||t?.acr?"B2C":t?.tid?"9188040d-6c67-4c5b-b112-36a304b66dad"===t?.tid?"MSA":"AAD":void 0}(n),s.dataBoundary=n.dataBoundary),this.truncateIntegralFields(s),this.emitEvents([s],e.correlationId),s}addFields(e,t){this.logger.trace("PerformanceClient: Updating static fields");const n=this.eventsByCorrelationId.get(t);n?this.eventsByCorrelationId.set(t,{...n,...e}):this.logger.trace("PerformanceClient: Event not found for",t)}incrementFields(e,t){this.logger.trace("PerformanceClient: Updating counters");const n=this.eventsByCorrelationId.get(t);if(n)for(const t in e){if(n.hasOwnProperty(t)){if(isNaN(Number(n[t])))return}else n[t]=0;n[t]+=e[t]}else this.logger.trace("PerformanceClient: Event not found for",t)}cacheEventByCorrelationId(e){const t=this.eventsByCorrelationId.get(e.correlationId);t?(this.logger.trace(`PerformanceClient: Performance measurement for ${e.name} added/updated`,e.correlationId),t.incompleteSubMeasurements=t.incompleteSubMeasurements||new Map,t.incompleteSubMeasurements.set(e.eventId,{name:e.name,startTimeMs:e.startTimeMs})):(this.logger.trace(`PerformanceClient: Performance measurement for ${e.name} started`,e.correlationId),this.eventsByCorrelationId.set(e.correlationId,{...e}),this.eventStack.set(e.correlationId,[]))}getQueueInfo(e){const t=this.queueMeasurements.get(e);t||this.logger.trace(`PerformanceClient: no queue measurements found for for correlationId: ${e}`);let n=0,r=0,o=0;return t?.forEach(e=>{n+=e.queueTime,r++,o+=e.manuallyCompleted?1:0}),{totalQueueTime:n,totalQueueCount:r,manuallyCompletedCount:o}}discardMeasurements(e){this.logger.trace("PerformanceClient: Performance measurements discarded",e),this.eventsByCorrelationId.delete(e),this.logger.trace("PerformanceClient: QueueMeasurements discarded",e),this.queueMeasurements.delete(e),this.logger.trace("PerformanceClient: Pre-queue times discarded",e),this.preQueueTimeByCorrelationId.delete(e),this.logger.trace("PerformanceClient: Event stack discarded",e),this.eventStack.delete(e)}addPerformanceCallback(e){for(const[t,n]of this.callbacks)if(n.toString()===e.toString())return this.logger.warning(`PerformanceClient: Performance callback is already registered with id: ${t}`),t;const t=this.generateId();return this.callbacks.set(t,e),this.logger.verbose(`PerformanceClient: Performance callback registered with id: ${t}`),t}removePerformanceCallback(e){const t=this.callbacks.delete(e);return t?this.logger.verbose(`PerformanceClient: Performance callback ${e} removed.`):this.logger.verbose(`PerformanceClient: Performance callback ${e} not removed.`),t}emitEvents(e,t){this.logger.verbose("PerformanceClient: Emitting performance events",t),this.callbacks.forEach((n,r)=>{this.logger.trace(`PerformanceClient: Emitting event to callback ${r}`,t),n.apply(null,[e])})}truncateIntegralFields(e){this.intFields.forEach(t=>{t in e&&"number"==typeof e[t]&&(e[t]=Math.floor(e[t]))})}getDurationMs(e){const t=Date.now()-e;return t<0?t:0}}const ro="pkce_not_created",oo="ear_jwk_empty",io="ear_jwe_empty",ao="crypto_nonexistent",so="empty_navigate_uri",co="hash_empty_error",lo="no_state_in_hash",uo="hash_does_not_contain_known_properties",ho="unable_to_parse_state",go="state_interaction_type_mismatch",po="interaction_in_progress",fo="popup_window_error",mo="empty_window_error",yo="user_cancelled",vo="monitor_popup_timeout",Co="monitor_window_timeout",wo="redirect_in_iframe",Io="block_iframe_reload",To="block_nested_popups",Ao="iframe_closed_prematurely",ko="silent_logout_unsupported",So="no_account_error",bo="silent_prompt_value_error",Ro="no_token_request_cache_error",Eo="unable_to_parse_token_request_cache_error",Po="auth_request_not_set_error",_o="invalid_cache_type",Mo="non_browser_environment",Oo="database_not_open",No="no_network_connectivity",qo="post_request_failed",Lo="get_request_failed",xo="failed_to_parse_response",Uo="unable_to_load_token",Do="crypto_key_not_found",Bo="auth_code_required",Ho="auth_code_or_nativeAccountId_required",Fo="spa_code_and_nativeAccountId_present",zo="database_unavailable",Ko="unable_to_acquire_token_from_native_platform",$o="native_handshake_timeout",Go="native_extension_not_installed",jo="native_connection_not_established",Wo="uninitialized_public_client_application",Vo="native_prompt_not_supported",Qo="invalid_base64_string",Jo="invalid_pop_token_request",Yo="failed_to_build_headers",Xo="failed_to_parse_headers",Zo="failed_to_decrypt_ear_response",ei="timed_out";var ti=Object.freeze({__proto__:null,authCodeOrNativeAccountIdRequired:Ho,authCodeRequired:Bo,authRequestNotSetError:Po,blockIframeReload:Io,blockNestedPopups:To,cryptoKeyNotFound:Do,cryptoNonExistent:ao,databaseNotOpen:Oo,databaseUnavailable:zo,earJweEmpty:io,earJwkEmpty:oo,emptyNavigateUri:so,emptyWindowError:mo,failedToBuildHeaders:Yo,failedToDecryptEarResponse:Zo,failedToParseHeaders:Xo,failedToParseResponse:xo,getRequestFailed:Lo,hashDoesNotContainKnownProperties:uo,hashEmptyError:co,iframeClosedPrematurely:Ao,interactionInProgress:po,invalidBase64String:Qo,invalidCacheType:_o,invalidPopTokenRequest:Jo,monitorPopupTimeout:vo,monitorWindowTimeout:Co,nativeConnectionNotEstablished:jo,nativeExtensionNotInstalled:Go,nativeHandshakeTimeout:$o,nativePromptNotSupported:Vo,noAccountError:So,noNetworkConnectivity:No,noStateInHash:lo,noTokenRequestCacheError:Ro,nonBrowserEnvironment:Mo,pkceNotCreated:ro,popupWindowError:fo,postRequestFailed:qo,redirectInIframe:wo,silentLogoutUnsupported:ko,silentPromptValueError:bo,spaCodeAndNativeAccountIdPresent:Fo,stateInteractionTypeMismatch:go,timedOut:ei,unableToAcquireTokenFromNativePlatform:Ko,unableToLoadToken:Uo,unableToParseState:ho,unableToParseTokenRequestCacheError:Eo,uninitializedPublicClientApplication:Wo,userCancelled:yo});const ni="For more visit: aka.ms/msaljs/browser-errors",ri={[ro]:"The PKCE code challenge and verifier could not be generated.",[oo]:"No EAR encryption key provided. This is unexpected.",[io]:"Server response does not contain ear_jwe property. This is unexpected.",[ao]:"The crypto object or function is not available.",[so]:"Navigation URI is empty. Please check stack trace for more info.",[co]:`Hash value cannot be processed because it is empty. Please verify that your redirectUri is not clearing the hash. ${ni}`,[lo]:"Hash does not contain state. Please verify that the request originated from msal.",[uo]:`Hash does not contain known properites. Please verify that your redirectUri is not changing the hash.  ${ni}`,[ho]:"Unable to parse state. Please verify that the request originated from msal.",[go]:"Hash contains state but the interaction type does not match the caller.",[po]:`Interaction is currently in progress. Please ensure that this interaction has been completed before calling an interactive API.   ${ni}`,[fo]:"Error opening popup window. This can happen if you are using IE or if popups are blocked in the browser.",[mo]:"window.open returned null or undefined window object.",[yo]:"User cancelled the flow.",[vo]:`Token acquisition in popup failed due to timeout.  ${ni}`,[Co]:`Token acquisition in iframe failed due to timeout.  ${ni}`,[wo]:"Redirects are not supported for iframed or brokered applications. Please ensure you are using MSAL.js in a top frame of the window if using the redirect APIs, or use the popup APIs.",[Io]:`Request was blocked inside an iframe because MSAL detected an authentication response.  ${ni}`,[To]:"Request was blocked inside a popup because MSAL detected it was running in a popup.",[Ao]:"The iframe being monitored was closed prematurely.",[ko]:"Silent logout not supported. Please call logoutRedirect or logoutPopup instead.",[So]:"No account object provided to acquireTokenSilent and no active account has been set. Please call setActiveAccount or provide an account on the request.",[bo]:"The value given for the prompt value is not valid for silent requests - must be set to 'none' or 'no_session'.",[Ro]:"No token request found in cache.",[Eo]:"The cached token request could not be parsed.",[Po]:"Auth Request not set. Please ensure initiateAuthRequest was called from the InteractionHandler",[_o]:"Invalid cache type",[Mo]:"Login and token requests are not supported in non-browser environments.",[Oo]:"Database is not open!",[No]:"No network connectivity. Check your internet connection.",[qo]:"Network request failed: If the browser threw a CORS error, check that the redirectUri is registered in the Azure App Portal as type 'SPA'",[Lo]:"Network request failed. Please check the network trace to determine root cause.",[xo]:"Failed to parse network response. Check network trace.",[Uo]:"Error loading token to cache.",[Do]:"Cryptographic Key or Keypair not found in browser storage.",[Bo]:"An authorization code must be provided (as the `code` property on the request) to this flow.",[Ho]:"An authorization code or nativeAccountId must be provided to this flow.",[Fo]:"Request cannot contain both spa code and native account id.",[zo]:"IndexedDB, which is required for persistent cryptographic key storage, is unavailable. This may be caused by browser privacy features which block persistent storage in third-party contexts.",[Ko]:`Unable to acquire token from native platform.  ${ni}`,[$o]:"Timed out while attempting to establish connection to browser extension",[Go]:"Native extension is not installed. If you think this is a mistake call the initialize function.",[jo]:`Connection to native platform has not been established. Please install a compatible browser extension and run initialize().  ${ni}`,[Wo]:`You must call and await the initialize function before attempting to call any other MSAL API.  ${ni}`,[Vo]:"The provided prompt is not supported by the native platform. This request should be routed to the web based flow.",[Qo]:"Invalid base64 encoded string.",[Jo]:"Invalid PoP token request. The request should not have both a popKid value and signPopToken set to true.",[Yo]:"Failed to build request headers object.",[Xo]:"Failed to parse response headers",[Zo]:"Failed to decrypt ear response",[ei]:"The request timed out."},oi={pkceNotGenerated:{code:ro,desc:ri[ro]},cryptoDoesNotExist:{code:ao,desc:ri[ao]},emptyNavigateUriError:{code:so,desc:ri[so]},hashEmptyError:{code:co,desc:ri[co]},hashDoesNotContainStateError:{code:lo,desc:ri[lo]},hashDoesNotContainKnownPropertiesError:{code:uo,desc:ri[uo]},unableToParseStateError:{code:ho,desc:ri[ho]},stateInteractionTypeMismatchError:{code:go,desc:ri[go]},interactionInProgress:{code:po,desc:ri[po]},popupWindowError:{code:fo,desc:ri[fo]},emptyWindowError:{code:mo,desc:ri[mo]},userCancelledError:{code:yo,desc:ri[yo]},monitorPopupTimeoutError:{code:vo,desc:ri[vo]},monitorIframeTimeoutError:{code:Co,desc:ri[Co]},redirectInIframeError:{code:wo,desc:ri[wo]},blockTokenRequestsInHiddenIframeError:{code:Io,desc:ri[Io]},blockAcquireTokenInPopupsError:{code:To,desc:ri[To]},iframeClosedPrematurelyError:{code:Ao,desc:ri[Ao]},silentLogoutUnsupportedError:{code:ko,desc:ri[ko]},noAccountError:{code:So,desc:ri[So]},silentPromptValueError:{code:bo,desc:ri[bo]},noTokenRequestCacheError:{code:Ro,desc:ri[Ro]},unableToParseTokenRequestCacheError:{code:Eo,desc:ri[Eo]},authRequestNotSet:{code:Po,desc:ri[Po]},invalidCacheType:{code:_o,desc:ri[_o]},notInBrowserEnvironment:{code:Mo,desc:ri[Mo]},databaseNotOpen:{code:Oo,desc:ri[Oo]},noNetworkConnectivity:{code:No,desc:ri[No]},postRequestFailed:{code:qo,desc:ri[qo]},getRequestFailed:{code:Lo,desc:ri[Lo]},failedToParseNetworkResponse:{code:xo,desc:ri[xo]},unableToLoadTokenError:{code:Uo,desc:ri[Uo]},signingKeyNotFoundInStorage:{code:Do,desc:ri[Do]},authCodeRequired:{code:Bo,desc:ri[Bo]},authCodeOrNativeAccountRequired:{code:Ho,desc:ri[Ho]},spaCodeAndNativeAccountPresent:{code:Fo,desc:ri[Fo]},databaseUnavailable:{code:zo,desc:ri[zo]},unableToAcquireTokenFromNativePlatform:{code:Ko,desc:ri[Ko]},nativeHandshakeTimeout:{code:$o,desc:ri[$o]},nativeExtensionNotInstalled:{code:Go,desc:ri[Go]},nativeConnectionNotEstablished:{code:jo,desc:ri[jo]},uninitializedPublicClientApplication:{code:Wo,desc:ri[Wo]},nativePromptNotSupported:{code:Vo,desc:ri[Vo]},invalidBase64StringError:{code:Qo,desc:ri[Qo]},invalidPopTokenRequest:{code:Jo,desc:ri[Jo]}};class ii extends U{constructor(e,t){super(e,ri[e],t),Object.setPrototypeOf(this,ii.prototype),this.name="BrowserAuthError"}}function ai(e,t){return new ii(e,t)}const si="invalid_grant",ci="msal",li="msal.js.browser",ui="53ee284d-920a-4b59-9d30-a60315b26836",di="ppnbnpeolgkicgegkbkbjmhlideopiji",hi="MicrosoftEntra",gi="Handshake",pi={LocalStorage:"localStorage",SessionStorage:"sessionStorage",MemoryStorage:"memoryStorage"},fi="signin",mi="signout",yi="request.origin",vi="urlHash",Ci="request.params",wi="code.verifier",Ii="interaction.status",Ti="request.native",Ai="wrapper.sku",ki="wrapper.version",Si={acquireTokenRedirect:861,acquireTokenPopup:862,ssoSilent:863,acquireTokenSilent_authCode:864,handleRedirectPromise:865,acquireTokenByCode:866,acquireTokenSilent_silentFlow:61,logout:961,logoutPopup:962};var bi;t.InteractionType=void 0,(bi=t.InteractionType||(t.InteractionType={})).Redirect="redirect",bi.Popup="popup",bi.Silent="silent",bi.None="none";const Ri={Startup:"startup",Login:"login",Logout:"logout",AcquireToken:"acquireToken",SsoSilent:"ssoSilent",HandleRedirect:"handleRedirect",None:"none"},Ei={scopes:o},Pi="msal.db",_i=`${Pi}.keys`,Mi={Default:0,AccessToken:1,AccessTokenAndRefreshToken:2,RefreshToken:3,RefreshTokenAndNetwork:4,Skip:5},Oi=[Mi.Default,Mi.Skip,Mi.RefreshTokenAndNetwork];function Ni(e){return encodeURIComponent(Li(e).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"))}function qi(e){return xi(e).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function Li(e){return xi((new TextEncoder).encode(e))}function xi(e){const t=Array.from(e,e=>String.fromCodePoint(e)).join("");return btoa(t)}function Ui(e){return(new TextDecoder).decode(Di(e))}function Di(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw ai(Qo)}const n=atob(t);return Uint8Array.from(n,e=>e.codePointAt(0)||0)}const Bi="AES-GCM",Hi="HKDF",Fi="SHA-256",zi=new Uint8Array([1,0,1]),Ki="0123456789abcdef",$i=new Uint32Array(1),Gi="raw",ji="encrypt",Wi="decrypt",Vi={name:"RSASSA-PKCS1-v1_5",hash:Fi,modulusLength:2048,publicExponent:zi};async function Qi(e,t,n){t?.addQueueMeasurement(Gt.Sha256Digest,n);const r=(new TextEncoder).encode(e);return window.crypto.subtle.digest(Fi,r)}function Ji(e){return window.crypto.getRandomValues(e)}function Yi(){return window.crypto.getRandomValues($i),$i[0]}function Xi(){const e=Date.now(),t=1024*Yi()+(1023&Yi()),n=new Uint8Array(16),r=Math.trunc(t/2**30),o=t&2**30-1,i=Yi();n[0]=e/2**40,n[1]=e/2**32,n[2]=e/2**24,n[3]=e/65536,n[4]=e/256,n[5]=e,n[6]=112|r>>>8,n[7]=r,n[8]=128|o>>>24,n[9]=o>>>16,n[10]=o>>>8,n[11]=o,n[12]=i>>>24,n[13]=i>>>16,n[14]=i>>>8,n[15]=i;let a="";for(let e=0;e<n.length;e++)a+=Ki.charAt(n[e]>>>4),a+=Ki.charAt(15&n[e]),3!==e&&5!==e&&7!==e&&9!==e||(a+="-");return a}async function Zi(e){return window.crypto.subtle.exportKey("jwk",e)}async function ea(){const e=await na(),t={alg:"dir",kty:"oct",k:qi(new Uint8Array(e))};return Li(JSON.stringify(t))}async function ta(e,t){const n=t.split(".");if(5!==n.length)throw ai(Zo,"jwe_length");const r=await async function(e){const t=Ui(e),n=Di(JSON.parse(t).k);return window.crypto.subtle.importKey(Gi,n,Bi,!1,[Wi])}(e).catch(()=>{throw ai(Zo,"import_key")});try{const e=(new TextEncoder).encode(n[0]),t=Di(n[2]),o=Di(n[3]),i=Di(n[4]),a=8*i.byteLength,s=new Uint8Array(o.length+i.length);s.set(o),s.set(i,o.length);const c=await window.crypto.subtle.decrypt({name:Bi,iv:t,tagLength:a,additionalData:e},r,s);return(new TextDecoder).decode(c)}catch(e){throw ai(Zo,"decrypt")}}async function na(){const e=await window.crypto.subtle.generateKey({name:Bi,length:256},!0,[ji,Wi]);return window.crypto.subtle.exportKey(Gi,e)}async function ra(e){return window.crypto.subtle.importKey(Gi,e,Hi,!1,["deriveKey"])}async function oa(e,t,n){return window.crypto.subtle.deriveKey({name:Hi,salt:t,hash:Fi,info:(new TextEncoder).encode(n)},e,{name:Bi,length:256},!1,[ji,Wi])}async function ia(e,t,n){const r=(new TextEncoder).encode(t),o=window.crypto.getRandomValues(new Uint8Array(16)),i=await oa(e,o,n),a=await window.crypto.subtle.encrypt({name:Bi,iv:new Uint8Array(12)},i,r);return{data:qi(new Uint8Array(a)),nonce:qi(o)}}async function aa(e,t,n,r){const o=Di(r),i=await oa(e,Di(t),n),a=await window.crypto.subtle.decrypt({name:Bi,iv:new Uint8Array(12)},i,o);return(new TextDecoder).decode(a)}async function sa(e){const t=await Qi(e);return qi(new Uint8Array(t))}const ca="storage_not_supported",la="stubbed_public_client_application_called",ua="in_mem_redirect_unavailable";var da=Object.freeze({__proto__:null,inMemRedirectUnavailable:ua,storageNotSupported:ca,stubbedPublicClientApplicationCalled:la});const ha={[ca]:"Given storage configuration option was not supported.",[la]:"Stub instance of Public Client Application was called. If using msal-react, please ensure context is not used without a provider. For more visit: aka.ms/msaljs/browser-errors",[ua]:"Redirect cannot be supported. In-memory storage was selected and storeAuthStateInCookie=false, which would cause the library to be unable to handle the incoming hash. If you would like to use the redirect API, please use session/localStorage or set storeAuthStateInCookie=true."},ga={storageNotSupportedError:{code:ca,desc:ha[ca]},stubPcaInstanceCalled:{code:la,desc:ha[la]},inMemRedirectUnavailable:{code:ua,desc:ha[ua]}};class pa extends U{constructor(e,t){super(e,t),this.name="BrowserConfigurationAuthError",Object.setPrototypeOf(this,pa.prototype)}}function fa(e){return new pa(e,ha[e])}function ma(e){e.location.hash="","function"==typeof e.history.replaceState&&e.history.replaceState(null,"",`${e.location.origin}${e.location.pathname}${e.location.search}`)}function ya(e){const t=e.split("#");t.shift(),window.location.hash=t.length>0?t.join("#"):""}function va(){return window.parent!==window}function Ca(){return"undefined"!=typeof window&&!!window.opener&&window.opener!==window&&"string"==typeof window.name&&0===window.name.indexOf(`${ci}.`)}function wa(){return"undefined"!=typeof window&&window.location?window.location.href.split("?")[0].split("#")[0]:""}function Ia(){const e=new Ot(window.location.href).getUrlComponents();return`${e.Protocol}//${e.HostNameAndPort}/`}function Ta(){if(Ot.hashContainsKnownProperties(window.location.hash)&&va())throw ai(Io)}function Aa(e){if(va()&&!e)throw ai(wo)}function ka(){if(Ca())throw ai(To)}function Sa(){if("undefined"==typeof window)throw ai(Mo)}function ba(e){if(!e)throw ai(Wo)}function Ra(e){Sa(),Ta(),ka(),ba(e)}function Ea(e,t){if(Ra(e),Aa(t.system.allowRedirectInIframe),t.cache.cacheLocation===pi.MemoryStorage&&!t.cache.storeAuthStateInCookie)throw fa(ua)}function Pa(e){const t=document.createElement("link");t.rel="preconnect",t.href=new URL(e).origin,t.crossOrigin="anonymous",document.head.appendChild(t),window.setTimeout(()=>{try{document.head.removeChild(t)}catch{}},1e4)}function _a(){return Xi()}const Ma=Bn;var Oa=Object.freeze({__proto__:null,addClientCapabilitiesToClaims:Ma,blockAPICallsBeforeInitialize:ba,blockAcquireTokenInPopups:ka,blockNonBrowserEnvironment:Sa,blockRedirectInIframe:Aa,blockReloadInHiddenIframes:Ta,clearHash:ma,createGuid:_a,getCurrentUri:wa,getHomepage:Ia,invoke:Gn,invokeAsync:jn,isInIframe:va,isInPopup:Ca,preconnect:Pa,preflightCheck:Ra,redirectPreflightCheck:Ea,replaceHash:ya});class Na{navigateInternal(e,t){return Na.defaultNavigateWindow(e,t)}navigateExternal(e,t){return Na.defaultNavigateWindow(e,t)}static defaultNavigateWindow(e,t){return t.noHistory?window.location.replace(e):window.location.assign(e),new Promise((e,n)=>{setTimeout(()=>{n(ai(ei,"failed_to_redirect"))},t.timeout)})}}class qa{async sendGetRequestAsync(e,t){let n,r={},o=0;const i=La(t);try{n=await fetch(e,{method:"GET",headers:i})}catch(e){throw vr(ai(window.navigator.onLine?Lo:No),void 0,void 0,e)}r=xa(n.headers);try{return o=n.status,{headers:r,body:await n.json(),status:o}}catch(e){throw vr(ai(xo),o,r,e)}}async sendPostRequestAsync(e,t){const n=t&&t.body||"",r=La(t);let o,i=0,a={};try{o=await fetch(e,{method:"POST",headers:r,body:n})}catch(e){throw vr(ai(window.navigator.onLine?qo:No),void 0,void 0,e)}a=xa(o.headers);try{return i=o.status,{headers:a,body:await o.json(),status:i}}catch(e){throw vr(ai(xo),i,a,e)}}}function La(e){try{const t=new Headers;if(!e||!e.headers)return t;const n=e.headers;return Object.entries(n).forEach(([e,n])=>{t.append(e,n)}),t}catch(e){throw vr(ai(Yo),void 0,void 0,e)}}function xa(e){try{const t={};return e.forEach((e,n)=>{t[n]=e}),t}catch(e){throw ai(Xo)}}const Ua=1e4,Da="@azure/msal-browser",Ba="4.26.0",Ha="msal",Fa="browser",za=`${Ha}.${Fa}.log.level`,Ka=`${Ha}.${Fa}.log.pii`,$a=`${Ha}.${Fa}.performance.enabled`,Ga=`${Ha}.${Fa}.platform.auth.dom`,ja=`${Ha}.version`,Wa="account.keys",Va="token.keys";function Qa(e=2){return e<1?`${Ha}.${Wa}`:`${Ha}.${e}.${Wa}`}function Ja(e,t=2){return t<1?`${Ha}.${Va}.${e}`:`${Ha}.${t}.${Va}.${e}`}class Ya{static loggerCallback(e,n){switch(e){case t.LogLevel.Error:return void console.error(n);case t.LogLevel.Info:return void console.info(n);case t.LogLevel.Verbose:return void console.debug(n);case t.LogLevel.Warning:return void console.warn(n);default:return void console.log(n)}}constructor(e){let r;this.browserEnvironment="undefined"!=typeof window,this.config=function({auth:e,cache:r,system:o,telemetry:i},a){const s={clientId:n.EMPTY_STRING,authority:`${n.DEFAULT_AUTHORITY}`,knownAuthorities:[],cloudDiscoveryMetadata:n.EMPTY_STRING,authorityMetadata:n.EMPTY_STRING,redirectUri:"undefined"!=typeof window?wa():"",postLogoutRedirectUri:n.EMPTY_STRING,navigateToLoginRequestUrl:!0,clientCapabilities:[],protocolMode:Tt.AAD,OIDCOptions:{serverResponseType:v.FRAGMENT,defaultScopes:[n.OPENID_SCOPE,n.PROFILE_SCOPE,n.OFFLINE_ACCESS_SCOPE]},azureCloudOptions:{azureCloudInstance:Be.None,tenant:n.EMPTY_STRING},skipAuthorityMetadataCache:!1,supportsNestedAppAuth:!1,instanceAware:!1,encodeExtraQueryParams:!1},c={cacheLocation:pi.SessionStorage,cacheRetentionDays:5,temporaryCacheLocation:pi.SessionStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!(!r||r.cacheLocation!==pi.LocalStorage),claimsBasedCachingEnabled:!1},l={loggerCallback:()=>{},logLevel:t.LogLevel.Info,piiLoggingEnabled:!1},u={...{...Jt,loggerOptions:l,networkClient:a?new qa:Gr,navigationClient:new Na,loadFrameTimeout:0,windowHashTimeout:o?.loadFrameTimeout||6e4,iframeHashTimeout:o?.loadFrameTimeout||Ua,navigateFrameWait:0,redirectNavigationTimeout:3e4,asyncPopups:!1,allowRedirectInIframe:!1,allowPlatformBroker:!1,nativeBrokerHandshakeTimeout:o?.nativeBrokerHandshakeTimeout||2e3,pollIntervalMilliseconds:30},...o,loggerOptions:o?.loggerOptions||l},d={application:{appName:n.EMPTY_STRING,appVersion:n.EMPTY_STRING},client:new Qt};if(e?.protocolMode!==Tt.OIDC&&e?.OIDCOptions&&new xe(u.loggerOptions).warning(JSON.stringify(gt(ot))),e?.protocolMode&&e.protocolMode===Tt.OIDC&&u?.allowPlatformBroker)throw gt(it);return{auth:{...s,...e,OIDCOptions:{...s.OIDCOptions,...e?.OIDCOptions}},cache:{...c,...r},system:u,telemetry:{...d,...i}}}(e,this.browserEnvironment);try{r=window[pi.SessionStorage]}catch(e){}const o=r?.getItem(za),i=r?.getItem(Ka)?.toLowerCase(),a="true"===i||"false"!==i&&void 0,s={...this.config.system.loggerOptions},c=o&&Object.keys(t.LogLevel).includes(o)?t.LogLevel[o]:void 0;c&&(s.loggerCallback=Ya.loggerCallback,s.logLevel=c),void 0!==a&&(s.piiLoggingEnabled=a),this.logger=new xe(s,Da,Ba),this.available=!1}getConfig(){return this.config}getLogger(){return this.logger}isAvailable(){return this.available}isBrowserEnvironment(){return this.browserEnvironment}}const Xa="NESTED_APP_AUTH_UNAVAILABLE";class Za{static async initializeNestedAppAuthBridge(){if(void 0===window)throw new Error("window is undefined");if(void 0===window.nestedAppAuthBridge)throw new Error("window.nestedAppAuthBridge is undefined");try{window.nestedAppAuthBridge.addEventListener("message",e=>{const t="string"==typeof e?e:e.data,n=JSON.parse(t),r=Za.bridgeRequests.find(e=>e.requestId===n.requestId);void 0!==r&&(Za.bridgeRequests.splice(Za.bridgeRequests.indexOf(r),1),n.success?r.resolve(n):r.reject(n.error))});const e=await new Promise((e,t)=>{const n=Za.buildRequest("GetInitContext"),r={requestId:n.requestId,method:n.method,resolve:e,reject:t};Za.bridgeRequests.push(r),window.nestedAppAuthBridge.postMessage(JSON.stringify(n))});return Za.validateBridgeResultOrThrow(e.initContext)}catch(e){throw window.console.log(e),e}}getTokenInteractive(e){return this.getToken("GetTokenPopup",e)}getTokenSilent(e){return this.getToken("GetToken",e)}async getToken(e,t){const n=await this.sendRequest(e,{tokenParams:t});return{token:Za.validateBridgeResultOrThrow(n.token),account:Za.validateBridgeResultOrThrow(n.account)}}getHostCapabilities(){return this.capabilities??null}getAccountContext(){return this.accountContext?this.accountContext:null}static buildRequest(e,t){return{messageType:"NestedAppAuthRequest",method:e,requestId:Xi(),sendTime:Date.now(),clientLibrary:li,clientLibraryVersion:Ba,...t}}sendRequest(e,t){const n=Za.buildRequest(e,t);return new Promise((e,t)=>{const r={requestId:n.requestId,method:n.method,resolve:e,reject:t};Za.bridgeRequests.push(r),window.nestedAppAuthBridge.postMessage(JSON.stringify(n))})}static validateBridgeResultOrThrow(e){if(void 0===e)throw{status:Xa};return e}constructor(e,t,n,r){this.sdkName=e,this.sdkVersion=t,this.accountContext=n,this.capabilities=r}static async create(){const e=await Za.initializeNestedAppAuthBridge();return new Za(e.sdkName,e.sdkVersion,e.accountContext,e.capabilities)}}Za.bridgeRequests=[];class es extends Ya{constructor(){super(...arguments),this.bridgeProxy=void 0,this.accountContext=null}getModuleName(){return es.MODULE_NAME}getId(){return es.ID}getBridgeProxy(){return this.bridgeProxy}async initialize(){try{if("undefined"!=typeof window){"function"==typeof window.__initializeNestedAppAuth&&await window.__initializeNestedAppAuth();const e=await Za.create();this.accountContext=e.getAccountContext(),this.bridgeProxy=e,this.available=void 0!==e}}catch(e){this.logger.infoPii(`Could not initialize Nested App Auth bridge (${e})`)}return this.logger.info(`Nested App Auth Bridge available: ${this.available}`),this.available}}es.MODULE_NAME="",es.ID="NestedAppOperatingContext";class ts extends Ya{getModuleName(){return ts.MODULE_NAME}getId(){return ts.ID}async initialize(){return this.available="undefined"!=typeof window,this.available}}ts.MODULE_NAME="",ts.ID="StandardOperatingContext";class ns{constructor(){this.dbName=Pi,this.version=1,this.tableName=_i,this.dbOpen=!1}async open(){return new Promise((e,t)=>{const n=window.indexedDB.open(this.dbName,this.version);n.addEventListener("upgradeneeded",e=>{e.target.result.createObjectStore(this.tableName)}),n.addEventListener("success",t=>{const n=t;this.db=n.target.result,this.dbOpen=!0,e()}),n.addEventListener("error",()=>t(ai(zo)))})}closeConnection(){const e=this.db;e&&this.dbOpen&&(e.close(),this.dbOpen=!1)}async validateDbIsOpen(){if(!this.dbOpen)return this.open()}async getItem(e){return await this.validateDbIsOpen(),new Promise((t,n)=>{if(!this.db)return n(ai(Oo));const r=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).get(e);r.addEventListener("success",e=>{const n=e;this.closeConnection(),t(n.target.result)}),r.addEventListener("error",e=>{this.closeConnection(),n(e)})})}async setItem(e,t){return await this.validateDbIsOpen(),new Promise((n,r)=>{if(!this.db)return r(ai(Oo));const o=this.db.transaction([this.tableName],"readwrite").objectStore(this.tableName).put(t,e);o.addEventListener("success",()=>{this.closeConnection(),n()}),o.addEventListener("error",e=>{this.closeConnection(),r(e)})})}async removeItem(e){return await this.validateDbIsOpen(),new Promise((t,n)=>{if(!this.db)return n(ai(Oo));const r=this.db.transaction([this.tableName],"readwrite").objectStore(this.tableName).delete(e);r.addEventListener("success",()=>{this.closeConnection(),t()}),r.addEventListener("error",e=>{this.closeConnection(),n(e)})})}async getKeys(){return await this.validateDbIsOpen(),new Promise((e,t)=>{if(!this.db)return t(ai(Oo));const n=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).getAllKeys();n.addEventListener("success",t=>{const n=t;this.closeConnection(),e(n.target.result)}),n.addEventListener("error",e=>{this.closeConnection(),t(e)})})}async containsKey(e){return await this.validateDbIsOpen(),new Promise((t,n)=>{if(!this.db)return n(ai(Oo));const r=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).count(e);r.addEventListener("success",e=>{const n=e;this.closeConnection(),t(1===n.target.result)}),r.addEventListener("error",e=>{this.closeConnection(),n(e)})})}async deleteDatabase(){return this.db&&this.dbOpen&&this.closeConnection(),new Promise((e,t)=>{const n=window.indexedDB.deleteDatabase(Pi),r=setTimeout(()=>t(!1),200);n.addEventListener("success",()=>(clearTimeout(r),e(!0))),n.addEventListener("blocked",()=>(clearTimeout(r),e(!0))),n.addEventListener("error",()=>(clearTimeout(r),t(!1)))})}}class rs{constructor(){this.cache=new Map}async initialize(){}getItem(e){return this.cache.get(e)||null}getUserData(e){return this.getItem(e)}setItem(e,t){this.cache.set(e,t)}async setUserData(e,t){this.setItem(e,t)}removeItem(e){this.cache.delete(e)}getKeys(){const e=[];return this.cache.forEach((t,n)=>{e.push(n)}),e}containsKey(e){return this.cache.has(e)}clear(){this.cache.clear()}decryptData(){return Promise.resolve(null)}}class os{constructor(e){this.inMemoryCache=new rs,this.indexedDBCache=new ns,this.logger=e}handleDatabaseAccessError(e){if(!(e instanceof ii&&e.errorCode===zo))throw e;this.logger.error("Could not access persistent storage. This may be caused by browser privacy features which block persistent storage in third-party contexts.")}async getItem(e){const t=this.inMemoryCache.getItem(e);if(!t)try{return this.logger.verbose("Queried item not found in in-memory cache, now querying persistent storage."),await this.indexedDBCache.getItem(e)}catch(e){this.handleDatabaseAccessError(e)}return t}async setItem(e,t){this.inMemoryCache.setItem(e,t);try{await this.indexedDBCache.setItem(e,t)}catch(e){this.handleDatabaseAccessError(e)}}async removeItem(e){this.inMemoryCache.removeItem(e);try{await this.indexedDBCache.removeItem(e)}catch(e){this.handleDatabaseAccessError(e)}}async getKeys(){const e=this.inMemoryCache.getKeys();if(0===e.length)try{return this.logger.verbose("In-memory cache is empty, now querying persistent storage."),await this.indexedDBCache.getKeys()}catch(e){this.handleDatabaseAccessError(e)}return e}async containsKey(e){const t=this.inMemoryCache.containsKey(e);if(!t)try{return this.logger.verbose("Key not found in in-memory cache, now querying persistent storage."),await this.indexedDBCache.containsKey(e)}catch(e){this.handleDatabaseAccessError(e)}return t}clearInMemory(){this.logger.verbose("Deleting in-memory keystore"),this.inMemoryCache.clear(),this.logger.verbose("In-memory keystore deleted")}async clearPersistent(){try{this.logger.verbose("Deleting persistent keystore");const e=await this.indexedDBCache.deleteDatabase();return e&&this.logger.verbose("Persistent keystore deleted"),e}catch(e){return this.handleDatabaseAccessError(e),!1}}}class is{constructor(e,t,n){this.logger=e,function(e){if(!window)throw ai(Mo);if(!window.crypto)throw ai(ao);if(!e&&!window.crypto.subtle)throw ai(ao,"crypto_subtle_undefined")}(n??!1),this.cache=new os(this.logger),this.performanceClient=t}createNewGuid(){return Xi()}base64Encode(e){return Li(e)}base64Decode(e){return Ui(e)}base64UrlEncode(e){return Ni(e)}encodeKid(e){return this.base64UrlEncode(JSON.stringify({kid:e}))}async getPublicKeyThumbprint(e){const t=this.performanceClient?.startMeasurement(Gt.CryptoOptsGetPublicKeyThumbprint,e.correlationId),n=await async function(e,t){return window.crypto.subtle.generateKey(Vi,e,t)}(is.EXTRACTABLE,is.POP_KEY_USAGES),r=await Zi(n.publicKey),o=as({e:r.e,kty:r.kty,n:r.n}),i=await this.hashString(o),a=await Zi(n.privateKey),s=await async function(e){return window.crypto.subtle.importKey("jwk",e,Vi,!1,["sign"])}(a);return await this.cache.setItem(i,{privateKey:s,publicKey:n.publicKey,requestMethod:e.resourceRequestMethod,requestUri:e.resourceRequestUri}),t&&t.end({success:!0}),i}async removeTokenBindingKey(e){if(await this.cache.removeItem(e),await this.cache.containsKey(e))throw Ne(Ie)}async clearKeystore(){this.cache.clearInMemory();try{return await this.cache.clearPersistent(),!0}catch(e){return e instanceof Error?this.logger.error(`Clearing keystore failed with error: ${e.message}`):this.logger.error("Clearing keystore failed with unknown error"),!1}}async signJwt(e,t,n,r){const o=this.performanceClient?.startMeasurement(Gt.CryptoOptsSignJwt,r),i=await this.cache.getItem(t);if(!i)throw ai(Do);const a=await Zi(i.publicKey),s=as(a),c=Ni(JSON.stringify({kid:t})),l=Ni(eo.getShrHeaderString({...n?.header,alg:a.alg,kid:c}));e.cnf={jwk:JSON.parse(s)};const u=`${l}.${Ni(JSON.stringify(e))}`,d=(new TextEncoder).encode(u),h=await async function(e,t){return window.crypto.subtle.sign(Vi,e,t)}(i.privateKey,d),g=`${u}.${qi(new Uint8Array(h))}`;return o&&o.end({success:!0}),g}async hashString(e){return sa(e)}}function as(e){return JSON.stringify(e,Object.keys(e).sort())}is.POP_KEY_USAGES=["sign","verify"],is.EXTRACTABLE=!0;const ss="None";class cs{initialize(){return Promise.resolve()}getItem(e){const t=`${encodeURIComponent(e)}`,n=document.cookie.split(";");for(let e=0;e<n.length;e++){const r=n[e],[o,...i]=decodeURIComponent(r).trim().split("="),a=i.join("=");if(o===t)return a}return""}getUserData(){throw Ne(Re)}setItem(e,t,n,r=!0,o="Lax"){let i=`${encodeURIComponent(e)}=${encodeURIComponent(t)};path=/;SameSite=${o};`;if(n){const e=function(e){const t=new Date;return new Date(t.getTime()+864e5*e).toUTCString()}(n);i+=`expires=${e};`}(r||o===ss)&&(i+="Secure;"),document.cookie=i}async setUserData(){return Promise.reject(Ne(Re))}removeItem(e){this.setItem(e,"",-1)}getKeys(){const e=document.cookie.split(";"),t=[];return e.forEach(e=>{const n=decodeURIComponent(e).trim().split("=");t.push(n[0])}),t}containsKey(e){return this.getKeys().includes(e)}decryptData(){return Promise.resolve(null)}}function ls(e,t){const n=e.getItem(Qa(t));return n?JSON.parse(n):[]}function us(e,t,n){const r=t.getItem(Ja(e,n));if(r){const e=JSON.parse(r);if(e&&e.hasOwnProperty("idToken")&&e.hasOwnProperty("accessToken")&&e.hasOwnProperty("refreshToken"))return e}return{idToken:[],accessToken:[],refreshToken:[]}}function ds(e){return e.hasOwnProperty("id")&&e.hasOwnProperty("nonce")&&e.hasOwnProperty("data")}const hs="msal.cache.encryption";class gs{constructor(e,t,n){if(!window.localStorage)throw fa(ca);this.memoryStorage=new rs,this.initialized=!1,this.clientId=e,this.logger=t,this.performanceClient=n,this.broadcast=new BroadcastChannel("msal.broadcast.cache")}async initialize(e){const t=new cs,n=t.getItem(hs);let r={key:"",id:""};if(n)try{r=JSON.parse(n)}catch(e){}if(r.key&&r.id){const t=Gn(Di,Gt.Base64Decode,this.logger,this.performanceClient,e)(r.key);this.encryptionCookie={id:r.id,key:await jn(ra,Gt.GenerateHKDF,this.logger,this.performanceClient,e)(t)}}else{const n=Xi(),r=await jn(na,Gt.GenerateBaseKey,this.logger,this.performanceClient,e)(),o=Gn(qi,Gt.UrlEncodeArr,this.logger,this.performanceClient,e)(new Uint8Array(r));this.encryptionCookie={id:n,key:await jn(ra,Gt.GenerateHKDF,this.logger,this.performanceClient,e)(r)};const i={id:n,key:o};t.setItem(hs,JSON.stringify(i),0,!0,ss)}await jn(this.importExistingCache.bind(this),Gt.ImportExistingCache,this.logger,this.performanceClient,e)(e),this.broadcast.addEventListener("message",this.updateCache.bind(this)),this.initialized=!0}getItem(e){return window.localStorage.getItem(e)}getUserData(e){if(!this.initialized)throw ai(Wo);return this.memoryStorage.getItem(e)}async decryptData(e,t,n){if(!this.initialized||!this.encryptionCookie)throw ai(Wo);if(t.id!==this.encryptionCookie.id)return this.performanceClient.incrementFields({encryptedCacheExpiredCount:1},n),null;const r=await jn(aa,Gt.Decrypt,this.logger,this.performanceClient,n)(this.encryptionCookie.key,t.nonce,this.getContext(e),t.data);if(!r)return null;try{return{...JSON.parse(r),lastUpdatedAt:t.lastUpdatedAt}}catch(e){return this.performanceClient.incrementFields({encryptedCacheCorruptionCount:1},n),null}}setItem(e,t){window.localStorage.setItem(e,t)}async setUserData(e,t,n,r,o){if(!this.initialized||!this.encryptionCookie)throw ai(Wo);if(o)this.setItem(e,t);else{const{data:o,nonce:i}=await jn(ia,Gt.Encrypt,this.logger,this.performanceClient,n)(this.encryptionCookie.key,t,this.getContext(e)),a={id:this.encryptionCookie.id,nonce:i,data:o,lastUpdatedAt:r};this.setItem(e,JSON.stringify(a))}this.memoryStorage.setItem(e,t),this.broadcast.postMessage({key:e,value:t,context:this.getContext(e)})}removeItem(e){this.memoryStorage.containsKey(e)&&(this.memoryStorage.removeItem(e),this.broadcast.postMessage({key:e,value:null,context:this.getContext(e)})),window.localStorage.removeItem(e)}getKeys(){return Object.keys(window.localStorage)}containsKey(e){return window.localStorage.hasOwnProperty(e)}clear(){this.memoryStorage.clear(),ls(this).forEach(e=>this.removeItem(e));const e=us(this.clientId,this);e.idToken.forEach(e=>this.removeItem(e)),e.accessToken.forEach(e=>this.removeItem(e)),e.refreshToken.forEach(e=>this.removeItem(e)),this.getKeys().forEach(e=>{(e.startsWith(Ha)||-1!==e.indexOf(this.clientId))&&this.removeItem(e)})}async importExistingCache(e){if(!this.encryptionCookie)return;let t=ls(this);t=await this.importArray(t,e),t.length?this.setItem(Qa(),JSON.stringify(t)):this.removeItem(Qa());const n=us(this.clientId,this);n.idToken=await this.importArray(n.idToken,e),n.accessToken=await this.importArray(n.accessToken,e),n.refreshToken=await this.importArray(n.refreshToken,e),n.idToken.length||n.accessToken.length||n.refreshToken.length?this.setItem(Ja(this.clientId),JSON.stringify(n)):this.removeItem(Ja(this.clientId))}async getItemFromEncryptedCache(e,t){if(!this.encryptionCookie)return null;const n=this.getItem(e);if(!n)return null;let r;try{r=JSON.parse(n)}catch(e){return null}return ds(r)?r.id!==this.encryptionCookie.id?(this.performanceClient.incrementFields({encryptedCacheExpiredCount:1},t),null):(this.performanceClient.incrementFields({encryptedCacheCount:1},t),jn(aa,Gt.Decrypt,this.logger,this.performanceClient,t)(this.encryptionCookie.key,r.nonce,this.getContext(e),r.data)):(this.performanceClient.incrementFields({unencryptedCacheCount:1},t),n)}async importArray(e,t){const n=[],r=[];return e.forEach(e=>{const o=this.getItemFromEncryptedCache(e,t).then(t=>{t?(this.memoryStorage.setItem(e,t),n.push(e)):this.removeItem(e)});r.push(o)}),await Promise.all(r),n}getContext(e){let t="";return e.includes(this.clientId)&&(t=this.clientId),t}updateCache(e){this.logger.trace("Updating internal cache from broadcast event");const t=this.performanceClient.startMeasurement(Gt.LocalStorageUpdated);t.add({isBackground:!0});const{key:n,value:r,context:o}=e.data;return n?o&&o!==this.clientId?(this.logger.trace(`Ignoring broadcast event from clientId: ${o}`),void t.end({success:!1,errorCode:"contextMismatch"})):(r?(this.memoryStorage.setItem(n,r),this.logger.verbose("Updated item in internal cache")):(this.memoryStorage.removeItem(n),this.logger.verbose("Removed item from internal cache")),void t.end({success:!0})):(this.logger.error("Broadcast event missing key"),void t.end({success:!1,errorCode:"noKey"}))}}class ps{constructor(){if(!window.sessionStorage)throw fa(ca)}async initialize(){}getItem(e){return window.sessionStorage.getItem(e)}getUserData(e){return this.getItem(e)}setItem(e,t){window.sessionStorage.setItem(e,t)}async setUserData(e,t){this.setItem(e,t)}removeItem(e){window.sessionStorage.removeItem(e)}getKeys(){return Object.keys(window.sessionStorage)}containsKey(e){return window.sessionStorage.hasOwnProperty(e)}decryptData(){return Promise.resolve(null)}}const fs={INITIALIZE_START:"msal:initializeStart",INITIALIZE_END:"msal:initializeEnd",ACCOUNT_ADDED:"msal:accountAdded",ACCOUNT_REMOVED:"msal:accountRemoved",ACTIVE_ACCOUNT_CHANGED:"msal:activeAccountChanged",LOGIN_START:"msal:loginStart",LOGIN_SUCCESS:"msal:loginSuccess",LOGIN_FAILURE:"msal:loginFailure",ACQUIRE_TOKEN_START:"msal:acquireTokenStart",ACQUIRE_TOKEN_SUCCESS:"msal:acquireTokenSuccess",ACQUIRE_TOKEN_FAILURE:"msal:acquireTokenFailure",ACQUIRE_TOKEN_NETWORK_START:"msal:acquireTokenFromNetworkStart",SSO_SILENT_START:"msal:ssoSilentStart",SSO_SILENT_SUCCESS:"msal:ssoSilentSuccess",SSO_SILENT_FAILURE:"msal:ssoSilentFailure",ACQUIRE_TOKEN_BY_CODE_START:"msal:acquireTokenByCodeStart",ACQUIRE_TOKEN_BY_CODE_SUCCESS:"msal:acquireTokenByCodeSuccess",ACQUIRE_TOKEN_BY_CODE_FAILURE:"msal:acquireTokenByCodeFailure",HANDLE_REDIRECT_START:"msal:handleRedirectStart",HANDLE_REDIRECT_END:"msal:handleRedirectEnd",POPUP_OPENED:"msal:popupOpened",LOGOUT_START:"msal:logoutStart",LOGOUT_SUCCESS:"msal:logoutSuccess",LOGOUT_FAILURE:"msal:logoutFailure",LOGOUT_END:"msal:logoutEnd",RESTORE_FROM_BFCACHE:"msal:restoreFromBFCache",BROKER_CONNECTION_ESTABLISHED:"msal:brokerConnectionEstablished"};function ms(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}class ys extends Kt{constructor(e,t,n,r,o,i,a){super(e,n,r,o,a),this.cacheConfig=t,this.logger=r,this.internalStorage=new rs,this.browserStorage=vs(e,t.cacheLocation,r,o),this.temporaryCacheStorage=vs(e,t.temporaryCacheLocation,r,o),this.cookieStorage=new cs,this.eventHandler=i}async initialize(e){this.performanceClient.addFields({cacheLocation:this.cacheConfig.cacheLocation,cacheRetentionDays:this.cacheConfig.cacheRetentionDays},e),await this.browserStorage.initialize(e),await this.migrateExistingCache(e),this.trackVersionChanges(e)}async migrateExistingCache(e){let t=ls(this.browserStorage),n=us(this.clientId,this.browserStorage);this.performanceClient.addFields({preMigrateAcntCount:t.length,preMigrateATCount:n.accessToken.length,preMigrateITCount:n.idToken.length,preMigrateRTCount:n.refreshToken.length},e);for(let t=0;t<2;t++){const n=t;await this.removeStaleAccounts(t,n,e)}for(let t=0;t<2;t++){const n=t;await this.migrateIdTokens(t,n,e)}const r=this.getKMSIValues();for(let t=0;t<2;t++)await this.migrateAccessTokens(t,r,e),await this.migrateRefreshTokens(t,r,e);t=ls(this.browserStorage),n=us(this.clientId,this.browserStorage),this.performanceClient.addFields({postMigrateAcntCount:t.length,postMigrateATCount:n.accessToken.length,postMigrateITCount:n.idToken.length,postMigrateRTCount:n.refreshToken.length},e)}async updateOldEntry(e,t){const n=this.browserStorage.getItem(e),r=this.validateAndParseJson(n||"");if(!r)return this.browserStorage.removeItem(e),null;if(r.lastUpdatedAt){if(Xn(r.lastUpdatedAt,this.cacheConfig.cacheRetentionDays))return this.browserStorage.removeItem(e),this.performanceClient.incrementFields({expiredCacheRemovedCount:1},t),null}else r.lastUpdatedAt=Date.now().toString(),this.setItem(e,JSON.stringify(r),t);const o=ds(r)?await this.browserStorage.decryptData(e,r,t):r;return o&&rr(o)?(or(o)||ir(o))&&o.expiresOn&&Yn(o.expiresOn,300)?(this.browserStorage.removeItem(e),this.performanceClient.incrementFields({expiredCacheRemovedCount:1},t),null):o:(this.performanceClient.incrementFields({invalidCacheCount:1},t),null)}async removeStaleAccounts(e,t,n){const r=ls(this.browserStorage,e);if(0!==r.length){for(const e of[...r]){this.performanceClient.incrementFields({oldAcntCount:1},n);const o=this.browserStorage.getItem(e),i=this.validateAndParseJson(o||"");i?i.lastUpdatedAt?Xn(i.lastUpdatedAt,this.cacheConfig.cacheRetentionDays)&&(await this.removeAccountOldSchema(e,i,t,n),ms(r,e)):(i.lastUpdatedAt=Date.now().toString(),this.setItem(e,JSON.stringify(i),n)):ms(r,e)}this.setAccountKeys(r,n,e)}}async removeAccountOldSchema(e,t,n,r){const o=ds(t)?await this.browserStorage.decryptData(e,t,r):t,i=o?.homeAccountId;if(i){const e=this.getTokenKeys(n);[...e.idToken].filter(e=>e.includes(i)).forEach(t=>{this.browserStorage.removeItem(t),ms(e.idToken,t)}),[...e.accessToken].filter(e=>e.includes(i)).forEach(t=>{this.browserStorage.removeItem(t),ms(e.accessToken,t)}),[...e.refreshToken].filter(e=>e.includes(i)).forEach(t=>{this.browserStorage.removeItem(t),ms(e.refreshToken,t)}),this.setTokenKeys(e,r,n)}this.performanceClient.incrementFields({expiredAcntRemovedCount:1},r),this.browserStorage.removeItem(e)}getKMSIValues(){const e={},t=this.getTokenKeys().idToken;for(const n of t){const t=this.browserStorage.getUserData(n);if(t){const n=JSON.parse(t),r=kt(n.secret,Ui);r&&(e[n.homeAccountId]=St(r))}}return e}async migrateIdTokens(e,t,n){const r=us(this.clientId,this.browserStorage,e);if(0===r.idToken.length)return;const o=us(this.clientId,this.browserStorage,2),i=ls(this.browserStorage),a=ls(this.browserStorage,t);for(const e of[...r.idToken]){this.performanceClient.incrementFields({oldITCount:1},n);const t=await this.updateOldEntry(e,n);if(!t){ms(r.idToken,e);continue}const s=i.find(e=>e.includes(t.homeAccountId)),c=a.find(e=>e.includes(t.homeAccountId));let l=null;if(s)l=this.getAccount(s,n);else if(c){const e=this.browserStorage.getItem(c),t=this.validateAndParseJson(e||"");l=t&&ds(t)?await this.browserStorage.decryptData(c,t,n):t}if(!l){this.performanceClient.incrementFields({skipITMigrateCount:1},n);continue}const u=kt(t.secret,Ui),d=this.generateCredentialKey(t),h=this.getIdTokenCredential(d,n),g=Object.keys(u).includes("signin_state"),p=h&&Object.keys(kt(h.secret,Ui)||{}).includes("signin_state");if(!h||t.lastUpdatedAt>h.lastUpdatedAt&&(g||!p)){const e=l.tenantProfiles||[],r=It(u)||l.realm;if(r&&!e.find(e=>e.tenantId===r)){const t=Ct(l.homeAccountId,l.localAccountId,r,u);e.push(t)}l.tenantProfiles=e;const a=this.generateAccountKey(At.getAccountInfo(l)),s=St(u);await this.setUserData(a,JSON.stringify(l),n,l.lastUpdatedAt,s),i.includes(a)||i.push(a),await this.setUserData(d,JSON.stringify(t),n,t.lastUpdatedAt,s),this.performanceClient.incrementFields({migratedITCount:1},n),o.idToken.push(d)}}this.setTokenKeys(r,n,e),this.setTokenKeys(o,n),this.setAccountKeys(i,n)}async migrateAccessTokens(e,t,n){const r=us(this.clientId,this.browserStorage,e);if(0===r.accessToken.length)return;const o=us(this.clientId,this.browserStorage,2);for(const e of[...r.accessToken]){this.performanceClient.incrementFields({oldATCount:1},n);const i=await this.updateOldEntry(e,n);if(!i){ms(r.accessToken,e);continue}if(!Object.keys(t).includes(i.homeAccountId)){this.performanceClient.incrementFields({skipATMigrateCount:1},n);continue}const a=this.generateCredentialKey(i),s=t[i.homeAccountId];if(o.accessToken.includes(a)){const e=this.getAccessTokenCredential(a,n);(!e||i.lastUpdatedAt>e.lastUpdatedAt)&&(await this.setUserData(a,JSON.stringify(i),n,i.lastUpdatedAt,s),this.performanceClient.incrementFields({migratedATCount:1},n))}else await this.setUserData(a,JSON.stringify(i),n,i.lastUpdatedAt,s),this.performanceClient.incrementFields({migratedATCount:1},n),o.accessToken.push(a)}this.setTokenKeys(r,n,e),this.setTokenKeys(o,n)}async migrateRefreshTokens(e,t,n){const r=us(this.clientId,this.browserStorage,e);if(0===r.refreshToken.length)return;const o=us(this.clientId,this.browserStorage,2);for(const e of[...r.refreshToken]){this.performanceClient.incrementFields({oldRTCount:1},n);const i=await this.updateOldEntry(e,n);if(!i){ms(r.refreshToken,e);continue}if(!Object.keys(t).includes(i.homeAccountId)){this.performanceClient.incrementFields({skipRTMigrateCount:1},n);continue}const a=this.generateCredentialKey(i),s=t[i.homeAccountId];if(o.refreshToken.includes(a)){const e=this.getRefreshTokenCredential(a,n);(!e||i.lastUpdatedAt>e.lastUpdatedAt)&&(await this.setUserData(a,JSON.stringify(i),n,i.lastUpdatedAt,s),this.performanceClient.incrementFields({migratedRTCount:1},n))}else await this.setUserData(a,JSON.stringify(i),n,i.lastUpdatedAt,s),this.performanceClient.incrementFields({migratedRTCount:1},n),o.refreshToken.push(a)}this.setTokenKeys(r,n,e),this.setTokenKeys(o,n)}trackVersionChanges(e){const t=this.browserStorage.getItem(ja);t&&(this.logger.info(`MSAL.js was last initialized by version: ${t}`),this.performanceClient.addFields({previousLibraryVersion:t},e)),t!==Ba&&this.setItem(ja,Ba,e)}validateAndParseJson(e){if(!e)return null;try{const t=JSON.parse(e);return t&&"object"==typeof t?t:null}catch(e){return null}}setItem(e,t,n){const r=new Array(3).fill(0),o=[];for(let i=0;i<=20;i++)try{if(this.browserStorage.setItem(e,t),i>0)for(let e=0;e<=2;e++){const t=r.slice(0,e).reduce((e,t)=>e+t,0);if(t>=i)break;const a=i>t+r[e]?t+r[e]:i;i>t&&r[e]>0&&this.removeAccessTokenKeys(o.slice(t,a),n,e)}break}catch(a){const s=zt(a);if(!(s.errorCode===Dt&&i<20))throw s;if(!o.length)for(let n=0;n<=2;n++)if(e===Ja(this.clientId,n)){const e=JSON.parse(t).accessToken;o.push(...e),r[n]=e.length}else{const e=this.getTokenKeys(n).accessToken;o.push(...e),r[n]=e.length}if(o.length<=i)throw s;this.removeAccessToken(o[i],n,!1)}}async setUserData(e,t,n,r,o){const i=new Array(3).fill(0),a=[];for(let s=0;s<=20;s++)try{if(await jn(this.browserStorage.setUserData.bind(this.browserStorage),Gt.SetUserData,this.logger,this.performanceClient)(e,t,n,r,o),s>0)for(let e=0;e<=2;e++){const t=i.slice(0,e).reduce((e,t)=>e+t,0);if(t>=s)break;const r=s>t+i[e]?t+i[e]:s;s>t&&i[e]>0&&this.removeAccessTokenKeys(a.slice(t,r),n,e)}break}catch(e){const t=zt(e);if(!(t.errorCode===Dt&&s<20))throw t;if(!a.length)for(let e=0;e<=2;e++){const t=this.getTokenKeys(e).accessToken;a.push(...t),i[e]=t.length}if(a.length<=s)throw t;this.removeAccessToken(a[s],n,!1)}}getAccount(e,t){this.logger.trace("BrowserCacheManager.getAccount called");const n=this.browserStorage.getUserData(e);if(!n)return this.removeAccountKeyFromMap(e,t),null;const r=this.validateAndParseJson(n);return r&&At.isAccountEntity(r)?Kt.toObject(new At,r):null}async setAccount(e,t,n){this.logger.trace("BrowserCacheManager.setAccount called");const r=this.generateAccountKey(At.getAccountInfo(e)),o=Date.now().toString();e.lastUpdatedAt=o,await this.setUserData(r,JSON.stringify(e),t,o,n);const i=this.addAccountKeyToMap(r,t);this.performanceClient.addFields({kmsi:n},t),this.cacheConfig.cacheLocation===pi.LocalStorage&&i&&this.eventHandler.emitEvent(fs.ACCOUNT_ADDED,void 0,At.getAccountInfo(e))}getAccountKeys(){return ls(this.browserStorage)}setAccountKeys(e,t,n=2){0===e.length?this.removeItem(Qa(n)):this.setItem(Qa(n),JSON.stringify(e),t)}addAccountKeyToMap(e,t){this.logger.trace("BrowserCacheManager.addAccountKeyToMap called"),this.logger.tracePii(`BrowserCacheManager.addAccountKeyToMap called with key: ${e}`);const n=this.getAccountKeys();return-1===n.indexOf(e)?(n.push(e),this.setItem(Qa(),JSON.stringify(n),t),this.logger.verbose("BrowserCacheManager.addAccountKeyToMap account key added"),!0):(this.logger.verbose("BrowserCacheManager.addAccountKeyToMap account key already exists in map"),!1)}removeAccountKeyFromMap(e,t){this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap called"),this.logger.tracePii(`BrowserCacheManager.removeAccountKeyFromMap called with key: ${e}`);const n=this.getAccountKeys(),r=n.indexOf(e);r>-1?(n.splice(r,1),this.setAccountKeys(n,t),this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap account key removed")):this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap key not found in existing map")}removeAccount(e,t){const n=this.getActiveAccount(t);n?.homeAccountId===e.homeAccountId&&n?.environment===e.environment&&this.setActiveAccount(null,t),super.removeAccount(e,t),this.removeAccountKeyFromMap(this.generateAccountKey(e),t),this.browserStorage.getKeys().forEach(t=>{t.includes(e.homeAccountId)&&t.includes(e.environment)&&this.browserStorage.removeItem(t)}),this.cacheConfig.cacheLocation===pi.LocalStorage&&this.eventHandler.emitEvent(fs.ACCOUNT_REMOVED,void 0,e)}removeIdToken(e,t){super.removeIdToken(e,t);const n=this.getTokenKeys(),r=n.idToken.indexOf(e);r>-1&&(this.logger.info("idToken removed from tokenKeys map"),n.idToken.splice(r,1),this.setTokenKeys(n,t))}removeAccessToken(e,t,n=!0){super.removeAccessToken(e,t),n&&this.removeAccessTokenKeys([e],t)}removeAccessTokenKeys(e,t,n=2){this.logger.trace("removeAccessTokenKey called");const r=this.getTokenKeys(n);let o=0;if(e.forEach(e=>{const t=r.accessToken.indexOf(e);t>-1&&(r.accessToken.splice(t,1),o++)}),o>0)return this.logger.info(`removed ${o} accessToken keys from tokenKeys map`),void this.setTokenKeys(r,t,n)}removeRefreshToken(e,t){super.removeRefreshToken(e,t);const n=this.getTokenKeys(),r=n.refreshToken.indexOf(e);r>-1&&(this.logger.info("refreshToken removed from tokenKeys map"),n.refreshToken.splice(r,1),this.setTokenKeys(n,t))}getTokenKeys(e=2){return us(this.clientId,this.browserStorage,e)}setTokenKeys(e,t,n=2){0!==e.idToken.length||0!==e.accessToken.length||0!==e.refreshToken.length?this.setItem(Ja(this.clientId,n),JSON.stringify(e),t):this.removeItem(Ja(this.clientId,n))}getIdTokenCredential(e,t){const n=this.browserStorage.getUserData(e);if(!n)return this.logger.trace("BrowserCacheManager.getIdTokenCredential: called, no cache hit"),this.removeIdToken(e,t),null;const r=this.validateAndParseJson(n);return r&&(o=r)&&rr(o)&&o.hasOwnProperty("realm")&&o.credentialType===w.ID_TOKEN?(this.logger.trace("BrowserCacheManager.getIdTokenCredential: cache hit"),r):(this.logger.trace("BrowserCacheManager.getIdTokenCredential: called, no cache hit"),null);var o}async setIdTokenCredential(e,t,n){this.logger.trace("BrowserCacheManager.setIdTokenCredential called");const r=this.generateCredentialKey(e),o=Date.now().toString();e.lastUpdatedAt=o,await this.setUserData(r,JSON.stringify(e),t,o,n);const i=this.getTokenKeys();-1===i.idToken.indexOf(r)&&(this.logger.info("BrowserCacheManager: addTokenKey - idToken added to map"),i.idToken.push(r),this.setTokenKeys(i,t))}getAccessTokenCredential(e,t){const n=this.browserStorage.getUserData(e);if(!n)return this.logger.trace("BrowserCacheManager.getAccessTokenCredential: called, no cache hit"),this.removeAccessTokenKeys([e],t),null;const r=this.validateAndParseJson(n);return r&&or(r)?(this.logger.trace("BrowserCacheManager.getAccessTokenCredential: cache hit"),r):(this.logger.trace("BrowserCacheManager.getAccessTokenCredential: called, no cache hit"),null)}async setAccessTokenCredential(e,t,n){this.logger.trace("BrowserCacheManager.setAccessTokenCredential called");const r=this.generateCredentialKey(e),o=Date.now().toString();e.lastUpdatedAt=o,await this.setUserData(r,JSON.stringify(e),t,o,n);const i=this.getTokenKeys(),a=i.accessToken.indexOf(r);-1!==a&&i.accessToken.splice(a,1),this.logger.trace(`access token ${-1===a?"added to":"updated in"} map`),i.accessToken.push(r),this.setTokenKeys(i,t)}getRefreshTokenCredential(e,t){const n=this.browserStorage.getUserData(e);if(!n)return this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: called, no cache hit"),this.removeRefreshToken(e,t),null;const r=this.validateAndParseJson(n);return r&&ir(r)?(this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: cache hit"),r):(this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: called, no cache hit"),null)}async setRefreshTokenCredential(e,t,n){this.logger.trace("BrowserCacheManager.setRefreshTokenCredential called");const r=this.generateCredentialKey(e),o=Date.now().toString();e.lastUpdatedAt=o,await this.setUserData(r,JSON.stringify(e),t,o,n);const i=this.getTokenKeys();-1===i.refreshToken.indexOf(r)&&(this.logger.info("BrowserCacheManager: addTokenKey - refreshToken added to map"),i.refreshToken.push(r),this.setTokenKeys(i,t))}getAppMetadata(e){const t=this.browserStorage.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getAppMetadata: called, no cache hit"),null;const n=this.validateAndParseJson(t);return n&&(r=n)&&0===e.indexOf(I)&&r.hasOwnProperty("clientId")&&r.hasOwnProperty("environment")?(this.logger.trace("BrowserCacheManager.getAppMetadata: cache hit"),n):(this.logger.trace("BrowserCacheManager.getAppMetadata: called, no cache hit"),null);var r}setAppMetadata(e,t){this.logger.trace("BrowserCacheManager.setAppMetadata called");const n=function({environment:e,clientId:t}){return[I,e,t].join("-").toLowerCase()}(e);this.setItem(n,JSON.stringify(e),t)}getServerTelemetry(e){const t=this.browserStorage.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getServerTelemetry: called, no cache hit"),null;const n=this.validateAndParseJson(t);return n&&function(e,t){const n=0===e.indexOf(E.CACHE_KEY);let r=!0;return t&&(r=t.hasOwnProperty("failedRequests")&&t.hasOwnProperty("errors")&&t.hasOwnProperty("cacheHits")),n&&r}(e,n)?(this.logger.trace("BrowserCacheManager.getServerTelemetry: cache hit"),n):(this.logger.trace("BrowserCacheManager.getServerTelemetry: called, no cache hit"),null)}setServerTelemetry(e,t,n){this.logger.trace("BrowserCacheManager.setServerTelemetry called"),this.setItem(e,JSON.stringify(t),n)}getAuthorityMetadata(e){const t=this.internalStorage.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getAuthorityMetadata: called, no cache hit"),null;const n=this.validateAndParseJson(t);return n&&function(e,t){return!!t&&0===e.indexOf(A)&&t.hasOwnProperty("aliases")&&t.hasOwnProperty("preferred_cache")&&t.hasOwnProperty("preferred_network")&&t.hasOwnProperty("canonical_authority")&&t.hasOwnProperty("authorization_endpoint")&&t.hasOwnProperty("token_endpoint")&&t.hasOwnProperty("issuer")&&t.hasOwnProperty("aliasesFromNetwork")&&t.hasOwnProperty("endpointsFromNetwork")&&t.hasOwnProperty("expiresAt")&&t.hasOwnProperty("jwks_uri")}(e,n)?(this.logger.trace("BrowserCacheManager.getAuthorityMetadata: cache hit"),n):null}getAuthorityMetadataKeys(){return this.internalStorage.getKeys().filter(e=>this.isAuthorityMetadata(e))}setWrapperMetadata(e,t){this.internalStorage.setItem(Ai,e),this.internalStorage.setItem(ki,t)}getWrapperMetadata(){return[this.internalStorage.getItem(Ai)||n.EMPTY_STRING,this.internalStorage.getItem(ki)||n.EMPTY_STRING]}setAuthorityMetadata(e,t){this.logger.trace("BrowserCacheManager.setAuthorityMetadata called"),this.internalStorage.setItem(e,JSON.stringify(t))}getActiveAccount(e){const t=this.generateCacheKey(d),n=this.browserStorage.getItem(t);if(!n)return this.logger.trace("BrowserCacheManager.getActiveAccount: No active account filters found"),null;const r=this.validateAndParseJson(n);return r?(this.logger.trace("BrowserCacheManager.getActiveAccount: Active account filters schema found"),this.getAccountInfoFilteredBy({homeAccountId:r.homeAccountId,localAccountId:r.localAccountId,tenantId:r.tenantId},e)):(this.logger.trace("BrowserCacheManager.getActiveAccount: No active account found"),null)}setActiveAccount(e,t){const n=this.generateCacheKey(d);if(e){this.logger.verbose("setActiveAccount: Active account set");const r={homeAccountId:e.homeAccountId,localAccountId:e.localAccountId,tenantId:e.tenantId,lastUpdatedAt:Vn().toString()};this.setItem(n,JSON.stringify(r),t)}else this.logger.verbose("setActiveAccount: No account passed, active account not set"),this.browserStorage.removeItem(n);this.eventHandler.emitEvent(fs.ACTIVE_ACCOUNT_CHANGED)}getThrottlingCache(e){const t=this.browserStorage.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getThrottlingCache: called, no cache hit"),null;const n=this.validateAndParseJson(t);return n&&function(e,t){let n=!1;e&&(n=0===e.indexOf(_));let r=!0;return t&&(r=t.hasOwnProperty("throttleTime")),n&&r}(e,n)?(this.logger.trace("BrowserCacheManager.getThrottlingCache: cache hit"),n):(this.logger.trace("BrowserCacheManager.getThrottlingCache: called, no cache hit"),null)}setThrottlingCache(e,t,n){this.logger.trace("BrowserCacheManager.setThrottlingCache called"),this.setItem(e,JSON.stringify(t),n)}getTemporaryCache(e,t){const n=t?this.generateCacheKey(e):e;if(this.cacheConfig.storeAuthStateInCookie){const e=this.cookieStorage.getItem(n);if(e)return this.logger.trace("BrowserCacheManager.getTemporaryCache: storeAuthStateInCookies set to true, retrieving from cookies"),e}const r=this.temporaryCacheStorage.getItem(n);if(!r){if(this.cacheConfig.cacheLocation===pi.LocalStorage){const e=this.browserStorage.getItem(n);if(e)return this.logger.trace("BrowserCacheManager.getTemporaryCache: Temporary cache item found in local storage"),e}return this.logger.trace("BrowserCacheManager.getTemporaryCache: No cache item found in local storage"),null}return this.logger.trace("BrowserCacheManager.getTemporaryCache: Temporary cache item returned"),r}setTemporaryCache(e,t,n){const r=n?this.generateCacheKey(e):e;this.temporaryCacheStorage.setItem(r,t),this.cacheConfig.storeAuthStateInCookie&&(this.logger.trace("BrowserCacheManager.setTemporaryCache: storeAuthStateInCookie set to true, setting item cookie"),this.cookieStorage.setItem(r,t,void 0,this.cacheConfig.secureCookies))}removeItem(e){this.browserStorage.removeItem(e)}removeTemporaryItem(e){this.temporaryCacheStorage.removeItem(e),this.cacheConfig.storeAuthStateInCookie&&(this.logger.trace("BrowserCacheManager.removeItem: storeAuthStateInCookie is true, clearing item cookie"),this.cookieStorage.removeItem(e))}getKeys(){return this.browserStorage.getKeys()}clear(e){this.removeAllAccounts(e),this.removeAppMetadata(e),this.temporaryCacheStorage.getKeys().forEach(e=>{-1===e.indexOf(Ha)&&-1===e.indexOf(this.clientId)||this.removeTemporaryItem(e)}),this.browserStorage.getKeys().forEach(e=>{-1===e.indexOf(Ha)&&-1===e.indexOf(this.clientId)||this.browserStorage.removeItem(e)}),this.internalStorage.clear()}clearTokensAndKeysWithClaims(e){this.performanceClient.addQueueMeasurement(Gt.ClearTokensAndKeysWithClaims,e);const t=this.getTokenKeys();let n=0;t.accessToken.forEach(t=>{const r=this.getAccessTokenCredential(t,e);r?.requestedClaimsHash&&t.includes(r.requestedClaimsHash.toLowerCase())&&(this.removeAccessToken(t,e),n++)}),n>0&&this.logger.warning(`${n} access tokens with claims in the cache keys have been removed from the cache.`)}generateCacheKey(e){return pt.startsWith(e,Ha)?e:`${Ha}.${this.clientId}.${e}`}generateCredentialKey(e){const t=e.credentialType===w.REFRESH_TOKEN&&e.familyId||e.clientId,n=e.tokenType&&e.tokenType.toLowerCase()!==P.BEARER.toLowerCase()?e.tokenType.toLowerCase():"";return[`${Ha}.2`,e.homeAccountId,e.environment,e.credentialType,t,e.realm||"",e.target||"",e.requestedClaimsHash||"",n].join("|").toLowerCase()}generateAccountKey(e){const t=e.homeAccountId.split(".")[1];return[`${Ha}.2`,e.homeAccountId,e.environment,t||e.tenantId||""].join("|").toLowerCase()}resetRequestCache(){this.logger.trace("BrowserCacheManager.resetRequestCache called"),this.removeTemporaryItem(this.generateCacheKey(Ci)),this.removeTemporaryItem(this.generateCacheKey(wi)),this.removeTemporaryItem(this.generateCacheKey(yi)),this.removeTemporaryItem(this.generateCacheKey(vi)),this.removeTemporaryItem(this.generateCacheKey(Ti)),this.setInteractionInProgress(!1)}cacheAuthorizeRequest(e,t){this.logger.trace("BrowserCacheManager.cacheAuthorizeRequest called");const n=Li(JSON.stringify(e));if(this.setTemporaryCache(Ci,n,!0),t){const e=Li(t);this.setTemporaryCache(wi,e,!0)}}getCachedRequest(){this.logger.trace("BrowserCacheManager.getCachedRequest called");const e=this.getTemporaryCache(Ci,!0);if(!e)throw ai(Ro);const t=this.getTemporaryCache(wi,!0);let n,r="";try{n=JSON.parse(Ui(e)),t&&(r=Ui(t))}catch(t){throw this.logger.errorPii(`Attempted to parse: ${e}`),this.logger.error(`Parsing cached token request threw with error: ${t}`),ai(Eo)}return[n,r]}getCachedNativeRequest(){this.logger.trace("BrowserCacheManager.getCachedNativeRequest called");const e=this.getTemporaryCache(Ti,!0);return e?this.validateAndParseJson(e)||(this.logger.error("BrowserCacheManager.getCachedNativeRequest: Unable to parse native request"),null):(this.logger.trace("BrowserCacheManager.getCachedNativeRequest: No cached native request found"),null)}isInteractionInProgress(e){const t=this.getInteractionInProgress()?.clientId;return e?t===this.clientId:!!t}getInteractionInProgress(){const e=`${Ha}.${Ii}`,t=this.getTemporaryCache(e,!1);try{return t?JSON.parse(t):null}catch(t){return this.logger.error("Cannot parse interaction status. Removing temporary cache items and clearing url hash. Retrying interaction should fix the error"),this.removeTemporaryItem(e),this.resetRequestCache(),ma(window),null}}setInteractionInProgress(e,t=fi){const n=`${Ha}.${Ii}`;if(e){if(this.getInteractionInProgress())throw ai(po);this.setTemporaryCache(n,JSON.stringify({clientId:this.clientId,type:t}),!1)}else e||this.getInteractionInProgress()?.clientId!==this.clientId||this.removeTemporaryItem(n)}async hydrateCache(e,t){const n=er(e.account?.homeAccountId,e.account?.environment,e.idToken,this.clientId,e.tenantId);let r;t.claims&&(r=await this.cryptoImpl.hashString(t.claims));const o={idToken:n,accessToken:tr(e.account?.homeAccountId,e.account.environment,e.accessToken,this.clientId,e.tenantId,e.scopes.join(" "),e.expiresOn?Qn(e.expiresOn):0,e.extExpiresOn?Qn(e.extExpiresOn):0,Ui,void 0,e.tokenType,void 0,t.sshKid,t.claims,r)};return this.saveCacheRecord(o,e.correlationId,St(kt(e.idToken,Ui)))}async saveCacheRecord(e,t,n,r){try{await super.saveCacheRecord(e,t,n,r)}catch(e){if(e instanceof Ft&&this.performanceClient&&t)try{const e=this.getTokenKeys();this.performanceClient.addFields({cacheRtCount:e.refreshToken.length,cacheIdCount:e.idToken.length,cacheAtCount:e.accessToken.length},t)}catch(e){}throw e}}}function vs(e,t,n,r){try{switch(t){case pi.LocalStorage:return new gs(e,n,r);case pi.SessionStorage:return new ps}}catch(e){n.error(e)}return new rs}const Cs=(e,t,n,r)=>new ys(e,{cacheLocation:pi.MemoryStorage,cacheRetentionDays:5,temporaryCacheLocation:pi.MemoryStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!1,claimsBasedCachingEnabled:!1},qe,t,n,r);function ws(e,t,n,r,o){return e.verbose("getAllAccounts called"),n?t.getAllAccounts(o||{},r):[]}function Is(e,t,n,r){const o=n.getAccountInfoFilteredBy(e,r);return o?(t.verbose("getAccount: Account matching provided filter found, returning"),o):(t.verbose("getAccount: No matching account found, returning null"),null)}function Ts(e,t,n,r){if(t.trace("getAccountByUsername called"),!e)return t.warning("getAccountByUsername: No username provided"),null;const o=n.getAccountInfoFilteredBy({username:e},r);return o?(t.verbose("getAccountByUsername: Account matching username found, returning"),t.verbosePii(`getAccountByUsername: Returning signed-in accounts matching username: ${e}`),o):(t.verbose("getAccountByUsername: No matching account found, returning null"),null)}function As(e,t,n,r){if(t.trace("getAccountByHomeId called"),!e)return t.warning("getAccountByHomeId: No homeAccountId provided"),null;const o=n.getAccountInfoFilteredBy({homeAccountId:e},r);return o?(t.verbose("getAccountByHomeId: Account matching homeAccountId found, returning"),t.verbosePii(`getAccountByHomeId: Returning signed-in accounts matching homeAccountId: ${e}`),o):(t.verbose("getAccountByHomeId: No matching account found, returning null"),null)}function ks(e,t,n,r){if(t.trace("getAccountByLocalId called"),!e)return t.warning("getAccountByLocalId: No localAccountId provided"),null;const o=n.getAccountInfoFilteredBy({localAccountId:e},r);return o?(t.verbose("getAccountByLocalId: Account matching localAccountId found, returning"),t.verbosePii(`getAccountByLocalId: Returning signed-in accounts matching localAccountId: ${e}`),o):(t.verbose("getAccountByLocalId: No matching account found, returning null"),null)}function Ss(e,t,n){t.setActiveAccount(e,n)}function bs(e,t){return e.getActiveAccount(t)}class Rs{constructor(e){this.eventCallbacks=new Map,this.logger=e||new xe({}),"undefined"!=typeof BroadcastChannel&&(this.broadcastChannel=new BroadcastChannel("msal.broadcast.event")),this.invokeCrossTabCallbacks=this.invokeCrossTabCallbacks.bind(this)}addEventCallback(e,t,n){if("undefined"!=typeof window){const r=n||_a();return this.eventCallbacks.has(r)?(this.logger.error(`Event callback with id: ${r} is already registered. Please provide a unique id or remove the existing callback and try again.`),null):(this.eventCallbacks.set(r,[e,t||[]]),this.logger.verbose(`Event callback registered with id: ${r}`),r)}return null}removeEventCallback(e){this.eventCallbacks.delete(e),this.logger.verbose(`Event callback ${e} removed.`)}emitEvent(e,t,n,r){const o={eventType:e,interactionType:t||null,payload:n||null,error:r||null,timestamp:Date.now()};switch(e){case fs.ACCOUNT_ADDED:case fs.ACCOUNT_REMOVED:case fs.ACTIVE_ACCOUNT_CHANGED:this.broadcastChannel?.postMessage(o);break;default:this.invokeCallbacks(o)}}invokeCallbacks(e){this.eventCallbacks.forEach(([t,n],r)=>{(0===n.length||n.includes(e.eventType))&&(this.logger.verbose(`Emitting event to callback ${r}: ${e.eventType}`),t.apply(null,[e]))})}invokeCrossTabCallbacks(e){const t=e.data;this.invokeCallbacks(t)}subscribeCrossTab(){this.broadcastChannel?.addEventListener("message",this.invokeCrossTabCallbacks)}unsubscribeCrossTab(){this.broadcastChannel?.removeEventListener("message",this.invokeCrossTabCallbacks)}}class Es{constructor(e,t,n,r,o,i,a,s,c){this.config=e,this.browserStorage=t,this.browserCrypto=n,this.networkClient=this.config.system.networkClient,this.eventHandler=o,this.navigationClient=i,this.platformAuthProvider=s,this.correlationId=c||Xi(),this.logger=r.clone(li,Ba,this.correlationId),this.performanceClient=a}async clearCacheOnLogout(e,t){if(t)try{this.browserStorage.removeAccount(t,e),this.logger.verbose("Cleared cache items belonging to the account provided in the logout request.")}catch(e){this.logger.error("Account provided in logout request was not found. Local cache unchanged.")}else try{this.logger.verbose("No account provided in logout request, clearing all cache items.",this.correlationId),this.browserStorage.clear(e),await this.browserCrypto.clearKeystore()}catch(e){this.logger.error("Attempted to clear all MSAL cache items and failed. Local cache unchanged.")}}getRedirectUri(e){this.logger.verbose("getRedirectUri called");const t=e||this.config.auth.redirectUri;return Ot.getAbsoluteUrl(t,wa())}initializeServerTelemetryManager(e,t){this.logger.verbose("initializeServerTelemetryManager called");const n={clientId:this.config.auth.clientId,correlationId:this.correlationId,apiId:e,forceRefresh:t||!1,wrapperSKU:this.browserStorage.getWrapperMetadata()[0],wrapperVer:this.browserStorage.getWrapperMetadata()[1]};return new Vr(n,this.browserStorage)}async getDiscoveredAuthority(e){const{account:t}=e,n=e.requestExtraQueryParameters&&e.requestExtraQueryParameters.hasOwnProperty("instance_aware")?e.requestExtraQueryParameters.instance_aware:void 0;this.performanceClient.addQueueMeasurement(Gt.StandardInteractionClientGetDiscoveredAuthority,this.correlationId);const r={protocolMode:this.config.auth.protocolMode,OIDCOptions:this.config.auth.OIDCOptions,knownAuthorities:this.config.auth.knownAuthorities,cloudDiscoveryMetadata:this.config.auth.cloudDiscoveryMetadata,authorityMetadata:this.config.auth.authorityMetadata,skipAuthorityMetadataCache:this.config.auth.skipAuthorityMetadataCache},o=e.requestAuthority||this.config.auth.authority,i=n?.length?"true"===n:this.config.auth.instanceAware,a=t&&i?this.config.auth.authority.replace(Ot.getDomainFromUrl(o),t.environment):o,s=ur.generateAuthority(a,e.requestAzureCloudOptions||this.config.auth.azureCloudOptions),c=await jn(gr,Gt.AuthorityFactoryCreateDiscoveredInstance,this.logger,this.performanceClient,this.correlationId)(s,this.config.system.networkClient,this.browserStorage,r,this.logger,this.correlationId,this.performanceClient);if(t&&!c.isAlias(t.environment))throw gt(at);return c}}async function Ps(e,t,n,r){n.addQueueMeasurement(Gt.InitializeBaseRequest,e.correlationId);const o=e.authority||t.auth.authority,i=[...e&&e.scopes||[]],a={...e,correlationId:e.correlationId,authority:o,scopes:i};if(a.authenticationScheme){if(a.authenticationScheme===P.SSH){if(!e.sshJwk)throw gt(et);if(!e.sshKid)throw gt(tt)}r.verbose(`Authentication Scheme set to "${a.authenticationScheme}" as configured in Auth request`)}else a.authenticationScheme=P.BEARER,r.verbose('Authentication Scheme wasn\'t explicitly set in request, defaulting to "Bearer" request');return t.cache.claimsBasedCachingEnabled&&e.claims&&!pt.isEmptyObj(e.claims)&&(a.requestedClaimsHash=await sa(e.claims)),a}async function _s(e,t,n,r,o){r.addQueueMeasurement(Gt.InitializeSilentRequest,e.correlationId);const i=await jn(Ps,Gt.InitializeBaseRequest,o,r,e.correlationId)(e,n,r,o);return{...e,...i,account:t,forceRefresh:e.forceRefresh||!1}}function Ms(e,t){let n;const o=e.httpMethod;if(t===Tt.EAR){if(n=o||r,n!==r)throw gt(st)}else n=o||"GET";if(e.authorizePostBodyParameters&&n!==r)throw gt(ct);return n}class Os extends Es{initializeLogoutRequest(e){this.logger.verbose("initializeLogoutRequest called",e?.correlationId);const t={correlationId:this.correlationId||Xi(),...e};if(e)if(e.logoutHint)this.logger.verbose("logoutHint has already been set in logoutRequest");else if(e.account){const n=this.getLogoutHintFromIdTokenClaims(e.account);n&&(this.logger.verbose("Setting logoutHint to login_hint ID Token Claim value for the account provided"),t.logoutHint=n)}else this.logger.verbose("logoutHint was not set and account was not passed into logout request, logoutHint will not be set");else this.logger.verbose("logoutHint will not be set since no logout request was configured");return e&&null===e.postLogoutRedirectUri?this.logger.verbose("postLogoutRedirectUri passed as null, not setting post logout redirect uri",t.correlationId):e&&e.postLogoutRedirectUri?(this.logger.verbose("Setting postLogoutRedirectUri to uri set on logout request",t.correlationId),t.postLogoutRedirectUri=Ot.getAbsoluteUrl(e.postLogoutRedirectUri,wa())):null===this.config.auth.postLogoutRedirectUri?this.logger.verbose("postLogoutRedirectUri configured as null and no uri set on request, not passing post logout redirect",t.correlationId):this.config.auth.postLogoutRedirectUri?(this.logger.verbose("Setting postLogoutRedirectUri to configured uri",t.correlationId),t.postLogoutRedirectUri=Ot.getAbsoluteUrl(this.config.auth.postLogoutRedirectUri,wa())):(this.logger.verbose("Setting postLogoutRedirectUri to current page",t.correlationId),t.postLogoutRedirectUri=Ot.getAbsoluteUrl(wa(),wa())),t}getLogoutHintFromIdTokenClaims(e){const t=e.idTokenClaims;if(t){if(t.login_hint)return t.login_hint;this.logger.verbose("The ID Token Claims tied to the provided account do not contain a login_hint claim, logoutHint will not be added to logout request")}else this.logger.verbose("The provided account does not contain ID Token Claims, logoutHint will not be added to logout request");return null}async createAuthCodeClient(e){this.performanceClient.addQueueMeasurement(Gt.StandardInteractionClientCreateAuthCodeClient,this.correlationId);const t=await jn(this.getClientConfiguration.bind(this),Gt.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,this.correlationId)(e);return new zr(t,this.performanceClient)}async getClientConfiguration(e){const{serverTelemetryManager:t,requestAuthority:r,requestAzureCloudOptions:o,requestExtraQueryParameters:i,account:a}=e;this.performanceClient.addQueueMeasurement(Gt.StandardInteractionClientGetClientConfiguration,this.correlationId);const s=await jn(this.getDiscoveredAuthority.bind(this),Gt.StandardInteractionClientGetDiscoveredAuthority,this.logger,this.performanceClient,this.correlationId)({requestAuthority:r,requestAzureCloudOptions:o,requestExtraQueryParameters:i,account:a}),c=this.config.system.loggerOptions;return{authOptions:{clientId:this.config.auth.clientId,authority:s,clientCapabilities:this.config.auth.clientCapabilities,redirectUri:this.config.auth.redirectUri},systemOptions:{tokenRenewalOffsetSeconds:this.config.system.tokenRenewalOffsetSeconds,preventCorsPreflight:!0},loggerOptions:{loggerCallback:c.loggerCallback,piiLoggingEnabled:c.piiLoggingEnabled,logLevel:c.logLevel,correlationId:this.correlationId},cacheOptions:{claimsBasedCachingEnabled:this.config.cache.claimsBasedCachingEnabled},cryptoInterface:this.browserCrypto,networkInterface:this.networkClient,storageInterface:this.browserStorage,serverTelemetryManager:t,libraryInfo:{sku:li,version:Ba,cpu:n.EMPTY_STRING,os:n.EMPTY_STRING},telemetry:this.config.telemetry}}async initializeAuthorizationRequest(e,t){this.performanceClient.addQueueMeasurement(Gt.StandardInteractionClientInitializeAuthorizationRequest,this.correlationId);const r=this.getRedirectUri(e.redirectUri),o={interactionType:t},i=xr.setRequestState(this.browserCrypto,e&&e.state||n.EMPTY_STRING,o),a={...await jn(Ps,Gt.InitializeBaseRequest,this.logger,this.performanceClient,this.correlationId)({...e,correlationId:this.correlationId},this.config,this.performanceClient,this.logger),redirectUri:r,state:i,nonce:e.nonce||Xi(),responseMode:this.config.auth.OIDCOptions.serverResponseType},s={...a,httpMethod:Ms(a,this.config.auth.protocolMode)};if(e.loginHint||e.sid)return s;const c=e.account||this.browserStorage.getActiveAccount(this.correlationId);return c&&(this.logger.verbose("Setting validated request account",this.correlationId),this.logger.verbosePii(`Setting validated request account: ${c.homeAccountId}`,this.correlationId),s.account=c),s}}function Ns(e,t,n){const r=Pt(e);if(!r)throw Et(e)?(n.error(`A ${t} is present in the iframe but it does not contain known properties. It's likely that the ${t} has been replaced by code running on the redirectUri page.`),n.errorPii(`The ${t} detected is: ${e}`),ai(uo)):(n.error(`The request has returned to the redirectUri but a ${t} is not present. It's likely that the ${t} has been removed or the page has been redirected by code running on the redirectUri page.`),ai(co));return r}class qs{constructor(e,t,n,r,o){this.authModule=e,this.browserStorage=t,this.authCodeRequest=n,this.logger=r,this.performanceClient=o}async handleCodeResponse(e,t){let n;this.performanceClient.addQueueMeasurement(Gt.HandleCodeResponse,t.correlationId);try{n=function(e,t){if(Wr(e,t),!e.code)throw Ne(we);return e}(e,t.state)}catch(e){throw e instanceof pr&&e.subError===yo?ai(yo):e}return jn(this.handleCodeResponseFromServer.bind(this),Gt.HandleCodeResponseFromServer,this.logger,this.performanceClient,t.correlationId)(n,t)}async handleCodeResponseFromServer(e,t,n=!0){if(this.performanceClient.addQueueMeasurement(Gt.HandleCodeResponseFromServer,t.correlationId),this.logger.trace("InteractionHandler.handleCodeResponseFromServer called"),this.authCodeRequest.code=e.code,e.cloud_instance_host_name&&await jn(this.authModule.updateAuthority.bind(this.authModule),Gt.UpdateTokenEndpointAuthority,this.logger,this.performanceClient,t.correlationId)(e.cloud_instance_host_name,t.correlationId),n&&(e.nonce=t.nonce||void 0),e.state=t.state,e.client_info)this.authCodeRequest.clientInfo=e.client_info;else{const e=this.createCcsCredentials(t);e&&(this.authCodeRequest.ccsCredential=e)}return await jn(this.authModule.acquireToken.bind(this.authModule),Gt.AuthClientAcquireToken,this.logger,this.performanceClient,t.correlationId)(this.authCodeRequest,e)}createCcsCredentials(e){return e.account?{credential:e.account.homeAccountId,type:an}:e.loginHint?{credential:e.loginHint,type:sn}:null}}const Ls="user_switch",xs={[Ls]:"User attempted to switch accounts in the native broker, which is not allowed. All new accounts must sign-in through the standard web flow first, please try again."};class Us extends U{constructor(e,t,n){super(e,t),Object.setPrototypeOf(this,Us.prototype),this.name="NativeAuthError",this.ext=n}}function Ds(e){if(e.ext&&e.ext.status&&"DISABLED"===e.ext.status)return!0;if(e.ext&&e.ext.error&&-2147186943===e.ext.error)return!0;switch(e.errorCode){case"ContentError":case"PageException":return!0;default:return!1}}function Bs(e,t,n){if(n&&n.status)switch(n.status){case"ACCOUNT_UNAVAILABLE":return Lr(Ir);case"USER_INTERACTION_REQUIRED":return new Nr(e,t);case"USER_CANCEL":return ai(yo);case"NO_NETWORK":return ai(No);case"UX_NOT_ALLOWED":return Lr(Ar)}return new Us(e,xs[e]||t,n)}class Hs extends Os{async acquireToken(e){this.performanceClient.addQueueMeasurement(Gt.SilentCacheClientAcquireToken,e.correlationId);const t=this.initializeServerTelemetryManager(Si.acquireTokenSilent_silentFlow),n=await jn(this.getClientConfiguration.bind(this),Gt.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:t,requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,account:e.account}),r=new $r(n,this.performanceClient);this.logger.verbose("Silent auth client created");try{const t=(await jn(r.acquireCachedToken.bind(r),Gt.SilentFlowClientAcquireCachedToken,this.logger,this.performanceClient,e.correlationId)(e))[0];return this.performanceClient.addFields({fromCache:!0},e.correlationId),t}catch(e){throw e instanceof ii&&e.errorCode===Do&&this.logger.verbose("Signing keypair for bound access token not found. Refreshing bound access token and generating a new crypto keypair."),e}}logout(e){this.logger.verbose("logoutRedirect called");const t=this.initializeLogoutRequest(e);return this.clearCacheOnLogout(t.correlationId,t?.account)}}class Fs extends Es{constructor(e,t,n,r,o,i,a,s,c,l,u,d){super(e,t,n,r,o,i,s,c,d),this.apiId=a,this.accountId=l,this.platformAuthProvider=c,this.nativeStorageManager=u,this.silentCacheClient=new Hs(e,this.nativeStorageManager,n,r,o,i,s,c,d);const h=this.platformAuthProvider.getExtensionName();this.skus=Vr.makeExtraSkuString({libraryName:li,libraryVersion:Ba,extensionName:h,extensionVersion:this.platformAuthProvider.getExtensionVersion()})}addRequestSKUs(e){e.extraParameters={...e.extraParameters,[gn]:this.skus}}async acquireToken(e,t){this.performanceClient.addQueueMeasurement(Gt.NativeInteractionClientAcquireToken,this.correlationId),this.logger.trace("NativeInteractionClient - acquireToken called.");const n=this.performanceClient.startMeasurement(Gt.NativeInteractionClientAcquireToken,this.correlationId),r=Vn(),o=this.initializeServerTelemetryManager(this.apiId);try{const i=await this.initializeNativeRequest(e);try{const e=await this.acquireTokensFromCache(this.accountId,i);return n.end({success:!0,isNativeBroker:!1,fromCache:!0}),e}catch(e){if(t===Mi.AccessToken)throw this.logger.info("MSAL internal Cache does not contain tokens, return error as per cache policy"),n.end({success:!1,brokerErrorCode:"cache_request_failed"}),e;this.logger.info("MSAL internal Cache does not contain tokens, proceed to make a native call")}const a=await this.platformAuthProvider.sendMessage(i);return await this.handleNativeResponse(a,i,r).then(e=>(n.end({success:!0,isNativeBroker:!0,requestId:e.requestId}),o.clearNativeBrokerErrorCode(),e)).catch(e=>{throw n.end({success:!1,errorCode:e.errorCode,subErrorCode:e.subError}),e})}catch(e){throw e instanceof Us&&o.setNativeBrokerErrorCode(e.errorCode),n.end({success:!1}),e}}createSilentCacheRequest(e,t){return{authority:e.authority,correlationId:this.correlationId,scopes:ft.fromString(e.scope).asArray(),account:t,forceRefresh:!1}}async acquireTokensFromCache(e,t){if(!e)throw this.logger.warning("NativeInteractionClient:acquireTokensFromCache - No nativeAccountId provided"),Ne(he);const n=this.browserStorage.getBaseAccountInfo({nativeAccountId:e},this.correlationId);if(!n)throw Ne(he);try{const e=this.createSilentCacheRequest(t,n),r=await this.silentCacheClient.acquireToken(e),o={...n,idTokenClaims:r?.idTokenClaims,idToken:r?.idToken};return{...r,account:o}}catch(e){throw e}}async acquireTokenRedirect(e,t){this.logger.trace("NativeInteractionClient - acquireTokenRedirect called.");const{...n}=e;delete n.onRedirectNavigate;const r=await this.initializeNativeRequest(n);try{await this.platformAuthProvider.sendMessage(r)}catch(e){if(e instanceof Us&&(this.initializeServerTelemetryManager(this.apiId).setNativeBrokerErrorCode(e.errorCode),Ds(e)))throw e}this.browserStorage.setTemporaryCache(Ti,JSON.stringify(r),!0);const o={apiId:Si.acquireTokenRedirect,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},i=this.config.auth.navigateToLoginRequestUrl?window.location.href:this.getRedirectUri(e.redirectUri);t.end({success:!0}),await this.navigationClient.navigateExternal(i,o)}async handleRedirectPromise(e,t){if(this.logger.trace("NativeInteractionClient - handleRedirectPromise called."),!this.browserStorage.isInteractionInProgress(!0))return this.logger.info("handleRedirectPromise called but there is no interaction in progress, returning null."),null;const n=this.browserStorage.getCachedNativeRequest();if(!n)return this.logger.verbose("NativeInteractionClient - handleRedirectPromise called but there is no cached request, returning null."),e&&t&&e?.addFields({errorCode:"no_cached_request"},t),null;const{prompt:r,...o}=n;r&&this.logger.verbose("NativeInteractionClient - handleRedirectPromise called and prompt was included in the original request, removing prompt from cached request to prevent second interaction with native broker window."),this.browserStorage.removeItem(this.browserStorage.generateCacheKey(Ti));const i=Vn();try{this.logger.verbose("NativeInteractionClient - handleRedirectPromise sending message to native broker.");const t=await this.platformAuthProvider.sendMessage(o),n=await this.handleNativeResponse(t,o,i);return this.initializeServerTelemetryManager(this.apiId).clearNativeBrokerErrorCode(),e&&this.correlationId&&this.performanceClient.addFields({isNativeBroker:!0},this.correlationId),n}catch(e){throw e}}logout(){return this.logger.trace("NativeInteractionClient - logout called."),Promise.reject("Logout not implemented yet")}async handleNativeResponse(e,t,n){this.logger.trace("NativeInteractionClient - handleNativeResponse called.");const r=kt(e.id_token,Ui),o=this.createHomeAccountIdentifier(e,r),i=this.browserStorage.getAccountInfoFilteredBy({nativeAccountId:t.accountId},this.correlationId)?.homeAccountId;if(t.extraParameters?.child_client_id&&e.account.id!==t.accountId)this.logger.info("handleNativeServerResponse: Double broker flow detected, ignoring accountId mismatch");else if(o!==i&&e.account.id!==t.accountId)throw Bs(Ls);const a=await this.getDiscoveredAuthority({requestAuthority:t.authority}),s=Hr(this.browserStorage,a,o,Ui,this.correlationId,r,e.client_info,void 0,r.tid,void 0,e.account.id,this.logger);e.expires_in=Number(e.expires_in);const c=await this.generateAuthenticationResult(e,t,r,s,a.canonicalAuthority,n);return await this.cacheAccount(s,this.correlationId,St(r)),await this.cacheNativeTokens(e,t,o,r,e.access_token,c.tenantId,n),c}createHomeAccountIdentifier(e,t){return At.generateHomeAccountId(e.client_info||n.EMPTY_STRING,0,this.logger,this.browserCrypto,t)}generateScopes(e,t){return t?ft.fromString(t):ft.fromString(e)}async generatePopAccessToken(e,t){if(t.tokenType===P.POP&&t.signPopToken){if(e.shr)return this.logger.trace("handleNativeServerResponse: SHR is enabled in native layer"),e.shr;const n=new Ur(this.browserCrypto),r={resourceRequestMethod:t.resourceRequestMethod,resourceRequestUri:t.resourceRequestUri,shrClaims:t.shrClaims,shrNonce:t.shrNonce};if(!t.keyId)throw Ne(Ae);return n.signPopToken(e.access_token,t.keyId,r)}return e.access_token}async generateAuthenticationResult(e,t,r,o,i,a){const s=this.addTelemetryFromNativeResponse(e.properties.MATS),c=this.generateScopes(t.scope,e.scope),l=e.account.properties||{},u=l.UID||r.oid||r.sub||n.EMPTY_STRING,d=l.TenantId||r.tid||n.EMPTY_STRING,h=wt(At.getAccountInfo(o),void 0,r,e.id_token);h.nativeAccountId!==e.account.id&&(h.nativeAccountId=e.account.id);const g=await this.generatePopAccessToken(e,t),p=t.tokenType===P.POP?P.POP:P.BEARER;return{authority:i,uniqueId:u,tenantId:d,scopes:c.asArray(),account:h,idToken:e.id_token,idTokenClaims:r,accessToken:g,fromCache:!!s&&this.isResponseFromCache(s),expiresOn:Jn(a+e.expires_in),tokenType:p,correlationId:this.correlationId,state:e.state,fromNativeBroker:!0}}async cacheAccount(e,t,n){await this.browserStorage.setAccount(e,this.correlationId,n),this.browserStorage.removeAccountContext(At.getAccountInfo(e),t)}cacheNativeTokens(e,t,r,o,i,a,s){const c=er(r,t.authority,e.id_token||"",t.clientId,o.tid||""),l=s+(t.tokenType===P.POP?n.SHR_NONCE_VALIDITY:("string"==typeof e.expires_in?parseInt(e.expires_in,10):e.expires_in)||0),u=this.generateScopes(e.scope,t.scope),d={idToken:c,accessToken:tr(r,t.authority,i,t.clientId,o.tid||a,u.printScopes(),l,0,Ui,void 0,t.tokenType,void 0,t.keyId)};return this.nativeStorageManager.saveCacheRecord(d,this.correlationId,St(o),t.storeInCache)}getExpiresInValue(e,t){return e===P.POP?n.SHR_NONCE_VALIDITY:("string"==typeof t?parseInt(t,10):t)||0}addTelemetryFromNativeResponse(e){const t=this.getMATSFromResponse(e);return t?(this.performanceClient.addFields({extensionId:this.platformAuthProvider.getExtensionId(),extensionVersion:this.platformAuthProvider.getExtensionVersion(),matsBrokerVersion:t.broker_version,matsAccountJoinOnStart:t.account_join_on_start,matsAccountJoinOnEnd:t.account_join_on_end,matsDeviceJoin:t.device_join,matsPromptBehavior:t.prompt_behavior,matsApiErrorCode:t.api_error_code,matsUiVisible:t.ui_visible,matsSilentCode:t.silent_code,matsSilentBiSubCode:t.silent_bi_sub_code,matsSilentMessage:t.silent_message,matsSilentStatus:t.silent_status,matsHttpStatus:t.http_status,matsHttpEventCount:t.http_event_count},this.correlationId),t):null}getMATSFromResponse(e){if(e)try{return JSON.parse(e)}catch(e){this.logger.error("NativeInteractionClient - Error parsing MATS telemetry, returning null instead")}return null}isResponseFromCache(e){return void 0===e.is_cached?(this.logger.verbose("NativeInteractionClient - MATS telemetry does not contain field indicating if response was served from cache. Returning false."),!1):!!e.is_cached}async initializeNativeRequest(e){this.logger.trace("NativeInteractionClient - initializeNativeRequest called");const t=await this.getCanonicalAuthority(e),{scopes:n,...r}=e,i=new ft(n||[]);i.appendScopes(o);const a={...r,accountId:this.accountId,clientId:this.config.auth.clientId,authority:t.urlString,scope:i.printScopes(),redirectUri:this.getRedirectUri(e.redirectUri),prompt:this.getPrompt(e.prompt),correlationId:this.correlationId,tokenType:e.authenticationScheme,windowTitleSubstring:document.title,extraParameters:{...e.extraQueryParameters,...e.tokenQueryParameters},extendedExpiryToken:!1,keyId:e.popKid};if(a.signPopToken&&e.popKid)throw ai(Jo);if(this.handleExtraBrokerParams(a),a.extraParameters=a.extraParameters||{},a.extraParameters.telemetry="MATS",e.authenticationScheme===P.POP){const t={resourceRequestUri:e.resourceRequestUri,resourceRequestMethod:e.resourceRequestMethod,shrClaims:e.shrClaims,shrNonce:e.shrNonce},n=new Ur(this.browserCrypto);let r;if(a.keyId)r=this.browserCrypto.base64UrlEncode(JSON.stringify({kid:a.keyId})),a.signPopToken=!1;else{const e=await jn(n.generateCnf.bind(n),Gt.PopTokenGenerateCnf,this.logger,this.performanceClient,this.correlationId)(t,this.logger);r=e.reqCnfString,a.keyId=e.kid,a.signPopToken=!0}a.reqCnf=r}return this.addRequestSKUs(a),a}async getCanonicalAuthority(e){const t=e.authority||this.config.auth.authority;e.account&&await this.getDiscoveredAuthority({requestAuthority:t,requestAzureCloudOptions:e.azureCloudOptions,account:e.account});const n=new Ot(t);return n.validateAsUri(),n}getPrompt(e){switch(this.apiId){case Si.ssoSilent:case Si.acquireTokenSilent_silentFlow:return this.logger.trace("initializeNativeRequest: silent request sets prompt to none"),m.NONE}if(e)switch(e){case m.NONE:case m.CONSENT:case m.LOGIN:case m.SELECT_ACCOUNT:return this.logger.trace("initializeNativeRequest: prompt is compatible with native flow"),e;default:throw this.logger.trace(`initializeNativeRequest: prompt = ${e} is not compatible with native flow`),ai(Vo)}else this.logger.trace("initializeNativeRequest: prompt was not provided")}handleExtraBrokerParams(e){const t=e.extraParameters&&e.extraParameters.hasOwnProperty(pn)&&e.extraParameters.hasOwnProperty(fn)&&e.extraParameters.hasOwnProperty(cn);if(!e.embeddedClientId&&!t)return;let n="";const r=e.redirectUri;e.embeddedClientId?(e.redirectUri=this.config.auth.redirectUri,n=e.embeddedClientId):e.extraParameters&&(e.redirectUri=e.extraParameters[fn],n=e.extraParameters[cn]),e.extraParameters={child_client_id:n,child_redirect_uri:r},this.performanceClient?.addFields({embeddedClientId:n,embeddedRedirectUri:r},this.correlationId)}}async function zs(e,t,n,r,o){const i=function(e,t,n,r){const o=t.correlationId,i=new Map;if(wn(i,t.embeddedClientId||t.extraQueryParameters?.[cn]||e.clientId),Cn(i,[...t.scopes||[],...t.extraScopesToConsent||[]],!0,e.authority.options.OIDCOptions?.defaultScopes),In(i,t.redirectUri),Rn(i,o),function(e,t){e.set("response_mode",t||"query")}(i,t.responseMode),xn(i),t.prompt&&(function(e,t){e.set("prompt",t)}(i,t.prompt),r?.addFields({prompt:t.prompt},o)),t.domainHint&&(function(e,t){e.set("domain_hint",t)}(i,t.domainHint),r?.addFields({domainHintFromRequest:!0},o)),t.prompt!==m.SELECT_ACCOUNT)if(t.sid&&t.prompt===m.NONE)n.verbose("createAuthCodeUrlQueryString: Prompt is none, adding sid from request"),Sn(i,t.sid),r?.addFields({sidFromRequest:!0},o);else if(t.account){const s=(a=t.account,a.idTokenClaims?.sid||null);let c=function(e){return e.loginHint||e.idTokenClaims?.login_hint||null}(t.account);if(c&&t.domainHint&&(n.warning('AuthorizationCodeClient.createAuthCodeUrlQueryString: "domainHint" param is set, skipping opaque "login_hint" claim. Please consider not passing domainHint'),c=null),c){n.verbose("createAuthCodeUrlQueryString: login_hint claim present on account"),Tn(i,c),r?.addFields({loginHintFromClaim:!0},o);try{kn(i,yt(t.account.homeAccountId))}catch(e){n.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}else if(s&&t.prompt===m.NONE){n.verbose("createAuthCodeUrlQueryString: Prompt is none, adding sid from account"),Sn(i,s),r?.addFields({sidFromClaim:!0},o);try{kn(i,yt(t.account.homeAccountId))}catch(e){n.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}else if(t.loginHint)n.verbose("createAuthCodeUrlQueryString: Adding login_hint from request"),Tn(i,t.loginHint),An(i,t.loginHint),r?.addFields({loginHintFromRequest:!0},o);else if(t.account.username){n.verbose("createAuthCodeUrlQueryString: Adding login_hint from account"),Tn(i,t.account.username),r?.addFields({loginHintFromUpn:!0},o);try{kn(i,yt(t.account.homeAccountId))}catch(e){n.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}}else t.loginHint&&(n.verbose("createAuthCodeUrlQueryString: No account, adding login_hint from request"),Tn(i,t.loginHint),An(i,t.loginHint),r?.addFields({loginHintFromRequest:!0},o));else n.verbose("createAuthCodeUrlQueryString: Prompt is select_account, ignoring account hints");var a;return t.nonce&&function(e,t){e.set("nonce",t)}(i,t.nonce),t.state&&_n(i,t.state),(t.claims||e.clientCapabilities&&e.clientCapabilities.length>0)&&bn(i,t.claims,e.clientCapabilities),t.embeddedClientId&&$n(i,e.clientId,e.redirectUri),!e.instanceAware||t.extraQueryParameters&&Object.keys(t.extraQueryParameters).includes(mn)||Un(i),i}({...e.auth,authority:t},n,r,o);if(En(i,{sku:li,version:Ba,os:"",cpu:""}),e.auth.protocolMode!==Tt.OIDC&&Pn(i,e.telemetry.application),n.platformBroker&&(function(e){e.set("nativebroker","1")}(i),o.addFields({isPlatformAuthorizeRequest:!0},n.correlationId),n.authenticationScheme===P.POP)){const e=new is(r,o),t=new Ur(e);let a;a=n.popKid?e.encodeKid(n.popKid):(await jn(t.generateCnf.bind(t),Gt.PopTokenGenerateCnf,r,o,n.correlationId)(n,r)).reqCnfString,Hn(i,a)}return yn(i,n.correlationId,o),i}async function Ks(e,t,r,o,i){if(!r.codeChallenge)throw gt(Je);const a=await jn(zs,Gt.GetStandardParams,o,i,r.correlationId)(e,t,r,o,i);return vn(a,y),Mn(a,r.codeChallenge,n.S256_CODE_CHALLENGE_METHOD),Dn(a,r.extraQueryParameters||{}),jr(t,a,e.auth.encodeExtraQueryParams,r.extraQueryParameters)}async function $s(e,t,n,r,o,i){if(!r.earJwk)throw ai(oo);const a=await zs(t,n,r,o,i);vn(a,"id_token token refresh_token"),function(e,t){e.set("ear_jwk",encodeURIComponent(t)),e.set("ear_jwe_crypto","eyJhbGciOiJkaXIiLCJlbmMiOiJBMjU2R0NNIn0")}(a,r.earJwk);const s=new Map;return Dn(s,r.extraQueryParameters||{}),js(e,jr(n,s,t.auth.encodeExtraQueryParams,r.extraQueryParameters),a)}async function Gs(e,t,r,o,i,a){const s=await zs(t,r,o,i,a);vn(s,y),Mn(s,o.codeChallenge,o.codeChallengeMethod||n.S256_CODE_CHALLENGE_METHOD),function(e,t){Object.entries(t).forEach(([t,n])=>{n&&e.set(t,n)})}(s,o.authorizePostBodyParameters||{});const c=new Map;return Dn(c,o.extraQueryParameters||{}),js(e,jr(r,c,t.auth.encodeExtraQueryParams,o.extraQueryParameters),s)}function js(e,t,n){const r=e.createElement("form");return r.method="post",r.action=t,n.forEach((t,n)=>{const o=e.createElement("input");o.hidden=!0,o.name=n,o.value=t,r.appendChild(o)}),e.body.appendChild(r),r}async function Ws(e,t,n,r,o,i,a,s,c,l){if(s.verbose("Account id found, calling WAM for token"),!l)throw ai(jo);const u=new is(s,c),d=new Fs(r,o,u,s,a,r.system.navigationClient,n,c,l,t,i,e.correlationId),{userRequestState:h}=xr.parseRequestState(u,e.state);return jn(d.acquireToken.bind(d),Gt.NativeInteractionClientAcquireToken,s,c,e.correlationId)({...e,state:h,prompt:void 0})}async function Vs(e,t,n,r,o,i,a,s,c,l,u,d){if(mr.removeThrottle(a,o.auth.clientId,e),t.accountId)return jn(Ws,Gt.HandleResponsePlatformBroker,l,u,e.correlationId)(e,t.accountId,r,o,a,s,c,l,u,d);const h={...e,code:t.code||"",codeVerifier:n},g=new qs(i,a,h,l,u);return await jn(g.handleCodeResponse.bind(g),Gt.HandleCodeResponse,l,u,e.correlationId)(t,e)}async function Qs(e,t,n,r,o,i,a,s,c,l,u){if(mr.removeThrottle(i,r.auth.clientId,e),Wr(t,e.state),!t.ear_jwe)throw ai(io);if(!e.earJwk)throw ai(oo);const d=JSON.parse(await jn(ta,Gt.DecryptEarResponse,c,l,e.correlationId)(e.earJwk,t.ear_jwe));if(d.accountId)return jn(Ws,Gt.HandleResponsePlatformBroker,c,l,e.correlationId)(e,d.accountId,n,r,i,a,s,c,l,u);const h=new Br(r.auth.clientId,i,new is(c,l),c,null,null,l);h.validateTokenResponse(d);const g={code:"",state:e.state,nonce:e.nonce,client_info:d.client_info,cloud_graph_host_name:d.cloud_graph_host_name,cloud_instance_host_name:d.cloud_instance_host_name,cloud_instance_name:d.cloud_instance_name,msgraph_host:d.msgraph_host};return await jn(h.handleServerTokenResponse.bind(h),Gt.HandleServerTokenResponse,c,l,e.correlationId)(d,o,Vn(),e,g,void 0,void 0,void 0,void 0)}async function Js(e,t,n){e.addQueueMeasurement(Gt.GeneratePkceCodes,n);const r=Gn(Ys,Gt.GenerateCodeVerifier,t,e,n)(e,t,n);return{verifier:r,challenge:await jn(Xs,Gt.GenerateCodeChallengeFromVerifier,t,e,n)(r,e,t,n)}}function Ys(e,t,n){try{const r=new Uint8Array(32);return Gn(Ji,Gt.GetRandomValues,t,e,n)(r),qi(r)}catch(e){throw ai(ro)}}async function Xs(e,t,n,r){t.addQueueMeasurement(Gt.GenerateCodeChallengeFromVerifier,r);try{const o=await jn(Qi,Gt.Sha256Digest,n,t,r)(e,t,r);return qi(new Uint8Array(o))}catch(e){throw ai(ro)}}class Zs{constructor(e,t,n,r){this.logger=e,this.handshakeTimeoutMs=t,this.extensionId=r,this.resolvers=new Map,this.handshakeResolvers=new Map,this.messageChannel=new MessageChannel,this.windowListener=this.onWindowMessage.bind(this),this.performanceClient=n,this.handshakeEvent=n.startMeasurement(Gt.NativeMessageHandlerHandshake),this.platformAuthType="PlatformAuthExtensionHandler"}async sendMessage(e){this.logger.trace(this.platformAuthType+" - sendMessage called.");const t={method:"GetToken",request:e},n={channel:ui,extensionId:this.extensionId,responseId:Xi(),body:t};this.logger.trace(this.platformAuthType+" - Sending request to browser extension"),this.logger.tracePii(this.platformAuthType+` - Sending request to browser extension: ${JSON.stringify(n)}`),this.messageChannel.port1.postMessage(n);const r=await new Promise((e,t)=>{this.resolvers.set(n.responseId,{resolve:e,reject:t})});return this.validatePlatformBrokerResponse(r)}static async createProvider(e,t,n){e.trace("PlatformAuthExtensionHandler - createProvider called.");try{const r=new Zs(e,t,n,di);return await r.sendHandshakeRequest(),r}catch(r){const o=new Zs(e,t,n);return await o.sendHandshakeRequest(),o}}async sendHandshakeRequest(){this.logger.trace(this.platformAuthType+" - sendHandshakeRequest called."),window.addEventListener("message",this.windowListener,!1);const e={channel:ui,extensionId:this.extensionId,responseId:Xi(),body:{method:gi}};return this.handshakeEvent.add({extensionId:this.extensionId,extensionHandshakeTimeoutMs:this.handshakeTimeoutMs}),this.messageChannel.port1.onmessage=e=>{this.onChannelMessage(e)},window.postMessage(e,window.origin,[this.messageChannel.port2]),new Promise((t,n)=>{this.handshakeResolvers.set(e.responseId,{resolve:t,reject:n}),this.timeoutId=window.setTimeout(()=>{window.removeEventListener("message",this.windowListener,!1),this.messageChannel.port1.close(),this.messageChannel.port2.close(),this.handshakeEvent.end({extensionHandshakeTimedOut:!0,success:!1}),n(ai($o)),this.handshakeResolvers.delete(e.responseId)},this.handshakeTimeoutMs)})}onWindowMessage(e){if(this.logger.trace(this.platformAuthType+" - onWindowMessage called"),e.source!==window)return;const t=e.data;if(t.channel&&t.channel===ui&&(!t.extensionId||t.extensionId===this.extensionId)&&t.body.method===gi){const e=this.handshakeResolvers.get(t.responseId);if(!e)return void this.logger.trace(this.platformAuthType+`.onWindowMessage - resolver can't be found for request ${t.responseId}`);this.logger.verbose(t.extensionId?`Extension with id: ${t.extensionId} not installed`:"No extension installed"),clearTimeout(this.timeoutId),this.messageChannel.port1.close(),this.messageChannel.port2.close(),window.removeEventListener("message",this.windowListener,!1),this.handshakeEvent.end({success:!1,extensionInstalled:!1}),e.reject(ai(Go))}}onChannelMessage(e){this.logger.trace(this.platformAuthType+" - onChannelMessage called.");const t=e.data,n=this.resolvers.get(t.responseId),r=this.handshakeResolvers.get(t.responseId);try{const e=t.body.method;if("Response"===e){if(!n)return;const e=t.body.response;if(this.logger.trace(this.platformAuthType+" - Received response from browser extension"),this.logger.tracePii(this.platformAuthType+` - Received response from browser extension: ${JSON.stringify(e)}`),"Success"!==e.status)n.reject(Bs(e.code,e.description,e.ext));else{if(!e.result)throw D(O,"Event does not contain result.");e.result.code&&e.result.description?n.reject(Bs(e.result.code,e.result.description,e.result.ext)):n.resolve(e.result)}this.resolvers.delete(t.responseId)}else if("HandshakeResponse"===e){if(!r)return void this.logger.trace(this.platformAuthType+`.onChannelMessage - resolver can't be found for request ${t.responseId}`);clearTimeout(this.timeoutId),window.removeEventListener("message",this.windowListener,!1),this.extensionId=t.extensionId,this.extensionVersion=t.body.version,this.logger.verbose(this.platformAuthType+` - Received HandshakeResponse from extension: ${this.extensionId}`),this.handshakeEvent.end({extensionInstalled:!0,success:!0}),r.resolve(),this.handshakeResolvers.delete(t.responseId)}}catch(t){this.logger.error("Error parsing response from WAM Extension"),this.logger.errorPii(`Error parsing response from WAM Extension: ${t}`),this.logger.errorPii(`Unable to parse ${e}`),n?n.reject(t):r&&r.reject(t)}}validatePlatformBrokerResponse(e){if(e.hasOwnProperty("access_token")&&e.hasOwnProperty("id_token")&&e.hasOwnProperty("client_info")&&e.hasOwnProperty("account")&&e.hasOwnProperty("scope")&&e.hasOwnProperty("expires_in"))return e;throw D(O,"Response missing expected properties.")}getExtensionId(){return this.extensionId}getExtensionVersion(){return this.extensionVersion}getExtensionName(){return this.getExtensionId()===di?"chrome":this.getExtensionId()?.length?"unknown":void 0}}class ec{constructor(e,t,n){this.logger=e,this.performanceClient=t,this.correlationId=n,this.platformAuthType="PlatformAuthDOMHandler"}static async createProvider(e,t,n){if(e.trace("PlatformAuthDOMHandler: createProvider called"),window.navigator?.platformAuthentication){const r=await window.navigator.platformAuthentication.getSupportedContracts(hi);if(r?.includes("get-token-and-sign-out"))return e.trace("Platform auth api available in DOM"),new ec(e,t,n)}}getExtensionId(){return hi}getExtensionVersion(){return""}getExtensionName(){return"DOM API"}async sendMessage(e){this.logger.trace(this.platformAuthType+" - Sending request to browser DOM API");try{const t=this.initializePlatformDOMRequest(e),n=await window.navigator.platformAuthentication.executeGetToken(t);return this.validatePlatformBrokerResponse(n)}catch(e){throw this.logger.error(this.platformAuthType+" - executeGetToken DOM API error"),e}}initializePlatformDOMRequest(e){this.logger.trace(this.platformAuthType+" - initializeNativeDOMRequest called");const{accountId:t,clientId:n,authority:r,scope:o,redirectUri:i,correlationId:a,state:s,storeInCache:c,embeddedClientId:l,extraParameters:u,...d}=e,h=this.getDOMExtraParams(d);return{accountId:t,brokerId:this.getExtensionId(),authority:r,clientId:n,correlationId:a||this.correlationId,extraParameters:{...u,...h},isSecurityTokenService:!1,redirectUri:i,scope:o,state:s,storeInCache:c,embeddedClientId:l}}validatePlatformBrokerResponse(e){if(e.hasOwnProperty("isSuccess")){if(e.hasOwnProperty("accessToken")&&e.hasOwnProperty("idToken")&&e.hasOwnProperty("clientInfo")&&e.hasOwnProperty("account")&&e.hasOwnProperty("scopes")&&e.hasOwnProperty("expiresIn"))return this.logger.trace(this.platformAuthType+" - platform broker returned successful and valid response"),this.convertToPlatformBrokerResponse(e);if(e.hasOwnProperty("error")){const t=e;if(!1===t.isSuccess&&t.error&&t.error.code)throw this.logger.trace(this.platformAuthType+" - platform broker returned error response"),Bs(t.error.code,t.error.description,{error:parseInt(t.error.errorCode),protocol_error:t.error.protocolError,status:t.error.status,properties:t.error.properties})}}throw D(O,"Response missing expected properties.")}convertToPlatformBrokerResponse(e){return this.logger.trace(this.platformAuthType+" - convertToNativeResponse called"),{access_token:e.accessToken,id_token:e.idToken,client_info:e.clientInfo,account:e.account,expires_in:e.expiresIn,scope:e.scopes,state:e.state||"",properties:e.properties||{},extendedLifetimeToken:e.extendedLifetimeToken??!1,shr:e.proofOfPossessionPayload}}getDOMExtraParams(e){return{...Object.entries(e).reduce((e,[t,n])=>(e[t]=String(n),e),{})}}}async function tc(e,t,n,r){e.trace("getPlatformAuthProvider called",n);const o=function(){let e;try{return e=window[pi.SessionStorage],"true"===e?.getItem(Ga)}catch(e){return!1}}();let i;e.trace("Has client allowed platform auth via DOM API: "+o);try{o&&(i=await ec.createProvider(e,t,n)),i||(e.trace("Platform auth via DOM API not available, checking for extension"),i=await Zs.createProvider(e,r||2e3,t))}catch(t){e.trace("Platform auth not available",t)}return i}function nc(e,t,n,r){if(t.trace("isPlatformAuthAllowed called"),!e.system.allowPlatformBroker)return t.trace("isPlatformAuthAllowed: allowPlatformBroker is not enabled, returning false"),!1;if(!n)return t.trace("isPlatformAuthAllowed: Platform auth provider is not initialized, returning false"),!1;if(r)switch(r){case P.BEARER:case P.POP:return t.trace("isPlatformAuthAllowed: authenticationScheme is supported, returning true"),!0;default:return t.trace("isPlatformAuthAllowed: authenticationScheme is not supported, returning false"),!1}return!0}class rc extends Os{constructor(e,t,n,r,o,i,a,s,c,l){super(e,t,n,r,o,i,a,c,l),this.unloadWindow=this.unloadWindow.bind(this),this.nativeStorage=s,this.eventHandler=o}acquireToken(e,t){let n;try{if(n={popupName:this.generatePopupName(e.scopes||o,e.authority||this.config.auth.authority),popupWindowAttributes:e.popupWindowAttributes||{},popupWindowParent:e.popupWindowParent??window},this.performanceClient.addFields({isAsyncPopup:this.config.system.asyncPopups},this.correlationId),this.config.system.asyncPopups)return this.logger.verbose("asyncPopups set to true, acquiring token"),this.acquireTokenPopupAsync(e,n,t);{const r={...e,httpMethod:Ms(e,this.config.auth.protocolMode)};return this.logger.verbose("asyncPopup set to false, opening popup before acquiring token"),n.popup=this.openSizedPopup("about:blank",n),this.acquireTokenPopupAsync(r,n,t)}}catch(e){return Promise.reject(e)}}logout(e){try{this.logger.verbose("logoutPopup called");const t=this.initializeLogoutRequest(e),n={popupName:this.generateLogoutPopupName(t),popupWindowAttributes:e?.popupWindowAttributes||{},popupWindowParent:e?.popupWindowParent??window},r=e&&e.authority,o=e&&e.mainWindowRedirectUri;return this.config.system.asyncPopups?(this.logger.verbose("asyncPopups set to true"),this.logoutPopupAsync(t,n,r,o)):(this.logger.verbose("asyncPopup set to false, opening popup"),n.popup=this.openSizedPopup("about:blank",n),this.logoutPopupAsync(t,n,r,o))}catch(e){return Promise.reject(e)}}async acquireTokenPopupAsync(e,n,r){this.logger.verbose("acquireTokenPopupAsync called");const o=await jn(this.initializeAuthorizationRequest.bind(this),Gt.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,this.correlationId)(e,t.InteractionType.Popup);n.popup&&Pa(o.authority);const i=nc(this.config,this.logger,this.platformAuthProvider,e.authenticationScheme);return o.platformBroker=i,this.config.auth.protocolMode===Tt.EAR?this.executeEarFlow(o,n):this.executeCodeFlow(o,n,r)}async executeCodeFlow(e,n,o){const i=e.correlationId,a=this.initializeServerTelemetryManager(Si.acquireTokenPopup),s=o||await jn(Js,Gt.GeneratePkceCodes,this.logger,this.performanceClient,i)(this.performanceClient,this.logger,i),c={...e,codeChallenge:s.challenge};try{const o=await jn(this.createAuthCodeClient.bind(this),Gt.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,i)({serverTelemetryManager:a,requestAuthority:c.authority,requestAzureCloudOptions:c.azureCloudOptions,requestExtraQueryParameters:c.extraQueryParameters,account:c.account});if(c.httpMethod===r)return await this.executeCodeFlowWithPost(c,n,o,s.verifier);{const r=await jn(Ks,Gt.GetAuthCodeUrl,this.logger,this.performanceClient,i)(this.config,o.authority,c,this.logger,this.performanceClient),a=this.initiateAuthRequest(r,n);this.eventHandler.emitEvent(fs.POPUP_OPENED,t.InteractionType.Popup,{popupWindow:a},null);const l=await this.monitorPopupForHash(a,n.popupWindowParent),u=Gn(Ns,Gt.DeserializeResponse,this.logger,this.performanceClient,this.correlationId)(l,this.config.auth.OIDCOptions.serverResponseType,this.logger);return await jn(Vs,Gt.HandleResponseCode,this.logger,this.performanceClient,i)(e,u,s.verifier,Si.acquireTokenPopup,this.config,o,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}}catch(e){throw n.popup?.close(),e instanceof U&&(e.setCorrelationId(this.correlationId),a.cacheFailedRequest(e)),e}}async executeEarFlow(e,t){const n=e.correlationId,r=await jn(this.getDiscoveredAuthority.bind(this),Gt.StandardInteractionClientGetDiscoveredAuthority,this.logger,this.performanceClient,n)({requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account}),o=await jn(ea,Gt.GenerateEarKey,this.logger,this.performanceClient,n)(),i={...e,earJwk:o},a=t.popup||this.openPopup("about:blank",t);(await $s(a.document,this.config,r,i,this.logger,this.performanceClient)).submit();const s=await jn(this.monitorPopupForHash.bind(this),Gt.SilentHandlerMonitorIframeForHash,this.logger,this.performanceClient,n)(a,t.popupWindowParent),c=Gn(Ns,Gt.DeserializeResponse,this.logger,this.performanceClient,this.correlationId)(s,this.config.auth.OIDCOptions.serverResponseType,this.logger);return jn(Qs,Gt.HandleResponseEar,this.logger,this.performanceClient,n)(i,c,Si.acquireTokenPopup,this.config,r,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}async executeCodeFlowWithPost(e,t,n,r){const o=e.correlationId,i=await jn(this.getDiscoveredAuthority.bind(this),Gt.StandardInteractionClientGetDiscoveredAuthority,this.logger,this.performanceClient,o)({requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account}),a=t.popup||this.openPopup("about:blank",t);(await Gs(a.document,this.config,i,e,this.logger,this.performanceClient)).submit();const s=await jn(this.monitorPopupForHash.bind(this),Gt.SilentHandlerMonitorIframeForHash,this.logger,this.performanceClient,o)(a,t.popupWindowParent),c=Gn(Ns,Gt.DeserializeResponse,this.logger,this.performanceClient,this.correlationId)(s,this.config.auth.OIDCOptions.serverResponseType,this.logger);return jn(Vs,Gt.HandleResponseCode,this.logger,this.performanceClient,o)(e,c,r,Si.acquireTokenPopup,this.config,n,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}async logoutPopupAsync(e,n,r,o){this.logger.verbose("logoutPopupAsync called"),this.eventHandler.emitEvent(fs.LOGOUT_START,t.InteractionType.Popup,e);const i=this.initializeServerTelemetryManager(Si.logoutPopup);try{await this.clearCacheOnLogout(this.correlationId,e.account);const a=await jn(this.createAuthCodeClient.bind(this),Gt.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:i,requestAuthority:r,account:e.account||void 0});try{a.authority.endSessionEndpoint}catch{if(e.account?.homeAccountId&&e.postLogoutRedirectUri&&a.authority.protocolMode===Tt.OIDC){if(this.eventHandler.emitEvent(fs.LOGOUT_SUCCESS,t.InteractionType.Popup,e),o){const e={apiId:Si.logoutPopup,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},t=Ot.getAbsoluteUrl(o,wa());await this.navigationClient.navigateInternal(t,e)}return void n.popup?.close()}}const s=a.getLogoutUri(e);this.eventHandler.emitEvent(fs.LOGOUT_SUCCESS,t.InteractionType.Popup,e);const c=this.openPopup(s,n);if(this.eventHandler.emitEvent(fs.POPUP_OPENED,t.InteractionType.Popup,{popupWindow:c},null),await this.monitorPopupForHash(c,n.popupWindowParent).catch(()=>{}),o){const e={apiId:Si.logoutPopup,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},t=Ot.getAbsoluteUrl(o,wa());this.logger.verbose("Redirecting main window to url specified in the request"),this.logger.verbosePii(`Redirecting main window to: ${t}`),await this.navigationClient.navigateInternal(t,e)}else this.logger.verbose("No main window navigation requested")}catch(e){throw n.popup?.close(),e instanceof U&&(e.setCorrelationId(this.correlationId),i.cacheFailedRequest(e)),this.eventHandler.emitEvent(fs.LOGOUT_FAILURE,t.InteractionType.Popup,null,e),this.eventHandler.emitEvent(fs.LOGOUT_END,t.InteractionType.Popup),e}this.eventHandler.emitEvent(fs.LOGOUT_END,t.InteractionType.Popup)}initiateAuthRequest(e,t){if(e)return this.logger.infoPii(`Navigate to: ${e}`),this.openPopup(e,t);throw this.logger.error("Navigate url is empty"),ai(so)}monitorPopupForHash(e,t){return new Promise((t,n)=>{this.logger.verbose("PopupHandler.monitorPopupForHash - polling started");const r=setInterval(()=>{if(e.closed)return this.logger.error("PopupHandler.monitorPopupForHash - window closed"),clearInterval(r),void n(ai(yo));let o="";try{o=e.location.href}catch(e){}if(!o||"about:blank"===o)return;clearInterval(r);let i="";const a=this.config.auth.OIDCOptions.serverResponseType;e&&(i=a===v.QUERY?e.location.search:e.location.hash),this.logger.verbose("PopupHandler.monitorPopupForHash - popup window is on same origin as caller"),t(i)},this.config.system.pollIntervalMilliseconds)}).finally(()=>{this.cleanPopup(e,t)})}openPopup(e,t){try{let n;if(t.popup?(n=t.popup,this.logger.verbosePii(`Navigating popup window to: ${e}`),n.location.assign(e)):void 0===t.popup&&(this.logger.verbosePii(`Opening popup window to: ${e}`),n=this.openSizedPopup(e,t)),!n)throw ai(mo);return n.focus&&n.focus(),this.currentWindow=n,t.popupWindowParent.addEventListener("beforeunload",this.unloadWindow),n}catch(e){throw this.logger.error("error opening popup "+e.message),ai(fo)}}openSizedPopup(e,{popupName:t,popupWindowAttributes:n,popupWindowParent:r}){const o=r.screenLeft?r.screenLeft:r.screenX,i=r.screenTop?r.screenTop:r.screenY,a=r.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,s=r.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;let c=n.popupSize?.width,l=n.popupSize?.height,u=n.popupPosition?.top,d=n.popupPosition?.left;return(!c||c<0||c>a)&&(this.logger.verbose("Default popup window width used. Window width not configured or invalid."),c=483),(!l||l<0||l>s)&&(this.logger.verbose("Default popup window height used. Window height not configured or invalid."),l=600),(!u||u<0||u>s)&&(this.logger.verbose("Default popup window top position used. Window top not configured or invalid."),u=Math.max(0,s/2-300+i)),(!d||d<0||d>a)&&(this.logger.verbose("Default popup window left position used. Window left not configured or invalid."),d=Math.max(0,a/2-241.5+o)),r.open(e,t,`width=${c}, height=${l}, top=${u}, left=${d}, scrollbars=yes`)}unloadWindow(e){this.currentWindow&&this.currentWindow.close(),e.preventDefault()}cleanPopup(e,t){e.close(),t.removeEventListener("beforeunload",this.unloadWindow)}generatePopupName(e,t){return`${ci}.${this.config.auth.clientId}.${e.join("-")}.${t}.${this.correlationId}`}generateLogoutPopupName(e){const t=e.account&&e.account.homeAccountId;return`${ci}.${this.config.auth.clientId}.${t}.${this.correlationId}`}}class oc extends Os{constructor(e,t,n,r,o,i,a,s,c,l){super(e,t,n,r,o,i,a,c,l),this.nativeStorage=s}async acquireToken(e){const n=await jn(this.initializeAuthorizationRequest.bind(this),Gt.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,this.correlationId)(e,t.InteractionType.Redirect);n.platformBroker=nc(this.config,this.logger,this.platformAuthProvider,e.authenticationScheme);const r=e=>{e.persisted&&(this.logger.verbose("Page was restored from back/forward cache. Clearing temporary cache."),this.browserStorage.resetRequestCache(),this.eventHandler.emitEvent(fs.RESTORE_FROM_BFCACHE,t.InteractionType.Redirect))},o=this.getRedirectStartPage(e.redirectStartPage);this.logger.verbosePii(`Redirect start page: ${o}`),this.browserStorage.setTemporaryCache(yi,o,!0),window.addEventListener("pageshow",r);try{this.config.auth.protocolMode===Tt.EAR?await this.executeEarFlow(n):await this.executeCodeFlow(n,e.onRedirectNavigate)}catch(e){throw e instanceof U&&e.setCorrelationId(this.correlationId),window.removeEventListener("pageshow",r),e}}async executeCodeFlow(e,t){const n=e.correlationId,o=this.initializeServerTelemetryManager(Si.acquireTokenRedirect),i=await jn(Js,Gt.GeneratePkceCodes,this.logger,this.performanceClient,n)(this.performanceClient,this.logger,n),a={...e,codeChallenge:i.challenge};this.browserStorage.cacheAuthorizeRequest(a,i.verifier);try{if(a.httpMethod===r)return await this.executeCodeFlowWithPost(a);{const n=await jn(this.createAuthCodeClient.bind(this),Gt.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:o,requestAuthority:a.authority,requestAzureCloudOptions:a.azureCloudOptions,requestExtraQueryParameters:a.extraQueryParameters,account:a.account}),r=await jn(Ks,Gt.GetAuthCodeUrl,this.logger,this.performanceClient,e.correlationId)(this.config,n.authority,a,this.logger,this.performanceClient);return await this.initiateAuthRequest(r,t)}}catch(e){throw e instanceof U&&(e.setCorrelationId(this.correlationId),o.cacheFailedRequest(e)),e}}async executeEarFlow(e){const t=e.correlationId,n=await jn(this.getDiscoveredAuthority.bind(this),Gt.StandardInteractionClientGetDiscoveredAuthority,this.logger,this.performanceClient,t)({requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account}),r=await jn(ea,Gt.GenerateEarKey,this.logger,this.performanceClient,t)(),o={...e,earJwk:r};return this.browserStorage.cacheAuthorizeRequest(o),(await $s(document,this.config,n,o,this.logger,this.performanceClient)).submit(),new Promise((e,t)=>{setTimeout(()=>{t(ai(ei,"failed_to_redirect"))},this.config.system.redirectNavigationTimeout)})}async executeCodeFlowWithPost(e){const t=e.correlationId,n=await jn(this.getDiscoveredAuthority.bind(this),Gt.StandardInteractionClientGetDiscoveredAuthority,this.logger,this.performanceClient,t)({requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account});return this.browserStorage.cacheAuthorizeRequest(e),(await Gs(document,this.config,n,e,this.logger,this.performanceClient)).submit(),new Promise((e,t)=>{setTimeout(()=>{t(ai(ei,"failed_to_redirect"))},this.config.system.redirectNavigationTimeout)})}async handleRedirectPromise(e="",t,r,o){const i=this.initializeServerTelemetryManager(Si.handleRedirectPromise);try{const[a,s]=this.getRedirectResponse(e||"");if(!a)return this.logger.info("handleRedirectPromise did not detect a response as a result of a redirect. Cleaning temporary cache."),this.browserStorage.resetRequestCache(),"back_forward"!==function(){if("undefined"==typeof window||void 0===window.performance||"function"!=typeof window.performance.getEntriesByType)return;const e=window.performance.getEntriesByType("navigation"),t=e.length?e[0]:void 0;return t?.type}()?o.event.errorCode="no_server_response":this.logger.verbose("Back navigation event detected. Muting no_server_response error"),null;const c=this.browserStorage.getTemporaryCache(yi,!0)||n.EMPTY_STRING;if(Mt(c)===Mt(window.location.href)&&this.config.auth.navigateToLoginRequestUrl)return this.logger.verbose("Current page is loginRequestUrl, handling response"),c.indexOf("#")>-1&&ya(c),await this.handleResponse(a,t,r,i);if(!this.config.auth.navigateToLoginRequestUrl)return this.logger.verbose("NavigateToLoginRequestUrl set to false, handling response"),await this.handleResponse(a,t,r,i);if(!va()||this.config.system.allowRedirectInIframe){this.browserStorage.setTemporaryCache(vi,s,!0);const e={apiId:Si.handleRedirectPromise,timeout:this.config.system.redirectNavigationTimeout,noHistory:!0};let n=!0;if(c&&"null"!==c)this.logger.verbose(`Navigating to loginRequestUrl: ${c}`),n=await this.navigationClient.navigateInternal(c,e);else{const t=Ia();this.browserStorage.setTemporaryCache(yi,t,!0),this.logger.warning("Unable to get valid login request url from cache, redirecting to home page"),n=await this.navigationClient.navigateInternal(t,e)}if(!n)return await this.handleResponse(a,t,r,i)}return null}catch(e){throw e instanceof U&&(e.setCorrelationId(this.correlationId),i.cacheFailedRequest(e)),e}}getRedirectResponse(e){this.logger.verbose("getRedirectResponseHash called");let n=e;n||(n=this.config.auth.OIDCOptions.serverResponseType===v.QUERY?window.location.search:window.location.hash);let r=Pt(n);if(r){try{!function(e,t,n){if(!e.state)throw ai(lo);const r=function(e,t){if(!t)return null;try{return xr.parseRequestState(e,t).libraryState.meta}catch(e){throw Ne(W)}}(t,e.state);if(!r)throw ai(ho);if(r.interactionType!==n)throw ai(go)}(r,this.browserCrypto,t.InteractionType.Redirect)}catch(e){return e instanceof U&&this.logger.error(`Interaction type validation failed due to ${e.errorCode}: ${e.errorMessage}`),[null,""]}return ma(window),this.logger.verbose("Hash contains known properties, returning response hash"),[r,n]}const o=this.browserStorage.getTemporaryCache(vi,!0);return this.browserStorage.removeItem(this.browserStorage.generateCacheKey(vi)),o&&(r=Pt(o),r)?(this.logger.verbose("Hash does not contain known properties, returning cached hash"),[r,o]):[null,""]}async handleResponse(e,t,n,r){if(!e.state)throw ai(lo);if(e.ear_jwe){const n=await jn(this.getDiscoveredAuthority.bind(this),Gt.StandardInteractionClientGetDiscoveredAuthority,this.logger,this.performanceClient,t.correlationId)({requestAuthority:t.authority,requestAzureCloudOptions:t.azureCloudOptions,requestExtraQueryParameters:t.extraQueryParameters,account:t.account});return jn(Qs,Gt.HandleResponseEar,this.logger,this.performanceClient,t.correlationId)(t,e,Si.acquireTokenRedirect,this.config,n,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}const o=await jn(this.createAuthCodeClient.bind(this),Gt.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:r,requestAuthority:t.authority});return jn(Vs,Gt.HandleResponseCode,this.logger,this.performanceClient,t.correlationId)(t,e,n,Si.acquireTokenRedirect,this.config,o,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}async initiateAuthRequest(e,t){if(this.logger.verbose("RedirectHandler.initiateAuthRequest called"),e){this.logger.infoPii(`RedirectHandler.initiateAuthRequest: Navigate to: ${e}`);const n={apiId:Si.acquireTokenRedirect,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},r=t||this.config.auth.onRedirectNavigate;return"function"==typeof r?(this.logger.verbose("RedirectHandler.initiateAuthRequest: Invoking onRedirectNavigate callback"),!1!==r(e)?(this.logger.verbose("RedirectHandler.initiateAuthRequest: onRedirectNavigate did not return false, navigating"),void await this.navigationClient.navigateExternal(e,n)):void this.logger.verbose("RedirectHandler.initiateAuthRequest: onRedirectNavigate returned false, stopping navigation")):(this.logger.verbose("RedirectHandler.initiateAuthRequest: Navigating window to navigate url"),void await this.navigationClient.navigateExternal(e,n))}throw this.logger.info("RedirectHandler.initiateAuthRequest: Navigate url is empty"),ai(so)}async logout(e){this.logger.verbose("logoutRedirect called");const n=this.initializeLogoutRequest(e),r=this.initializeServerTelemetryManager(Si.logout);try{this.eventHandler.emitEvent(fs.LOGOUT_START,t.InteractionType.Redirect,e),await this.clearCacheOnLogout(this.correlationId,n.account);const o={apiId:Si.logout,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},i=await jn(this.createAuthCodeClient.bind(this),Gt.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:r,requestAuthority:e&&e.authority,requestExtraQueryParameters:e?.extraQueryParameters,account:e&&e.account||void 0});if(i.authority.protocolMode===Tt.OIDC)try{i.authority.endSessionEndpoint}catch{if(n.account?.homeAccountId)return void this.eventHandler.emitEvent(fs.LOGOUT_SUCCESS,t.InteractionType.Redirect,n)}const a=i.getLogoutUri(n);if(this.eventHandler.emitEvent(fs.LOGOUT_SUCCESS,t.InteractionType.Redirect,n),!e||"function"!=typeof e.onRedirectNavigate)return this.browserStorage.getInteractionInProgress()||this.browserStorage.setInteractionInProgress(!0,mi),void await this.navigationClient.navigateExternal(a,o);if(!1!==e.onRedirectNavigate(a))return this.logger.verbose("Logout onRedirectNavigate did not return false, navigating"),this.browserStorage.getInteractionInProgress()||this.browserStorage.setInteractionInProgress(!0,mi),void await this.navigationClient.navigateExternal(a,o);this.browserStorage.setInteractionInProgress(!1),this.logger.verbose("Logout onRedirectNavigate returned false, stopping navigation")}catch(e){throw e instanceof U&&(e.setCorrelationId(this.correlationId),r.cacheFailedRequest(e)),this.eventHandler.emitEvent(fs.LOGOUT_FAILURE,t.InteractionType.Redirect,null,e),this.eventHandler.emitEvent(fs.LOGOUT_END,t.InteractionType.Redirect),e}this.eventHandler.emitEvent(fs.LOGOUT_END,t.InteractionType.Redirect)}getRedirectStartPage(e){const t=e||window.location.href;return Ot.getAbsoluteUrl(t,wa())}}async function ic(e,t,n,r,o){if(t.addQueueMeasurement(Gt.SilentHandlerInitiateAuthRequest,r),!e)throw n.info("Navigate url is empty"),ai(so);return o?jn(lc,Gt.SilentHandlerLoadFrame,n,t,r)(e,o,t,r):Gn(uc,Gt.SilentHandlerLoadFrameSync,n,t,r)(e)}async function ac(e,t,n,r,o){const i=dc();if(!i.contentDocument)throw"No document associated with iframe!";return(await Gs(i.contentDocument,e,t,n,r,o)).submit(),i}async function sc(e,t,n,r,o){const i=dc();if(!i.contentDocument)throw"No document associated with iframe!";return(await $s(i.contentDocument,e,t,n,r,o)).submit(),i}async function cc(e,t,n,r,o,i,a){return r.addQueueMeasurement(Gt.SilentHandlerMonitorIframeForHash,i),new Promise((r,i)=>{t<Ua&&o.warning(`system.loadFrameTimeout or system.iframeHashTimeout set to lower (${t}ms) than the default (10000ms). This may result in timeouts.`);const s=window.setTimeout(()=>{window.clearInterval(c),i(ai(Co))},t),c=window.setInterval(()=>{let t="";const n=e.contentWindow;try{t=n?n.location.href:""}catch(e){}if(!t||"about:blank"===t)return;let o="";n&&(o=a===v.QUERY?n.location.search:n.location.hash),window.clearTimeout(s),window.clearInterval(c),r(o)},n)}).finally(()=>{Gn(hc,Gt.RemoveHiddenIframe,o,r,i)(e)})}function lc(e,t,n,r){return n.addQueueMeasurement(Gt.SilentHandlerLoadFrame,r),new Promise((n,r)=>{const o=dc();window.setTimeout(()=>{o?(o.src=e,n(o)):r("Unable to load iframe")},t)})}function uc(e){const t=dc();return t.src=e,t}function dc(){const e=document.createElement("iframe");return e.className="msalSilentIframe",e.style.visibility="hidden",e.style.position="absolute",e.style.width=e.style.height="0",e.style.border="0",e.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms"),document.body.appendChild(e),e}function hc(e){document.body===e.parentNode&&document.body.removeChild(e)}class gc extends Os{constructor(e,t,n,r,o,i,a,s,c,l,u){super(e,t,n,r,o,i,s,l,u),this.apiId=a,this.nativeStorage=c}async acquireToken(e){this.performanceClient.addQueueMeasurement(Gt.SilentIframeClientAcquireToken,e.correlationId),e.loginHint||e.sid||e.account&&e.account.username||this.logger.warning("No user hint provided. The authorization server may need more information to complete this request.");const n={...e};n.prompt?n.prompt!==m.NONE&&n.prompt!==m.NO_SESSION&&(this.logger.warning(`SilentIframeClient. Replacing invalid prompt ${n.prompt} with ${m.NONE}`),n.prompt=m.NONE):n.prompt=m.NONE;const r=await jn(this.initializeAuthorizationRequest.bind(this),Gt.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,e.correlationId)(n,t.InteractionType.Silent);return r.platformBroker=nc(this.config,this.logger,this.platformAuthProvider,r.authenticationScheme),Pa(r.authority),this.config.auth.protocolMode===Tt.EAR?this.executeEarFlow(r):this.executeCodeFlow(r)}async executeCodeFlow(e){let t;const n=this.initializeServerTelemetryManager(this.apiId);try{return t=await jn(this.createAuthCodeClient.bind(this),Gt.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,e.correlationId)({serverTelemetryManager:n,requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account}),await jn(this.silentTokenHelper.bind(this),Gt.SilentIframeClientTokenHelper,this.logger,this.performanceClient,e.correlationId)(t,e)}catch(r){if(r instanceof U&&(r.setCorrelationId(this.correlationId),n.cacheFailedRequest(r)),!(t&&r instanceof U&&r.errorCode===si))throw r;return this.performanceClient.addFields({retryError:r.errorCode},this.correlationId),await jn(this.silentTokenHelper.bind(this),Gt.SilentIframeClientTokenHelper,this.logger,this.performanceClient,this.correlationId)(t,e)}}async executeEarFlow(e){const t=e.correlationId,n=await jn(this.getDiscoveredAuthority.bind(this),Gt.StandardInteractionClientGetDiscoveredAuthority,this.logger,this.performanceClient,t)({requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account}),r=await jn(ea,Gt.GenerateEarKey,this.logger,this.performanceClient,t)(),o={...e,earJwk:r},i=await jn(sc,Gt.SilentHandlerInitiateAuthRequest,this.logger,this.performanceClient,t)(this.config,n,o,this.logger,this.performanceClient),a=this.config.auth.OIDCOptions.serverResponseType,s=await jn(cc,Gt.SilentHandlerMonitorIframeForHash,this.logger,this.performanceClient,t)(i,this.config.system.iframeHashTimeout,this.config.system.pollIntervalMilliseconds,this.performanceClient,this.logger,t,a),c=Gn(Ns,Gt.DeserializeResponse,this.logger,this.performanceClient,t)(s,a,this.logger);return jn(Qs,Gt.HandleResponseEar,this.logger,this.performanceClient,t)(o,c,this.apiId,this.config,n,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}logout(){return Promise.reject(ai(ko))}async silentTokenHelper(e,t){const n=t.correlationId;this.performanceClient.addQueueMeasurement(Gt.SilentIframeClientTokenHelper,n);const o=await jn(Js,Gt.GeneratePkceCodes,this.logger,this.performanceClient,n)(this.performanceClient,this.logger,n),i={...t,codeChallenge:o.challenge};let a;if(t.httpMethod===r)a=await jn(ac,Gt.SilentHandlerInitiateAuthRequest,this.logger,this.performanceClient,n)(this.config,e.authority,i,this.logger,this.performanceClient);else{const t=await jn(Ks,Gt.GetAuthCodeUrl,this.logger,this.performanceClient,n)(this.config,e.authority,i,this.logger,this.performanceClient);a=await jn(ic,Gt.SilentHandlerInitiateAuthRequest,this.logger,this.performanceClient,n)(t,this.performanceClient,this.logger,n,this.config.system.navigateFrameWait)}const s=this.config.auth.OIDCOptions.serverResponseType,c=await jn(cc,Gt.SilentHandlerMonitorIframeForHash,this.logger,this.performanceClient,n)(a,this.config.system.iframeHashTimeout,this.config.system.pollIntervalMilliseconds,this.performanceClient,this.logger,n,s),l=Gn(Ns,Gt.DeserializeResponse,this.logger,this.performanceClient,n)(c,s,this.logger);return jn(Vs,Gt.HandleResponseCode,this.logger,this.performanceClient,n)(t,l,o.verifier,this.apiId,this.config,e,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}}class pc extends Os{async acquireToken(e){this.performanceClient.addQueueMeasurement(Gt.SilentRefreshClientAcquireToken,e.correlationId);const t=await jn(Ps,Gt.InitializeBaseRequest,this.logger,this.performanceClient,e.correlationId)(e,this.config,this.performanceClient,this.logger),n={...e,...t};e.redirectUri&&(n.redirectUri=this.getRedirectUri(e.redirectUri));const r=this.initializeServerTelemetryManager(Si.acquireTokenSilent_silentFlow),o=await this.createRefreshTokenClient({serverTelemetryManager:r,authorityUrl:n.authority,azureCloudOptions:n.azureCloudOptions,account:n.account});return jn(o.acquireTokenByRefreshToken.bind(o),Gt.RefreshTokenClientAcquireTokenByRefreshToken,this.logger,this.performanceClient,e.correlationId)(n).catch(e=>{throw e.setCorrelationId(this.correlationId),r.cacheFailedRequest(e),e})}logout(){return Promise.reject(ai(ko))}async createRefreshTokenClient(e){const t=await jn(this.getClientConfiguration.bind(this),Gt.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:e.serverTelemetryManager,requestAuthority:e.authorityUrl,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account});return new Kr(t,this.performanceClient)}}class fc{constructor(e,t,n,r){this.isBrowserEnvironment="undefined"!=typeof window,this.config=e,this.storage=t,this.logger=n,this.cryptoObj=r}async loadExternalTokens(e,t,n){if(!this.isBrowserEnvironment)throw ai(Mo);const r=e.correlationId||Xi(),o=t.id_token?kt(t.id_token,Ui):void 0,i=St(o||{}),a={protocolMode:this.config.auth.protocolMode,knownAuthorities:this.config.auth.knownAuthorities,cloudDiscoveryMetadata:this.config.auth.cloudDiscoveryMetadata,authorityMetadata:this.config.auth.authorityMetadata,skipAuthorityMetadataCache:this.config.auth.skipAuthorityMetadataCache},s=e.authority?new ur(ur.generateAuthority(e.authority,e.azureCloudOptions),this.config.system.networkClient,this.storage,a,this.logger,e.correlationId||Xi()):void 0,c=await this.loadAccount(e,n.clientInfo||t.client_info||"",r,o,s),l=await this.loadIdToken(t,c.homeAccountId,c.environment,c.realm,r,i),u=await this.loadAccessToken(e,t,c.homeAccountId,c.environment,c.realm,n,r,i),d=await this.loadRefreshToken(t,c.homeAccountId,c.environment,r,i);return this.generateAuthenticationResult(e,{account:c,idToken:l,accessToken:u,refreshToken:d},o,s)}async loadAccount(e,t,n,r,o){if(this.logger.verbose("TokenCache - loading account"),e.account){const t=At.createFromAccountInfo(e.account);return await this.storage.setAccount(t,n,St(r||{})),t}if(!o||!t&&!r)throw this.logger.error("TokenCache - if an account is not provided on the request, authority and either clientInfo or idToken must be provided instead."),ai(Uo);const i=At.generateHomeAccountId(t,o.authorityType,this.logger,this.cryptoObj,r),a=r?.tid,s=Hr(this.storage,o,i,Ui,n,r,t,o.hostnameAndPort,a,void 0,void 0,this.logger);return await this.storage.setAccount(s,n,St(r||{})),s}async loadIdToken(e,t,n,r,o,i){if(!e.id_token)return this.logger.verbose("TokenCache - no id token found in response"),null;this.logger.verbose("TokenCache - loading id token");const a=er(t,n,e.id_token,this.config.auth.clientId,r);return await this.storage.setIdTokenCredential(a,o,i),a}async loadAccessToken(e,t,n,r,o,i,a,s){if(!t.access_token)return this.logger.verbose("TokenCache - no access token found in response"),null;if(!t.expires_in)return this.logger.error("TokenCache - no expiration set on the access token. Cannot add it to the cache."),null;if(!(t.scope||e.scopes&&e.scopes.length))return this.logger.error("TokenCache - scopes not specified in the request or response. Cannot add token to the cache."),null;this.logger.verbose("TokenCache - loading access token");const c=t.scope?ft.fromString(t.scope):new ft(e.scopes),l=i.expiresOn||t.expires_in+Vn(),u=i.extendedExpiresOn||(t.ext_expires_in||t.expires_in)+Vn(),d=tr(n,r,t.access_token,this.config.auth.clientId,o,c.printScopes(),l,u,Ui);return await this.storage.setAccessTokenCredential(d,a,s),d}async loadRefreshToken(e,t,n,r,o){if(!e.refresh_token)return this.logger.verbose("TokenCache - no refresh token found in response"),null;this.logger.verbose("TokenCache - loading refresh token");const i=nr(t,n,e.refresh_token,this.config.auth.clientId,e.foci,void 0,e.refresh_token_expires_in);return await this.storage.setRefreshTokenCredential(i,r,o),i}generateAuthenticationResult(e,t,n,r){let o,i="",a=[],s=null;t?.accessToken&&(i=t.accessToken.secret,a=ft.fromString(t.accessToken.target).asArray(),s=Jn(t.accessToken.expiresOn),o=Jn(t.accessToken.extendedExpiresOn));const c=t.account;return{authority:r?r.canonicalAuthority:"",uniqueId:t.account.localAccountId,tenantId:t.account.realm,scopes:a,account:At.getAccountInfo(c),idToken:t.idToken?.secret||"",idTokenClaims:n||{},accessToken:i,fromCache:!0,expiresOn:s,correlationId:e.correlationId||"",requestId:"",extExpiresOn:o,familyId:t.refreshToken?.familyId||"",tokenType:t?.accessToken?.tokenType||"",state:e.state||"",cloudGraphHostName:c.cloudGraphHostName||"",msGraphHost:c.msGraphHost||"",fromNativeBroker:!1}}}class mc extends zr{constructor(e){super(e),this.includeRedirectUri=!1}}class yc extends Os{constructor(e,t,n,r,o,i,a,s,c,l){super(e,t,n,r,o,i,s,c,l),this.apiId=a}async acquireToken(e){if(!e.code)throw ai(Bo);const n=await jn(this.initializeAuthorizationRequest.bind(this),Gt.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,e.correlationId)(e,t.InteractionType.Silent),r=this.initializeServerTelemetryManager(this.apiId);try{const t={...n,code:e.code},o=await jn(this.getClientConfiguration.bind(this),Gt.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,e.correlationId)({serverTelemetryManager:r,requestAuthority:n.authority,requestAzureCloudOptions:n.azureCloudOptions,requestExtraQueryParameters:n.extraQueryParameters,account:n.account}),i=new mc(o);this.logger.verbose("Auth code client created");const a=new qs(i,this.browserStorage,t,this.logger,this.performanceClient);return await jn(a.handleCodeResponseFromServer.bind(a),Gt.HandleCodeResponseFromServer,this.logger,this.performanceClient,e.correlationId)({code:e.code,msgraph_host:e.msGraphHost,cloud_graph_host_name:e.cloudGraphHostName,cloud_instance_host_name:e.cloudInstanceHostName},n,!1)}catch(e){throw e instanceof U&&(e.setCorrelationId(this.correlationId),r.cacheFailedRequest(e)),e}}logout(){return Promise.reject(ai(ko))}}function vc(e,t,n){try{Ra(e)}catch(e){throw t.end({success:!1},e,n),e}}class Cc{constructor(e){this.operatingContext=e,this.isBrowserEnvironment=this.operatingContext.isBrowserEnvironment(),this.config=e.getConfig(),this.initialized=!1,this.logger=this.operatingContext.getLogger(),this.networkClient=this.config.system.networkClient,this.navigationClient=this.config.system.navigationClient,this.redirectResponse=new Map,this.hybridAuthCodeResponses=new Map,this.performanceClient=this.config.telemetry.client,this.browserCrypto=this.isBrowserEnvironment?new is(this.logger,this.performanceClient):qe,this.eventHandler=new Rs(this.logger),this.browserStorage=this.isBrowserEnvironment?new ys(this.config.auth.clientId,this.config.cache,this.browserCrypto,this.logger,this.performanceClient,this.eventHandler,hr(this.config.auth)):Cs(this.config.auth.clientId,this.logger,this.performanceClient,this.eventHandler);const t={cacheLocation:pi.MemoryStorage,cacheRetentionDays:5,temporaryCacheLocation:pi.MemoryStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!1,claimsBasedCachingEnabled:!1};this.nativeInternalStorage=new ys(this.config.auth.clientId,t,this.browserCrypto,this.logger,this.performanceClient,this.eventHandler),this.tokenCache=new fc(this.config,this.browserStorage,this.logger,this.browserCrypto),this.activeSilentTokenRequests=new Map,this.trackPageVisibility=this.trackPageVisibility.bind(this),this.trackPageVisibilityWithMeasurement=this.trackPageVisibilityWithMeasurement.bind(this)}static async createController(e,t){const n=new Cc(e);return await n.initialize(t),n}trackPageVisibility(e){e&&(this.logger.info("Perf: Visibility change detected"),this.performanceClient.incrementFields({visibilityChangeCount:1},e))}async initialize(e,t){if(this.logger.trace("initialize called"),this.initialized)return void this.logger.info("initialize has already been called, exiting early.");if(!this.isBrowserEnvironment)return this.logger.info("in non-browser environment, exiting early."),this.initialized=!0,void this.eventHandler.emitEvent(fs.INITIALIZE_END);const n=e?.correlationId||this.getRequestCorrelationId(),r=this.config.system.allowPlatformBroker,o=this.performanceClient.startMeasurement(Gt.InitializeClientApplication,n);if(this.eventHandler.emitEvent(fs.INITIALIZE_START),!t)try{this.logMultipleInstances(o)}catch{}if(await jn(this.browserStorage.initialize.bind(this.browserStorage),Gt.InitializeCache,this.logger,this.performanceClient,n)(n),r)try{this.platformAuthProvider=await tc(this.logger,this.performanceClient,n,this.config.system.nativeBrokerHandshakeTimeout)}catch(e){this.logger.verbose(e)}this.config.cache.claimsBasedCachingEnabled||(this.logger.verbose("Claims-based caching is disabled. Clearing the previous cache with claims"),Gn(this.browserStorage.clearTokensAndKeysWithClaims.bind(this.browserStorage),Gt.ClearTokensAndKeysWithClaims,this.logger,this.performanceClient,n)(n)),this.config.system.asyncPopups&&await this.preGeneratePkceCodes(n),this.initialized=!0,this.eventHandler.emitEvent(fs.INITIALIZE_END),o.end({allowPlatformBroker:r,success:!0})}async handleRedirectPromise(e){if(this.logger.verbose("handleRedirectPromise called"),ba(this.initialized),this.isBrowserEnvironment){const t=e||"";let n=this.redirectResponse.get(t);return void 0===n?(n=this.handleRedirectPromiseInternal(e),this.redirectResponse.set(t,n),this.logger.verbose("handleRedirectPromise has been called for the first time, storing the promise")):this.logger.verbose("handleRedirectPromise has been called previously, returning the result from the first call"),n}return this.logger.verbose("handleRedirectPromise returns null, not browser environment"),null}async handleRedirectPromiseInternal(e){if(!this.browserStorage.isInteractionInProgress(!0))return this.logger.info("handleRedirectPromise called but there is no interaction in progress, returning null."),null;const n=this.browserStorage.getInteractionInProgress()?.type;if(n===mi)return this.logger.verbose("handleRedirectPromise removing interaction_in_progress flag and returning null after sign-out"),this.browserStorage.setInteractionInProgress(!1),Promise.resolve(null);const r=this.getAllAccounts(),o=this.browserStorage.getCachedNativeRequest(),i=o&&this.platformAuthProvider&&!e;let a,s;this.eventHandler.emitEvent(fs.HANDLE_REDIRECT_START,t.InteractionType.Redirect);try{if(i&&this.platformAuthProvider){a=this.performanceClient.startMeasurement(Gt.AcquireTokenRedirect,o?.correlationId||""),this.logger.trace("handleRedirectPromise - acquiring token from native platform"),a.add({isPlatformBrokerRequest:!0});const e=new Fs(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,Si.handleRedirectPromise,this.performanceClient,this.platformAuthProvider,o.accountId,this.nativeInternalStorage,o.correlationId);s=jn(e.handleRedirectPromise.bind(e),Gt.HandleNativeRedirectPromiseMeasurement,this.logger,this.performanceClient,a.event.correlationId)(this.performanceClient,a.event.correlationId)}else{const[t,n]=this.browserStorage.getCachedRequest(),r=t.correlationId;a=this.performanceClient.startMeasurement(Gt.AcquireTokenRedirect,r),this.logger.trace("handleRedirectPromise - acquiring token from web flow");const o=this.createRedirectClient(r);s=jn(o.handleRedirectPromise.bind(o),Gt.HandleRedirectPromiseMeasurement,this.logger,this.performanceClient,a.event.correlationId)(e,t,n,a)}}catch(e){throw this.browserStorage.resetRequestCache(),e}return s.then(e=>(e?(this.browserStorage.resetRequestCache(),r.length<this.getAllAccounts().length?(this.eventHandler.emitEvent(fs.LOGIN_SUCCESS,t.InteractionType.Redirect,e),this.logger.verbose("handleRedirectResponse returned result, login success")):(this.eventHandler.emitEvent(fs.ACQUIRE_TOKEN_SUCCESS,t.InteractionType.Redirect,e),this.logger.verbose("handleRedirectResponse returned result, acquire token success")),a.end({success:!0},void 0,e.account)):a.event.errorCode?a.end({success:!1},void 0):a.discard(),this.eventHandler.emitEvent(fs.HANDLE_REDIRECT_END,t.InteractionType.Redirect),e)).catch(e=>{this.browserStorage.resetRequestCache();const n=e;throw r.length>0?this.eventHandler.emitEvent(fs.ACQUIRE_TOKEN_FAILURE,t.InteractionType.Redirect,null,n):this.eventHandler.emitEvent(fs.LOGIN_FAILURE,t.InteractionType.Redirect,null,n),this.eventHandler.emitEvent(fs.HANDLE_REDIRECT_END,t.InteractionType.Redirect),a.end({success:!1},n),e})}async acquireTokenRedirect(e){const n=this.getRequestCorrelationId(e);this.logger.verbose("acquireTokenRedirect called",n);const r=this.performanceClient.startMeasurement(Gt.AcquireTokenPreRedirect,n);r.add({scenarioId:e.scenarioId});const o=e.onRedirectNavigate;if(o)e.onRedirectNavigate=t=>{const n="function"==typeof o?o(t):void 0;return r.add({navigateCallbackResult:!1!==n}),r.event=r.end({success:!0},void 0,e.account)||r.event,n};else{const t=this.config.auth.onRedirectNavigate;this.config.auth.onRedirectNavigate=n=>{const o="function"==typeof t?t(n):void 0;return r.add({navigateCallbackResult:!1!==o}),r.event=r.end({success:!0},void 0,e.account)||r.event,o}}const i=this.getAllAccounts().length>0;try{let o;return Ea(this.initialized,this.config),this.browserStorage.setInteractionInProgress(!0,fi),i?this.eventHandler.emitEvent(fs.ACQUIRE_TOKEN_START,t.InteractionType.Redirect,e):this.eventHandler.emitEvent(fs.LOGIN_START,t.InteractionType.Redirect,e),o=this.platformAuthProvider&&this.canUsePlatformBroker(e)?new Fs(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,Si.acquireTokenRedirect,this.performanceClient,this.platformAuthProvider,this.getNativeAccountId(e),this.nativeInternalStorage,n).acquireTokenRedirect(e,r).catch(t=>{if(r.add({brokerErrorName:t.name,brokerErrorCode:t.errorCode}),t instanceof Us&&Ds(t))return this.platformAuthProvider=void 0,this.createRedirectClient(n).acquireToken(e);if(t instanceof Nr)return this.logger.verbose("acquireTokenRedirect - Resolving interaction required error thrown by native broker by falling back to web flow"),this.createRedirectClient(n).acquireToken(e);throw t}):this.createRedirectClient(n).acquireToken(e),await o}catch(o){throw this.browserStorage.resetRequestCache(),2===r.event.status?this.performanceClient.startMeasurement(Gt.AcquireTokenRedirect,n).end({success:!1},o,e.account):r.end({success:!1},o,e.account),i?this.eventHandler.emitEvent(fs.ACQUIRE_TOKEN_FAILURE,t.InteractionType.Redirect,null,o):this.eventHandler.emitEvent(fs.LOGIN_FAILURE,t.InteractionType.Redirect,null,o),o}}acquireTokenPopup(e){const n=this.getRequestCorrelationId(e),r=this.performanceClient.startMeasurement(Gt.AcquireTokenPopup,n);r.add({scenarioId:e.scenarioId});try{this.logger.verbose("acquireTokenPopup called",n),vc(this.initialized,r,e.account),this.browserStorage.setInteractionInProgress(!0,fi)}catch(e){return Promise.reject(e)}const o=this.getAllAccounts();let i;o.length>0?this.eventHandler.emitEvent(fs.ACQUIRE_TOKEN_START,t.InteractionType.Popup,e):this.eventHandler.emitEvent(fs.LOGIN_START,t.InteractionType.Popup,e);const a=this.getPreGeneratedPkceCodes(n);return this.canUsePlatformBroker(e)?(r.add({isPlatformBrokerRequest:!0}),i=this.acquireTokenNative({...e,correlationId:n},Si.acquireTokenPopup).then(e=>(r.end({success:!0},void 0,e.account),e)).catch(t=>{if(r.add({brokerErrorName:t.name,brokerErrorCode:t.errorCode}),t instanceof Us&&Ds(t))return this.platformAuthProvider=void 0,this.createPopupClient(n).acquireToken(e,a);if(t instanceof Nr)return this.logger.verbose("acquireTokenPopup - Resolving interaction required error thrown by native broker by falling back to web flow"),this.createPopupClient(n).acquireToken(e,a);throw t})):i=this.createPopupClient(n).acquireToken(e,a),i.then(e=>(o.length<this.getAllAccounts().length?this.eventHandler.emitEvent(fs.LOGIN_SUCCESS,t.InteractionType.Popup,e):this.eventHandler.emitEvent(fs.ACQUIRE_TOKEN_SUCCESS,t.InteractionType.Popup,e),r.end({success:!0,accessTokenSize:e.accessToken.length,idTokenSize:e.idToken.length},void 0,e.account),e)).catch(n=>(o.length>0?this.eventHandler.emitEvent(fs.ACQUIRE_TOKEN_FAILURE,t.InteractionType.Popup,null,n):this.eventHandler.emitEvent(fs.LOGIN_FAILURE,t.InteractionType.Popup,null,n),r.end({success:!1},n,e.account),Promise.reject(n))).finally(async()=>{this.browserStorage.setInteractionInProgress(!1),this.config.system.asyncPopups&&await this.preGeneratePkceCodes(n)})}trackPageVisibilityWithMeasurement(){const e=this.ssoSilentMeasurement||this.acquireTokenByCodeAsyncMeasurement;e&&(this.logger.info("Perf: Visibility change detected in ",e.event.name),e.increment({visibilityChangeCount:1}))}async ssoSilent(e){const n=this.getRequestCorrelationId(e),r={...e,prompt:e.prompt,correlationId:n};let o;return this.ssoSilentMeasurement=this.performanceClient.startMeasurement(Gt.SsoSilent,n),this.ssoSilentMeasurement?.add({scenarioId:e.scenarioId}),vc(this.initialized,this.ssoSilentMeasurement,e.account),this.ssoSilentMeasurement?.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement),this.logger.verbose("ssoSilent called",n),this.eventHandler.emitEvent(fs.SSO_SILENT_START,t.InteractionType.Silent,r),this.canUsePlatformBroker(r)?(this.ssoSilentMeasurement?.add({isPlatformBrokerRequest:!0}),o=this.acquireTokenNative(r,Si.ssoSilent).catch(e=>{if(this.ssoSilentMeasurement?.add({brokerErrorName:e.name,brokerErrorCode:e.errorCode}),e instanceof Us&&Ds(e))return this.platformAuthProvider=void 0,this.createSilentIframeClient(r.correlationId).acquireToken(r);throw e})):o=this.createSilentIframeClient(r.correlationId).acquireToken(r),o.then(e=>(this.eventHandler.emitEvent(fs.SSO_SILENT_SUCCESS,t.InteractionType.Silent,e),this.ssoSilentMeasurement?.end({success:!0,accessTokenSize:e.accessToken.length,idTokenSize:e.idToken.length},void 0,e.account),e)).catch(n=>{throw this.eventHandler.emitEvent(fs.SSO_SILENT_FAILURE,t.InteractionType.Silent,null,n),this.ssoSilentMeasurement?.end({success:!1},n,e.account),n}).finally(()=>{document.removeEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement)})}async acquireTokenByCode(e){const n=this.getRequestCorrelationId(e);this.logger.trace("acquireTokenByCode called",n);const r=this.performanceClient.startMeasurement(Gt.AcquireTokenByCode,n);vc(this.initialized,r),this.eventHandler.emitEvent(fs.ACQUIRE_TOKEN_BY_CODE_START,t.InteractionType.Silent,e),r.add({scenarioId:e.scenarioId});try{if(e.code&&e.nativeAccountId)throw ai(Fo);if(e.code){const o=e.code;let i=this.hybridAuthCodeResponses.get(o);return i?(this.logger.verbose("Existing acquireTokenByCode request found",n),r.discard()):(this.logger.verbose("Initiating new acquireTokenByCode request",n),i=this.acquireTokenByCodeAsync({...e,correlationId:n}).then(e=>(this.eventHandler.emitEvent(fs.ACQUIRE_TOKEN_BY_CODE_SUCCESS,t.InteractionType.Silent,e),this.hybridAuthCodeResponses.delete(o),r.end({success:!0,accessTokenSize:e.accessToken.length,idTokenSize:e.idToken.length},void 0,e.account),e)).catch(e=>{throw this.hybridAuthCodeResponses.delete(o),this.eventHandler.emitEvent(fs.ACQUIRE_TOKEN_BY_CODE_FAILURE,t.InteractionType.Silent,null,e),r.end({success:!1},e),e}),this.hybridAuthCodeResponses.set(o,i)),await i}if(e.nativeAccountId){if(this.canUsePlatformBroker(e,e.nativeAccountId)){r.add({isPlatformBrokerRequest:!0});const t=await this.acquireTokenNative({...e,correlationId:n},Si.acquireTokenByCode,e.nativeAccountId).catch(e=>{throw e instanceof Us&&Ds(e)&&(this.platformAuthProvider=void 0),r.add({brokerErrorName:e.name,brokerErrorCode:e.errorCode}),e});return r.end({success:!0},void 0,t.account),t}throw ai(Ko)}throw ai(Ho)}catch(e){throw this.eventHandler.emitEvent(fs.ACQUIRE_TOKEN_BY_CODE_FAILURE,t.InteractionType.Silent,null,e),r.end({success:!1},e),e}}async acquireTokenByCodeAsync(e){this.logger.trace("acquireTokenByCodeAsync called",e.correlationId),this.acquireTokenByCodeAsyncMeasurement=this.performanceClient.startMeasurement(Gt.AcquireTokenByCodeAsync,e.correlationId),this.acquireTokenByCodeAsyncMeasurement?.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement);const t=this.createSilentAuthCodeClient(e.correlationId);return await t.acquireToken(e).then(e=>(this.acquireTokenByCodeAsyncMeasurement?.end({success:!0,fromCache:e.fromCache}),e)).catch(e=>{throw this.acquireTokenByCodeAsyncMeasurement?.end({success:!1},e),e}).finally(()=>{document.removeEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement)})}async acquireTokenFromCache(e,t){switch(this.performanceClient.addQueueMeasurement(Gt.AcquireTokenFromCache,e.correlationId),t){case Mi.Default:case Mi.AccessToken:case Mi.AccessTokenAndRefreshToken:const t=this.createSilentCacheClient(e.correlationId);return jn(t.acquireToken.bind(t),Gt.SilentCacheClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(e);default:throw Ne(ye)}}async acquireTokenByRefreshToken(e,t){switch(this.performanceClient.addQueueMeasurement(Gt.AcquireTokenByRefreshToken,e.correlationId),t){case Mi.Default:case Mi.AccessTokenAndRefreshToken:case Mi.RefreshToken:case Mi.RefreshTokenAndNetwork:const t=this.createSilentRefreshClient(e.correlationId);return jn(t.acquireToken.bind(t),Gt.SilentRefreshClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(e);default:throw Ne(ye)}}async acquireTokenBySilentIframe(e){this.performanceClient.addQueueMeasurement(Gt.AcquireTokenBySilentIframe,e.correlationId);const t=this.createSilentIframeClient(e.correlationId);return jn(t.acquireToken.bind(t),Gt.SilentIframeClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(e)}async logout(e){const t=this.getRequestCorrelationId(e);return this.logger.warning("logout API is deprecated and will be removed in msal-browser v3.0.0. Use logoutRedirect instead.",t),this.logoutRedirect({correlationId:t,...e})}async logoutRedirect(e){const t=this.getRequestCorrelationId(e);return Ea(this.initialized,this.config),this.browserStorage.setInteractionInProgress(!0,mi),this.createRedirectClient(t).logout(e)}logoutPopup(e){try{const t=this.getRequestCorrelationId(e);return Ra(this.initialized),this.browserStorage.setInteractionInProgress(!0,mi),this.createPopupClient(t).logout(e).finally(()=>{this.browserStorage.setInteractionInProgress(!1)})}catch(e){return Promise.reject(e)}}async clearCache(e){if(!this.isBrowserEnvironment)return void this.logger.info("in non-browser environment, returning early.");const t=this.getRequestCorrelationId(e);return this.createSilentCacheClient(t).logout(e)}getAllAccounts(e){const t=this.getRequestCorrelationId();return ws(this.logger,this.browserStorage,this.isBrowserEnvironment,t,e)}getAccount(e){const t=this.getRequestCorrelationId();return Is(e,this.logger,this.browserStorage,t)}getAccountByUsername(e){const t=this.getRequestCorrelationId();return Ts(e,this.logger,this.browserStorage,t)}getAccountByHomeId(e){const t=this.getRequestCorrelationId();return As(e,this.logger,this.browserStorage,t)}getAccountByLocalId(e){const t=this.getRequestCorrelationId();return ks(e,this.logger,this.browserStorage,t)}setActiveAccount(e){const t=this.getRequestCorrelationId();Ss(e,this.browserStorage,t)}getActiveAccount(){const e=this.getRequestCorrelationId();return bs(this.browserStorage,e)}async hydrateCache(e,t){this.logger.verbose("hydrateCache called");const n=At.createFromAccountInfo(e.account,e.cloudGraphHostName,e.msGraphHost);return await this.browserStorage.setAccount(n,e.correlationId,St(e.idTokenClaims)),e.fromNativeBroker?(this.logger.verbose("Response was from native broker, storing in-memory"),this.nativeInternalStorage.hydrateCache(e,t)):this.browserStorage.hydrateCache(e,t)}async acquireTokenNative(e,t,n,r){if(this.logger.trace("acquireTokenNative called"),!this.platformAuthProvider)throw ai(jo);return new Fs(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,t,this.performanceClient,this.platformAuthProvider,n||this.getNativeAccountId(e),this.nativeInternalStorage,e.correlationId).acquireToken(e,r)}canUsePlatformBroker(e,t){if(this.logger.trace("canUsePlatformBroker called"),!this.platformAuthProvider)return this.logger.trace("canUsePlatformBroker: platform broker unavilable, returning false"),!1;if(!nc(this.config,this.logger,this.platformAuthProvider,e.authenticationScheme))return this.logger.trace("canUsePlatformBroker: isBrokerAvailable returned false, returning false"),!1;if(e.prompt)switch(e.prompt){case m.NONE:case m.CONSENT:case m.LOGIN:case m.SELECT_ACCOUNT:this.logger.trace("canUsePlatformBroker: prompt is compatible with platform broker flow");break;default:return this.logger.trace(`canUsePlatformBroker: prompt = ${e.prompt} is not compatible with platform broker flow, returning false`),!1}return!(!t&&!this.getNativeAccountId(e)&&(this.logger.trace("canUsePlatformBroker: nativeAccountId is not available, returning false"),1))}getNativeAccountId(e){const t=e.account||this.getAccount({loginHint:e.loginHint,sid:e.sid})||this.getActiveAccount();return t&&t.nativeAccountId||""}createPopupClient(e){return new rc(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,this.platformAuthProvider,e)}createRedirectClient(e){return new oc(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,this.platformAuthProvider,e)}createSilentIframeClient(e){return new gc(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,Si.ssoSilent,this.performanceClient,this.nativeInternalStorage,this.platformAuthProvider,e)}createSilentCacheClient(e){return new Hs(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.platformAuthProvider,e)}createSilentRefreshClient(e){return new pc(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.platformAuthProvider,e)}createSilentAuthCodeClient(e){return new yc(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,Si.acquireTokenByCode,this.performanceClient,this.platformAuthProvider,e)}addEventCallback(e,t){return this.eventHandler.addEventCallback(e,t)}removeEventCallback(e){this.eventHandler.removeEventCallback(e)}addPerformanceCallback(e){return Sa(),this.performanceClient.addPerformanceCallback(e)}removePerformanceCallback(e){return this.performanceClient.removePerformanceCallback(e)}enableAccountStorageEvents(){this.config.cache.cacheLocation===pi.LocalStorage?this.eventHandler.subscribeCrossTab():this.logger.info("Account storage events are only available when cacheLocation is set to localStorage")}disableAccountStorageEvents(){this.config.cache.cacheLocation===pi.LocalStorage?this.eventHandler.unsubscribeCrossTab():this.logger.info("Account storage events are only available when cacheLocation is set to localStorage")}getTokenCache(){return this.tokenCache}getLogger(){return this.logger}setLogger(e){this.logger=e}initializeWrapperLibrary(e,t){this.browserStorage.setWrapperMetadata(e,t)}setNavigationClient(e){this.navigationClient=e}getConfiguration(){return this.config}getPerformanceClient(){return this.performanceClient}isBrowserEnv(){return this.isBrowserEnvironment}getRequestCorrelationId(e){return e?.correlationId?e.correlationId:this.isBrowserEnvironment?Xi():n.EMPTY_STRING}async loginRedirect(e){const t=this.getRequestCorrelationId(e);return this.logger.verbose("loginRedirect called",t),this.acquireTokenRedirect({correlationId:t,...e||Ei})}loginPopup(e){const t=this.getRequestCorrelationId(e);return this.logger.verbose("loginPopup called",t),this.acquireTokenPopup({correlationId:t,...e||Ei})}async acquireTokenSilent(e){const t=this.getRequestCorrelationId(e),n=this.performanceClient.startMeasurement(Gt.AcquireTokenSilent,t);n.add({cacheLookupPolicy:e.cacheLookupPolicy,scenarioId:e.scenarioId}),vc(this.initialized,n,e.account),this.logger.verbose("acquireTokenSilent called",t);const r=e.account||this.getActiveAccount();if(!r)throw ai(So);return this.acquireTokenSilentDeduped(e,r,t).then(r=>(n.end({success:!0,fromCache:r.fromCache,accessTokenSize:r.accessToken.length,idTokenSize:r.idToken.length},void 0,r.account),{...r,state:e.state,correlationId:t})).catch(e=>{throw e instanceof U&&e.setCorrelationId(t),n.end({success:!1},e,r),e})}async acquireTokenSilentDeduped(e,t,n){const r=fr(this.config.auth.clientId,{...e,authority:e.authority||this.config.auth.authority},t.homeAccountId),o=JSON.stringify(r),i=this.activeSilentTokenRequests.get(o);if(void 0===i){this.logger.verbose("acquireTokenSilent called for the first time, storing active request",n),this.performanceClient.addFields({deduped:!1},n);const r=jn(this.acquireTokenSilentAsync.bind(this),Gt.AcquireTokenSilentAsync,this.logger,this.performanceClient,n)({...e,correlationId:n},t);return this.activeSilentTokenRequests.set(o,r),r.finally(()=>{this.activeSilentTokenRequests.delete(o)})}return this.logger.verbose("acquireTokenSilent has been called previously, returning the result from the first call",n),this.performanceClient.addFields({deduped:!0},n),i}async acquireTokenSilentAsync(e,n){const r=()=>this.trackPageVisibility(e.correlationId);this.performanceClient.addQueueMeasurement(Gt.AcquireTokenSilentAsync,e.correlationId),this.eventHandler.emitEvent(fs.ACQUIRE_TOKEN_START,t.InteractionType.Silent,e),e.correlationId&&this.performanceClient.incrementFields({visibilityChangeCount:0},e.correlationId),document.addEventListener("visibilitychange",r);const o=await jn(_s,Gt.InitializeSilentRequest,this.logger,this.performanceClient,e.correlationId)(e,n,this.config,this.performanceClient,this.logger),i=e.cacheLookupPolicy||Mi.Default;return this.acquireTokenSilentNoIframe(o,i).catch(async e=>{const t=function(e,t){const n=!(e instanceof Nr&&e.subError!==Rr),r=e.errorCode===si||e.errorCode===ye,o=n&&r||e.errorCode===wr||e.errorCode===Tr,i=Oi.includes(t);return o&&i}(e,i);if(t){if(this.activeIframeRequest){if(i!==Mi.Skip){const[t,n]=this.activeIframeRequest;this.logger.verbose(`Iframe request is already in progress, awaiting resolution for request with correlationId: ${n}`,o.correlationId);const r=this.performanceClient.startMeasurement(Gt.AwaitConcurrentIframe,o.correlationId);r.add({awaitIframeCorrelationId:n});const a=await t;if(r.end({success:a}),a)return this.logger.verbose(`Parallel iframe request with correlationId: ${n} succeeded. Retrying cache and/or RT redemption`,o.correlationId),this.acquireTokenSilentNoIframe(o,i);throw this.logger.info(`Iframe request with correlationId: ${n} failed. Interaction is required.`),e}return this.logger.warning("Another iframe request is currently in progress and CacheLookupPolicy is set to Skip. This may result in degraded performance and/or reliability for both calls. Please consider changing the CacheLookupPolicy to take advantage of request queuing and token cache.",o.correlationId),jn(this.acquireTokenBySilentIframe.bind(this),Gt.AcquireTokenBySilentIframe,this.logger,this.performanceClient,o.correlationId)(o)}{let e;return this.activeIframeRequest=[new Promise(t=>{e=t}),o.correlationId],this.logger.verbose("Refresh token expired/invalid or CacheLookupPolicy is set to Skip, attempting acquire token by iframe.",o.correlationId),jn(this.acquireTokenBySilentIframe.bind(this),Gt.AcquireTokenBySilentIframe,this.logger,this.performanceClient,o.correlationId)(o).then(t=>(e(!0),t)).catch(t=>{throw e(!1),t}).finally(()=>{this.activeIframeRequest=void 0})}}throw e}).then(n=>(this.eventHandler.emitEvent(fs.ACQUIRE_TOKEN_SUCCESS,t.InteractionType.Silent,n),this.performanceClient.addFields({fromCache:n.fromCache},e.correlationId),n)).catch(e=>{throw this.eventHandler.emitEvent(fs.ACQUIRE_TOKEN_FAILURE,t.InteractionType.Silent,null,e),e}).finally(()=>{document.removeEventListener("visibilitychange",r)})}async acquireTokenSilentNoIframe(e,n){return nc(this.config,this.logger,this.platformAuthProvider,e.authenticationScheme)&&e.account.nativeAccountId?(this.logger.verbose("acquireTokenSilent - attempting to acquire token from native platform"),this.performanceClient.addFields({isPlatformBrokerRequest:!0},e.correlationId),this.acquireTokenNative(e,Si.acquireTokenSilent_silentFlow,e.account.nativeAccountId,n).catch(async t=>{if(this.performanceClient.addFields({brokerErrorName:t.name,brokerErrorCode:t.errorCode},e.correlationId),t instanceof Us&&Ds(t))throw this.logger.verbose("acquireTokenSilent - native platform unavailable, falling back to web flow"),this.platformAuthProvider=void 0,Ne(ye);throw t})):(this.logger.verbose("acquireTokenSilent - attempting to acquire token from web flow"),n===Mi.AccessToken&&this.logger.verbose("acquireTokenSilent - cache lookup policy set to AccessToken, attempting to acquire token from local cache"),jn(this.acquireTokenFromCache.bind(this),Gt.AcquireTokenFromCache,this.logger,this.performanceClient,e.correlationId)(e,n).catch(r=>{if(n===Mi.AccessToken)throw r;return this.eventHandler.emitEvent(fs.ACQUIRE_TOKEN_NETWORK_START,t.InteractionType.Silent,e),jn(this.acquireTokenByRefreshToken.bind(this),Gt.AcquireTokenByRefreshToken,this.logger,this.performanceClient,e.correlationId)(e,n)}))}async preGeneratePkceCodes(e){return this.logger.verbose("Generating new PKCE codes"),this.pkceCode=await jn(Js,Gt.GeneratePkceCodes,this.logger,this.performanceClient,e)(this.performanceClient,this.logger,e),Promise.resolve()}getPreGeneratedPkceCodes(e){this.logger.verbose("Attempting to pick up pre-generated PKCE codes");const t=this.pkceCode?{...this.pkceCode}:void 0;return this.pkceCode=void 0,this.logger.verbose((t?"Found":"Did not find")+" pre-generated PKCE codes"),this.performanceClient.addFields({usePreGeneratedPkce:!!t},e),t}logMultipleInstances(e){const t=this.config.auth.clientId;window&&(window.msal=window.msal||{},window.msal.clientIds=window.msal.clientIds||[],window.msal.clientIds.length>0&&this.logger.verbose("There is already an instance of MSAL.js in the window."),window.msal.clientIds.push(t),function(e,t,n){const r=window.msal?.clientIds||[],o=r.length,i=r.filter(t=>t===e).length;i>1&&n.warning("There is already an instance of MSAL.js in the window with the same client id."),t.add({msalInstanceCount:o,sameClientIdInstanceCount:i})}(t,e,this.logger))}}class wc{constructor(e,t,n,r){this.clientId=e,this.clientCapabilities=t,this.crypto=n,this.logger=r}toNaaTokenRequest(e){let t;t=void 0===e.extraQueryParameters?new Map:new Map(Object.entries(e.extraQueryParameters));const n=e.correlationId||this.crypto.createNewGuid(),r=Bn(e.claims,this.clientCapabilities),i=e.scopes||o;return{platformBrokerId:e.account?.homeAccountId,clientId:this.clientId,authority:e.authority,scope:i.join(" "),correlationId:n,claims:pt.isEmptyObj(r)?void 0:r,state:e.state,authenticationScheme:e.authenticationScheme||P.BEARER,extraParameters:t}}fromNaaTokenResponse(e,t,n){if(!t.token.id_token||!t.token.access_token)throw Ne(z);const r=Jn(n+(t.token.expires_in||0)),o=kt(t.token.id_token,this.crypto.base64Decode),i=this.fromNaaAccountInfo(t.account,t.token.id_token,o),a=t.token.scope||e.scope;return{authority:t.token.authority||i.environment,uniqueId:i.localAccountId,tenantId:i.tenantId,scopes:a.split(" "),account:i,idToken:t.token.id_token,idTokenClaims:o,accessToken:t.token.access_token,fromCache:!1,expiresOn:r,tokenType:e.authenticationScheme||P.BEARER,correlationId:e.correlationId,extExpiresOn:r,state:e.state}}fromNaaAccountInfo(e,t,n){const r=n||e.idTokenClaims,o=e.localAccountId||r?.oid||r?.sub||"",i=e.tenantId||r?.tid||"",a=e.homeAccountId||`${o}.${i}`,s=e.username||r?.preferred_username||"",c=e.name||r?.name,l=e.loginHint||r?.login_hint,u=new Map,d=Ct(a,o,i,r);return u.set(i,d),{homeAccountId:a,environment:e.environment,tenantId:i,username:s,localAccountId:o,name:c,loginHint:l,idToken:t,idTokenClaims:r,tenantProfiles:u}}fromBridgeError(e){if(!function(e){return void 0!==e.status}(e))return new U("unknown_error","An unknown error occurred");switch(e.status){case"USER_CANCEL":return new Oe(Se);case"NO_NETWORK":return new Oe(ke);case"ACCOUNT_UNAVAILABLE":return new Oe(he);case"DISABLED":return new Oe(Ee);case Xa:return new Oe(e.code||Ee,e.description);case"TRANSIENT_ERROR":case"PERSISTENT_ERROR":return new pr(e.code,e.description);case"USER_INTERACTION_REQUIRED":return new Nr(e.code,e.description);default:return new U(e.code,e.description)}}toAuthenticationResultFromCache(e,t,n,r,o){if(!t||!n)throw Ne(z);const i=kt(t.secret,this.crypto.base64Decode),a=n.target||r.scopes.join(" ");return{authority:n.environment||e.environment,uniqueId:e.localAccountId,tenantId:e.tenantId,scopes:a.split(" "),account:e,idToken:t.secret,idTokenClaims:i||{},accessToken:n.secret,fromCache:!0,expiresOn:Jn(n.expiresOn),extExpiresOn:Jn(n.extendedExpiresOn),tokenType:r.authenticationScheme||P.BEARER,correlationId:o,state:r.state}}}class Ic extends U{constructor(e,t){super(e,t),Object.setPrototypeOf(this,Ic.prototype),this.name="NestedAppAuthError"}static createUnsupportedError(){return new Ic("unsupported_method","This method is not supported in nested app environment.")}}class Tc{constructor(e){this.operatingContext=e;const t=this.operatingContext.getBridgeProxy();if(void 0===t)throw new Error("unexpected: bridgeProxy is undefined");this.bridgeProxy=t,this.config=e.getConfig(),this.logger=this.operatingContext.getLogger(),this.performanceClient=this.config.telemetry.client,this.browserCrypto=e.isBrowserEnvironment()?new is(this.logger,this.performanceClient,!0):qe,this.eventHandler=new Rs(this.logger),this.browserStorage=this.operatingContext.isBrowserEnvironment()?new ys(this.config.auth.clientId,this.config.cache,this.browserCrypto,this.logger,this.performanceClient,this.eventHandler,hr(this.config.auth)):Cs(this.config.auth.clientId,this.logger,this.performanceClient,this.eventHandler),this.nestedAppAuthAdapter=new wc(this.config.auth.clientId,this.config.auth.clientCapabilities,this.browserCrypto,this.logger);const n=this.bridgeProxy.getAccountContext();this.currentAccountContext=n||null}static async createController(e){const t=new Tc(e);return Promise.resolve(t)}async initialize(e,t){const n=e?.correlationId||Xi();return await this.browserStorage.initialize(n),Promise.resolve()}ensureValidRequest(e){return e?.correlationId?e:{...e,correlationId:this.browserCrypto.createNewGuid()}}async acquireTokenInteractive(e){const n=this.ensureValidRequest(e);this.eventHandler.emitEvent(fs.ACQUIRE_TOKEN_START,t.InteractionType.Popup,n);const r=this.performanceClient.startMeasurement(Gt.AcquireTokenPopup,n.correlationId);r.add({nestedAppAuthRequest:!0});try{const o=this.nestedAppAuthAdapter.toNaaTokenRequest(n),i=Vn(),a=await this.bridgeProxy.getTokenInteractive(o),s={...this.nestedAppAuthAdapter.fromNaaTokenResponse(o,a,i)};try{await this.hydrateCache(s,e)}catch(e){this.logger.warningPii(`Failed to hydrate cache. Error: ${e}`,n.correlationId)}return this.currentAccountContext={homeAccountId:s.account.homeAccountId,environment:s.account.environment,tenantId:s.account.tenantId},this.eventHandler.emitEvent(fs.ACQUIRE_TOKEN_SUCCESS,t.InteractionType.Popup,s),r.add({accessTokenSize:s.accessToken.length,idTokenSize:s.idToken.length}),r.end({success:!0,requestId:s.requestId},void 0,s.account),s}catch(n){const o=n instanceof U?n:this.nestedAppAuthAdapter.fromBridgeError(n);throw this.eventHandler.emitEvent(fs.ACQUIRE_TOKEN_FAILURE,t.InteractionType.Popup,null,n),r.end({success:!1},n,e.account),o}}async acquireTokenSilentInternal(e){const n=this.ensureValidRequest(e);this.eventHandler.emitEvent(fs.ACQUIRE_TOKEN_START,t.InteractionType.Silent,n);const r=await this.acquireTokenFromCache(n);if(r)return this.eventHandler.emitEvent(fs.ACQUIRE_TOKEN_SUCCESS,t.InteractionType.Silent,r),r;const o=this.performanceClient.startMeasurement(Gt.SsoSilent,n.correlationId);o.increment({visibilityChangeCount:0}),o.add({nestedAppAuthRequest:!0});try{const r=this.nestedAppAuthAdapter.toNaaTokenRequest(n);r.forceRefresh=n.forceRefresh;const i=Vn(),a=await this.bridgeProxy.getTokenSilent(r),s=this.nestedAppAuthAdapter.fromNaaTokenResponse(r,a,i);try{await this.hydrateCache(s,e)}catch(e){this.logger.warningPii(`Failed to hydrate cache. Error: ${e}`,n.correlationId)}return this.currentAccountContext={homeAccountId:s.account.homeAccountId,environment:s.account.environment,tenantId:s.account.tenantId},this.eventHandler.emitEvent(fs.ACQUIRE_TOKEN_SUCCESS,t.InteractionType.Silent,s),o?.add({accessTokenSize:s.accessToken.length,idTokenSize:s.idToken.length}),o?.end({success:!0,requestId:s.requestId},void 0,s.account),s}catch(n){const r=n instanceof U?n:this.nestedAppAuthAdapter.fromBridgeError(n);throw this.eventHandler.emitEvent(fs.ACQUIRE_TOKEN_FAILURE,t.InteractionType.Silent,null,n),o?.end({success:!1},n,e.account),r}}async acquireTokenFromCache(e){const n=this.performanceClient.startMeasurement(Gt.AcquireTokenSilent,e.correlationId);if(n?.add({nestedAppAuthRequest:!0}),e.claims)return this.logger.verbose("Claims are present in the request, skipping cache lookup"),null;if(e.forceRefresh)return this.logger.verbose("forceRefresh is set to true, skipping cache lookup"),null;let r=null;switch(e.cacheLookupPolicy||(e.cacheLookupPolicy=Mi.Default),e.cacheLookupPolicy){case Mi.Default:case Mi.AccessToken:case Mi.AccessTokenAndRefreshToken:r=await this.acquireTokenFromCacheInternal(e);break;default:return null}return r?(this.eventHandler.emitEvent(fs.ACQUIRE_TOKEN_SUCCESS,t.InteractionType.Silent,r),n.add({accessTokenSize:r.accessToken.length,idTokenSize:r.idToken.length}),n.end({success:!0},void 0,r.account),r):(this.logger.warning("Cached tokens are not found for the account, proceeding with silent token request."),this.eventHandler.emitEvent(fs.ACQUIRE_TOKEN_FAILURE,t.InteractionType.Silent,null),n.end({success:!1},void 0,e.account),null)}async acquireTokenFromCacheInternal(e){const t=this.bridgeProxy.getAccountContext()||this.currentAccountContext;let n=null;const r=e.correlationId||this.browserCrypto.createNewGuid();if(t&&(n=Is(t,this.logger,this.browserStorage,r)),!n)return this.logger.verbose("No active account found, falling back to the host"),Promise.resolve(null);this.logger.verbose("active account found, attempting to acquire token silently");const i={...e,correlationId:e.correlationId||this.browserCrypto.createNewGuid(),authority:e.authority||n.environment,scopes:e.scopes?.length?e.scopes:[...o]},a=this.browserStorage.getTokenKeys(),s=this.browserStorage.getAccessToken(n,i,a,n.tenantId);if(!s)return this.logger.verbose("No cached access token found"),Promise.resolve(null);if(Zn(s.cachedAt)||Yn(s.expiresOn,this.config.system.tokenRenewalOffsetSeconds))return this.logger.verbose("Cached access token has expired"),Promise.resolve(null);const c=this.browserStorage.getIdToken(n,i.correlationId,a,n.tenantId,this.performanceClient);return c?this.nestedAppAuthAdapter.toAuthenticationResultFromCache(n,c,s,i,i.correlationId):(this.logger.verbose("No cached id token found"),Promise.resolve(null))}async acquireTokenPopup(e){return this.acquireTokenInteractive(e)}acquireTokenRedirect(e){throw Ic.createUnsupportedError()}async acquireTokenSilent(e){return this.acquireTokenSilentInternal(e)}acquireTokenByCode(e){throw Ic.createUnsupportedError()}acquireTokenNative(e,t,n){throw Ic.createUnsupportedError()}acquireTokenByRefreshToken(e,t){throw Ic.createUnsupportedError()}addEventCallback(e,t){return this.eventHandler.addEventCallback(e,t)}removeEventCallback(e){this.eventHandler.removeEventCallback(e)}addPerformanceCallback(e){throw Ic.createUnsupportedError()}removePerformanceCallback(e){throw Ic.createUnsupportedError()}enableAccountStorageEvents(){throw Ic.createUnsupportedError()}disableAccountStorageEvents(){throw Ic.createUnsupportedError()}getAllAccounts(e){const t=this.browserCrypto.createNewGuid();return ws(this.logger,this.browserStorage,this.isBrowserEnv(),t,e)}getAccount(e){const t=this.browserCrypto.createNewGuid();return Is(e,this.logger,this.browserStorage,t)}getAccountByUsername(e){const t=this.browserCrypto.createNewGuid();return Ts(e,this.logger,this.browserStorage,t)}getAccountByHomeId(e){const t=this.browserCrypto.createNewGuid();return As(e,this.logger,this.browserStorage,t)}getAccountByLocalId(e){const t=this.browserCrypto.createNewGuid();return ks(e,this.logger,this.browserStorage,t)}setActiveAccount(e){const t=this.browserCrypto.createNewGuid();return Ss(e,this.browserStorage,t)}getActiveAccount(){const e=this.browserCrypto.createNewGuid();return bs(this.browserStorage,e)}handleRedirectPromise(e){return Promise.resolve(null)}loginPopup(e){return this.acquireTokenInteractive(e||Ei)}loginRedirect(e){throw Ic.createUnsupportedError()}logout(e){throw Ic.createUnsupportedError()}logoutRedirect(e){throw Ic.createUnsupportedError()}logoutPopup(e){throw Ic.createUnsupportedError()}ssoSilent(e){return this.acquireTokenSilentInternal(e)}getTokenCache(){throw Ic.createUnsupportedError()}getLogger(){return this.logger}setLogger(e){this.logger=e}initializeWrapperLibrary(e,t){}setNavigationClient(e){this.logger.warning("setNavigationClient is not supported in nested app auth")}getConfiguration(){return this.config}isBrowserEnv(){return this.operatingContext.isBrowserEnvironment()}getBrowserCrypto(){return this.browserCrypto}getPerformanceClient(){throw Ic.createUnsupportedError()}getRedirectResponse(){throw Ic.createUnsupportedError()}async clearCache(e){throw Ic.createUnsupportedError()}async hydrateCache(e,t){this.logger.verbose("hydrateCache called");const n=At.createFromAccountInfo(e.account,e.cloudGraphHostName,e.msGraphHost);return await this.browserStorage.setAccount(n,e.correlationId,St(e.idTokenClaims)),this.browserStorage.hydrateCache(e,t)}}async function Ac(e){const t=new ts(e),n=new es(e),r=[t.initialize(),n.initialize()];return await Promise.all(r),n.isAvailable()&&e.auth.supportsNestedAppAuth?Tc.createController(n):t.isAvailable()?Cc.createController(t):null}class kc{static async createPublicClientApplication(e){const t=await async function(e){const t=new ts(e);return await t.initialize(),Cc.createController(t,void 0)}(e);return new kc(e,t)}constructor(e,t){this.isBroker=!1,this.controller=t||new Cc(new ts(e))}async initialize(e){return this.controller.initialize(e,this.isBroker)}async acquireTokenPopup(e){return this.controller.acquireTokenPopup(e)}acquireTokenRedirect(e){return this.controller.acquireTokenRedirect(e)}acquireTokenSilent(e){return this.controller.acquireTokenSilent(e)}acquireTokenByCode(e){return this.controller.acquireTokenByCode(e)}addEventCallback(e,t){return this.controller.addEventCallback(e,t)}removeEventCallback(e){return this.controller.removeEventCallback(e)}addPerformanceCallback(e){return this.controller.addPerformanceCallback(e)}removePerformanceCallback(e){return this.controller.removePerformanceCallback(e)}enableAccountStorageEvents(){this.controller.enableAccountStorageEvents()}disableAccountStorageEvents(){this.controller.disableAccountStorageEvents()}getAccount(e){return this.controller.getAccount(e)}getAccountByHomeId(e){return this.controller.getAccountByHomeId(e)}getAccountByLocalId(e){return this.controller.getAccountByLocalId(e)}getAccountByUsername(e){return this.controller.getAccountByUsername(e)}getAllAccounts(e){return this.controller.getAllAccounts(e)}handleRedirectPromise(e){return this.controller.handleRedirectPromise(e)}loginPopup(e){return this.controller.loginPopup(e)}loginRedirect(e){return this.controller.loginRedirect(e)}logout(e){return this.controller.logout(e)}logoutRedirect(e){return this.controller.logoutRedirect(e)}logoutPopup(e){return this.controller.logoutPopup(e)}ssoSilent(e){return this.controller.ssoSilent(e)}getTokenCache(){return this.controller.getTokenCache()}getLogger(){return this.controller.getLogger()}setLogger(e){this.controller.setLogger(e)}setActiveAccount(e){this.controller.setActiveAccount(e)}getActiveAccount(){return this.controller.getActiveAccount()}initializeWrapperLibrary(e,t){return this.controller.initializeWrapperLibrary(e,t)}setNavigationClient(e){this.controller.setNavigationClient(e)}getConfiguration(){return this.controller.getConfiguration()}async hydrateCache(e,t){return this.controller.hydrateCache(e,t)}clearCache(e){return this.controller.clearCache(e)}}async function Sc(e){const t=new kc(e);return await t.initialize(),t}class bc{constructor(e){this.initialized=!1,this.operatingContext=e,this.isBrowserEnvironment=this.operatingContext.isBrowserEnvironment(),this.config=e.getConfig(),this.logger=e.getLogger(),this.performanceClient=this.config.telemetry.client,this.browserCrypto=this.isBrowserEnvironment?new is(this.logger,this.performanceClient):qe,this.eventHandler=new Rs(this.logger),this.browserStorage=this.isBrowserEnvironment?new ys(this.config.auth.clientId,this.config.cache,this.browserCrypto,this.logger,this.performanceClient,this.eventHandler,void 0):Cs(this.config.auth.clientId,this.logger,this.performanceClient,this.eventHandler)}getBrowserStorage(){return this.browserStorage}getAccount(e){return null}getAccountByHomeId(e){return null}getAccountByLocalId(e){return null}getAccountByUsername(e){return null}getAllAccounts(){return[]}initialize(){return this.initialized=!0,Promise.resolve()}acquireTokenPopup(e){return ba(this.initialized),Sa(),{}}acquireTokenRedirect(e){return ba(this.initialized),Sa(),Promise.resolve()}acquireTokenSilent(e){return ba(this.initialized),Sa(),{}}acquireTokenByCode(e){return ba(this.initialized),Sa(),{}}acquireTokenNative(e,t,n){return ba(this.initialized),Sa(),{}}acquireTokenByRefreshToken(e,t){return ba(this.initialized),Sa(),{}}addEventCallback(e,t){return null}removeEventCallback(e){}addPerformanceCallback(e){return ba(this.initialized),Sa(),""}removePerformanceCallback(e){return ba(this.initialized),Sa(),!0}enableAccountStorageEvents(){ba(this.initialized),Sa()}disableAccountStorageEvents(){ba(this.initialized),Sa()}handleRedirectPromise(e){return ba(this.initialized),Promise.resolve(null)}loginPopup(e){return ba(this.initialized),Sa(),{}}loginRedirect(e){return ba(this.initialized),Sa(),{}}logout(e){return ba(this.initialized),Sa(),{}}logoutRedirect(e){return ba(this.initialized),Sa(),{}}logoutPopup(e){return ba(this.initialized),Sa(),{}}ssoSilent(e){return ba(this.initialized),Sa(),{}}getTokenCache(){return ba(this.initialized),Sa(),{}}getLogger(){return this.logger}setLogger(e){ba(this.initialized),Sa()}setActiveAccount(e){ba(this.initialized),Sa()}getActiveAccount(){return ba(this.initialized),Sa(),null}initializeWrapperLibrary(e,t){this.browserStorage.setWrapperMetadata(e,t)}setNavigationClient(e){ba(this.initialized),Sa()}getConfiguration(){return this.config}isBrowserEnv(){return ba(this.initialized),Sa(),!0}getBrowserCrypto(){return ba(this.initialized),Sa(),{}}getPerformanceClient(){return ba(this.initialized),Sa(),{}}getRedirectResponse(){return ba(this.initialized),Sa(),{}}async clearCache(e){ba(this.initialized),Sa()}async hydrateCache(e,t){ba(this.initialized),Sa()}}class Rc extends Ya{getId(){return Rc.ID}getModuleName(){return Rc.MODULE_NAME}async initialize(){return!0}}Rc.MODULE_NAME="",Rc.ID="UnknownOperatingContext";class Ec{static async createPublicClientApplication(e){const t=await Ac(e);let n;return n=null!==t?new Ec(e,t):new Ec(e),n}constructor(e,t){if(this.configuration=e,t)this.controller=t;else{const t=new Rc(e);this.controller=new bc(t)}}async initialize(){if(this.controller instanceof bc){const e=await Ac(this.configuration);return null!==e&&(this.controller=e),this.controller.initialize()}return Promise.resolve()}async acquireTokenPopup(e){return this.controller.acquireTokenPopup(e)}acquireTokenRedirect(e){return this.controller.acquireTokenRedirect(e)}acquireTokenSilent(e){return this.controller.acquireTokenSilent(e)}acquireTokenByCode(e){return this.controller.acquireTokenByCode(e)}addEventCallback(e,t){return this.controller.addEventCallback(e,t)}removeEventCallback(e){return this.controller.removeEventCallback(e)}addPerformanceCallback(e){return this.controller.addPerformanceCallback(e)}removePerformanceCallback(e){return this.controller.removePerformanceCallback(e)}enableAccountStorageEvents(){this.controller.enableAccountStorageEvents()}disableAccountStorageEvents(){this.controller.disableAccountStorageEvents()}getAccount(e){return this.controller.getAccount(e)}getAccountByHomeId(e){return this.controller.getAccountByHomeId(e)}getAccountByLocalId(e){return this.controller.getAccountByLocalId(e)}getAccountByUsername(e){return this.controller.getAccountByUsername(e)}getAllAccounts(e){return this.controller.getAllAccounts(e)}handleRedirectPromise(e){return this.controller.handleRedirectPromise(e)}loginPopup(e){return this.controller.loginPopup(e)}loginRedirect(e){return this.controller.loginRedirect(e)}logout(e){return this.controller.logout(e)}logoutRedirect(e){return this.controller.logoutRedirect(e)}logoutPopup(e){return this.controller.logoutPopup(e)}ssoSilent(e){return this.controller.ssoSilent(e)}getTokenCache(){return this.controller.getTokenCache()}getLogger(){return this.controller.getLogger()}setLogger(e){this.controller.setLogger(e)}setActiveAccount(e){this.controller.setActiveAccount(e)}getActiveAccount(){return this.controller.getActiveAccount()}initializeWrapperLibrary(e,t){return this.controller.initializeWrapperLibrary(e,t)}setNavigationClient(e){this.controller.setNavigationClient(e)}getConfiguration(){return this.controller.getConfiguration()}async hydrateCache(e,t){return this.controller.hydrateCache(e,t)}clearCache(e){return this.controller.clearCache(e)}}const Pc={initialize:()=>Promise.reject(fa(la)),acquireTokenPopup:()=>Promise.reject(fa(la)),acquireTokenRedirect:()=>Promise.reject(fa(la)),acquireTokenSilent:()=>Promise.reject(fa(la)),acquireTokenByCode:()=>Promise.reject(fa(la)),getAllAccounts:()=>[],getAccount:()=>null,getAccountByHomeId:()=>null,getAccountByUsername:()=>null,getAccountByLocalId:()=>null,handleRedirectPromise:()=>Promise.reject(fa(la)),loginPopup:()=>Promise.reject(fa(la)),loginRedirect:()=>Promise.reject(fa(la)),logout:()=>Promise.reject(fa(la)),logoutRedirect:()=>Promise.reject(fa(la)),logoutPopup:()=>Promise.reject(fa(la)),ssoSilent:()=>Promise.reject(fa(la)),addEventCallback:()=>null,removeEventCallback:()=>{},addPerformanceCallback:()=>"",removePerformanceCallback:()=>!1,enableAccountStorageEvents:()=>{},disableAccountStorageEvents:()=>{},getTokenCache:()=>{throw fa(la)},getLogger:()=>{throw fa(la)},setLogger:()=>{},setActiveAccount:()=>{},getActiveAccount:()=>null,initializeWrapperLibrary:()=>{},setNavigationClient:()=>{},getConfiguration:()=>{throw fa(la)},hydrateCache:()=>Promise.reject(fa(la)),clearCache:()=>Promise.reject(fa(la))};function _c(){let e;try{e=window[pi.SessionStorage];const t=e?.getItem($a);if(1===Number(t))return Promise.resolve().then(function(){return qc})}catch(e){}}function Mc(){return"undefined"!=typeof window&&void 0!==window.performance&&"function"==typeof window.performance.now}function Oc(e){if(e&&Mc())return Math.round(window.performance.now()-e)}class Nc{constructor(e,t){this.correlationId=t,this.measureName=Nc.makeMeasureName(e,t),this.startMark=Nc.makeStartMark(e,t),this.endMark=Nc.makeEndMark(e,t)}static makeMeasureName(e,t){return`msal.measure.${e}.${t}`}static makeStartMark(e,t){return`msal.start.${e}.${t}`}static makeEndMark(e,t){return`msal.end.${e}.${t}`}static supportsBrowserPerformance(){return"undefined"!=typeof window&&void 0!==window.performance&&"function"==typeof window.performance.mark&&"function"==typeof window.performance.measure&&"function"==typeof window.performance.clearMarks&&"function"==typeof window.performance.clearMeasures&&"function"==typeof window.performance.getEntriesByName}static flushMeasurements(e,t){if(Nc.supportsBrowserPerformance())try{t.forEach(t=>{const n=Nc.makeMeasureName(t.name,e);window.performance.getEntriesByName(n,"measure").length>0&&(window.performance.clearMeasures(n),window.performance.clearMarks(Nc.makeStartMark(n,e)),window.performance.clearMarks(Nc.makeEndMark(n,e)))})}catch(e){}}startMeasurement(){if(Nc.supportsBrowserPerformance())try{window.performance.mark(this.startMark)}catch(e){}}endMeasurement(){if(Nc.supportsBrowserPerformance())try{window.performance.mark(this.endMark),window.performance.measure(this.measureName,this.startMark,this.endMark)}catch(e){}}flushMeasurement(){if(Nc.supportsBrowserPerformance())try{const e=window.performance.getEntriesByName(this.measureName,"measure");if(e.length>0){const t=e[0].duration;return window.performance.clearMeasures(this.measureName),window.performance.clearMarks(this.startMark),window.performance.clearMarks(this.endMark),t}}catch(e){}return null}}var qc=Object.freeze({__proto__:null,BrowserPerformanceMeasurement:Nc});t.AccountEntity=At,t.ApiId=Si,t.AuthError=U,t.AuthErrorCodes=q,t.AuthErrorMessage=x,t.AuthenticationHeaderParser=class{constructor(e){this.headers=e}getShrNonce(){const e=this.headers["Authentication-Info"];if(e){const t=this.parseChallenges(e);if(t.nextnonce)return t.nextnonce;throw gt(rt)}const t=this.headers["WWW-Authenticate"];if(t){const e=this.parseChallenges(t);if(e.nonce)return e.nonce;throw gt(rt)}throw gt(nt)}parseChallenges(e){const t=e.indexOf(" "),r=e.substr(t+1).split(","),o={};return r.forEach(e=>{const[t,r]=e.split("=");o[t]=unescape(r.replace(/['"]+/g,n.EMPTY_STRING))}),o}},t.AuthenticationScheme=P,t.AzureCloudInstance=Be,t.BrowserAuthError=ii,t.BrowserAuthErrorCodes=ti,t.BrowserAuthErrorMessage=oi,t.BrowserCacheLocation=pi,t.BrowserConfigurationAuthError=pa,t.BrowserConfigurationAuthErrorCodes=da,t.BrowserConfigurationAuthErrorMessage=ga,t.BrowserPerformanceClient=class extends no{constructor(e,t,r){super(e.auth.clientId,e.auth.authority||`${n.DEFAULT_AUTHORITY}`,new xe(e.system?.loggerOptions||{},Da,Ba),Da,Ba,e.telemetry?.application||{appName:"",appVersion:""},t,r)}generateId(){return Xi()}getPageVisibility(){return document.visibilityState?.toString()||null}deleteIncompleteSubMeasurements(e){_c()?.then(t=>{const n=this.eventsByCorrelationId.get(e.event.correlationId),r=n&&n.eventId===e.event.eventId,o=[];r&&n?.incompleteSubMeasurements&&n.incompleteSubMeasurements.forEach(e=>{o.push({...e})}),t.BrowserPerformanceMeasurement.flushMeasurements(e.event.correlationId,o)})}startMeasurement(e,t){const n=this.getPageVisibility(),r=super.startMeasurement(e,t),o=Mc()?window.performance.now():void 0,i=_c()?.then(t=>new t.BrowserPerformanceMeasurement(e,r.event.correlationId));return i?.then(e=>e.startMeasurement()),{...r,end:(e,t,a)=>{const s=r.end({...e,startPageVisibility:n,endPageVisibility:this.getPageVisibility(),durationMs:Oc(o)},t,a);return i?.then(e=>e.endMeasurement()),this.deleteIncompleteSubMeasurements(r),s},discard:()=>{r.discard(),i?.then(e=>e.flushMeasurement()),this.deleteIncompleteSubMeasurements(r)}}}setPreQueueTime(e,t){if(!Mc())return void this.logger.trace(`BrowserPerformanceClient: window performance API not available, unable to set telemetry queue time for ${e}`);if(!t)return void this.logger.trace(`BrowserPerformanceClient: correlationId for ${e} not provided, unable to set telemetry queue time`);const n=this.preQueueTimeByCorrelationId.get(t);n&&(this.logger.trace(`BrowserPerformanceClient: Incomplete pre-queue ${n.name} found`,t),this.addQueueMeasurement(n.name,t,void 0,!0)),this.preQueueTimeByCorrelationId.set(t,{name:e,time:window.performance.now()})}addQueueMeasurement(e,t,n,r){if(!Mc())return void this.logger.trace(`BrowserPerformanceClient: window performance API not available, unable to add queue measurement for ${e}`);if(!t)return void this.logger.trace(`BrowserPerformanceClient: correlationId for ${e} not provided, unable to add queue measurement`);const o=super.getPreQueueTime(e,t);if(!o)return;const i=window.performance.now(),a=n||super.calculateQueuedTime(o,i);return super.addQueueMeasurement(e,t,a,r)}},t.BrowserPerformanceMeasurement=Nc,t.BrowserUtils=Oa,t.CacheLookupPolicy=Mi,t.ClientAuthError=Oe,t.ClientAuthErrorCodes=Pe,t.ClientAuthErrorMessage=Me,t.ClientConfigurationError=ht,t.ClientConfigurationErrorCodes=lt,t.ClientConfigurationErrorMessage=dt,t.DEFAULT_IFRAME_TIMEOUT_MS=Ua,t.EventHandler=Rs,t.EventMessageUtils=class{static getInteractionStatusFromEvent(e,n){switch(e.eventType){case fs.LOGIN_START:return Ri.Login;case fs.SSO_SILENT_START:return Ri.SsoSilent;case fs.ACQUIRE_TOKEN_START:if(e.interactionType===t.InteractionType.Redirect||e.interactionType===t.InteractionType.Popup)return Ri.AcquireToken;break;case fs.HANDLE_REDIRECT_START:return Ri.HandleRedirect;case fs.LOGOUT_START:return Ri.Logout;case fs.SSO_SILENT_SUCCESS:case fs.SSO_SILENT_FAILURE:if(n&&n!==Ri.SsoSilent)break;return Ri.None;case fs.LOGOUT_END:if(n&&n!==Ri.Logout)break;return Ri.None;case fs.HANDLE_REDIRECT_END:if(n&&n!==Ri.HandleRedirect)break;return Ri.None;case fs.LOGIN_SUCCESS:case fs.LOGIN_FAILURE:case fs.ACQUIRE_TOKEN_SUCCESS:case fs.ACQUIRE_TOKEN_FAILURE:case fs.RESTORE_FROM_BFCACHE:if(e.interactionType===t.InteractionType.Redirect||e.interactionType===t.InteractionType.Popup){if(n&&n!==Ri.Login&&n!==Ri.AcquireToken)break;return Ri.None}}return null}},t.EventType=fs,t.InteractionRequiredAuthError=Nr,t.InteractionRequiredAuthErrorCodes=Er,t.InteractionRequiredAuthErrorMessage=Or,t.InteractionStatus=Ri,t.JsonWebTokenTypes=M,t.LocalStorage=gs,t.Logger=xe,t.MemoryStorage=rs,t.NavigationClient=Na,t.OIDC_DEFAULT_SCOPES=o,t.PerformanceEvents=Gt,t.PromptValue=m,t.ProtocolMode=Tt,t.PublicClientApplication=kc,t.PublicClientNext=Ec,t.ServerError=pr,t.ServerResponseType=v,t.SessionStorage=ps,t.SignedHttpRequest=class{constructor(e,t){const n=t&&t.loggerOptions||{};this.logger=new xe(n,Da,Ba),this.cryptoOps=new is(this.logger),this.popTokenGenerator=new Ur(this.cryptoOps),this.shrParameters=e}async generatePublicKeyThumbprint(){const{kid:e}=await this.popTokenGenerator.generateKid(this.shrParameters);return e}async signRequest(e,t,n){return this.popTokenGenerator.signPayload(e,t,this.shrParameters,n)}async removeKeys(e){return this.cryptoOps.removeTokenBindingKey(e).then(()=>!0).catch(e=>{if(e instanceof Oe&&e.errorCode===Ie)return!1;throw e})}},t.StringUtils=pt,t.StubPerformanceClient=Qt,t.UrlString=Ot,t.WrapperSKU={React:"@azure/msal-react",Angular:"@azure/msal-angular"},t.createNestablePublicClientApplication=async function(e){const t=new es(e);if(await t.initialize(),t.isAvailable()){const n=new Tc(t),r=new kc(e,n);return await r.initialize(),r}return Sc(e)},t.createStandardPublicClientApplication=Sc,t.isPlatformBrokerAvailable=async function(e,t,n){const r=new xe(e||{},Da,Ba);r.trace("isPlatformBrokerAvailable called");const o=t||new Qt;return"undefined"==typeof window?(r.trace("Non-browser environment detected, returning false"),!1):!!await tc(r,o,n||Xi())},t.stubbedPublicClientApplication=Pc,t.version=Ba},216:(e,t,n)=>{n.r(t),n.d(t,{AppInsightsCore:()=>Va,ApplicationInsights:()=>ec,BE_PROFILE:()=>Xa,BaseTelemetryPlugin:()=>Ci,Cloud:()=>Zi,CoreUtils:()=>Vo,Device:()=>ea,DiagnosticLogger:()=>ar,EventLatency:()=>wc,EventPersistence:()=>Ic,EventsDiscardedReason:()=>Qa,InternalAppInsightsCore:()=>ja,Loc:()=>oa,LoggingSeverity:()=>yc,MinChannelPriorty:()=>Ac,NRT_PROFILE:()=>Ya,NotificationManager:()=>Ga,PostChannel:()=>Xs,PropertiesPlugin:()=>qa,RT_PROFILE:()=>Ja,Session:()=>Gi,TelemetryContext:()=>Oa,TraceLevel:()=>Tc,ValueKind:()=>Cc,_InternalLogMessage:()=>or,_InternalMessageId:()=>vc,cookieAvailable:()=>Er,getISOString:()=>rn,isArray:()=>Yt,isBeaconsSupported:()=>Wn,isBoolean:()=>tn,isLatency:()=>Fo,isNumber:()=>en,isReactNative:()=>$n,isString:()=>Zt,isUint8ArrayAvailable:()=>Ho,isValueAssigned:()=>Bo});var r="function",o="object",i="undefined",a="prototype",s="hasOwnProperty",c=Object,l=c[a],u=c.assign,d=c.create,h=c.defineProperty,g=l[s],p=null;function f(e){void 0===e&&(e=!0);var t=!1===e?null:p;return t||(typeof globalThis!==i&&(t=globalThis),t||typeof self===i||(t=self),t||typeof window===i||(t=window),t||typeof n.g===i||(t=n.g),p=t),t}function m(e){throw new TypeError(e)}function y(e){if(d)return d(e);if(null==e)return{};var t=typeof e;function n(){}return t!==o&&t!==r&&m("Object prototype may only be an Object:"+e),n[a]=e,new n}(f()||{}).Symbol,(f()||{}).Reflect;var v,C=u||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])l[s].call(t,o)&&(e[o]=t[o]);return e},w=function(e,t){return w=c.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t[s](n)&&(e[n]=t[n])},w(e,t)};function I(e,t){function n(){this.constructor=e}typeof t!==r&&null!==t&&m("Class extends value "+String(t)+" is not a constructor or null"),w(e,t),e[a]=null===t?y(t):(n[a]=t[a],new n)}function T(e,t){for(var n=0,r=t.length,o=e.length;n<r;n++,o++)e[o]=t[n];return e}var A,k="undefined",S="constructor",b="prototype",R="function",E="_dynInstFuncs",P="_isDynProxy",_="_dynClass",M="_dynInstChk",O=M,N="_dfOpts",q="_unknown_",L="__proto__",x="_dyn"+L,U="__dynProto$Gbl",D="_dynInstProto",B="useBaseInst",H="setInstFuncs",F=Object,z=F.getPrototypeOf,K=F.getOwnPropertyNames,$=(typeof globalThis!==k&&(A=globalThis),A||typeof self===k||(A=self),A||typeof window===k||(A=window),A||typeof n.g===k||(A=n.g),A||{}),G=$[U]||($[U]={o:(v={},v[H]=!0,v[B]=!0,v),n:1e3});function j(e,t){return e&&F[b].hasOwnProperty.call(e,t)}function W(e){return e&&(e===F[b]||e===Array[b])}function V(e){return W(e)||e===Function[b]}function Q(e){var t;if(e){if(z)return z(e);var n=e[L]||e[b]||(e[S]?e[S][b]:null);t=e[x]||n,j(e,x)||(delete e[D],t=e[x]=e[D]||e[x],e[D]=n)}return t}function J(e,t){var n=[];if(K)n=K(e);else for(var r in e)"string"==typeof r&&j(e,r)&&n.push(r);if(n&&n.length>0)for(var o=0;o<n.length;o++)t(n[o])}function Y(e,t,n){return t!==S&&typeof e[t]===R&&(n||j(e,t))&&t!==L&&t!==b}function X(e){throw new TypeError("DynamicProto: "+e)}function Z(){return Object.create&&(e=Object.create)?e(null):{};var e}function ee(e,t){for(var n=e.length-1;n>=0;n--)if(e[n]===t)return!0;return!1}function te(e,t){return j(e,b)?e.name||t||q:((e||{})[S]||{}).name||t||q}function ne(e,t,n,r){j(e,b)||X("theClass is an invalid class definition.");var o=e[b];(function(e,t){if(z){for(var n=[],r=Q(t);r&&!V(r)&&!ee(n,r);){if(r===e)return!0;n.push(r),r=Q(r)}return!1}return!0})(o,t)||X("["+te(e)+"] not in hierarchy of ["+te(t)+"]");var i=null;j(o,_)?i=o[_]:(i="_dynCls$"+te(e,"_")+"$"+G.n,G.n++,o[_]=i);var a=ne[N],s=!!a[B];s&&r&&void 0!==r[B]&&(s=!!r[B]);var c=function(e){var t=Z();return J(e,function(n){!t[n]&&Y(e,n,!1)&&(t[n]=e[n])}),t}(t),l=function(e,t,n,r){function o(e,t,n){var o=t[n];if(o[P]&&r){var i=e[E]||{};!1!==i[O]&&(o=(i[t[_]]||{})[n]||o)}return function(){return o.apply(e,arguments)}}var i=Z();J(n,function(e){i[e]=o(t,n,e)});for(var a=Q(e),s=[];a&&!V(a)&&!ee(s,a);)J(a,function(e){!i[e]&&Y(a,e,!z)&&(i[e]=o(t,a,e))}),s.push(a),a=Q(a);return i}(o,t,c,s);n(t,l);var u=!!z&&!!a[H];u&&r&&(u=!!r[H]),function(e,t,n,r,o){if(!W(e)){var i=n[E]=n[E]||Z();if(!W(i)){var a=i[t]=i[t]||Z();!1!==i[O]&&(i[O]=!!o),W(a)||J(n,function(t){Y(n,t,!1)&&n[t]!==r[t]&&(a[t]=n[t],delete n[t],(!j(e,t)||e[t]&&!e[t][P])&&(e[t]=function(e,t){var n=function(){var r=function(e,t,n,r){var o=null;if(e&&j(n,_)){var i=e[E]||Z();if((o=(i[n[_]]||Z())[t])||X("Missing ["+t+"] "+R),!o[M]&&!1!==i[O]){for(var a=!j(e,t),s=Q(e),c=[];a&&s&&!V(s)&&!ee(c,s);){var l=s[t];if(l){a=l===r;break}c.push(s),s=Q(s)}try{a&&(e[t]=o),o[M]=1}catch(e){i[O]=!1}}}return o}(this,t,e,n)||function(e,t,n){var r=t[e];return r===n&&(r=Q(t)[e]),typeof r!==R&&X("["+e+"] is not a "+R),r}(t,e,n);return r.apply(this,arguments)};return n[P]=1,n}(e,t)))})}}}(o,i,t,c,!1!==u)}ne[N]=G.o;var re="initialize",oe="name",ie="getNotifyMgr",ae="identifier",se="push",ce="isInitialized",le="config",ue="instrumentationKey",de="logger",he="length",ge="time",pe="processNext",fe="getProcessTelContext",me="addNotificationListener",ye="removeNotificationListener",ve="stopPollingInternalLogs",Ce="onComplete",we="getPlugin",Ie="flush",Te="_extensions",Ae="splice",ke="teardown",Se="messageId",be="message",Re="isAsync",Ee="_doTeardown",Pe="update",_e="getNext",Me="diagLog",Oe="setNextPlugin",Ne="createNew",qe="cookieCfg",Le="indexOf",xe="substring",Ue="userAgent",De="split",Be="setEnabled",He="substr",Fe="nodeType",ze="apply",Ke="replace",$e="enableDebugExceptions",Ge="call",je="type",We="handler",Ve="listeners",Qe="isChildEvt",Je="getCtx",Ye="setCtx",Xe="complete",Ze="traceId",et="spanId",tt="traceFlags",nt="",rt="channels",ot="core",it="createPerfMgr",at="disabled",st="extensionConfig",ct="processTelemetry",lt="priority",ut="eventsSent",dt="eventsDiscarded",ht="eventsSendRequest",gt="perfEvent",pt="errorToConsole",ft="warnToConsole",mt="getPerfMgr",yt="toISOString",vt="endsWith",Ct="startsWith",wt="indexOf",It="reduce",Tt="trim",At="toString",kt="constructor",St=h,bt=c.freeze,Rt=(c.seal,c.keys),Et=String[a],Pt=Et[Tt],_t=Et[vt],Mt=Et[Ct],Ot=Date[a][yt],Nt=Array.isArray,qt=l[At],Lt=g[At],xt=Lt[Ge](c),Ut=/-([a-z])/g,Dt=/([^\w\d_$])/g,Bt=/^(\d+[\w\d_$])/,Ht=Object.getPrototypeOf;function Ft(e){return void 0===e||typeof e===i}function zt(e){return null===e||Ft(e)}function Kt(e){return!zt(e)}function $t(e,t){return!(!e||!g[Ge](e,t))}function Gt(e){return!(!e||typeof e!==o)}function jt(e){return!(!e||typeof e!==r)}function Wt(e){var t=e;return t&&Zt(t)&&(t=(t=(t=t[Ke](Ut,function(e,t){return t.toUpperCase()}))[Ke](Dt,"_"))[Ke](Bt,function(e,t){return"_"+t})),t}function Vt(e,t){if(e)for(var n in e)g[Ge](e,n)&&t[Ge](e,n,e[n])}function Qt(e,t){var n=!1;return e&&t&&!(n=e===t)&&(n=Mt?e[Ct](t):function(e,t){var n=!1,r=t?t[he]:0;if(e&&r&&e[he]>=r&&!(n=e===t)){for(var o=0;o<r;o++)if(e[o]!==t[o])return!1;n=!0}return n}(e,t)),n}function Jt(e,t){return!(!e||!t)&&-1!==e[Le](t)}var Yt=Nt||function(e){return!(!e||"[object Array]"!==qt[Ge](e))};function Xt(e){return!(!e||"[object Error]"!==qt[Ge](e))}function Zt(e){return"string"==typeof e}function en(e){return"number"==typeof e}function tn(e){return"boolean"==typeof e}function nn(e){var t=!1;if(e&&"object"==typeof e){var n=Ht?Ht(e):function(e){if(e){if(Ht)return Ht(e);var t=e.__proto__||e[a]||e[kt];if(t)return t}return null}(e);n?(n[kt]&&g[Ge](n,kt)&&(n=n[kt]),t=typeof n===r&&Lt[Ge](n)===xt):t=!0}return t}function rn(e){if(e)return Ot?e[yt]():function(e){if(e&&e.getUTCFullYear){var t=function(e){var t=String(e);return 1===t[he]&&(t="0"+t),t};return e.getUTCFullYear()+"-"+t(e.getUTCMonth()+1)+"-"+t(e.getUTCDate())+"T"+t(e.getUTCHours())+":"+t(e.getUTCMinutes())+":"+t(e.getUTCSeconds())+"."+String((e.getUTCMilliseconds()/1e3).toFixed(3)).slice(2,5)+"Z"}}(e)}function on(e,t,n){var r=e[he];try{for(var o=0;o<r&&(!(o in e)||-1!==t[Ge](n||e,e[o],o,e));o++);}catch(e){}}function an(e,t,n){if(e){if(e[wt])return e[wt](t,n);var r=e[he],o=n||0;try{for(var i=Math.max(o>=0?o:r-Math.abs(o),0);i<r;i++)if(i in e&&e[i]===t)return i}catch(e){}}return-1}function sn(e){return e&&(e=Pt&&e[Tt]?e[Tt]():e[Ke]?e[Ke](/^\s+|(?=\s)\s+$/g,nt):e),e}var cn=!{toString:null}.propertyIsEnumerable("toString"),ln=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"];function un(e){var t=typeof e;if(t===r||t===o&&null!==e||m("objKeys called on non-object"),!cn&&Rt)return Rt(e);var n=[];for(var i in e)e&&g[Ge](e,i)&&n[se](i);if(cn)for(var a=ln[he],s=0;s<a;s++)e&&g[Ge](e,ln[s])&&n[se](ln[s]);return n}function dn(e,t,n,r){if(St)try{var o={enumerable:!0,configurable:!0};return n&&(o.get=n),r&&(o.set=r),St(e,t,o),!0}catch(e){}return!1}function hn(e){return bt&&Vt(e,function(e,t){(Yt(t)||Gt(t))&&bt(t)}),gn(e)}var gn=bt||function(e){return e};function pn(){var e=Date;return e.now?e.now():(new e).getTime()}function fn(e){return Xt(e)?e[oe]:nt}function mn(e,t,n,r,o){var i=n;return e&&((i=e[t])===n||o&&!o(i)||r&&!r(n)||(i=n,e[t]=i)),i}function yn(e,t,n){var r;return e?!(r=e[t])&&zt(r)&&(r=Ft(n)?{}:n,e[t]=r):r=Ft(n)?{}:n,r}function vn(e,t){return zt(e)?t:e}function Cn(e){return!!e}function wn(e){throw new Error(e)}function In(e,t,n,r,o){e&&t&&n&&(!1!==o||Ft(e[t]))&&(e[t]=function(e,t){var n=null,r=null;return jt(e)?n=e:r=e,function(){var e=arguments;if(n&&(r=n()),r)return r[t][ze](r,e)}}(n,r))}function Tn(e){return e&&u&&(e=c(u({},e))),e}function An(e,t,n,r,o,i){var a=arguments,s=a[0]||{},c=a[he],l=!1,u=1;for(c>0&&tn(s)&&(l=s,s=a[u]||{},u++),Gt(s)||(s={});u<c;u++){var d=a[u],h=Yt(d),p=Gt(d);for(var f in d)if(h&&f in d||p&&g[Ge](d,f)){var m=d[f],y=void 0;if(l&&m&&((y=Yt(m))||nn(m))){var v=s[f];y?Yt(v)||(v=[]):nn(v)||(v={}),m=An(l,v,m)}void 0!==m&&(s[f]=m)}}return s}var kn="window",Sn="navigator",bn="JSON",Rn="ReactNative",En="XMLHttpRequest",Pn=null,_n=null,Mn=null,On=null;function Nn(e,t){var n=!1;if(e){try{if(!(n=t in e)){var r=e[a];r&&(n=t in r)}}catch(e){}if(!n)try{n=!Ft((new e)[t])}catch(e){}}return n}function qn(e){var t=f();return t&&t[e]?t[e]:e===kn&&Ln()?window:null}function Ln(){return Boolean(typeof window===o&&window)}function xn(){return Ln()?window:qn(kn)}function Un(){return Boolean(typeof document===o&&document)}function Dn(){return Un()?document:qn("document")}function Bn(){return Boolean(typeof navigator===o&&navigator)}function Hn(){return Bn()?navigator:qn(Sn)}function Fn(e){return typeof location===o&&location?location:qn("location")}function zn(){return Boolean(typeof JSON===o&&JSON||null!==qn(bn))}function Kn(){return zn()?JSON||qn(bn):null}function $n(){var e=Hn();return!(!e||!e.product)&&e.product===Rn}function Gn(){var e=Hn();if(e&&(e[Ue]!==_n||null===Pn)){var t=((_n=e[Ue])||nt).toLowerCase();Pn=Jt(t,"msie")||Jt(t,"trident/")}return Pn}function jn(e){var t=Object[a].toString[Ge](e),n=nt;return"[object Error]"===t?n="{ stack: '"+e.stack+"', message: '"+e.message+"', name: '"+e[oe]+"'":zn()&&(n=Kn().stringify(e)),t+n}function Wn(){return null===On&&(On=Bn()&&Boolean(Hn().sendBeacon)),On}function Vn(e){var t=!1;try{t=!!qn("fetch");var n=qn("Request");t&&e&&n&&(t=Nn(n,"keepalive"))}catch(e){}return t}function Qn(){return null===Mn&&(Mn=typeof XDomainRequest!==i)&&Jn()&&(Mn=Mn&&!Nn(qn(En),"withCredentials")),Mn}function Jn(){var e=!1;try{e=!!qn(En)}catch(e){}return e}var Yn,Xn=["eventsSent","eventsDiscarded","eventsSendRequest","perfEvent"],Zn=null;function er(e,t){return function(){var n=arguments,r=tr(t);if(r){var o=r.listener;o&&o[e]&&o[e][ze](o,n)}}}function tr(e){var t,n=Zn;return n||!0===e.disableDbgExt||(n=Zn||((t=qn("Microsoft"))&&(Zn=t.ApplicationInsights),Zn)),n?n.ChromeDbgExt:null}function nr(e){return e?'"'+e[Ke](/\"/g,nt)+'"':nt}function rr(e,t){var n=typeof console!==i?console:qn("console");if(n){var r="log";n[e]&&(r=e),jt(n[r])&&n[r](t)}}var or=function(){function e(e,t,n,r){void 0===n&&(n=!1);var o=this;o[Se]=e,o[be]=(n?"AI: ":"AI (Internal): ")+e;var i=nt;zn()&&(i=Kn().stringify(r));var a=(t?" message:"+nr(t):nt)+(r?" props:"+nr(i):nt);o[be]+=a}return e.dataType="MessageData",e}();function ir(e,t){return(e||{})[de]||new ar(t)}var ar=function(){function e(t){this.identifier="DiagnosticLogger",this.queue=[];var n,r,o,i,a=0,s={};ne(e,this,function(e){function c(t,n){if(!(a>=o)){var i=!0,c="AITR_"+n[Se];if(s[c]?i=!1:s[c]=!0,i&&(t<=r&&(e.queue[se](n),a++,l(1===t?"error":"warn",n)),a===o)){var u="Internal events throttle limit per PageView reached for this app.",d=new or(23,u,!1);e.queue[se](d),1===t?e[pt](u):e[ft](u)}}}function l(e,n){var r=tr(t||{});r&&r[Me]&&r[Me](e,n)}!function(e){n=vn(e.loggingLevelConsole,0),r=vn(e.loggingLevelTelemetry,1),o=vn(e.maxMessageLimit,25),i=vn(e.enableDebug,vn(e[$e],!1))}(t||{}),e.consoleLoggingLevel=function(){return n},e.telemetryLoggingLevel=function(){return r},e.maxInternalMessageLimit=function(){return o},e[$e]=function(){return i},e.throwInternal=function(t,r,o,a,u){void 0===u&&(u=!1);var d=new or(r,o,u,a);if(i)throw jn(d);var h=1===t?pt:ft;if(Ft(d[be]))l("throw"+(1===t?"Critical":"Warning"),d);else{if(u){var g=+d[Se];!s[g]&&n>=t&&(e[h](d[be]),s[g]=!0)}else n>=t&&e[h](d[be]);c(t,d)}},e[ft]=function(e){rr("warn",e),l("warning",e)},e[pt]=function(e){rr("error",e),l("error",e)},e.resetInternalMessageCount=function(){a=0,s={}},e.logInternalMessage=c})}return e.__ieDyn=1,e}();function sr(e){return e||new ar}function cr(e,t,n,r,o,i){void 0===i&&(i=!1),sr(e).throwInternal(t,n,r,o,i)}function lr(e,t){sr(e)[ft](t)}var ur="toGMTString",dr="toUTCString",hr="cookie",gr="expires",pr="enabled",fr="isCookieUseDisabled",mr="disableCookiesUsage",yr="_ckMgr",vr=null,Cr=null,wr=null,Ir=Dn(),Tr={},Ar={};function kr(e){return!e||e.isEnabled()}function Sr(e,t){return!!(t&&e&&Yt(e.ignoreCookies))&&-1!==e.ignoreCookies[Le](t)}function br(e,t){var n;if(e)n=e.getCookieMgr();else if(t){var r=t[qe];n=r[yr]?r[yr]:Rr(t)}return n||(n=function(e,t){var n=Rr[yr]||Ar[yr];return n||(n=Rr[yr]=Rr(e,t),Ar[yr]=n),n}(t,(e||{})[de])),n}function Rr(e,t){var n,r=function(e){var t=e[qe]=e[qe]||{};if(mn(t,"domain",e.cookieDomain,Kt,zt),mn(t,"path",e.cookiePath||"/",null,zt),zt(t[pr])){var n=void 0;Ft(e[fr])||(n=!e[fr]),Ft(e[mr])||(n=!e[mr]),t[pr]=n}return t}(e||Ar),o=r.path||"/",i=r.domain,a=!1!==r[pr],s=((n={isEnabled:function(){var e=a&&Er(t),n=Ar[yr];return e&&n&&s!==n&&(e=kr(n)),e}})[Be]=function(e){a=!1!==e},n.set=function(e,t,n,a,c){var l,u=!1;if(kr(s)&&!function(e,t){return!!(t&&e&&Yt(e.blockedCookies)&&-1!==e.blockedCookies[Le](t))||Sr(e,t)}(r,e)){var d={},h=sn(t||nt),g=h[Le](";");if(-1!==g&&(h=sn(t[xe](0,g)),d=Pr(t[xe](g+1))),mn(d,"domain",a||i,Cn,Ft),!zt(n)){var p=Gn();if(Ft(d[gr])){var f=pn()+1e3*n;if(f>0){var m=new Date;m.setTime(f),mn(d,gr,_r(m,p?ur:dr)||_r(m,p?ur:dr)||nt,Cn)}}p||mn(d,"max-age",nt+n,null,Ft)}var y=Fn();y&&"https:"===y.protocol&&(mn(d,"secure",null,null,Ft),null===Cr&&(l=(Hn()||{})[Ue],Cr=!(Zt(l)&&(Jt(l,"CPU iPhone OS 12")||Jt(l,"iPad; CPU OS 12")||Jt(l,"Macintosh; Intel Mac OS X 10_14")&&Jt(l,"Version/")&&Jt(l,"Safari")||Jt(l,"Macintosh; Intel Mac OS X 10_14")&&function(e,t){var n=!1;return e&&t&&!(n=e===t)&&(n=_t?e[vt](t):function(e,t){var n=!1,r=t?t[he]:0,o=e?e[he]:0;if(r&&o&&o>=r&&!(n=e===t)){for(var i=o-1,a=r-1;a>=0;a--){if(e[i]!=t[a])return!1;i--}n=!0}return n}(e,t)),n}(l,"AppleWebKit/605.1.15 (KHTML, like Gecko)")||Jt(l,"Chrome/5")||Jt(l,"Chrome/6")||Jt(l,"UnrealEngine")&&!Jt(l,"Chrome")||Jt(l,"UCBrowser/12")||Jt(l,"UCBrowser/11")))),Cr&&mn(d,"SameSite","None",null,Ft)),mn(d,"path",c||o,null,Ft),(r.setCookie||Nr)(e,Mr(h,d)),u=!0}return u},n.get=function(e){var t=nt;return kr(s)&&!Sr(r,e)&&(t=(r.getCookie||Or)(e)),t},n.del=function(e,t){var n=!1;return kr(s)&&(n=s.purge(e,t)),n},n.purge=function(e,n){var o,i=!1;if(Er(t)){var a=((o={}).path=n||"/",o[gr]="Thu, 01 Jan 1970 00:00:01 GMT",o);Gn()||(a["max-age"]="0"),(r.delCookie||Nr)(e,Mr(nt,a)),i=!0}return i},n);return s[yr]=s,s}function Er(e){if(null===vr){vr=!1;try{vr=void 0!==(Ir||{})[hr]}catch(t){cr(e,2,68,"Cannot access document.cookie - "+fn(t),{exception:jn(t)})}}return vr}function Pr(e){var t={};return e&&e[he]&&on(sn(e)[De](";"),function(e){if(e=sn(e||nt)){var n=e[Le]("=");-1===n?t[e]=null:t[sn(e[xe](0,n))]=sn(e[xe](n+1))}}),t}function _r(e,t){return jt(e[t])?e[t]():null}function Mr(e,t){var n=e||nt;return Vt(t,function(e,t){n+="; "+e+(zt(t)?nt:"="+t)}),n}function Or(e){var t=nt;if(Ir){var n=Ir[hr]||nt;wr!==n&&(Tr=Pr(n),wr=n),t=sn(Tr[e]||nt)}return t}function Nr(e,t){Ir&&(Ir[hr]=e+"="+t)}var qr=4294967296,Lr=4294967295,xr=!1,Ur=123456789,Dr=987654321;function Br(e){e<0&&(e>>>=0),Ur=123456789+e&Lr,Dr=987654321-e&Lr,xr=!0}function Hr(){try{var e=2147483647&pn();Br((Math.random()*qr^e)+e)}catch(e){}}function Fr(e){var t=0,n=qn("crypto")||qn("msCrypto");return n&&n.getRandomValues&&(t=n.getRandomValues(new Uint32Array(1))[0]&Lr),0===t&&Gn()&&(xr||Hr(),t=zr()&Lr),0===t&&(t=Math.floor(qr*Math.random()|0)),e||(t>>>=0),t}function zr(e){var t=((Dr=36969*(65535&Dr)+(Dr>>16)&Lr)<<16)+(65535&(Ur=18e3*(65535&Ur)+(Ur>>16)&Lr))>>>0&Lr;return e||(t>>>=0),t}function Kr(e){void 0===e&&(e=22);for(var t=Fr()>>>0,n=0,r=nt;r[he]<e;)n++,r+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(63&t),t>>>=6,5===n&&(t=(Fr()<<2&4294967295|3&t)>>>0,n=0);return r}var $r=h,Gr="2.8.18",jr="."+Kr(6),Wr=0;function Vr(e){return 1===e[Fe]||9===e[Fe]||!+e[Fe]}function Qr(e,t){return void 0===t&&(t=!1),Wt(e+Wr+++(t?"."+Gr:nt)+jr)}function Jr(e){var t={id:Qr("_aiData-"+(e||nt)+"."+Gr),accept:function(e){return Vr(e)},get:function(e,n,r,o){var i=e[t.id];return i?i[Wt(n)]:(o&&((i=function(e,t){var n=t[e.id];if(!n){n={};try{Vr(t)&&(function(e,t,n){if($r)try{return $r(e,t,{value:n,enumerable:!1,configurable:!0}),!0}catch(e){}return!1}(t,e.id,n)||(t[e.id]=n))}catch(e){}}return n}(t,e))[Wt(n)]=r),r)},kill:function(e,t){if(e&&e[t])try{delete e[t]}catch(e){}}};return t}var Yr="attachEvent",Xr="addEventListener",Zr="detachEvent",eo="removeEventListener",to="events",no="visibilitychange",ro="pagehide",oo="pageshow",io="unload",ao="beforeunload",so=Qr("aiEvtPageHide"),co=Qr("aiEvtPageShow"),lo=/\.[\.]+/g,uo=/[\.]+$/,ho=1,go=Jr("events"),po=/^([^.]*)(?:\.(.+)|)/;function fo(e){return e&&e[Ke]?e[Ke](/^[\s\.]+|(?=[\s\.])[\.\s]+$/g,nt):e}function mo(e,t){var n;if(t){var r=nt;Yt(t)?(r=nt,on(t,function(e){(e=fo(e))&&("."!==e[0]&&(e="."+e),r+=e)})):r=fo(t),r&&("."!==r[0]&&(r="."+r),e=(e||nt)+r)}var o=po.exec(e||nt)||[];return(n={})[je]=o[1],n.ns=(o[2]||nt).replace(lo,".").replace(uo,nt)[De](".").sort().join("."),n}function yo(e,t,n){void 0===n&&(n=!0);var r=go.get(e,to,{},n),o=r[t];return o||(o=r[t]=[]),o}function vo(e,t,n,r){e&&t&&t[je]&&(e[eo]?e[eo](t[je],n,r):e[Zr]&&e[Zr]("on"+t[je],n))}function Co(e,t,n,r){for(var o=t[he];o--;){var i=t[o];i&&(n.ns&&n.ns!==i.evtName.ns||r&&!r(i)||(vo(e,i.evtName,i[We],i.capture),t[Ae](o,1)))}}function wo(e,t){return t?mo("xx",Yt(t)?[e].concat(t):[e,t]).ns[De]("."):e}function Io(e,t,n,r,o){var i;void 0===o&&(o=!1);var a=!1;if(e)try{var s=mo(t,r);if(a=function(e,t,n,r){var o=!1;return e&&t&&t[je]&&n&&(e[Xr]?(e[Xr](t[je],n,r),o=!0):e[Yr]&&(e[Yr]("on"+t[je],n),o=!0)),o}(e,s,n,o),a&&go.accept(e)){var c=((i={guid:ho++,evtName:s})[We]=n,i.capture=o,i);yo(e,s.type)[se](c)}}catch(e){}return a}function To(e,t,n,r,o){if(void 0===o&&(o=!1),e)try{var i=mo(t,r),a=!1;!function(e,t,n){if(t[je])Co(e,yo(e,t[je]),t,n);else{var r=go.get(e,to,{});Vt(r,function(r,o){Co(e,o,t,n)}),0===un(r)[he]&&go.kill(e,to)}}(e,i,function(e){return!((!i.ns||n)&&e[We]!==n||(a=!0,0))}),a||vo(e,i,n,o)}catch(e){}}function Ao(e,t,n){var r=!1,o=xn();o&&(r=Io(o,e,t,n),r=Io(o.body,e,t,n)||r);var i=Dn();return i&&(r=Io(i,e,t,n)||r),r}function ko(e,t,n,r){var o=!1;return t&&e&&e[he]>0&&on(e,function(e){e&&(n&&-1!==an(n,e)||(o=Ao(e,t,r)||o))}),o}function So(e,t,n){e&&Yt(e)&&on(e,function(e){e&&function(e,t,n){var r=xn();r&&(To(r,e,t,n),To(r.body,e,t,n));var o=Dn();o&&To(o,e,t,n)}(e,t,n)})}function bo(e,t,n){var r=wo(so,n),o=ko([ro],e,t,r);return t&&-1!==an(t,no)||(o=ko([no],function(t){var n=Dn();e&&n&&"hidden"===n.visibilityState&&e(t)},t,r)||o),!o&&t&&(o=bo(e,null,n)),o}function Ro(e,t,n){var r=wo(co,n),o=ko([oo],e,t,r);return!(o=ko([no],function(t){var n=Dn();e&&n&&"visible"===n.visibilityState&&e(t)},t,r)||o)&&t&&(o=Ro(e,null,n)),o}function Eo(){var e=_o();return e[xe](0,8)+"-"+e[xe](8,12)+"-"+e[xe](12,16)+"-"+e[xe](16,20)+"-"+e[xe](20)}function Po(){var e=qn("performance");return e&&e.now?e.now():pn()}function _o(){for(var e,t=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],n=nt,r=0;r<4;r++)n+=t[15&(e=Fr())]+t[e>>4&15]+t[e>>8&15]+t[e>>12&15]+t[e>>16&15]+t[e>>20&15]+t[e>>24&15]+t[e>>28&15];var o=t[8+(3&Fr())|0];return n[He](0,8)+n[He](9,4)+"4"+n[He](13,3)+o+n[He](16,3)+n[He](19,12)}var Mo,Oo="",No="version",qo="properties",Lo="1DS-Web-JS-3.2.18",xo="withCredentials",Uo=((Mo={})[0]=0,Mo[2]=6,Mo[1]=1,Mo[3]=7,Mo[4098]=6,Mo[4097]=1,Mo[4099]=7,Mo),Do=null;function Bo(e){return!(e===Oo||zt(e))}function Ho(){return null===Do&&(Do=!Ft(Uint8Array)&&!function(){var e=Hn();if(!Ft(e)&&e.userAgent){var t=e.userAgent.toLowerCase();if((t.indexOf("safari")>=0||t.indexOf("firefox")>=0)&&t.indexOf("chrome")<0)return!0}return!1}()&&!$n()),Do}function Fo(e){return!!(e&&en(e)&&e>=1&&e<=4)}function zo(e,t,n){var r;return void 0===n&&(n=!0),e&&(r=e.get(t),n&&r&&decodeURIComponent&&(r=decodeURIComponent(r))),r||Oo}function Ko(e){void 0===e&&(e="D");var t=Eo();return"B"===e?t="{"+t+"}":"P"===e?t="("+t+")":"N"===e&&(t=t.replace(/-/g,Oo)),t}function $o(e,t,n,r,o){var i={},s=!1,c=0,l=arguments.length,u=arguments;for("[object Boolean]"===Object[a].toString.call(u[0])&&(s=u[0],c++);c<l;c++)Vt(u[c],function(e,t){s&&t&&Gt(t)?Yt(t)?(i[e]=i[e]||[],on(t,function(t,n){t&&Gt(t)?i[e][n]=$o(!0,i[e][n],t):i[e][n]=t})):i[e]=$o(!0,i[e],t):i[e]=t});return i}Boolean(Dn()),Boolean(xn());var Go=Po;function jo(e,t){var n=e;n.timings=n.timings||{},n.timings.processTelemetryStart=n.timings.processTelemetryStart||{},n.timings.processTelemetryStart[t]=Go()}function Wo(e){var t=0;if(null!=e){var n=typeof e;"string"===n?t=1:"number"===n?t=2:"boolean"===n?t=3:n===o&&(t=4,Yt(e)?(t=4096,e.length>0&&(t|=Wo(e[0]))):g.call(e,"value")&&(t=8192|Wo(e.value)))}return t}var Vo={_canUseCookies:void 0,isTypeof:function(e,t){return typeof e===t},isUndefined:Ft,isNullOrUndefined:zt,hasOwnProperty:$t,isFunction:jt,isObject:Gt,isDate:function(e){return!(!e||"[object Date]"!==qt[Ge](e))},isArray:Yt,isError:Xt,isString:Zt,isNumber:en,isBoolean:tn,toISOString:rn,arrForEach:on,arrIndexOf:an,arrMap:function(e,t,n){var r;if(e){if(e.map)return e.map(t,n);var o=e[he],i=n||e;r=new Array(o);try{for(var a=0;a<o;a++)a in e&&(r[a]=t[Ge](i,e[a],e))}catch(e){}}return r},arrReduce:function(e,t,n){var r;if(e){if(e[It])return e[It](t,n);var o=e[he],i=0;if(arguments[he]>=3)r=arguments[2];else{for(;i<o&&!(i in e);)i++;r=e[i++]}for(;i<o;)i in e&&(r=t(r,e[i],i,e)),i++}return r},strTrim:sn,objCreate:y,objKeys:un,objDefineAccessors:dn,addEventHandler:Ao,dateNow:pn,isIE:Gn,disableCookies:function(){br(null).setEnabled(!1)},newGuid:Eo,perfNow:Po,newId:Kr,randomValue:function(e){return e>0?Math.floor(Fr()/Lr*(e+1))>>>0:0},random32:Fr,mwcRandomSeed:function(e){e?Br(e):Hr()},mwcRandom32:zr,generateW3CId:_o},Qo="ctx",Jo="ParentContextKey",Yo="ChildrenContextKey",Xo=function(){function e(t,n,r){var o,i=this,a=!1;i.start=pn(),i[oe]=t,i[Re]=r,i[Qe]=function(){return!1},jt(n)&&(a=dn(i,"payload",function(){return!o&&jt(n)&&(o=n(),n=null),o})),i[Je]=function(t){return t?t===e[Jo]||t===e[Yo]?i[t]:(i[Qo]||{})[t]:null},i[Ye]=function(t,n){t&&(t===e[Jo]?(i[t]||(i[Qe]=function(){return!0}),i[t]=n):t===e[Yo]?i[t]=n:(i[Qo]=i[Qo]||{})[t]=n)},i[Xe]=function(){var t=0,r=i[Je](e[Yo]);if(Yt(r))for(var o=0;o<r[he];o++){var s=r[o];s&&(t+=s[ge])}i[ge]=pn()-i.start,i.exTime=i[ge]-t,i[Xe]=function(){},!a&&jt(n)&&(i.payload=n())}}return e.ParentContextKey="parent",e.ChildrenContextKey="childEvts",e}(),Zo=function(){function e(t){this.ctx={},ne(e,this,function(e){e.create=function(e,t,n){return new Xo(e,t,n)},e.fire=function(e){e&&(e[Xe](),t&&jt(t[gt])&&t[gt](e))},e[Ye]=function(t,n){t&&((e[Qo]=e[Qo]||{})[t]=n)},e[Je]=function(t){return(e[Qo]||{})[t]}})}return e.__ieDyn=1,e}(),ei="CoreUtils.doPerf";function ti(e,t,n,r,o){if(e){var i=e;if(i[mt]&&(i=i[mt]()),i){var a=void 0,s=i[Je](ei);try{if(a=i.create(t(),r,o)){if(s&&a[Ye]&&(a[Ye](Xo[Jo],s),s[Je]&&s[Ye])){var c=s[Je](Xo[Yo]);c||(c=[],s[Ye](Xo[Yo],c)),c[se](a)}return i[Ye](ei,a),n(a)}}catch(e){a&&a[Ye]&&a[Ye]("exception",e)}finally{a&&i.fire(a),i[Ye](ei,s)}}}return n()}function ni(e,t,n){return!(!e||e[he]!==t||e===n||!e.match(/^[\da-f]*$/i))}function ri(e){return ni(e,32,"00000000000000000000000000000000")}function oi(e){return ni(e,16,"0000000000000000")}var ii=Jr("plugin");function ai(e){return ii.get(e,"state",{},!0)}function si(e,t){for(var n,r=[],o=null,i=e[_e]();i;){var a=i[we]();a&&(o&&jt(o[Oe])&&jt(a[ct])&&o[Oe](a),(jt(a[ce])?a[ce]():(n=ai(a))[ce])||r[se](a),o=a,i=i[_e]())}on(r,function(r){var o=e[ot]();r[re](e.getCfg(),o,t,e[_e]()),n=ai(r),r[ot]||n[ot]||(n[ot]=o),n[ce]=!0,delete n[ke]})}function ci(e){return e.sort(function(e,t){var n=0;if(t){var r=jt(t[ct]);jt(e[ct])?n=r?e[lt]-t[lt]:1:r&&(n=-1)}else n=e?1:-1;return n})}var li="_hasRun",ui="_getTelCtx",di=0;function hi(e,t,n,r){var o=null,i=[];null!==r&&(o=r?function(e,t,n){for(;e;){if(e[we]()===n)return e;e=e[_e]()}return mi([n],t[le]||{},t)}(e,n,r):e);var a={_next:function(){var e=o;if(o=e?e[_e]():null,!e){var t=i;t&&t[he]>0&&(on(t,function(e){try{e.func[Ge](e.self,e.args)}catch(e){cr(n[de],2,73,"Unexpected Exception during onComplete - "+jn(e))}}),i=[])}return e},ctx:{core:function(){return n},diagLog:function(){return ir(n,t)},getCfg:function(){return t},getExtCfg:s,getConfig:function(e,n,r){void 0===r&&(r=!1);var o,i=s(e,null);return i&&!zt(i[n])?o=i[n]:t&&!zt(t[n])&&(o=t[n]),zt(o)?r:o},hasNext:function(){return!!o},getNext:function(){return o},setNext:function(e){o=e},iterate:function(e){for(var t;t=a._next();){var n=t[we]();n&&e(n)}},onComplete:function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];e&&i[se]({func:e,self:Ft(t)?a.ctx:t,args:n})}}};function s(e,n,r){var o;if(void 0===n&&(n={}),void 0===r&&(r=0),t){var i=t[st];i&&e&&(o=i[e])}if(o){if(Gt(n)&&0!==r){var a=An(!0,n,o);t&&2===r&&Vt(n,function(e){if(zt(a[e])){var n=t[e];zt(n)||(a[e]=n)}}),o=a}}else o=n;return o}return a}function gi(e,t,n,r){var o=hi(e,t,n,r),i=o.ctx;return i[pe]=function(e){var t=o._next();return t&&t[ct](e,i),!t},i[Ne]=function(e,r){return void 0===e&&(e=null),Yt(e)&&(e=mi(e,t,n,r)),gi(e||i[_e](),t,n,r)},i}function pi(e,t,n){var r=t[le]||{},o=hi(e,r,t,n),i=o.ctx;return i[pe]=function(e){var t=o._next();return t&&t.unload(i,e),!t},i[Ne]=function(e,n){return void 0===e&&(e=null),Yt(e)&&(e=mi(e,r,t,n)),pi(e||i[_e](),t,n)},i}function fi(e,t,n){var r=t[le]||{},o=hi(e,r,t,n).ctx;return o[pe]=function(e){return o.iterate(function(t){jt(t[Pe])&&t[Pe](o,e)})},o[Ne]=function(e,n){return void 0===e&&(e=null),Yt(e)&&(e=mi(e,r,t,n)),fi(e||o[_e](),t,n)},o}function mi(e,t,n,r){var o=null,i=!r;if(Yt(e)&&e[he]>0){var a=null;on(e,function(e){if(i||r!==e||(i=!0),i&&e&&jt(e[ct])){var s=function(e,t,n){var r,o=null,i=jt(e[ct]),a=jt(e[Oe]),s={getPlugin:function(){return e},getNext:function(){return o},processTelemetry:function(r,l){c(l=l||function(){var r;return e&&jt(e[ui])&&(r=e[ui]()),r||(r=gi(s,t,n)),r}(),function(t){if(!e||!i)return!1;var n=ai(e);return!n[ke]&&!n[at]&&(a&&e[Oe](o),e[ct](r,t),!0)},"processTelemetry",function(){return{item:r}},!r.sync)||l[pe](r)},unload:function(t,n){c(t,function(){var r=!1;if(e){var o=ai(e),i=e[ot]||o[ot];!e||i&&i!==t.core()||o[ke]||(o[ot]=null,o[ke]=!0,o[ce]=!1,e[ke]&&!0===e[ke](t,n)&&(r=!0))}return r},"unload",function(){},n[Re])||t[pe](n)},update:function(t,n){c(t,function(){var r=!1;if(e){var o=ai(e),i=e[ot]||o[ot];!e||i&&i!==t.core()||o[ke]||e[Pe]&&!0===e[Pe](t,n)&&(r=!0)}return r},"update",function(){},!1)||t[pe](n)},_id:r=e?e[ae]+"-"+e[lt]+"-"+di++:"Unknown-0-"+di++,_setNext:function(e){o=e}};function c(t,n,i,a,s){var c=!1,l=e?e[ae]:"TelemetryPluginChain",u=t[li];return u||(u=t[li]={}),t.setNext(o),e&&ti(t[ot](),function(){return l+":"+i},function(){u[r]=!0;try{var e=o?o._id:nt;e&&(u[e]=!1),c=n(t)}catch(e){var a=!o||u[o._id];a&&(c=!0),o&&a||cr(t[Me](),1,73,"Plugin ["+l+"] failed during "+i+" - "+jn(e)+", run flags: "+jn(u))}},a,s),c}return gn(s)}(e,t,n);o||(o=s),a&&a._setNext(s),a=s}})}return r&&!o?mi([r],t,n):o}function yi(){var e=[];return{add:function(t){t&&e[se](t)},run:function(t,n){on(e,function(e){try{e(t,n)}catch(e){cr(t[Me](),2,73,"Unexpected error calling unload handler - "+jn(e))}}),e=[]}}}var vi="getPlugin",Ci=function(){function e(){var t,n,r,o,i,a=this;function s(e){void 0===e&&(e=null);var t=e;if(!t){var o=n||gi(null,{},a[ot]);t=r&&r[vi]?o[Ne](null,r[vi]):o[Ne](null,r)}return t}function c(e,t,o){e&&mn(e,st,[],null,zt),!o&&t&&(o=t[fe]()[_e]());var i=r;r&&r[vi]&&(i=r[vi]()),a[ot]=t,n=gi(o,e,t,i)}function l(){t=!1,a[ot]=null,n=null,r=null,i=[],o=yi()}l(),ne(e,a,function(e){e[re]=function(e,n,r,o){c(e,n,o),t=!0},e[ke]=function(t,n){var a,s=e[ot];if(s&&(!t||s===t[ot]())){var c,u=!1,d=t||pi(null,s,r&&r[vi]?r[vi]():r),h=n||((a={reason:0})[Re]=!1,a);return e[Ee]&&!0===e[Ee](d,h,g)?c=!0:g(),c}function g(){if(!u){u=!0,o.run(d,n);var e=i;i=[],on(e,function(e){e.rm()}),!0===c&&d[pe](h),l()}}},e[Pe]=function(t,n){var o=e[ot];if(o&&(!t||o===t[ot]())){var i,a=!1,s=t||fi(null,o,r&&r[vi]?r[vi]():r),l=n||{reason:0};return e._doUpdate&&!0===e._doUpdate(s,l,u)?i=!0:u(),i}function u(){a||(a=!0,c(s.getCfg(),s.core(),s[_e]()))}},e._addHook=function(e){e&&(Yt(e)?i=i.concat(e):i[se](e))},In(e,"_addUnloadCb",function(){return o},"add")}),a[Me]=function(e){return s(e)[Me]()},a[ce]=function(){return t},a.setInitialized=function(e){t=e},a[Oe]=function(e){r=e},a[pe]=function(e,t){t?t[pe](e):r&&jt(r[ct])&&r[ct](e,null)},a._getTelCtx=s}return e.__ieDyn=1,e}();function wi(e){var t={};return Vt(e,function(e,n){t[e]=n,t[n]=e}),hn(t)}function Ii(e){var t={};return Vt(e,function(e,n){t[e]=n[1],t[n[0]]=n[1]}),hn(t)}var Ti,Ai="locale",ki="ver",Si="name",bi=Ii({UserExt:[0,"user"],DeviceExt:[1,"device"],TraceExt:[2,"trace"],WebExt:[3,"web"],AppExt:[4,"app"],OSExt:[5,"os"],SdkExt:[6,"sdk"],IntWebExt:[7,"intweb"],UtcExt:[8,"utc"],LocExt:[9,"loc"],CloudExt:[10,"cloud"],DtExt:[11,"dt"]}),Ri=Ii({id:[0,"id"],ver:[1,ki],appName:[2,Si],locale:[3,Ai],expId:[4,"expId"],env:[5,"env"]}),Ei=Ii({domain:[0,"domain"],browser:[1,"browser"],browserVer:[2,"browserVer"],screenRes:[3,"screenRes"],userConsent:[4,"userConsent"],consentDetails:[5,"consentDetails"]}),Pi=Ii({locale:[0,Ai],localId:[1,"localId"],id:[2,"id"]}),_i=Ii({osName:[0,Si],ver:[1,ki]}),Mi=Ii({ver:[0,ki],seq:[1,"seq"],installId:[2,"installId"],epoch:[3,"epoch"]}),Oi=Ii({msfpc:[0,"msfpc"],anid:[1,"anid"],serviceName:[2,"serviceName"]}),Ni=Ii({popSample:[0,"popSample"],eventFlags:[1,"eventFlags"]}),qi=Ii({tz:[0,"tz"]}),Li=Ii({sessionId:[0,"sesId"]}),xi=Ii({localId:[0,"localId"],deviceClass:[1,"deviceClass"],make:[2,"make"],model:[3,"model"]}),Ui=Ii({role:[0,"role"],roleInstance:[1,"roleInstance"],roleVer:[2,"roleVer"]}),Di=Ii({traceId:[0,"traceID"],traceName:[1,Si],parentId:[2,"parentID"]}),Bi=Ii({traceId:[0,"traceId"],spanId:[1,"spanId"],traceFlags:[2,"traceFlags"]});function Hi(){return void 0===Ti&&(Ti=!!zi(0)),Ti}function Fi(){return Hi()?zi(0):null}function zi(e){var t,n,r=null;try{var o=f();if(!o)return null;n=new Date,(r=0===e?o.localStorage:o.sessionStorage)&&jt(r.setItem)&&(r.setItem(n,n),t=r.getItem(n)!==n,r.removeItem(n),t&&(r=null))}catch(e){r=null}return r}function Ki(){return this.getId()}function $i(e){this.setId(e)}var Gi=function(){function e(){ne(e,this,function(e){e.setId=function(t){e.customId=t},e.getId=function(){return Zt(e.customId)?e.customId:e.automaticId}})}return e._staticInit=void dn(e.prototype,"id",Ki,$i),e}(),ji="ai_session",Wi=function(){function e(t,n){var r,o,i=ir(t),a=br(t);ne(e,this,function(t){var s,c={sessionRenewalMs:(s=n).sessionRenewalMs&&function(){return s.sessionRenewalMs},sessionExpirationMs:s.sessionExpirationMs&&function(){return s.sessionExpirationMs},cookieDomain:s.cookieDomain&&function(){return s.cookieDomain},namePrefix:s.namePrefix&&function(){return s.namePrefix},sessionAsGuid:function(){return s.sessionAsGuid},idLength:function(){return s.idLength?s.idLength:22}};function l(e){var n=t.automaticSession,r=e.split("|");r.length>0&&n.setId(r[0]);try{if(r.length>1){var o=+r[1];n.acquisitionDate=+new Date(o),n.acquisitionDate=n.acquisitionDate>0?n.acquisitionDate:0}if(r.length>2){var a=+r[2];n.renewalDate=+new Date(a),n.renewalDate=n.renewalDate>0?n.renewalDate:0}}catch(e){cr(i,1,510,"Error parsing ai_session cookie, session will be reset: "+e)}0===n.renewalDate&&cr(i,2,517,"AI session renewal date is 0, session will be reset.")}function u(){var e=t.automaticSession,n=(new Date).getTime(),r=t.config.sessionAsGuid();!Ft(r)&&r?tn(r)?e.setId(Ko()):e.setId(Ko(r)):e.setId(Kr(c&&c.idLength?c.idLength():22)),e.acquisitionDate=n,e.renewalDate=n,d(e.getId(),e.acquisitionDate,e.renewalDate),Hi()||cr(i,2,505,"Browser does not support local storage. Session durations will be inaccurate.")}function d(e,n,i){var s=n+t.config.sessionExpirationMs(),c=i+t.config.sessionRenewalMs(),l=new Date,u=[e,n,i];s<c?l.setTime(s):l.setTime(c);var d=t.config.cookieDomain?t.config.cookieDomain():null;a.set(o(),u.join("|")+";expires="+l.toUTCString(),null,d),r=(new Date).getTime()}jt(n.sessionExpirationMs)||(c.sessionExpirationMs=function(){return e.acquisitionSpan}),jt(n.sessionRenewalMs)||(c.sessionRenewalMs=function(){return e.renewalSpan}),t.config=c,o=function(){return t.config.namePrefix&&t.config.namePrefix()?ji+t.config.namePrefix():ji},t.automaticSession=new Gi,t.update=function(){t.automaticSession.getId()||function(){var e=a.get(o());if(e&&jt(e.split))l(e);else{var n=function(e,t){var n=Fi();if(null!==n)try{return n.getItem(t)}catch(t){Ti=!1,cr(e,1,503,"Browser failed read of local storage. "+t)}return null}(i,o());n&&l(n)}t.automaticSession.getId()||u()}();var n=t.automaticSession,s=t.config,c=(new Date).getTime(),h=c-n.acquisitionDate>s.sessionExpirationMs(),g=c-n.renewalDate>s.sessionRenewalMs();h||g?u():(!r||c-r>e.cookieUpdateInterval)&&(n.renewalDate=c,d(n.getId(),n.acquisitionDate,n.renewalDate))},t.backup=function(){var e,n,r,a=t.automaticSession;e=a.getId(),n=a.acquisitionDate,r=a.renewalDate,function(e,t,n){var r=Fi();if(null!==r)try{return r.setItem(t,n),!0}catch(t){Ti=!1,cr(e,1,504,"Browser failed write to local storage. "+t)}}(i,o(),[e,n,r].join("|"))}})}return e.acquisitionSpan=864e5,e.renewalSpan=18e5,e.cookieUpdateInterval=6e4,e}(),Vi=["AX","EX","SF","CS","CF","CT","CU","DC","DF","H5","HL","WS","WP"];function Qi(e,t){void 0===t&&(t=Vi);var n=null;if(e)for(var r=e.split(","),o=0;o<r.length;o++)Ji(r[o],t)&&(n?n+=","+r[o]:n=r[o]);return n}function Ji(e,t){if(void 0===t&&(t=Vi),!e||e.length<4)return!1;for(var n=!1,r=e.substring(0,3).toString().toUpperCase(),o=0;o<t.length;o++)if(t[o]+":"===r&&e.length<=256){n=!0;break}return n}function Yi(){return this.getExpId()}var Xi=function(){function e(t,n){var r=null,o=Vi.slice(0),i=br(n),a=t;ne(e,this,function(e){if(Un()){var n=Dn().documentElement;n&&(e.locale=n.lang)}function s(e){e!==r&&(r=Qi(e,o))}e.env=t.env?t.env:function(e){var t,n={},r=Dn();if(r){t=r&&r.querySelectorAll("meta");for(var o=0;o<t.length;o++){var i=t[o];i.name&&0===i.name.toLowerCase().indexOf(e)&&(n[i.name.replace(e,"")]=i.content)}}return n}("awa-").env,e.getExpId=function(){return a.expId?(s(a.expId),r):(s(zo(i,"Treatments")),r)}})}return e.validateAppExpId=Qi,e._staticInit=void dn(e.prototype,"expId",Yi),e}(),Zi=function(){},ea=function(){};function ta(){return this.getMsfpc()}function na(){return this.getAnid()}var ra=function(){function e(t,n){var r=br(n);ne(e,this,function(e){t.serviceName&&(e.serviceName=t.serviceName),e.getMsfpc=function(){return zo(r,"MSFPC")},e.getAnid=function(){return zo(r,"ANON").slice(0,34)}})}var t;return e._staticInit=(dn(t=e.prototype,"msfpc",ta),void dn(t,"anid",na)),e}(),oa=function(){var e=(new Date).getTimezoneOffset(),t=e%60,n=(e-t)/60,r="+";n>0&&(r="-"),n=Math.abs(n),t=Math.abs(t),this.tz=r+(n<10?"0"+n:n.toString())+":"+(t<10?"0"+t:t.toString())},ia={WIN:/(windows|win32)/i,WINRT:/ arm;/i,WINPHONE:/windows\sphone\s\d+\.\d+/i,OSX:/(macintosh|mac os x)/i,IOS:/(ipad|iphone|ipod)(?=.*like mac os x)/i,LINUX:/(linux|joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk)/i,ANDROID:/android/i,CROS:/CrOS/i},aa={5.1:"XP","6.0":"Vista",6.1:"7",6.2:"8",6.3:"8.1","10.0":"10"},sa="([\\d,_,.]+)",ca="Unknown",la=[{r:ia.WINPHONE,os:"Windows Phone"},{r:ia.WINRT,os:"Windows RT"},{r:ia.WIN,os:"Windows"},{r:ia.IOS,os:"iOS"},{r:ia.ANDROID,os:"Android"},{r:ia.LINUX,os:"Linux"},{r:ia.CROS,os:"Chrome OS"},{s:"x11",os:"Unix"},{s:"blackberry",os:"BlackBerry"},{s:"symbian",os:"Symbian"},{s:"nokia",os:"Nokia"},{r:ia.OSX,os:"Mac OS X"}];function ua(e,t){var n=e.match(new RegExp(t+" ([\\d,.]+)"));return n?aa[n[1]]?aa[n[1]]:n[1]:ca}function da(e){return e.indexOf(".")>-1?".":e.indexOf("_")>-1?"_":null}var ha=function(e){if(e.populateOperatingSystemInfo){var t=this,n=Hn()||{},r=e.userAgent||n.userAgent||"",o=e.userAgentData||n.userAgentData||{};if(r){var i=function(e){for(var t=0;t<la.length;t++){var n=la[t];if(n.r&&e.match(n.r))return n.os;if(n.s&&-1!==e.indexOf(n.s))return n.os}return ca}(r.toLowerCase());t.name=i,t.ver=function(e,t){return"Windows"===t?ua(e,"Windows NT"):"Android"===t?ua(e,t):"Mac OS X"===t?function(e){var t=e.match(new RegExp("Mac OS X "+sa));if(t){var n=t[1].replace(/_/g,".");if(n){var r=da(n);return r?n.split(r)[0]:n}}return ca}(e):"iOS"===t?function(e){var t=e.match(new RegExp("OS "+sa));if(t){var n=t[1].replace(/_/g,".");if(n){var r=da(n);return r?n.split(r)[0]:n}}return ca}(e):ca}(r,i)}t.name&&t.name!==ca||!Zt(o.platform)||(t.name=o.platform)}},ga="MicrosoftApplicationsTelemetryDeviceId",pa=function(){function e(t,n){var r=0;ne(e,this,function(e){var o=t.propertyStorageOverride;e.seq=r,e.epoch=Fr(!1).toString();var i=br(n,t);if(i.isEnabled()||o){var a=function(e,t,n){return t?t.getProperty(n)||"":zo(e,n)}(i,o,ga);a||(a=Eo()),function(e,t,n,r){t?t.setProperty(n,r):e.set(n,r,31536e3)}(i,o,ga,a),e.installId=a}else i.purge(ga);e.getSequenceId=function(){return++r}})}return e.__ieDyn=1,e}(),fa=function(e,t,n,r){var o=this;if(o.traceId=t||_o(),e.enableDistributedTracing&&!n&&(n=_o().substring(0,16)),o.parentId=n,e.enableApplicationInsightsTrace){o.name=r;var i=Fn();i&&i.pathname&&(o.name=i.pathname)}},ma="setLocalId";function ya(){return this.getLocalId()}function va(e){this[ma](e)}var Ca=function(){function e(t,n,r){var o,i=n,a=br(r,t);ne(e,this,function(n){if(a&&a.isEnabled()&&(h(),i.enableApplicationInsightsUser)){var r=zo(a,e.userCookieName);if(r){var s=r.split(e.cookieSeparator);s.length>0&&(n.id=s[0])}if(!n.id){n.id=Kr(t&&!Ft(t.idLength)?t.idLength:22);var c=rn(new Date);n.accountAcquisitionDate=c;var l=[n.id,c],u=i.cookieDomain?i.cookieDomain:void 0;a.set(e.userCookieName,l.join(e.cookieSeparator),31536e3,u)}}if("undefined"!=typeof navigator){var d=navigator;n.locale=d.userLanguage||d.language}function h(){if(!i.hashIdentifiers&&!i.dropIdentifiers){var e=zo(a,"MUID");e&&(o="t:"+e)}return o}n.getLocalId=function(){return o||h()},n[ma]=function(e){o=e}})}return e.cookieSeparator="|",e.userCookieName="ai_user",e._staticInit=void dn(e.prototype,"localId",ya,va),e}(),wa=function(e){var t=this;t.popSample=100,t.eventFlags=0,e.hashIdentifiers&&(t.eventFlags=1048576|t.eventFlags),e.dropIdentifiers&&(t.eventFlags=2097152|t.eventFlags),e.scrubIpOnly&&(t.eventFlags=4194304|t.eventFlags)},Ia=["Required","Analytics","SocialMedia","Advertising"],Ta="([\\d,.]+)",Aa="Unknown",ka="Edg/",Sa=[{ua:"OPR/",b:"Opera"},{ua:"PhantomJS",b:"PhantomJS"},{ua:"Edge",b:"Edge"},{ua:ka,b:"Edge"},{ua:"Electron",b:"Electron"},{ua:"Chrome",b:"Chrome"},{ua:"Trident",b:"MSIE"},{ua:"MSIE ",b:"MSIE"},{ua:"Firefox",b:"Firefox"},{ua:"Safari",b:"Safari"},{ua:"SkypeShell",b:"SkypeShell"}],ba=[{br:"Microsoft Edge",b:"Edge"},{br:"Google Chrome",b:"Chrome"},{br:"Opera",b:"Opera"}];function Ra(e,t){return t.indexOf(e)>-1}function Ea(e,t){for(var n=0;n<t.length;n++)if(e==t[n].brand)return t[n].version;return null}function Pa(){return this.getUserConsent()}var _a=function(){function e(t,n){var r=br(n),o=t||{};ne(e,this,function(e){var t=Fn();if(t){var n=t.hostname;n&&(e.domain="file:"===t.protocol?"local":n)}if(o.populateBrowserInfo){var i=o.userAgent,a=(o.userAgentData||{}).brands,s=Hn();s&&(i=i||s.userAgent||"",a=a||(s.userAgentData||{}).brands),function(t,n){if(Yt(n))try{for(var r=0;r<ba.length;r++){var o=Ea(ba[r].br,n);if(o)return e.browser=ba[r].b,void(e.browserVer=o)}}catch(e){}if(t){var i=function(e){if(e)for(var t=0;t<Sa.length;t++)if(Ra(Sa[t].ua,e))return Sa[t].b;return Aa}(t);e.browser=i,e.browserVer=function(e,t){return"MSIE"===t?function(e){var t=e.match(new RegExp("MSIE "+Ta));if(t)return t[1];var n=e.match(new RegExp("rv:"+Ta));return n?n[1]:void 0}(e):function(e,t){"Safari"===e?e="Version":"Edge"===e&&Ra(ka,t)&&(e="Edg");var n=t.match(new RegExp(e+"/"+Ta));return n||"Opera"===e&&(n=t.match(new RegExp("OPR/"+Ta)))?n[1]:Aa}(t,e)}(t,i)}}(i,a);var c=function(){var e={h:0,w:0},t=xn();return t&&t.screen&&(e.h=screen.height,e.w=screen.width),e}();e.screenRes=c.w+"X"+c.h}Ft(o.gpcDataSharingOptIn)?e.gpcDataSharingOptIn=null:e.gpcDataSharingOptIn=o.gpcDataSharingOptIn,e.getUserConsent=function(){return o.userConsented||!!zo(r,o.userConsentCookieName||"MSCC")},e.getUserConsentDetails=function(){var t=null;try{var n=o.callback;if(n&&n.userConsentDetails){var r=n.userConsentDetails();if(r){t=o.disableConsentDetailsSanitize?r:{};for(var i=0;i<Ia.length;i++){var a=Ia[i];t[a]=r[a]||!1}}}var s=e.gpcDataSharingOptIn;return null!==s&&((t=t||{}).GPC_DataSharingOptIn=!!s),t?JSON.stringify(t):null}catch(e){}},dn(e,"userConsent",e.getUserConsent)})}return e._staticInit=void dn(e.prototype,"userConsent",Pa),e}();function Ma(e,t,n,r,o){var i=t.ext[bi[e]];if(i)try{Vt(r,function(e,t){if(Zt(t)||en(t)||tn(t)){var r=i[n[e]];!o&&(r||Zt(r)||en(r)||tn(r))&&(t=r),i[n[e]]=t}})}catch(e){}return i}var Oa=function(){function e(t,n,r){ne(e,this,function(e){e.app=new Xi(n,r),e.cloud=new Zi,e.user=new Ca(t,n,r),e.os=new ha(n),e.web=new _a(n,r);var o=new pa(t,r),i=new ra(n,r),a=new wa(n);e.loc=new oa,e.device=new ea;var s=new Wi(r,n);e.session=new Gi;var c,l,u,d=(c=new fa(n),l=p(),u=c||{},{getName:function(){return u.name},setName:function(e){l&&l.setName(e),u.name=e},getTraceId:function(){return u.traceId},setTraceId:function(e){l&&l.setTraceId(e),ri(e)&&(u.traceId=e)},getSpanId:function(){return u.parentId},setSpanId:function(e){l&&l.setSpanId(e),oi(e)&&(u.parentId=e)},getTraceFlags:function(){return u.traceFlags},setTraceFlags:function(e){l&&l.setTraceFlags(e),u.traceFlags=e}}),h=!(n||{}).eventContainExtFields;function g(){var t=e.session;if(t&&Zt(t.customId))return t.customId;s.update();var n=s.automaticSession;if(n){var r=n.getId();r&&Zt(r)&&(t.automaticId=r)}return t.automaticId}function p(){var e=d;return r&&r.getTraceCtx&&(e=r.getTraceCtx(!1)||d),e}e.getTraceCtx=function(){return d},e.getSessionId=g,e.applyApplicationContext=function(t){var n,r=e.app;Ma(4,t,Ri,((n={})[0]=r.id,n[1]=r.ver,n[2]=r.name,n[3]=r.locale,n[4]=r.getExpId(),n[5]=r.env,n),h)},e.applyUserContext=function(t){var n,r=e.user;Ma(0,t,Pi,((n={})[1]=r.getLocalId(),n[0]=r.locale,n[2]=r.id,n),h)},e.applyWebContext=function(t){var n,r=e.web;Ma(3,t,Ei,((n={})[0]=r.domain,n[1]=r.browser,n[2]=r.browserVer,n[3]=r.screenRes,n[5]=r.getUserConsentDetails(),n[4]=r.getUserConsent(),n),h)},e.applyOsContext=function(t){var n,r=e.os;Ma(5,t,_i,((n={})[0]=r.name,n[1]=r.ver,n),h)},e.applySdkContext=function(e){var t;Ma(6,e,Mi,((t={})[2]=o.installId,t[1]=o.getSequenceId(),t[3]=o.epoch,t),h)},e.applyIntWebContext=function(e){var t;Ma(7,e,Oi,((t={})[0]=i.getMsfpc(),t[1]=i.getAnid(),t[2]=i.serviceName,t),h)},e.applyUtcContext=function(e){var t,n=((t={})[0]=a.popSample,t);a.eventFlags>0&&(n[1]=a.eventFlags),Ma(8,e,Ni,n,h)},e.applyLocContext=function(t){var n;Ma(9,t,qi,((n={})[0]=e.loc.tz,n),h)},e.applySessionContext=function(e){var t;Ma(4,e,Li,((t={})[0]=g(),t),h)},e.applyDeviceContext=function(t){var n,r=e.device;Ma(1,t,xi,((n={})[0]=r.localId,n[2]=r.make,n[3]=r.model,n[1]=r.deviceClass,n),h)},e.applyCloudContext=function(t){var n,r=e.cloud;Ma(10,t,Ui,((n={})[0]=r.role,n[1]=r.roleInstance,n[2]=r.roleVer,n),h)},e.applyAITraceContext=function(e){var t;if(n.enableApplicationInsightsTrace){var r=p();r&&Ma(2,e,Di,((t={})[0]=r.getTraceId(),t[1]=r.getName(),t[2]=r.getSpanId(),t),!1)}},e.applyDistributedTraceContext=function(e){var t,n=p();if(n){var r=((t={})[0]=n.getTraceId(),t[1]=n.getSpanId(),t),o=n.getTraceFlags();zt(o)||(r[2]=o),Ma(11,e,Bi,r,!1)}}})}return e.__ieDyn=1,e}(),Na=[bi[4],bi[0],bi[3],bi[5],bi[6],bi[7],bi[8],bi[9],bi[1],bi[2],bi[11],bi[10]];const qa=function(e){function t(){var n,r,o,i=e.call(this)||this;return i.identifier="SystemPropertiesCollector",i.priority=3,i.version="3.2.18",ne(t,i,function(e,t){function i(){n=null,r={}}i(),e.initialize=function(r,i,a){t.initialize(r,i,a),o=e._getTelCtx().getExtCfg(e.identifier),n=new Oa(r,o,i),i&&i.setTraceCtx&&i.setTraceCtx(n.getTraceCtx())},e.processTelemetry=function(t,i){jo(t,e.identifier),i=e._getTelCtx(i);var a,s,c=t.ext=t.ext?t.ext:{};t.data=t.data?t.data:{},on(Na,function(e){c[e]=c[e]||{}}),n&&(n.applyUtcContext(t),n.applyApplicationContext(t),n.applyUserContext(t),n.applyWebContext(t),n.applyOsContext(t),n.applySdkContext(t),n.applyIntWebContext(t),n.applyLocContext(t),n.applySessionContext(t),n.applyDeviceContext(t),o.enableApplicationInsightsTrace&&n.applyAITraceContext(t),o.enableDistributedTracing&&n.applyDistributedTraceContext(t),n.applyCloudContext(t)),on(un(c),function(e){0===un(c[e]).length&&delete c[e]}),a=r,s=t.data,a&&Vt(a,function(e,t){s[e]||(s[e]=t)}),e.processNext(t,i)},e.getPropertiesContext=function(){return n},e.setProperty=function(e,t){r[e]=t},e._doTeardown=function(e,t){var r=(e||{}).core();if(r&&r.getTraceCtx&&n){var o=r.getTraceCtx(!1);o&&o===n.getTraceCtx()&&r.setTraceCtx(null)}i()}}),i}return I(t,e),t.__ieDyn=1,t}(Ci);function La(e,t,n){t&&Yt(t)&&t[he]>0&&(on(t=t.sort(function(e,t){return e[lt]-t[lt]}),function(e){e[lt]<500&&wn("Channel has invalid priority - "+e[ae])}),e[se]({queue:gn(t),chain:mi(t,n[le],n)}))}var xa=function(e){function t(){var n,r,o=e.call(this)||this;function i(){n=0,r=[]}return o.identifier="TelemetryInitializerPlugin",o.priority=199,i(),ne(t,o,function(e,t){e.addTelemetryInitializer=function(e){var t={id:n++,fn:e};return r[se](t),{remove:function(){on(r,function(e,n){if(e.id===t.id)return r[Ae](n,1),-1})}}},e[ct]=function(t,n){for(var o=!1,i=r[he],a=0;a<i;++a){var s=r[a];if(s)try{if(!1===s.fn[ze](null,[t])){o=!0;break}}catch(e){cr(n[Me](),1,64,"One of telemetry initializers failed, telemetry item will not be sent: "+fn(e),{exception:jn(e)},!0)}}o||e[pe](t,n)},e[Ee]=function(){i()}}),o}return I(t,e),t.__ieDyn=1,t}(Ci),Ua="Plugins must provide initialize method",Da="_notificationManager",Ba="SDK is still unloading...",Ha={loggingLevelConsole:1};function Fa(e,t){return new Zo(t)}function za(e,t){var n=!1;return on(t,function(t){if(t===e)return n=!0,-1}),n}var Ka=function(){function e(){var t,n,r,o,i,a,s,c,l,u,d,h,g,p,f,m,v,C,w,I,A=0,k=!1;ne(e,this,function(e){function S(n){if(!A&&!k&&(n||e[de]&&e[de].queue[he]>0)){var r=vn(t.diagnosticLogInterval);r&&r>0||(r=1e4),A=setInterval(function(){clearInterval(A),A=0,O()},r)}return A}function b(){n=!1,t=An(!0,{},Ha),e[le]=t,e[de]=new ar(t),e[Te]=[],f=new xa,r=[],o=null,i=null,a=null,s=null,c=null,u=null,l=[],d=null,h=null,g=null,p=!1,m=null,v=Qr("AIBaseCore",!0),C=yi(),I=null}function R(){var n=gi(_(),t,e);return n[Ce](S),n}function E(n){var r=function(e,t,n){var r,o=[],i={};return on(n,function(t){(zt(t)||zt(t[re]))&&wn(Ua);var n=t[lt],r=t[ae];t&&n&&(zt(i[n])?i[n]=r:lr(e,"Two extensions have same priority #"+n+" - "+i[n]+", "+r)),(!n||n<500)&&o[se](t)}),(r={all:n})[ot]=o,r}(e[de],0,l);u=r[ot],c=null;var o=r.all;if(g=gn(function(e,t,n){var r=[];if(e&&on(e,function(e){return La(r,e,n)}),t){var o=[];on(t,function(e){e[lt]>500&&o[se](e)}),La(r,o,n)}return r}(h,o,e)),d){var i=an(o,d);-1!==i&&o[Ae](i,1),-1!==(i=an(u,d))&&u[Ae](i,1),d._setQueue(g)}else d=function(e,t){function n(){return gi(null,t[le],t,null)}function r(e,t,n,r){var o=e?e[he]+1:1;function i(){0===--o&&(r&&r(),r=null)}o>0&&on(e,function(e){if(e&&e.queue[he]>0){var r=e.chain,a=t[Ne](r);a[Ce](i),n(a)}else o--}),i()}var o=!1,i={identifier:"ChannelControllerPlugin",priority:500,initialize:function(t,n,r,i){o=!0,on(e,function(e){e&&e.queue[he]>0&&si(gi(e.chain,t,n),r)})},isInitialized:function(){return o},processTelemetry:function(t,o){r(e,o||n(),function(e){e[pe](t)},function(){o[pe](t)})},update:function(t,n){var o=n||{reason:0};return r(e,t,function(e){e[pe](o)},function(){t[pe](o)}),!0},pause:function(){r(e,n(),function(e){e.iterate(function(e){e.pause&&e.pause()})},null)},resume:function(){r(e,n(),function(e){e.iterate(function(e){e.resume&&e.resume()})},null)},teardown:function(t,n){var i=n||{reason:0,isAsync:!1};return r(e,t,function(e){e[pe](i)},function(){t[pe](i),o=!1}),!0},getChannel:function(t){var n=null;return e&&e[he]>0&&on(e,function(e){if(e&&e.queue[he]>0&&(on(e.queue,function(e){if(e[ae]===t)return n=e,-1}),n))return-1}),n},flush:function(t,o,i,a){var s=1,c=!1,l=null;function u(){s--,c&&0===s&&(l&&(clearTimeout(l),l=null),o&&o(c),o=null)}return a=a||5e3,r(e,n(),function(e){e.iterate(function(e){if(e[Ie]){s++;var n=!1;e[Ie](t,function(){n=!0,u()},i)||n||(t&&null==l?l=setTimeout(function(){l=null,u()},a):u())}})},function(){c=!0,u()}),!0},_setQueue:function(t){e=t}};return i}(g,e);o[se](d),u[se](d),e[Te]=ci(o),d[re](t,e,o),si(R(),o),e[Te]=gn(ci(u||[])).slice(),n&&function(t){var n=fi(_(),e);n[Ce](S),e._updateHook&&!0===e._updateHook(n,t)||n[pe](t)}(n)}function P(t){var n,r=null,o=null;return on(e[Te],function(e){if(e[ae]===t&&e!==d&&e!==f)return o=e,-1}),!o&&d&&(o=d.getChannel(t)),o&&((n={plugin:o})[Be]=function(e){ai(o)[at]=!e},n.isEnabled=function(){var e=ai(o);return!e[ke]&&!e[at]},n.remove=function(e,t){var n;void 0===e&&(e=!0);var r=[o],i=((n={reason:1})[Re]=e,n);M(r,i,function(e){e&&E({reason:32,removed:r}),t&&t(e)})},r=n),r}function _(){if(!c){var n=(u||[]).slice();-1===an(n,f)&&n[se](f),c=mi(ci(n),t,e)}return c}function M(n,r,o){if(n&&n[he]>0){var i=pi(mi(n,t,e),e);i[Ce](function(){var e=!1,t=[];on(l,function(r,o){za(r,n)?e=!0:t[se](r)}),l=t;var r=[];h&&(on(h,function(t,o){var i=[];on(t,function(t){za(t,n)?e=!0:i[se](t)}),r[se](i)}),h=r),o&&o(e),S()}),i[pe](r)}else o(!1)}function O(){if(e[de]&&e[de].queue){var n=e[de].queue.slice(0);e[de].queue[he]=0,on(n,function(n){var r,o=((r={})[oe]=m||"InternalMessageId: "+n[Se],r.iKey=vn(t[ue]),r.time=rn(new Date),r.baseType=or.dataType,r.baseData={message:n[be]},r);e.track(o)})}}function N(e,t,n,r){return d?d[Ie](e,t,n||6,r):(t&&t(!1),!0)}function q(t){var n=e[de];n?(cr(n,2,73,t),S()):wn(t)}var L,x,U;b(),e[ce]=function(){return n},e[re]=function(r,i,s,c){var u,d;p&&wn(Ba),e[ce]()&&wn("Core should not be initialized more than once"),t=r||{},e[le]=t,zt(r[ue])&&wn("Please provide instrumentation key"),o=c,e[Da]=c,!0===(d=vn(t.disableDbgExt))&&w&&(o[ye](w),w=null),o&&!w&&!0!==d&&(w=function(e){if(!Yn){Yn={};for(var t=0;t<Xn[he];t++)Yn[Xn[t]]=er(Xn[t],e)}return Yn}(t),o[me](w)),!(u=vn(t.enablePerfMgr))&&a&&(a=null),u&&yn(t,it,Fa),yn(t,st,{}).NotificationManager=o,s&&(e[de]=s);var f=yn(t,"extensions",[]);(l=[])[se].apply(l,T(T([],i),f)),h=yn(t,rt,[]),E(null),g&&0!==g[he]||wn("No "+rt+" available"),n=!0,e.releaseQueue()},e.getTransmissionControls=function(){var e=[];return g&&on(g,function(t){e[se](t.queue)}),gn(e)},e.track=function(n){n.iKey=n.iKey||t[ue],n[ge]=n[ge]||rn(new Date),n.ver=n.ver||"4.0",!p&&e[ce]()?R()[pe](n):r[se](n)},e[fe]=R,e[ie]=function(){return o||(o=function(){var e;return y(((e={})[me]=function(e){},e[ye]=function(e){},e[ut]=function(e){},e[dt]=function(e,t){},e[ht]=function(e,t){},e))}(),e[Da]=o),o},e[me]=function(e){o&&o[me](e)},e[ye]=function(e){o&&o[ye](e)},e.getCookieMgr=function(){return s||(s=Rr(t,e[de])),s},e.setCookieMgr=function(e){s=e},e[mt]=function(){if(!i&&!a&&vn(t.enablePerfMgr)){var n=vn(t[it]);jt(n)&&(a=n(e,e[ie]()))}return i||a||null},e.setPerfMgr=function(e){i=e},e.eventCnt=function(){return r[he]},e.releaseQueue=function(){if(n&&r[he]>0){var e=r;r=[],on(e,function(e){R()[pe](e)})}},e.pollInternalLogs=function(e){return m=e||null,k=!1,A&&(clearInterval(A),A=null),S(!0)},e[ve]=function(){k=!0,A&&(clearInterval(A),A=0,O())},x=function(){return f},U=["addTelemetryInitializer"],(L=e)&&x&&Gt(L)&&Yt(U)&&on(U,function(e){Zt(e)&&In(L,e,x,e,void 0)}),e.unload=function(t,r,o){var i;void 0===t&&(t=!0),n||wn("SDK is not initialized"),p&&wn(Ba);var a=((i={reason:50})[Re]=t,i.flushComplete=!1,i),s=pi(_(),e);function c(t){a.flushComplete=t,p=!0,C.run(s,a),e[ve](),s[pe](a)}s[Ce](function(){b(),r&&r(a)},e),O(),N(t,c,6,o)||c(!1)},e[we]=P,e.addPlugin=function(e,t,n,r){if(!e)return r&&r(!1),void q(Ua);var o=P(e[ae]);if(o&&!t)return r&&r(!1),void q("Plugin ["+e[ae]+"] is already loaded!");var i={reason:16};function a(t){l[se](e),i.added=[e],E(i),r&&r(!0)}if(o){var s=[o.plugin];M(s,{reason:2,isAsync:!!n},function(e){e?(i.removed=s,i.reason|=32,a()):r&&r(!1)})}else a()},e.evtNamespace=function(){return v},e[Ie]=N,e.getTraceCtx=function(e){var t;return I||(t={},I={getName:function(){return t[oe]},setName:function(e){t[oe]=e},getTraceId:function(){return t[Ze]},setTraceId:function(e){ri(e)&&(t[Ze]=e)},getSpanId:function(){return t[et]},setSpanId:function(e){oi(e)&&(t[et]=e)},getTraceFlags:function(){return t[tt]},setTraceFlags:function(e){t[tt]=e}}),I},e.setTraceCtx=function(e){I=e||null},In(e,"addUnloadCb",function(){return C},"add")})}return e.__ieDyn=1,e}();function $a(e,t,n,r){on(e,function(e){if(e&&e[t])if(n)setTimeout(function(){return r(e)},0);else try{r(e)}catch(e){}})}var Ga=function(){function e(t){this.listeners=[];var n=!!(t||{}).perfEvtsSendAll;ne(e,this,function(e){e[me]=function(t){e.listeners[se](t)},e[ye]=function(t){for(var n=an(e[Ve],t);n>-1;)e.listeners[Ae](n,1),n=an(e[Ve],t)},e[ut]=function(t){$a(e[Ve],ut,!0,function(e){e[ut](t)})},e[dt]=function(t,n){$a(e[Ve],dt,!0,function(e){e[dt](t,n)})},e[ht]=function(t,n){$a(e[Ve],ht,n,function(e){e[ht](t,n)})},e[gt]=function(t){t&&(!n&&t[Qe]()||$a(e[Ve],gt,!1,function(e){t[Re]?setTimeout(function(){return e[gt](t)},0):e[gt](t)}))}})}return e.__ieDyn=1,e}(),ja=function(e){function t(){var n=e.call(this)||this;return ne(t,n,function(e,t){function n(t){var n=e[ie]();n&&n[dt]([t],2)}e[re]=function(e,n,r,o){t[re](e,n,r||new ar(e),o||new Ga(e))},e.track=function(r){ti(e[mt](),function(){return"AppInsightsCore:track"},function(){null===r&&(n(r),wn("Invalid telemetry item")),function(e){zt(e[oe])&&(n(e),wn("telemetry name required"))}(r),t.track(r)},function(){return{item:r}},!r.sync)}}),n}return I(t,e),t.__ieDyn=1,t}(Ka),Wa=function(e){function t(){var n=e.call(this)||this;return n.pluginVersionStringArr=[],ne(t,n,function(e,t){e.logger&&e.logger.queue||(e.logger=new ar({loggingLevelConsole:1})),e.initialize=function(n,r,o,i){ti(e,function(){return"AppInsightsCore.initialize"},function(){var a=e.pluginVersionStringArr;if(n){n.endpointUrl||(n.endpointUrl="https://browser.events.data.microsoft.com/OneCollector/1.0/");var s=n.propertyStorageOverride;!s||s.getProperty&&s.setProperty||wn("Invalid property storage override passed."),n.channels&&on(n.channels,function(e){e&&on(e,function(e){if(e.identifier&&e.version){var t=e.identifier+"="+e.version;a.push(t)}})})}e.getWParam=function(){return"undefined"!=typeof document||n.enableWParam?0:-1},r&&on(r,function(e){if(e&&e.identifier&&e.version){var t=e.identifier+"="+e.version;a.push(t)}}),e.pluginVersionString=a.join(";"),e.pluginVersionStringArr=a;try{t.initialize(n,r,o,i),e.pollInternalLogs("InternalLog")}catch(t){var c=e.logger,l=jn(t);-1!==l.indexOf("channels")&&(l+="\n - Channels must be provided through config.channels only!"),cr(c,1,514,"SDK Initialization Failed - no telemetry will be sent: "+l)}},function(){return{config:n,extensions:r,logger:o,notificationManager:i}})},e.track=function(n){ti(e,function(){return"AppInsightsCore.track"},function(){var r=n;if(r){r.timings=r.timings||{},r.timings.trackStart=Go(),Fo(r.latency)||(r.latency=1);var o=r.ext=r.ext||{};o.sdk=o.sdk||{},o.sdk.ver=Lo;var i=r.baseData=r.baseData||{};i[qo]=i[qo]||{};var a=i[qo];a[No]=a[No]||e.pluginVersionString||Oo}t.track(r)},function(){return{item:n}},!n.sync)}}),n}return I(t,e),t.__ieDyn=1,t}(ja);const Va=Wa;var Qa=wi({Unknown:0,NonRetryableStatus:1,InvalidEvent:2,SizeLimitExceeded:3,KillSwitch:4,QueueFull:5}),Ja="REAL_TIME",Ya="NEAR_REAL_TIME",Xa="BEST_EFFORT",Za="",es="POST",ts="drop",ns="requeue",rs="application/x-json-stream",os="cache-control",is="content-type",as="kill-duration",ss="time-delta-millis",cs="client-version",ls="client-id",us="time-delta-to-apply-millis",ds="upload-time",hs="apikey",gs="AuthMsaDeviceTicket",ps="AuthXToken",fs="msfpc",ms="trace",ys="user";function vs(e){var t=(e.ext||{}).intweb;return t&&Bo(t[fs])?t[fs]:null}function Cs(e){for(var t=null,n=0;null===t&&n<e.length;n++)t=vs(e[n]);return t}var ws=function(){function e(t,n){var r=n?[].concat(n):[],o=this,i=Cs(r);o.iKey=function(){return t},o.Msfpc=function(){return i||Za},o.count=function(){return r.length},o.events=function(){return r},o.addEvent=function(e){return!!e&&(r.push(e),i||(i=vs(e)),!0)},o.split=function(n,o){var a;if(n<r.length){var s=r.length-n;zt(o)||(s=o<s?o:s),a=r.splice(n,s),i=Cs(r)}return new e(t,a)}}return e.create=function(t,n){return new e(t,n)},e}();const Is=function(){function e(){var t=!0,n=!0,r=!0,o="use-collector-delta",i=!1;ne(e,this,function(e){e.allowRequestSending=function(){return t},e.firstRequestSent=function(){r&&(r=!1,i||(t=!1))},e.shouldAddClockSkewHeaders=function(){return n},e.getClockSkewHeaderValue=function(){return o},e.setClockSkew=function(e){i||(e?(o=e,n=!0,i=!0):n=!1,t=!0)}})}return e.__ieDyn=1,e}();var Ts=function(){function e(){var t={};ne(e,this,function(e){e.setKillSwitchTenants=function(e,n){if(e&&n)try{var r=function(e){var t=[];return e&&on(e,function(e){t.push(sn(e))}),t}(e.split(","));if("this-request-only"===n)return r;for(var o=1e3*parseInt(n,10),i=0;i<r.length;++i)t[r[i]]=pn()+o}catch(e){return[]}return[]},e.isTenantKilled=function(e){var n=t,r=sn(e);return void 0!==n[r]&&n[r]>pn()||(delete n[r],!1)}})}return e.__ieDyn=1,e}();const As=Ts;function ks(e){var t,n=Math.floor(1200*Math.random())+2400;return t=Math.pow(2,e)*n,Math.min(t,6e5)}var Ss,bs=2e6,Rs=Math.min(bs,65e3),Es="metadata",Ps="f",_s=/\./,Ms=function(){function e(t,n,r,o){var i="data",a="baseData",s=!!o,c=!0,l=n,u={};ne(e,this,function(e){function n(e,t,o,i,a,c,d){Vt(e,function(e,h){var p=null;if(h||Bo(h)){var f=o,m=e,y=a,v=t;if(s&&!i&&_s.test(e)){var C=e.split("."),w=C.length;if(w>1){y&&(y=y.slice());for(var I=0;I<w-1;I++){var T=C[I];v=v[T]=v[T]||{},f+="."+T,y&&y.push(T)}m=C[w-1]}}var A=i&&function(e){var t=u[e];return void 0===t&&(e.length>=7&&(t=Qt(e,"ext.metadata")||Qt(e,"ext.web")),u[e]=t),t}(f);if(p=!A&&l&&l.handleField(f,m)?l.value(f,m,h,r):function(e,t,n){if(!t&&!Bo(t)||"string"!=typeof e)return null;var r,o=typeof t;if("string"===o||"number"===o||"boolean"===o||Yt(t))t={value:t};else if("object"!==o||g.call(t,"value")){if(zt(t.value)||t.value===Oo||!Zt(t.value)&&!en(t.value)&&!tn(t.value)&&!Yt(t.value))return null}else t={value:n?JSON.stringify(t):t};if(Yt(t.value)&&!(t.value.length>0))return null;if(!zt(t.kind)){if(Yt(t.value)||!(0===(r=t.kind)||r>0&&r<=13||32===r))return null;t.value=t.value.toString()}return t}(m,h,r)){var k=p.value;if(v[m]=k,c&&c(y,m,p),d&&"object"==typeof k&&!Yt(k)){var S=y;S&&(S=S.slice()).push(m),n(h,k,f+"."+m,i,S,c,d)}}}})}e.createPayload=function(e,t,n,r,o,i){return{apiKeys:[],payloadBlob:Za,overflow:null,sizeExceed:[],failedEvts:[],batches:[],numEvents:0,retryCnt:e,isTeardown:t,isSync:n,isBeacon:r,sendType:i,sendReason:o}},e.appendPayload=function(n,r,o){var i=n&&r&&!n.overflow;return i&&ti(t,function(){return"Serializer:appendPayload"},function(){for(var t=r.events(),i=n.payloadBlob,a=n.numEvents,s=!1,c=[],l=[],u=n.isBeacon,d=u?65e3:3984588,h=u?Rs:bs,g=0,p=0;g<t.length;){var f=t[g];if(f){if(a>=o){n.overflow=r.split(g);break}var m=e.getEventBlob(f);if(m&&m.length<=h){var y=m.length;if(i.length+y>d){n.overflow=r.split(g);break}i&&(i+="\n"),i+=m,++p>20&&(i.substr(0,1),p=0),s=!0,a++}else m?c.push(f):l.push(f),t.splice(g,1),g--}g++}if(c&&c.length>0&&n.sizeExceed.push(ws.create(r.iKey(),c)),l&&l.length>0&&n.failedEvts.push(ws.create(r.iKey(),l)),s){n.batches.push(r),n.payloadBlob=i,n.numEvents=a;var v=r.iKey();-1===an(n.apiKeys,v)&&n.apiKeys.push(v)}},function(){return{payload:n,theBatch:{iKey:r.iKey(),evts:r.events()},max:o}}),i},e.getEventBlob=function(e){try{return ti(t,function(){return"Serializer.getEventBlob"},function(){var t={};t.name=e.name,t.time=e.time,t.ver=e.ver,t.iKey="o:"+function(e){if(e){var t=e.indexOf("-");if(t>-1)return e.substring(0,t)}return Oo}(e.iKey);var r={},o=e.ext;o&&(t.ext=r,Vt(o,function(e,t){n(t,r[e]={},"ext."+e,!0,null,null,!0)}));var s=t[i]={};s.baseType=e.baseType;var l=s[a]={};return n(e.baseData,l,a,!1,[a],function(e,t,n){Os(r,e,t,n)},c),n(e.data,s,i,!1,[],function(e,t,n){Os(r,e,t,n)},c),JSON.stringify(t)},function(){return{item:e}})}catch(e){return null}}})}return e.__ieDyn=1,e}();function Os(e,t,n,r){if(r&&e){var o=function(e,t,n){var r=-1;if(!Ft(e))if(t>0&&(32===t?r=8192:t<=13&&(r=t<<5)),function(e){return e>=0&&e<=9}(n))-1===r&&(r=0),r|=n;else{var o=Uo[Wo(e)]||-1;-1!==r&&-1!==o?r|=o:6===o&&(r=o)}return r}(r.value,r.kind,r.propertyType);if(o>-1){var i=e[Es];i||(i=e[Es]={f:{}});var a=i[Ps];if(a||(a=i[Ps]={}),t)for(var s=0;s<t.length;s++){var c=t[s];a[c]||(a[c]={f:{}});var l=a[c][Ps];l||(l=a[c][Ps]={}),a=l}a=a[n]={},Yt(r.value)?a.a={t:o}:a.t=o}}}var Ns="sendAttempt",qs="&NoResponseBody=true",Ls=((Ss={})[1]=ns,Ss[100]=ns,Ss[200]="sent",Ss[8004]=ts,Ss[8003]=ts,Ss),xs={},Us={};function Ds(e,t,n){xs[e]=t,!1!==n&&(Us[t]=e)}function Bs(e){try{return e.responseText}catch(e){}return Za}function Hs(e,t){var n=!1;if(e&&t){var r=un(e);if(r&&r.length>0)for(var o=t.toLowerCase(),i=0;i<r.length;i++){var a=r[i];if(a&&$t(t,a)&&a.toLowerCase()===o){n=!0;break}}}return n}function Fs(e,t,n,r){t&&n&&n.length>0&&(r&&xs[t]?(e.hdrs[xs[t]]=n,e.useHdrs=!0):e.url+="&"+t+"="+n)}function zs(e,t){return t&&(en(t)?e=[t].concat(e):Yt(t)&&(e=t.concat(e))),e}Ds(gs,gs,!1),Ds(cs,cs),Ds(ls,"Client-Id"),Ds(hs,hs),Ds(us,us),Ds(ds,ds),Ds(ps,ps);var Ks=function(){function e(t,n,r,o,a){this._responseHandlers=[];var s,c,l,u,d,h,g,p,f,m,y="?cors=true&"+is.toLowerCase()+"="+rs,v=new As,C=!1,w=new Is,I=!1,T=0,A=!0,k=[],S={},b=[],R=null,E=!1,P=!1,_=!1;ne(e,this,function(e){var M=!0;function O(e,t){for(var n=0,r=null,o=0;null==r&&o<e.length;)1===(n=e[o])?Qn()?r=N:Jn()&&(r=L):2===n&&Vn(t)&&(!t||t&&!p)?r=q:I&&3===n&&Wn()&&(r=U),o++;return r?{_transport:n,_isSync:t,sendPOST:r}:null}function N(e,t,n){var r=new XDomainRequest;r.open(es,e.urlString),e.timeout&&(r.timeout=e.timeout),r.onload=function(){var e=Bs(r);x(t,200,{},e),V(e)},r.onerror=function(){x(t,400,{})},r.ontimeout=function(){x(t,500,{})},r.onprogress=function(){},n?r.send(e.data):a.set(function(){r.send(e.data)},0)}function q(e,t,n){var r,o=e.urlString,i=!1,s=!1,c=((r={body:e.data,method:es}).Microsoft_ApplicationInsights_BypassAjaxInstrumentation=!0,r);n&&(c.keepalive=!0,2===e._sendReason&&(i=!0,m&&(o+=qs))),M&&(c.credentials="include"),e.headers&&un(e.headers).length>0&&(c.headers=e.headers),fetch(o,c).then(function(e){var n={},r=Za,o=e.headers;o&&o.forEach(function(e,t){n[t]=e}),e.body&&e.text().then(function(e){r=e}),s||(s=!0,x(t,e.status,n,r),V(r))}).catch(function(e){s||(s=!0,x(t,0,{}))}),i&&!s&&(s=!0,x(t,200,{})),!s&&e.timeout>0&&a.set(function(){s||(s=!0,x(t,500,{}))},e.timeout)}function L(e,t,n){var r=e.urlString;function o(e,t,n){if(!e[n]&&t&&t.getResponseHeader){var r=t.getResponseHeader(n);r&&(e[n]=sn(r))}return e}function i(e,n){x(t,e.status,function(e){var t,n,r={};return e.getAllResponseHeaders?(t=e.getAllResponseHeaders(),n={},Zt(t)&&on(sn(t).split(/[\r\n]+/),function(e){if(e){var t=e.indexOf(": ");if(-1!==t){var r=sn(e.substring(0,t)).toLowerCase(),o=sn(e.substring(t+1));n[r]=o}else n[sn(e)]=1}}),r=n):(r=o(r,e,ss),r=o(r,e,as),r=o(r,e,"kill-duration-seconds")),r}(e),n)}n&&e.disableXhrSync&&(n=!1);var a=function(e,t,n,r,o,i){function a(e,t,n){try{e[t]=n}catch(e){}}void 0===r&&(r=!1),void 0===o&&(o=!1);var s=new XMLHttpRequest;return r&&a(s,"Microsoft_ApplicationInsights_BypassAjaxInstrumentation",r),n&&a(s,xo,n),s.open(e,t,!o),n&&a(s,xo,n),!o&&i&&a(s,"timeout",i),s}(es,r,M,!0,n,e.timeout);Vt(e.headers,function(e,t){a.setRequestHeader(e,t)}),a.onload=function(){var e=Bs(a);i(a,e),V(e)},a.onerror=function(){i(a)},a.ontimeout=function(){i(a)},a.send(e.data)}function x(e,t,n,r){try{e(t,n,r)}catch(e){cr(c,2,518,jn(e))}}function U(e,t,n){var r=200,o=e._thePayload,i=e.urlString+(m?qs:Za);try{var a=Hn();if(!a.sendBeacon(i,e.data))if(o){var s=[];on(o.batches,function(e){if(s&&e&&e.count()>0){for(var t=e.events(),n=0;n<t.length;n++)if(!a.sendBeacon(i,R.getEventBlob(t[n]))){s.push(e.split(n));break}}else s.push(e.split(0))}),Q(s,8003,o.sendType,!0)}else r=0}catch(e){lr(c,"Failed to send telemetry using sendBeacon API. Ex:"+jn(e)),r=0}finally{x(t,r,{},Za)}}function D(e){return 2===e||3===e}function B(e){return P&&D(e)&&(e=2),e}function H(){return!C&&T<n}function F(){var e=b;return b=[],e}function z(e,t,n){var r=!1;return e&&e.length>0&&!C&&l[t]&&R&&(r=0!==t||H()&&(n>0||w.allowRequestSending())),r}function K(e){var t={};return e&&on(e,function(e,n){t[n]={iKey:e.iKey(),evts:e.events()}}),t}function $(e,n,r,o,i){if(e&&0!==e.length)if(C)Q(e,1,o);else{o=B(o);try{var a=e,s=0!==o;ti(u,function(){return"HttpManager:_sendBatches"},function(a){a&&(e=e.slice(0));for(var c=[],u=null,d=Go(),h=l[o]||(s?l[1]:l[0]),g=h&&h._transport,p=f&&(P||D(o)||3===g||h._isSync&&2===g);z(e,o,n);){var m=e.shift();m&&m.count()>0&&(v.isTenantKilled(m.iKey())?c.push(m):(u=u||R.createPayload(n,r,s,p,i,o),R.appendPayload(u,m,t)?null!==u.overflow&&(e=[u.overflow].concat(e),u.overflow=null,j(u,d,Go(),i),d=Go(),u=null):(j(u,d,Go(),i),d=Go(),e=[m].concat(e),u=null)))}u&&j(u,d,Go(),i),e.length>0&&(b=e.concat(b)),Q(c,8004,o)},function(){return{batches:K(a),retryCount:n,isTeardown:r,isSynchronous:s,sendReason:i,useSendBeacon:D(o),sendType:o}},!s)}catch(e){cr(c,2,48,"Unexpected Exception sending batch: "+jn(e))}}}function G(e,t,n){e[t]=e[t]||{},e[t][s.identifier]=n}function j(t,n,o,a){if(t&&t.payloadBlob&&t.payloadBlob.length>0){var d=!!e.sendHook,f=l[t.sendType];!D(t.sendType)&&t.isBeacon&&2===t.sendReason&&(f=l[2]||l[3]||f);var m=_;(t.isBeacon||3===f._transport)&&(m=!1);var C=function(e,t){var n={url:y,hdrs:{},useHdrs:!1};t?(n.hdrs=$o(n.hdrs,S),n.useHdrs=un(n.hdrs).length>0):Vt(S,function(e,t){Us[e]?Fs(n,Us[e],t,!1):(n.hdrs[e]=t,n.useHdrs=!0)}),Fs(n,ls,"NO_AUTH",t),Fs(n,cs,Lo,t);var r=Za;on(e.apiKeys,function(e){r.length>0&&(r+=","),r+=e}),Fs(n,hs,r,t),Fs(n,ds,pn().toString(),t);var o=function(e){for(var t=0;t<e.batches.length;t++){var n=e.batches[t].Msfpc();if(n)return encodeURIComponent(n)}return Za}(e);if(Bo(o)&&(n.url+="&ext.intweb.msfpc="+o),w.shouldAddClockSkewHeaders()&&Fs(n,us,w.getClockSkewHeaderValue(),t),u.getWParam){var i=u.getWParam();i>=0&&(n.url+="&w="+i)}for(var a=0;a<k.length;a++)n.url+="&"+k[a].name+"="+k[a].value;return n}(t,m);m=m||C.useHdrs;var I=Go();ti(u,function(){return"HttpManager:_doPayloadSend"},function(){for(var l=0;l<t.batches.length;l++)for(var y=t.batches[l].events(),k=0;k<y.length;k++){var S=y[k];if(E){var b=S.timings=S.timings||{};G(b,"sendEventStart",I),G(b,"serializationStart",n),G(b,"serializationCompleted",o)}S[Ns]>0?S[Ns]++:S[Ns]=1}Q(t.batches,1e3+(a||0),t.sendType,!0);var R={data:t.payloadBlob,urlString:C.url,headers:C.hdrs,_thePayload:t,_sendReason:a,timeout:h,disableXhrSync:g,disableFetchKeepAlive:p};m&&(Hs(R.headers,os)||(R.headers[os]="no-cache, no-store"),Hs(R.headers,is)||(R.headers[is]=rs));var _=null;f&&(_=function(n){w.firstRequestSent();var o=function(n,o){!function(t,n,o,a){var c,l=9e3,u=null,d=!1,h=!1;try{var g=!0;if(typeof t!==i){if(n){w.setClockSkew(n[ss]);var p=n[as]||n["kill-duration-seconds"];on(v.setKillSwitchTenants(n["kill-tokens"],p),function(e){on(o.batches,function(t){if(t.iKey()===e){u=u||[];var n=t.split(0);o.numEvents-=n.count(),u.push(n)}})})}if(200==t||204==t)return void(l=200);((c=t)>=300&&c<500&&408!=c&&429!=c||501==c||505==c||o.numEvents<=0)&&(g=!1),l=9e3+t%1e3}if(g){l=100;var f=o.retryCnt;0===o.sendType&&(f<r?(d=!0,W(function(){0===o.sendType&&T--,$(o.batches,f+1,o.isTeardown,P?2:o.sendType,5)},P,ks(f))):(h=!0,P&&(l=8001)))}}finally{d||(w.setClockSkew(),function(t,n,r,o){try{o&&s._backOffTransmission(),200===n&&(o||t.isSync||s._clearBackOff(),function(e){if(E){var t=Go();on(e,function(e){e&&e.count()>0&&function(e,t){E&&on(e,function(e){G(e.timings=e.timings||{},"sendEventCompleted",t)})}(e.events(),t)})}}(t.batches)),Q(t.batches,n,t.sendType,!0)}finally{0===t.sendType&&(T--,5!==r&&e.sendQueuedRequests(t.sendType,r))}}(o,l,a,h)),Q(u,8004,o.sendType)}}(n,o,t,a)},l=t.isTeardown||t.isSync;try{f.sendPOST(n,o,l),e.sendListener&&e.sendListener(R,n,l,t.isBeacon)}catch(e){lr(c,"Unexpected exception sending payload. Ex:"+jn(e)),x(o,0,{})}}),ti(u,function(){return"HttpManager:_doPayloadSend.sender"},function(){if(_)if(0===t.sendType&&T++,d&&!t.isBeacon&&3!==f._transport){var n={data:R.data,urlString:R.urlString,headers:$o({},R.headers),timeout:R.timeout,disableXhrSync:R.disableXhrSync,disableFetchKeepAlive:R.disableFetchKeepAlive},r=!1;ti(u,function(){return"HttpManager:_doPayloadSend.sendHook"},function(){try{e.sendHook(n,function(e){r=!0,A||e._thePayload||(e._thePayload=e._thePayload||R._thePayload,e._sendReason=e._sendReason||R._sendReason),_(e)},t.isSync||t.isTeardown)}catch(e){r||_(R)}})}else _(R)})},function(){return{thePayload:t,serializationStart:n,serializationCompleted:o,sendReason:a}},t.isSync)}t.sizeExceed&&t.sizeExceed.length>0&&Q(t.sizeExceed,8003,t.sendType),t.failedEvts&&t.failedEvts.length>0&&Q(t.failedEvts,8002,t.sendType)}function W(e,t,n){t?e():a.set(e,n)}function V(t){var n=e._responseHandlers;try{for(var r=0;r<n.length;r++)try{n[r](t)}catch(e){cr(c,1,519,"Response handler failed: "+e)}if(t){var o=JSON.parse(t);Bo(o.webResult)&&Bo(o.webResult[fs])&&d.set("MSFPC",o.webResult[fs],31536e3)}}catch(e){}}function Q(e,t,n,r){if(e&&e.length>0&&o){var i=o[(s=t,l=Ls[s],Bo(l)||(l="oth",s>=9e3&&s<=9999?l="rspFail":s>=8e3&&s<=8999?l=ts:s>=1e3&&s<=1999&&(l="send")),l)];if(i){var a=0!==n;ti(u,function(){return"HttpManager:_sendBatchesNotification"},function(){W(function(){try{i.call(o,e,t,a,n)}catch(e){cr(c,1,74,"send request notification failed: "+e)}},r||a,0)},function(){return{batches:K(e),reason:t,isSync:a,sendSync:r,sendType:n}},!a)}}var s,l}e.initialize=function(e,t,n,r,o){var i;o||(o={}),y=e+y,_=!!Ft(o.avoidOptions)||!o.avoidOptions,u=t,d=t.getCookieMgr(),E=!u.config.disableEventTimings;var a=!!u.config.enableCompoundKey;c=(s=n).diagLog();var v=o.valueSanitizer,C=o.stringifyObjects;Ft(o.enableCompoundKey)||(a=!!o.enableCompoundKey),h=o.xhrTimeout,g=!!o.disableXhrSync,p=!!o.disableFetchKeepAlive,m=!1!==o.addNoResponse,I=!$n(),R=new Ms(u,v,C,a),zt(o.useSendBeacon)||(I=!!o.useSendBeacon);var w=r,T=o.alwaysUseXhrOverride?r:null,k=o.alwaysUseXhrOverride?r:null,S=[3,2];if(!r){A=!1;var b=Fn();b&&b.protocol&&"file:"===b.protocol.toLowerCase()&&(M=!1);var P=[];$n()?(P=[2,1],S=[2,1,3]):P=[1,2,3],(r=O(P=zs(P,o.transports),!1))||lr(c,"No available transport to send events"),w=O(P,!0)}T||(T=O(S=zs(S,o.unloadTransports),!0)),f=!A&&(I&&Wn()||!p&&Vn(!0)),(i={})[0]=r,i[1]=w||O([1,2,3],!0),i[2]=T||w||O([1],!0),i[3]=k||O([2,3],!0)||w||O([1],!0),l=i},e._getDbgPlgTargets=function(){return[l[0],v,R,l]},e.addQueryStringParameter=function(e,t){for(var n=0;n<k.length;n++)if(k[n].name===e)return void(k[n].value=t);k.push({name:e,value:t})},e.addHeader=function(e,t){S[e]=t},e.canSendRequest=function(){return H()&&w.allowRequestSending()},e.sendQueuedRequests=function(e,t){Ft(e)&&(e=0),P&&(e=B(e),t=2),z(b,e,0)&&$(F(),0,!1,e,t||0)},e.isCompletelyIdle=function(){return!C&&0===T&&0===b.length},e.setUnloading=function(e){P=e},e.addBatch=function(e){if(e&&e.count()>0){if(v.isTenantKilled(e.iKey()))return!1;b.push(e)}return!0},e.teardown=function(){b.length>0&&$(F(),0,!0,2,2)},e.pause=function(){C=!0},e.resume=function(){C=!1,e.sendQueuedRequests(0,4)},e.sendSynchronousBatch=function(e,t,n){e&&e.count()>0&&(zt(t)&&(t=1),P&&(t=B(t),n=2),$([e],0,!1,t,n||0))}})}return e.__ieDyn=1,e}();function $s(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return setTimeout(e,t,n)}function Gs(e){clearTimeout(e)}function js(e,t){return{set:e||$s,clear:t||Gs}}var Ws="eventsDiscarded",Vs="overrideInstrumentationKey",Qs="maxEventRetryAttempts",Js="maxUnloadEventRetryAttempts",Ys=function(e){function t(){var n,r=e.call(this)||this;r.identifier="PostChannel",r.priority=1011,r.version="3.2.18";var o,i,a,s,c,l,u,d=!1,h=[],g=null,p=!1,f=0,m=500,y=0,v=1e4,C={},w=Ja,I=null,T=null,A=0,k=0,S={},b=-1,R=!0,E=!1,P=6,_=2;return ne(t,r,function(e,t){function r(e){"beforeunload"!==(e||xn().event).type&&(E=!0,i.setUnloading(E)),B(2,2)}function M(e){E=!1,i.setUnloading(E)}function O(e,t){if(e.sendAttempt||(e.sendAttempt=0),e.latency||(e.latency=1),e.ext&&e.ext[ms]&&delete e.ext[ms],e.ext&&e.ext[ys]&&e.ext[ys].id&&delete e.ext[ys].id,R&&(e.ext=Tn(e.ext),e.baseData&&(e.baseData=Tn(e.baseData)),e.data&&(e.data=Tn(e.data))),e.sync)if(A||p)e.latency=3,e.sync=!1;else if(i)return R&&(e=Tn(e)),void i.sendSynchronousBatch(ws.create(e.iKey,[e]),!0===e.sync?1:e.sync,3);var n=e.latency,r=y,o=v;4===n&&(r=f,o=m);var a=!1;if(r<o)a=!z(e,t);else{var s=1,c=20;4===n&&(s=4,c=1),a=!0,function(e,t,n,r){for(;n<=t;){var o=H(e,t,!0);if(o&&o.count()>0){var i=o.split(0,r),a=i.count();if(a>0)return 4===n?f-=a:y-=a,Y(Ws,[i],Qa.QueueFull),!0}n++}return K(),!1}(e.iKey,e.latency,s,c)&&(a=!z(e,t))}a&&J(Ws,[e],Qa.QueueFull)}function N(e,t,n){var r=$(e,t,n);return i.sendQueuedRequests(t,n),r}function q(){return y>0}function L(){if(b>=0&&$(b,0,c)&&i.sendQueuedRequests(0,c),f>0&&!T&&!p){var e=C[w][2];e>=0&&(T=U(function(){T=null,N(4,0,1),L()},e))}var t=C[w][1];!I&&!g&&t>=0&&!p&&(q()?I=U(function(){I=null,N(0===k?3:1,0,1),k++,k%=2,L()},t):k=0)}function x(){n=null,d=!1,h=[],g=null,p=!1,f=0,m=500,y=0,v=1e4,C={},w=Ja,I=null,T=null,A=0,k=0,o=null,S={},a=void 0,s=0,b=-1,c=null,R=!0,E=!1,P=6,_=2,l=null,u=js(),i=new Ks(500,2,1,{requeue:V,send:X,sent:Z,drop:ee,rspFail:te,oth:ne},u),W(),S[4]={batches:[],iKeyMap:{}},S[3]={batches:[],iKeyMap:{}},S[2]={batches:[],iKeyMap:{}},S[1]={batches:[],iKeyMap:{}},re()}function U(e,t){0===t&&A&&(t=1);var n=1e3;return A&&(n=ks(A-1)),u.set(e,t*n)}function D(){return null!==I&&(u.clear(I),I=null,k=0,!0)}function B(e,t){D(),g&&(u.clear(g),g=null),p||N(1,e,t)}function H(e,t,n){var r=S[t];r||(r=S[t=1]);var o=r.iKeyMap[e];return!o&&n&&(o=ws.create(e),r.batches.push(o),r.iKeyMap[e]=o),o}function F(t,n){i.canSendRequest()&&!A&&(a>0&&y>a&&(n=!0),n&&null==g&&e.flush(t,null,20))}function z(e,t){R&&(e=Tn(e));var n=e.latency,r=H(e.iKey,n,!0);return!!r.addEvent(e)&&(4!==n?(y++,t&&0===e.sendAttempt&&F(!e.sync,s>0&&r.count()>=s)):f++,!0)}function K(){for(var e=0,t=0,n=function(n){var r=S[n];r&&r.batches&&on(r.batches,function(r){4===n?e+=r.count():t+=r.count()})},r=1;r<=4;r++)n(r);y=t,f=e}function $(t,n,r){var o=!1,a=0===n;return!a||i.canSendRequest()?ti(e.core,function(){return"PostChannel._queueBatches"},function(){for(var e=[],n=4;n>=t;){var r=S[n];r&&r.batches&&r.batches.length>0&&(on(r.batches,function(t){i.addBatch(t)?o=o||t&&t.count()>0:e=e.concat(t.events()),4===n?f-=t.count():y-=t.count()}),r.batches=[],r.iKeyMap={}),n--}e.length>0&&J(Ws,e,Qa.KillSwitch),o&&b>=t&&(b=-1,c=0)},function(){return{latency:t,sendType:n,sendReason:r}},!a):(b=b>=0?Math.min(b,t):t,c=Math.max(c,r)),o}function G(e,t){N(1,0,t),K(),j(function(){e&&e(),h.length>0?g=U(function(){g=null,G(h.shift(),t)},0):(g=null,L())})}function j(e){i.isCompletelyIdle()?e():g=U(function(){g=null,j(e)},.25)}function W(){(C={})[Ja]=[2,1,0],C[Ya]=[6,3,0],C[Xa]=[18,9,0]}function V(t,n){var r=[],o=P;E&&(o=_),on(t,function(t){t&&t.count()>0&&on(t.events(),function(t){t&&(t.sync&&(t.latency=4,t.sync=!1),t.sendAttempt<o?(jo(t,e.identifier),O(t,!1)):r.push(t))})}),r.length>0&&J(Ws,r,Qa.NonRetryableStatus),E&&B(2,2)}function Q(t,n){var r=e._notificationManager||{},o=r[t];if(o)try{o.apply(r,n)}catch(n){cr(e.diagLog(),1,74,t+" notification failed: "+n)}}function J(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];t&&t.length>0&&Q(e,[t].concat(n))}function Y(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];t&&t.length>0&&on(t,function(t){t&&t.count()>0&&Q(e,[t.events()].concat(n))})}function X(e,t,n){e&&e.length>0&&Q("eventsSendRequest",[t>=1e3&&t<=1999?t-1e3:0,!0!==n])}function Z(e,t){Y("eventsSent",e,t),L()}function ee(e,t){Y(Ws,e,t>=8e3&&t<=8999?t-8e3:Qa.Unknown)}function te(e){Y(Ws,e,Qa.NonRetryableStatus),L()}function ne(e,t){Y(Ws,e,Qa.Unknown),L()}function re(){s=n&&n.disableAutoBatchFlushLimit?0:Math.max(1500,v/6)}x(),e._getDbgPlgTargets=function(){return[i]},e.initialize=function(s,c,d){ti(c,function(){return"PostChannel:initialize"},function(){var h=c;t.initialize(s,c,d);try{c.addUnloadCb,l=wo(Qr(e.identifier),c.evtNamespace&&c.evtNamespace());var g=e._getTelCtx();s.extensionConfig[e.identifier]=s.extensionConfig[e.identifier]||{},n=g.getExtCfg(e.identifier),u=js(n.setTimeoutOverride,n.clearTimeoutOverride),R=!n.disableOptimizeObj&&!!qn("chrome"),function(e){var t=e.getWParam;e.getWParam=function(){var e=0;return n.ignoreMc1Ms0CookieProcessing&&(e|=2),e|t()}}(h),n.eventsLimitInMem>0&&(v=n.eventsLimitInMem),n.immediateEventLimit>0&&(m=n.immediateEventLimit),n.autoFlushEventsLimit>0&&(a=n.autoFlushEventsLimit),en(n[Qs])&&(P=n[Qs]),en(n[Js])&&(_=n[Js]),re(),n.httpXHROverride&&n.httpXHROverride.sendPOST&&(o=n.httpXHROverride),Bo(s.anonCookieName)&&i.addQueryStringParameter("anoncknm",s.anonCookieName),i.sendHook=n.payloadPreprocessor,i.sendListener=n.payloadListener;var p=n.overrideEndpointUrl?n.overrideEndpointUrl:s.endpointUrl;e._notificationManager=c.getNotifyMgr(),i.initialize(p,e.core,e,o,n);var f=s.disablePageUnloadEvents||[];(function(e,t,n,r){t&&e&&Yt(e)&&!ko(e,t,n,r)&&n&&n[he]>0&&ko(e,t,null,r)})([ao,io,ro],r,f,l),bo(r,f,l),Ro(M,s.disablePageShowEvents,l)}catch(t){throw e.setInitialized(!1),t}},function(){return{coreConfig:s,core:c,extensions:d}})},e.processTelemetry=function(t,r){jo(t,e.identifier);var o=(r=e._getTelCtx(r)).getExtCfg(e.identifier),i=!!n.disableTelemetry;o&&(i=i||!!o.disableTelemetry);var a=t;i||d||(n[Vs]&&(a.iKey=n[Vs]),o&&o[Vs]&&(a.iKey=o[Vs]),O(a,!0),E?B(2,2):L()),e.processNext(a,r)},e._doTeardown=function(e,t){var n;B(2,2),d=!0,i.teardown(),So([ao,io,ro],null,l),n=wo(so,l),So([ro],null,n),So([no],null,n),function(e,t){var n=wo(co,t);So([oo],null,n),So([no],null,n)}(0,l),x()},e.setEventQueueLimits=function(e,t){v=e>0?e:1e4,a=t>0?t:0,re();var n=y>e;if(!n&&s>0)for(var r=1;!n&&r<=3;r++){var o=S[r];o&&o.batches&&on(o.batches,function(e){e&&e.count()>=s&&(n=!0)})}F(!0,n)},e.pause=function(){D(),p=!0,i.pause()},e.resume=function(){p=!1,i.resume(),L()},e.addResponseHandler=function(e){i._responseHandlers.push(e)},e._loadTransmitProfiles=function(e){D(),W(),w=Ja,L(),Vt(e,function(e,t){var n=t.length;if(n>=2){var r=n>2?t[2]:0;if(t.splice(0,n-2),t[1]<0&&(t[0]=-1),t[1]>0&&t[0]>0){var o=t[0]/t[1];t[0]=Math.ceil(o)*t[1]}r>=0&&t[1]>=0&&r>t[1]&&(r=t[1]),t.push(r),C[e]=t}})},e.flush=function(e,t,n){if(void 0===e&&(e=!0),!p)if(n=n||1,e)null==g?(D(),$(1,0,n),g=U(function(){g=null,G(t,n)},0)):h.push(t);else{var r=D();N(1,1,n),null!=t&&t(),r&&L()}},e.setMsaAuthTicket=function(e){i.addHeader(gs,e)},e.hasEvents=q,e._setTransmitProfile=function(e){w!==e&&void 0!==C[e]&&(D(),w=e,L())},e._backOffTransmission=function(){A<4&&(A++,D(),L())},e._clearBackOff=function(){A&&(A=0,D(),L())},dn(e,"_setTimeoutOverride",function(){return u.set},function(e){u=js(e,u.clear)}),dn(e,"_clearTimeoutOverride",function(){return u.clear},function(e){u=js(u.set,e)})}),r}return I(t,e),t.__ieDyn=1,t}(Ci);const Xs=Ys;var Zs=function(e){function t(){var n,r,o=e.call(this)||this;return ne(t,o,function(e,t){e.initialize=function(e,i){var a=o;ti(o,function(){return"ApplicationInsights:initialize"},function(){n=new Xs;var o=[r=new qa];i&&(o=o.concat(i)),e||wn("You must provide a config object!");var s=e.channels;if(s&&s.length>0){for(var c=!1,l=0;l<s[0].length;l++)if(s[0][l].identifier===n.identifier){c=!0;break}c||s[0].push(n)}else e.channels=[[n]];var u=e.extensionConfig=e.extensionConfig||[];u[n.identifier]=u[n.identifier]||e&&e.channelConfiguration||{},u[r.identifier]=u[r.identifier]||e&&e.propertyConfiguration||{};try{t.initialize(e,o)}catch(e){cr(a.logger,1,514,"Failed to initialize SDK."+jn(e))}},function(){return{config:e,extensions:i}})},e.getPropertyManager=function(){return r},e.getPostChannel=function(){return n}}),o}return I(t,e),t.__ieDyn=1,t}(Va);const ec=Zs;var tc,nc="Failed",rc=nc+"MonitorAjax",oc="Track",ic="Start",ac="Stop",sc="Event",cc="AuthContext",lc="Exception",uc="Local",dc="Session",hc="Storage",gc="Browser",pc="Cannot",fc="Buffer",mc="InstrumentationKey",yc=wi({CRITICAL:1,WARNING:2}),vc=wi(((tc={})[gc+"DoesNotSupport"+uc+hc]=0,tc[gc+pc+"Read"+uc+hc]=1,tc[gc+pc+"Read"+dc+hc]=2,tc[gc+pc+"Write"+uc+hc]=3,tc[gc+pc+"Write"+dc+hc]=4,tc[gc+nc+"RemovalFrom"+uc+hc]=5,tc[gc+nc+"RemovalFrom"+dc+hc]=6,tc[pc+"SendEmptyTelemetry"]=7,tc.ClientPerformanceMathError=8,tc["ErrorParsingAI"+dc+"Cookie"]=9,tc.ErrorPVCalc=10,tc[lc+"WhileLoggingError"]=11,tc[nc+"AddingTelemetryTo"+fc]=12,tc[rc+"Abort"]=13,tc[rc+"Dur"]=14,tc[rc+"Open"]=15,tc[rc+"RSC"]=16,tc[rc+"Send"]=17,tc[rc+"GetCorrelationHeader"]=18,tc[nc+"ToAddHandlerForOnBeforeUnload"]=19,tc[nc+"ToSendQueuedTelemetry"]=20,tc[nc+"ToReportDataLoss"]=21,tc["Flush"+nc]=22,tc.MessageLimitPerPVExceeded=23,tc.MissingRequiredFieldSpecification=24,tc.NavigationTimingNotSupported=25,tc.OnError=26,tc[dc+"RenewalDateIsZero"]=27,tc.SenderNotInitialized=28,tc[ic+oc+sc+nc]=29,tc[ac+oc+sc+nc]=30,tc[ic+oc+nc]=31,tc[ac+oc+nc]=32,tc.TelemetrySampledAndNotSent=33,tc[oc+sc+nc]=34,tc[oc+lc+nc]=35,tc[oc+"Metric"+nc]=36,tc[oc+"PV"+nc]=37,tc[oc+"PV"+nc+"Calc"]=38,tc[oc+"Trace"+nc]=39,tc["Transmission"+nc]=40,tc[nc+"ToSet"+hc+fc]=41,tc[nc+"ToRestore"+hc+fc]=42,tc.InvalidBackendResponse=43,tc[nc+"ToFixDepricatedValues"]=44,tc.InvalidDurationValue=45,tc.TelemetryEnvelopeInvalid=46,tc.CreateEnvelopeError=47,tc[pc+"SerializeObject"]=48,tc[pc+"SerializeObjectNonSerializable"]=49,tc.CircularReferenceDetected=50,tc["Clear"+cc+nc]=51,tc[lc+"Truncated"]=52,tc.IllegalCharsInName=53,tc.ItemNotInArray=54,tc.MaxAjaxPerPVExceeded=55,tc.MessageTruncated=56,tc.NameTooLong=57,tc.SampleRateOutOfRange=58,tc["Set"+cc+nc]=59,tc["Set"+cc+nc+"AccountName"]=60,tc.StringValueTooLong=61,tc.StartCalledMoreThanOnce=62,tc.StopCalledWithoutStart=63,tc["TelemetryInitializer"+nc]=64,tc.TrackArgumentsNotSpecified=65,tc.UrlTooLong=66,tc[dc+hc+fc+"Full"]=67,tc[pc+"AccessCookie"]=68,tc.IdTooLong=69,tc.InvalidEvent=70,tc[rc+"SetRequestHeader"]=71,tc["Send"+gc+"InfoOnUserInit"]=72,tc["Plugin"+lc]=73,tc["Notification"+lc]=74,tc.SnippetScriptLoadFailure=99,tc["Invalid"+mc]=100,tc[pc+"ParseAiBlobValue"]=101,tc.InvalidContentBlob=102,tc[oc+"PageAction"+sc+nc]=103,tc[nc+"AddingCustomDefinedRequestContext"]=104,tc["InMemory"+hc+fc+"Full"]=105,tc[mc+"Deprecation"]=106,tc)),Cc=wi({NotSet:0,Pii_DistinguishedName:1,Pii_GenericData:2,Pii_IPV4Address:3,Pii_IPv6Address:4,Pii_MailSubject:5,Pii_PhoneNumber:6,Pii_QueryString:7,Pii_SipAddress:8,Pii_SmtpAddress:9,Pii_Identity:10,Pii_Uri:11,Pii_Fqdn:12,Pii_IPV4AddressLegacy:13,Pii_IPv6ScrubLastHextets:14,Pii_DropValue:15,CustomerContent_GenericContent:32}),wc=wi({Normal:1,CostDeferred:2,RealTime:3,Immediate:4}),Ic=(wi({Unspecified:0,String:1,Int32:2,UInt32:3,Int64:4,UInt64:5,Double:6,Bool:7,Guid:8,DateTime:9}),wi({Normal:1,Critical:2})),Tc=wi({NONE:0,ERROR:1,WARNING:2,INFORMATION:3}),Ac=(gn(C(C({},vc),wi({AuthHandShakeError:501,AuthRedirectFail:502,BrowserCannotReadLocalStorage:503,BrowserCannotWriteLocalStorage:504,BrowserDoesNotSupportLocalStorage:505,CannotParseBiBlobValue:506,CannotParseDataAttribute:507,CVPluginNotAvailable:508,DroppedEvent:509,ErrorParsingAISessionCookie:510,ErrorProvidedChannels:511,FailedToGetCookies:512,FailedToInitializeCorrelationVector:513,FailedToInitializeSDK:514,InvalidContentBlob:515,InvalidCorrelationValue:516,SessionRenewalDateIsZero:517,SendPostOnCompleteFailure:518,PostResponseHandler:519,SDKNotInitialized:520}))),100)},330:(e,t,n)=>{n.r(t),n.d(t,{MAX:()=>r,NIL:()=>o,parse:()=>s,stringify:()=>u,v1:()=>m,v1ToV6:()=>y,v3:()=>_,v4:()=>O,v5:()=>U,v6:()=>D,v6ToV1:()=>B,v7:()=>z,validate:()=>a,version:()=>K});const r="ffffffff-ffff-ffff-ffff-ffffffffffff",o="00000000-0000-0000-0000-000000000000",i=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i,a=function(e){return"string"==typeof e&&i.test(e)},s=function(e){if(!a(e))throw TypeError("Invalid UUID");let t;return Uint8Array.of((t=parseInt(e.slice(0,8),16))>>>24,t>>>16&255,t>>>8&255,255&t,(t=parseInt(e.slice(9,13),16))>>>8,255&t,(t=parseInt(e.slice(14,18),16))>>>8,255&t,(t=parseInt(e.slice(19,23),16))>>>8,255&t,(t=parseInt(e.slice(24,36),16))/1099511627776&255,t/4294967296&255,t>>>24&255,t>>>16&255,t>>>8&255,255&t)},c=[];for(let e=0;e<256;++e)c.push((e+256).toString(16).slice(1));function l(e,t=0){return(c[e[t+0]]+c[e[t+1]]+c[e[t+2]]+c[e[t+3]]+"-"+c[e[t+4]]+c[e[t+5]]+"-"+c[e[t+6]]+c[e[t+7]]+"-"+c[e[t+8]]+c[e[t+9]]+"-"+c[e[t+10]]+c[e[t+11]]+c[e[t+12]]+c[e[t+13]]+c[e[t+14]]+c[e[t+15]]).toLowerCase()}const u=function(e,t=0){const n=l(e,t);if(!a(n))throw TypeError("Stringified UUID is invalid");return n};let d;const h=new Uint8Array(16);function g(){if(!d){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");d=crypto.getRandomValues.bind(crypto)}return d(h)}const p={};function f(e,t,n,r,o,i,a=0){if(e.length<16)throw new Error("Random bytes length must be >= 16");if(i){if(a<0||a+16>i.length)throw new RangeError(`UUID byte range ${a}:${a+15} is out of buffer bounds`)}else i=new Uint8Array(16),a=0;t??=Date.now(),n??=0,r??=16383&(e[8]<<8|e[9]),o??=e.slice(10,16);const s=(1e4*(268435455&(t+=122192928e5))+n)%4294967296;i[a++]=s>>>24&255,i[a++]=s>>>16&255,i[a++]=s>>>8&255,i[a++]=255&s;const c=t/4294967296*1e4&268435455;i[a++]=c>>>8&255,i[a++]=255&c,i[a++]=c>>>24&15|16,i[a++]=c>>>16&255,i[a++]=r>>>8|128,i[a++]=255&r;for(let e=0;e<6;++e)i[a++]=o[e];return i}const m=function(e,t,n){let r;const o=e?._v6??!1;if(e){const t=Object.keys(e);1===t.length&&"_v6"===t[0]&&(e=void 0)}if(e)r=f(e.random??e.rng?.()??g(),e.msecs,e.nsecs,e.clockseq,e.node,t,n);else{const e=Date.now(),i=g();!function(e,t,n){e.msecs??=-1/0,e.nsecs??=0,t===e.msecs?(e.nsecs++,e.nsecs>=1e4&&(e.node=void 0,e.nsecs=0)):t>e.msecs?e.nsecs=0:t<e.msecs&&(e.node=void 0),e.node||(e.node=n.slice(10,16),e.node[0]|=1,e.clockseq=16383&(n[8]<<8|n[9])),e.msecs=t}(p,e,i),r=f(i,p.msecs,p.nsecs,o?void 0:p.clockseq,o?void 0:p.node,t,n)}return t??l(r)};function y(e){const t=function(e){return Uint8Array.of((15&e[6])<<4|e[7]>>4&15,(15&e[7])<<4|(240&e[4])>>4,(15&e[4])<<4|(240&e[5])>>4,(15&e[5])<<4|(240&e[0])>>4,(15&e[0])<<4|(240&e[1])>>4,(15&e[1])<<4|(240&e[2])>>4,96|15&e[2],e[3],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}("string"==typeof e?s(e):e);return"string"==typeof e?l(t):t}function v(e){return 14+(e+64>>>9<<4)+1}function C(e,t){const n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function w(e,t,n,r,o,i){return C((a=C(C(t,e),C(r,i)))<<(s=o)|a>>>32-s,n);var a,s}function I(e,t,n,r,o,i,a){return w(t&n|~t&r,e,t,o,i,a)}function T(e,t,n,r,o,i,a){return w(t&r|n&~r,e,t,o,i,a)}function A(e,t,n,r,o,i,a){return w(t^n^r,e,t,o,i,a)}function k(e,t,n,r,o,i,a){return w(n^(t|~r),e,t,o,i,a)}const S=function(e){return function(e){const t=new Uint8Array(4*e.length);for(let n=0;n<4*e.length;n++)t[n]=e[n>>2]>>>n%4*8&255;return t}(function(e,t){const n=new Uint32Array(v(t)).fill(0);n.set(e),n[t>>5]|=128<<t%32,n[n.length-1]=t,e=n;let r=1732584193,o=-271733879,i=-1732584194,a=271733878;for(let t=0;t<e.length;t+=16){const n=r,s=o,c=i,l=a;r=I(r,o,i,a,e[t],7,-680876936),a=I(a,r,o,i,e[t+1],12,-389564586),i=I(i,a,r,o,e[t+2],17,606105819),o=I(o,i,a,r,e[t+3],22,-1044525330),r=I(r,o,i,a,e[t+4],7,-176418897),a=I(a,r,o,i,e[t+5],12,1200080426),i=I(i,a,r,o,e[t+6],17,-1473231341),o=I(o,i,a,r,e[t+7],22,-45705983),r=I(r,o,i,a,e[t+8],7,1770035416),a=I(a,r,o,i,e[t+9],12,-1958414417),i=I(i,a,r,o,e[t+10],17,-42063),o=I(o,i,a,r,e[t+11],22,-1990404162),r=I(r,o,i,a,e[t+12],7,1804603682),a=I(a,r,o,i,e[t+13],12,-40341101),i=I(i,a,r,o,e[t+14],17,-1502002290),o=I(o,i,a,r,e[t+15],22,1236535329),r=T(r,o,i,a,e[t+1],5,-165796510),a=T(a,r,o,i,e[t+6],9,-1069501632),i=T(i,a,r,o,e[t+11],14,643717713),o=T(o,i,a,r,e[t],20,-373897302),r=T(r,o,i,a,e[t+5],5,-701558691),a=T(a,r,o,i,e[t+10],9,38016083),i=T(i,a,r,o,e[t+15],14,-660478335),o=T(o,i,a,r,e[t+4],20,-405537848),r=T(r,o,i,a,e[t+9],5,568446438),a=T(a,r,o,i,e[t+14],9,-1019803690),i=T(i,a,r,o,e[t+3],14,-187363961),o=T(o,i,a,r,e[t+8],20,1163531501),r=T(r,o,i,a,e[t+13],5,-1444681467),a=T(a,r,o,i,e[t+2],9,-51403784),i=T(i,a,r,o,e[t+7],14,1735328473),o=T(o,i,a,r,e[t+12],20,-1926607734),r=A(r,o,i,a,e[t+5],4,-378558),a=A(a,r,o,i,e[t+8],11,-2022574463),i=A(i,a,r,o,e[t+11],16,1839030562),o=A(o,i,a,r,e[t+14],23,-35309556),r=A(r,o,i,a,e[t+1],4,-1530992060),a=A(a,r,o,i,e[t+4],11,1272893353),i=A(i,a,r,o,e[t+7],16,-155497632),o=A(o,i,a,r,e[t+10],23,-1094730640),r=A(r,o,i,a,e[t+13],4,681279174),a=A(a,r,o,i,e[t],11,-358537222),i=A(i,a,r,o,e[t+3],16,-722521979),o=A(o,i,a,r,e[t+6],23,76029189),r=A(r,o,i,a,e[t+9],4,-640364487),a=A(a,r,o,i,e[t+12],11,-421815835),i=A(i,a,r,o,e[t+15],16,530742520),o=A(o,i,a,r,e[t+2],23,-995338651),r=k(r,o,i,a,e[t],6,-198630844),a=k(a,r,o,i,e[t+7],10,1126891415),i=k(i,a,r,o,e[t+14],15,-1416354905),o=k(o,i,a,r,e[t+5],21,-57434055),r=k(r,o,i,a,e[t+12],6,1700485571),a=k(a,r,o,i,e[t+3],10,-1894986606),i=k(i,a,r,o,e[t+10],15,-1051523),o=k(o,i,a,r,e[t+1],21,-2054922799),r=k(r,o,i,a,e[t+8],6,1873313359),a=k(a,r,o,i,e[t+15],10,-30611744),i=k(i,a,r,o,e[t+6],15,-1560198380),o=k(o,i,a,r,e[t+13],21,1309151649),r=k(r,o,i,a,e[t+4],6,-145523070),a=k(a,r,o,i,e[t+11],10,-1120210379),i=k(i,a,r,o,e[t+2],15,718787259),o=k(o,i,a,r,e[t+9],21,-343485551),r=C(r,n),o=C(o,s),i=C(i,c),a=C(a,l)}return Uint32Array.of(r,o,i,a)}(function(e){if(0===e.length)return new Uint32Array;const t=new Uint32Array(v(8*e.length)).fill(0);for(let n=0;n<e.length;n++)t[n>>2]|=(255&e[n])<<n%4*8;return t}(e),8*e.length))},b="6ba7b810-9dad-11d1-80b4-00c04fd430c8",R="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function E(e,t,n,r,o,i){const a="string"==typeof n?function(e){e=unescape(encodeURIComponent(e));const t=new Uint8Array(e.length);for(let n=0;n<e.length;++n)t[n]=e.charCodeAt(n);return t}(n):n,c="string"==typeof r?s(r):r;if("string"==typeof r&&(r=s(r)),16!==r?.length)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let u=new Uint8Array(16+a.length);if(u.set(c),u.set(a,c.length),u=t(u),u[6]=15&u[6]|e,u[8]=63&u[8]|128,o){i=i||0;for(let e=0;e<16;++e)o[i+e]=u[e];return o}return l(u)}function P(e,t,n,r){return E(48,S,e,t,n,r)}P.DNS=b,P.URL=R;const _=P,M={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)},O=function(e,t,n){return!M.randomUUID||t||e?function(e,t,n){const r=(e=e||{}).random??e.rng?.()??g();if(r.length<16)throw new Error("Random bytes length must be >= 16");if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){if((n=n||0)<0||n+16>t.length)throw new RangeError(`UUID byte range ${n}:${n+15} is out of buffer bounds`);for(let e=0;e<16;++e)t[n+e]=r[e];return t}return l(r)}(e,t,n):M.randomUUID()};function N(e,t,n,r){switch(e){case 0:return t&n^~t&r;case 1:case 3:return t^n^r;case 2:return t&n^t&r^n&r}}function q(e,t){return e<<t|e>>>32-t}const L=function(e){const t=[1518500249,1859775393,2400959708,3395469782],n=[1732584193,4023233417,2562383102,271733878,3285377520],r=new Uint8Array(e.length+1);r.set(e),r[e.length]=128;const o=(e=r).length/4+2,i=Math.ceil(o/16),a=new Array(i);for(let t=0;t<i;++t){const n=new Uint32Array(16);for(let r=0;r<16;++r)n[r]=e[64*t+4*r]<<24|e[64*t+4*r+1]<<16|e[64*t+4*r+2]<<8|e[64*t+4*r+3];a[t]=n}a[i-1][14]=8*(e.length-1)/Math.pow(2,32),a[i-1][14]=Math.floor(a[i-1][14]),a[i-1][15]=8*(e.length-1)&4294967295;for(let e=0;e<i;++e){const r=new Uint32Array(80);for(let t=0;t<16;++t)r[t]=a[e][t];for(let e=16;e<80;++e)r[e]=q(r[e-3]^r[e-8]^r[e-14]^r[e-16],1);let o=n[0],i=n[1],s=n[2],c=n[3],l=n[4];for(let e=0;e<80;++e){const n=Math.floor(e/20),a=q(o,5)+N(n,i,s,c)+l+t[n]+r[e]>>>0;l=c,c=s,s=q(i,30)>>>0,i=o,o=a}n[0]=n[0]+o>>>0,n[1]=n[1]+i>>>0,n[2]=n[2]+s>>>0,n[3]=n[3]+c>>>0,n[4]=n[4]+l>>>0}return Uint8Array.of(n[0]>>24,n[0]>>16,n[0]>>8,n[0],n[1]>>24,n[1]>>16,n[1]>>8,n[1],n[2]>>24,n[2]>>16,n[2]>>8,n[2],n[3]>>24,n[3]>>16,n[3]>>8,n[3],n[4]>>24,n[4]>>16,n[4]>>8,n[4])};function x(e,t,n,r){return E(80,L,e,t,n,r)}x.DNS=b,x.URL=R;const U=x,D=function(e,t,n){e??={},n??=0;let r=m({...e,_v6:!0},new Uint8Array(16));if(r=y(r),t){for(let e=0;e<16;e++)t[n+e]=r[e];return t}return l(r)};function B(e){const t=(n="string"==typeof e?s(e):e,Uint8Array.of((15&n[3])<<4|n[4]>>4&15,(15&n[4])<<4|(240&n[5])>>4,(15&n[5])<<4|15&n[6],n[7],(15&n[1])<<4|(240&n[2])>>4,(15&n[2])<<4|(240&n[3])>>4,16|(240&n[0])>>4,(15&n[0])<<4|(240&n[1])>>4,n[8],n[9],n[10],n[11],n[12],n[13],n[14],n[15]));var n;return"string"==typeof e?l(t):t}const H={};function F(e,t,n,r,o=0){if(e.length<16)throw new Error("Random bytes length must be >= 16");if(r){if(o<0||o+16>r.length)throw new RangeError(`UUID byte range ${o}:${o+15} is out of buffer bounds`)}else r=new Uint8Array(16),o=0;return t??=Date.now(),n??=127*e[6]<<24|e[7]<<16|e[8]<<8|e[9],r[o++]=t/1099511627776&255,r[o++]=t/4294967296&255,r[o++]=t/16777216&255,r[o++]=t/65536&255,r[o++]=t/256&255,r[o++]=255&t,r[o++]=112|n>>>28&15,r[o++]=n>>>20&255,r[o++]=128|n>>>14&63,r[o++]=n>>>6&255,r[o++]=n<<2&255|3&e[10],r[o++]=e[11],r[o++]=e[12],r[o++]=e[13],r[o++]=e[14],r[o++]=e[15],r}const z=function(e,t,n){let r;if(e)r=F(e.random??e.rng?.()??g(),e.msecs,e.seq,t,n);else{const e=Date.now(),o=g();!function(e,t,n){e.msecs??=-1/0,e.seq??=0,t>e.msecs?(e.seq=n[6]<<23|n[7]<<16|n[8]<<8|n[9],e.msecs=t):(e.seq=e.seq+1|0,0===e.seq&&e.msecs++)}(H,e,o),r=F(o,H.msecs,H.seq,t,n)}return t??l(r)},K=function(e){if(!a(e))throw TypeError("Invalid UUID");return parseInt(e.slice(14,15),16)}},351:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.voteArticle=t.deleteAttachment=t.uploadAttachment=t.submitTicketForm=t.getCaptchaChallenge=t.getArticle=t.getCategories=t.getSections=t.getLocales=t.getDynamicContentItems=t.getSuggestedArticles=t.getTicketForm=t.getSupportArticle=t.searchArticles=t.searchArticleList=void 0,t.getTicketFields=async function(e){const t=new URLSearchParams;let n=!0,o=[];t.set("page[size]","100");const a=new URL("ticket_fields",e);let s=null;for(;n;){a.search=t.toString();const e=await(0,r.getRequest)({application:i,name:"GET_TICKET_FIELDS",url:a.toString()});if(!0===e.error||!e.data)return e;s=e;const{ticket_fields:c,meta:{has_more:l,after_cursor:u}}=e.data;n=l,t.set("page[after]",u),o=[...o,...c]}return{data:{ticket_fields:o},error:!1,response:null===s?new Response:s.response}};const r=n(736),o=n(749),i="Help";var a,s;!function(e){e.help="help_center/"}(a||(a={})),function(e){e.articles="articles",e.categories="categories",e.sections="sections"}(s||(s={})),t.searchArticleList=(e,t,n=o.SORT_DIRECTION.DESC,c,l)=>{const u=new URLSearchParams;u.set("per_page","10"),c&&u.set("page",String(c)),u.set("sort_by","updated_at"),l?(u.set("label_names",l),u.set("sort_by","title")):u.set("sort_by","updated_at"),u.set("sort_order",n);const d=new URL(`${a.help}${t}/${s.articles}`,e);return d.search=u.toString(),(0,r.getRequest)({name:"NEW_ARTICLES",url:d.toString(),application:i})},t.searchArticles=(e,t,n,c,l,u,d)=>{const h=new URLSearchParams,g=new Date;h.set(n,c),h.set("locale",t),h.set("cache",""+(g.getTime()-6e4*g.getMinutes()-1e3*g.getSeconds()-g.getMilliseconds())),d&&h.set("per_page",`${d}`),u&&h.set("page",String(u)),l!==o.SORT_DIRECTION.BEST_MATCH&&(h.set("sort_order",l),h.set("sort_by","updated_at"));const p=new URL(`${a.help}${s.articles}/search`,e);return p.search=h.toString(),(0,r.getRequest)({name:"SEARCH",application:i,url:p.toString()})},t.getSupportArticle=(e,t)=>{const n=new URLSearchParams;n.set("label_names","server_status"),n.set("locale",t),n.set("page[size]","1");const o=new URL(`${a.help}${t}/${s.articles}`,e);return o.search=n.toString(),(0,r.getRequest)({application:i,name:"SUPPORT_ARTICLE",url:o.toString()})},t.getTicketForm=(e,t)=>{const n=new URL(`/ticket_forms/${t}`,e);return(0,r.getRequest)({application:i,name:"GET_TICKET",url:n.toString()})},t.getSuggestedArticles=(e,t,n,o,c,l)=>{const u=new URL(`${a.help}${t}/${s.articles}`,e);return u.search=new URLSearchParams([["label_names",`${n},${o},${c},${l}`],["page[size]","15"]]).toString(),(0,r.getRequest)({application:i,name:"SUGGESTED_ARTICLES",url:u.toString()})},t.getDynamicContentItems=async e=>{const t=[],n=new URL("/dynamic_content/items",e),o=await(0,r.getRequest)({application:i,name:"DYNAMIC_CONTENT",url:n.toString()});if(!1===o.error&&o.data){t.push(...o.data.items);const n=Math.ceil(o.data.count/100),a=await Promise.all([...new Array(n-1)].map((t,n)=>{const o=new URL("/dynamic_content/items",e);return o.search=new URLSearchParams([["page",`${n+2}`]]).toString(),(0,r.getRequest)({application:i,name:"DYNAMIC_CONTENT",url:o.toString()})}));for(const e of a){if(!0===e.error||!e.data)return e;t.push(...e.data.items)}return{...o,data:{...o.data,items:t}}}return o},t.getLocales=async e=>{const t=new URL("/locales",e);return(0,r.getRequest)({application:i,name:"LOCALES",url:t.toString()})},t.getSections=(e,t)=>{const n=new URL(`${a.help}${t}/${s.sections}`,e);return n.search=new URLSearchParams([["page[size]","100"]]).toString(),(0,r.getRequest)({application:i,name:"SECTIONS",url:n.toString()})},t.getCategories=(e,t)=>{const n=new URL(`${a.help}${t}/${s.categories}`,e);return n.search=new URLSearchParams([["page[size]","100"]]).toString(),(0,r.getRequest)({application:i,name:"CATEGORIES",url:n.toString()})},t.getArticle=(e,t,n)=>{const o=new URL(`${a.help}${t}/${s.articles}/${n}`,e);return(0,r.getRequest)({application:i,name:"ARTICLE",url:o.toString(),globalResource:`${n}`})},t.getCaptchaChallenge=(e,t)=>{const n=new URL("/api/v1.0/reportconcern/challenge",e);return n.search=new URLSearchParams([["challengeType",t]]).toString(),(0,r.getRequest)({application:i,name:"CAPTCHA",url:n.toString()})},t.submitTicketForm=(e,t)=>{const n=new URL("/api/v1.0/help/create-ticket",e);return(0,r.postRequest)({application:i,name:"SUBMIT_FORM",url:n.toString(),payload:JSON.stringify(t)})},t.uploadAttachment=(e,t,n,o)=>{const a=new URL("/uploads.json",e);return a.search=new URLSearchParams([["filename",t]]).toString(),(0,r.postRequest)({application:i,name:"UPLOAD_ATTACHMENT",url:a.toString(),payload:o,headers:{"content-type":n}})},t.deleteAttachment=(e,t)=>{const n=new URL(`/uploads/${t}`,e);return(0,r.deleteRequest)({application:i,name:"DELETE_ATTACHMENT",url:n.toString()})},t.voteArticle=(e,t,n,o)=>{const c=new URL(`${a.help}${t}/${s.articles}/${n}/${o}`,e);return(0,r.postRequest)({application:i,name:"VOTE",url:c.toString(),globalResource:`${n}`})}},352:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.MinecraftAuthToken=void 0,function(e){e.Access="access_token",e.Bearer="bearer_token",e.MCToken="MCToken",e.PlayFab="PlayFabXBLToken",e.Xbox="XboxXBLToken",e.Realms="RealmsXBLToken",e.Marketplace="MarketplaceXBLToken",e.Expiration="XBLTokensNotAfter",e.MCServices="MCServicesRPToken"}(n||(t.MinecraftAuthToken=n={}))},396:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MINECOIN_VIRTUAL_CURRENCY_TYPE=void 0,t.MINECOIN_VIRTUAL_CURRENCY_TYPE="Minecoin"},402:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.redeemAndProcessReceipt=t.sessionStart=t.getClientSubscriptionState=t.getMarketplaceEntitlements=t.getEntitlements=void 0;const r=n(736);t.getEntitlements=async({application:e,authorization:t,serviceURL:n,requestId:o})=>{const{data:i,error:a,response:s}=await(0,r.getRequest)({application:e,url:`${n}?requestId=${o}`,headers:{authorization:`Bearer ${t}`},name:"Entitlement"});if(!1===a&&i)return{status:s.status,data:i.items};throw{response:s}},t.getMarketplaceEntitlements=async({application:e,urlBase:t,authorization:n,inventoryETag:o})=>{const i=new URL("/api/v1.0/player/inventory/offersandsubscriptions",t);let a={authorization:`MCToken ${n}`};return o&&(a={...a,inventoryETag:o}),await(0,r.getRequest)({application:e,name:"GET_MARKETPLACE_ENTITLEMENTS",url:i.toString(),headers:a})},t.getClientSubscriptionState=async({application:e,urlBase:t,authorization:n})=>{const o=new URL("/api/v1.0/subscriptions/client/state",t),i={authorization:`MCToken ${n}`},a=await(0,r.getRequest)({application:e,name:"GET_CLIENT_SUBS",url:o.toString(),headers:i});return!1===a.error&&a.data?{...a,data:a.data.result.statesWrapper.subscriptionStates}:a},t.sessionStart=async({application:e,urlBase:t,authorization:n,marketplaceXBLToken:o})=>{const i=new URL("/api/v1.0/session/start",t),a={authorization:`MCToken ${n}`};return await(0,r.postRequest)({application:e,name:"ENT_SESSION_START",url:i.toString(),headers:a,payload:JSON.stringify({redemptions:{receiptPurchases:[{receipt:o,receiptType:"microsoftPurchasingToken"}]}})})},t.redeemAndProcessReceipt=async({application:e,urlBase:t,authorization:n,marketplaceXBLToken:o})=>{const i=new URL("/api/v1.0/transaction/redeem",t),a={authorization:`MCToken ${n}`};return await(0,r.putRequest)({application:e,name:"REDEEM_PROCESS",url:i.toString(),headers:a,payload:JSON.stringify({purchaseInfo:{receipt:o,receiptType:"microsoftPurchasingToken"}})})}},432:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getProductCatalog=t.getProductsCatalog=void 0;const r=n(946),o=n(736),i=e=>(0,r.cleanMap)(e,e=>({Actions:e.Actions,Markets:e.Markets,AvailabilityId:e.AvailabilityId,SkuId:e.SkuId,DisplayRank:e.DisplayRank,Properties:e.Properties,OrderManagementData:{Price:{ListPrice:e.OrderManagementData.Price.ListPrice,CurrencyCode:e.OrderManagementData.Price.CurrencyCode,RecurrencePrice:e.OrderManagementData.Price.RecurrencePrice,MSRP:e.OrderManagementData.Price.MSRP}}})).sort((e,t)=>e.DisplayRank>t.DisplayRank?1:-1),a=async e=>{const{application:t,productIds:n,locale:a,market:s,mscv:c,authorization:l,serviceURL:u,noFilter:d}=e;let h;l&&(h={authorization:l});const g=n.join(","),p=new URL(u);p.searchParams.set("ms-cv",c),p.searchParams.set("languages",a),p.searchParams.set("market",s),d||p.searchParams.set("actionFilter","purchase,gift"),p.searchParams.set("bigIds",g);const{response:f,data:m,error:y}=await(0,o.getRequest)({url:p.toString(),headers:h,application:t,name:"CATALOG",globalResource:g});if(!1===y&&m)return{status:f.status,data:{Products:m.Products.map(e=>({PreferredSkuId:e.PreferredSkuId,DisplaySkuAvailabilities:(0,r.cleanMap)(e.DisplaySkuAvailabilities,e=>({Availabilities:i(e.Availabilities),HistoricalBestAvailabilities:i(e.HistoricalBestAvailabilities||[]),Sku:{LocalizedProperties:(0,r.cleanMap)(e.Sku.LocalizedProperties,e=>({Markets:e.Markets})),Rank:e.Sku.Properties.SkuDisplayRank,Properties:{SkuDisplayRank:e.Sku.Properties.SkuDisplayRank}}})).sort((e,t)=>e.Sku.Rank>t.Sku.Rank?1:-1),LocalizedProperties:(0,r.cleanMap)(e.LocalizedProperties,e=>({Markets:e.Markets,ProductTitle:e.ProductTitle}))}))}};throw{response:f}};t.getProductsCatalog=e=>a(e),t.getProductCatalog=async e=>{const t=await a({...e,productIds:[e.productId]});return{status:t.status,data:{Product:t.data.Products[0]}}}},450:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.polling=t.wait=t.readCookie=void 0,t.retry=async function e(n,{tries:o=3,delayInMs:i=100,currentTry:a=0},s){try{return await n(a+1)}catch(c){if(o<a)throw s&&s(),new Error(r.MAX_RETRY_ERROR);{let r=0;return r=Array.isArray(i)?i.length<a+1?i[i.length-1]:i[a]:i,await(0,t.wait)(r),await e(n,{tries:o,delayInMs:i,currentTry:a+1},s)}}},t.getUserVisitorLocation=function(){const e=document.getElementsByName("visitor-country-code");let t=e.length&&e[0].getAttribute("content");return t=t?t.toLowerCase():"us",o.get(t)??t};const r=n(875);t.readCookie=(e,t)=>{const n=e.split("; ").find(e=>e.startsWith(`${t}=`));let r;if(n){const[,...e]=n.split("=");r=e.join("=")}return r},t.wait=(e=0)=>new Promise(t=>setTimeout(t,e));const o=new Map([["ax","fi"],["bl","fr"],["bq","nl"],["bv","no"],["cw","nl"],["gs","gb"],["hm","au"],["im","gb"],["io","gb"],["mf","fr"],["mo","cn"],["pr","us"],["sj","no"],["sx","nl"],["tf","fr"],["um","us"]]);t.polling=(e,t=25,n=25)=>{let r=0;return new Promise(o=>{const i=setInterval(function(){r<=n?!1===e()?r++:(clearInterval(i),o(!0)):(clearInterval(i),o(!1))},t)})}},452:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getMinecoinBalanceWithRetries=t.minecoinProductCheck=t.getMinecoinBalance=t.purchaseProductWithMinecoin=void 0;const r=n(396),o=n(736),i=n(875),a=n(450);t.purchaseProductWithMinecoin=async({application:e,authorization:t,urlBase:n,product:r})=>{const i={offerId:r.productId,transactionType:"purchase",useTitlePlayerId:!1,virtualCurrency:{amount:r.price,type:"Minecoin"}};r.storeId&&(i.storeId=r.storeId);const a=new URL("/api/v1.0/transaction/virtual",n),{data:s,error:c,response:l}=await(0,o.postRequest)({application:e,url:a.toString(),name:"TransactVirtualCurrency",headers:{authorization:`MCToken ${t}`},globalResource:r.productId,payload:JSON.stringify(i)});return!(!1!==c||!s)||(l?.status??Number.NaN)},t.getMinecoinBalance=async(e,t,n,i,a)=>{const s={authorization:t,microsoftPurchasingToken:n};a&&(s.platformStoreOfferId=a);const{data:c,error:l,response:u}=await(0,o.postRequest)({application:e,url:`${i}/currencies/virtual/refresh`,headers:s,name:"VirtualCurrenciesRefresh",payload:JSON.stringify({platformStoreOfferId:a})});let d;if(!1===l&&c){let e=0;const t=c.result.virtualCurrency.virtualCurrencyBalances.find(e=>e.type===r.MINECOIN_VIRTUAL_CURRENCY_TYPE);t&&(e=t.amount),d={error:!1,data:{balance:e,status:c.result.status,inventoryVersion:c.result.virtualCurrency.inventoryVersion,statusCode:c.result.statusCode},response:u}}else d={error:!0,response:u,data:void 0};return d},t.minecoinProductCheck=e=>i.MINECOIN_PRODUCTS.includes(e),t.getMinecoinBalanceWithRetries=async(e,n,r,o,i)=>await(0,a.retry)(async a=>{const s=await(0,t.getMinecoinBalance)(e,n,r,o,i),c=!i||"Success"===s.data?.status,l=("Failure"===s.data?.status||"Unknown"===s.data?.status)&&i&&3===a;if(c||l)return s;throw"failed"},{tries:3,delayInMs:[500,1500,2e3]})},453:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getSessionIdFromCookie=async function(){await(0,o.polling)(()=>null!=s("ai_session"),25,25);const e=s("ai_session");return e?e.split("|")[0]:null},t.getDeviceId=function(){return s("MicrosoftApplicationsTelemetryDeviceId")??null},t.getLanguage=function(){const[e]=a.get(document.documentElement.lang?.toLowerCase())||[null,null];return e??"en"},t.getRegion=function(){const[,e]=a.get(document.documentElement.lang?.toLowerCase())||[null,null];return e??"US"},t.getBrowser=function(e){return-1!==e.indexOf("Edg/")?"Edge":-1!==e.indexOf("Safari")&&-1===e.indexOf("Chrome")?"Safari":-1!==e.indexOf("Firefox")?"Firefox":-1!==e.indexOf("Chrome")?"Chrome":"Unknown"},t.getDeviceType=function(){return window.innerWidth>=1200?"Desktop":window.innerWidth>=768?"Tablet":"Phone"},t.getPlatform=function(e){return-1!==e.indexOf("Windows ")?"Windows":-1!==e.indexOf("iPhone")||-1!==e.indexOf("iPad")?"iOS":-1!==e.indexOf("Android")?"Android":-1!==e.indexOf("Mac")?"Apple":-1!==e.indexOf("X11")||-1!==window.navigator.userAgent.indexOf("Linux")?"Linux":-1!==e.indexOf("PlayStation")?"PlayStation":-1!==e.indexOf("Nintendo Switch")?"Nintendo":"Unknown"},t.getDomain=function(){return new URL(location.href).host},t.getXuid=function(){return localStorage.getItem("XBLXid")??null},t.getExperimentConfig=async function({application:e,baseUrl:t}){let n=function(){if(null!==localStorage){const e=localStorage.getItem(c);if(null!==e)try{const t=JSON.parse(e),n=(new Date).valueOf();return new Date(t.expiration).valueOf()-n<=0?(localStorage.removeItem(c),null):t}catch(e){}}return null}();return null===n&&(null===l&&(l=async function({application:e,baseUrl:t}){const n=new URL("/experiment/config.json",t).toString(),{data:o,error:i}=await(0,r.getRequest)({application:e,name:"EXP_CONFIG",url:n});return!1===i&&o?o:null}({application:e,baseUrl:t})),n=await l,l=null,null!==n&&function(e){const t=new Date;t.setHours(t.getHours()+1);const n={...e,expiration:t};localStorage.setItem(c,JSON.stringify(n))}(n)),n},t.experimentMatches=function(e,{pathname:t,search:n},r){const{regex:o,domain:i}=e;let a=r===i;if(a=a&&new RegExp(o.include.url).test(t),o.include.search&&(a=a&&new RegExp(o.include.search).test(n)),a){let e=!1;o.exclude.url&&(e=new RegExp(o.exclude.url).test(t)),o.exclude.search&&!e&&(e=new RegExp(o.exclude.search).test(n)),e&&(a=!1)}return a},t.fetchFlightAssignment=async function({baseUrl:e,flightParameters:t}){if(t.sessionId){const n=new URL("/api/v1.0/flight/assignment",e).toString(),{data:o,error:a}=await(0,r.postRequest)({application:"MinecraftNet",name:"flightAssignment",url:n,payload:JSON.stringify({application:"MinecraftNet",...t})});if(!1===a&&o&&o.result)return(0,i.trackServiceApi)({application:"MinecraftNet",apiUrl:n,endpointName:"snapshotEvent",method:"POST",globalResource:JSON.stringify(o.result)}),o.result}return null},t.storeFlightAssignmentToCache=function(e,t){const n=new Date;n.setHours(n.getHours()+1);const r={...t,expiration:n,flightParameters:e};localStorage.setItem(u,JSON.stringify(r))},t.retrieveFlightAssignmentFromCache=function(e){if(null!==localStorage){const t=localStorage.getItem(u);if(null!==t)try{const n=JSON.parse(t),r=(new Date).valueOf();return new Date(n.expiration).valueOf()-r<=0||n.flightParameters.browser!==e.browser||n.flightParameters.region!==e.region||n.flightParameters.language!==e.language||n.flightParameters.sessionId!==e.sessionId||n.flightParameters.platform!==e.platform||n.flightParameters.xuid!==e.xuid||n.flightParameters.domain!==e.domain||n.flightParameters.deviceId!==e.deviceId?(localStorage.removeItem(u),null):n}catch(e){}}return null};const r=n(736),o=n(450),i=n(784),a=new Map([["en-us",["en","US"]],["da-dk",["da","DK"]],["de-de",["de","DE"]],["es-es",["es","ES"]],["es-mx",["es","MX"]],["fi-fi",["fi","FI"]],["fr-ca",["fr","CA"]],["fr-fr",["fr","FR"]],["it-it",["it","IT"]],["ja-jp",["ja","JP"]],["ko-kr",["ko","KR"]],["nb-no",["nb","NO"]],["nl-nl",["nl","NL"]],["pl-pl",["pl","PL"]],["pt-br",["pt","BR"]],["pt-pt",["pt","PT"]],["ru-ru",["ru","RU"]],["sv-se",["sv","SE"]],["tr-tr",["tr","TR"]],["zh-hans",["zh","TW"]],["zh-hant",["zh","TW"]],["zh-cn",["zh","TW"]],["zh-tw",["zh","TW"]]]);function s(e){return document.cookie.split("; ").find(t=>t.startsWith(`${e}=`))?.split("=")[1]}const c="experimentConfig";let l=null;const u="minecraftFlight"},521:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},604:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.msaAuthRedirectDomain=t.msalScopes=t.msalConfig=t.PPEPlayfabTitleId=t.ProdPlayfabTitleId=t.RelyingPartyLocalStorageKeys=t.PPEBedrockRealmsRelyingPartyUrl=t.RelyingPartyURLs=void 0;const r=n(201),o=n(352);t.RelyingPartyURLs={Marketplace:"http://mp.microsoft.com/",BedrockRealms:"https://pocket.realms.minecraft.net/",PlayFab:"http://playfab.xboxlive.com/",XboxLive:"http://xboxlive.com",MinecraftServices:"rp://api.minecraftservices.com/"},t.PPEBedrockRealmsRelyingPartyUrl="https://pocket-stage.realms.minecraft.net/",t.RelyingPartyLocalStorageKeys={Marketplace:o.MinecraftAuthToken.Marketplace,BedrockRealms:o.MinecraftAuthToken.Realms,PlayFab:o.MinecraftAuthToken.PlayFab,XboxLive:o.MinecraftAuthToken.Xbox,MinecraftServices:o.MinecraftAuthToken.MCServices},t.ProdPlayfabTitleId="1DF18",t.PPEPlayfabTitleId="E9358",t.msalConfig={auth:{clientId:"1ff61d79-e173-4b60-b594-94a0ed4927cd",authority:"https://login.microsoftonline.com/consumers"},cache:{cacheLocation:r.BrowserCacheLocation.LocalStorage}},t.msalScopes=["xboxlive.signin"],t.msaAuthRedirectDomain={local:"https://local.minecraft.net",dev:"https://mc-dev.minecraft.net",stage:"https://mc-stage.minecraft.net",prod:"https://minecraft.net"}},664:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.redeem15YearCape=t.getGamerTagPicUrl=t.putResumeSubscription=t.putPauseSubscription=t.getProfileFromIds=t.getProfile=void 0;const r=n(736);t.getProfile=async e=>{const{application:t,authorization:n,serviceURL:o}=e,{data:i,error:a,response:s}=await(0,r.getRequest)({headers:{authorization:`Bearer ${n}`},url:`${o}/minecraft/profile`,application:t,name:"GetProfile"});if(!1===a&&i)return{status:s.status,data:{id:i.id,name:i.name,skins:i.skins.map(e=>({id:e.id,state:e.state,url:e.url,variant:e.variant,alias:e.alias})),capes:i.capes.map(e=>({id:e.id,state:e.state,url:e.url,alias:e.alias}))}};throw{response:s}},t.getProfileFromIds=async e=>{const{application:t,profileId:n,serviceURL:o,authorization:i}=e,{data:a,error:s,response:c}=await(0,r.getRequest)({headers:{authorization:`Bearer ${i}`},url:`${o}/realms/profile/${n}`,application:t,name:"GetProfileFromId"});if(!1===s&&a)return{status:c.status,data:a.map(e=>({id:e.id,name:e.name,regionId:e.regionId,ownerProfileId:e.ownerProfileId,daysLeft:e.daysLeft,mayExtend:e.mayExtend,state:e.state,hasPayment:e.hasPayment,paymentIsActive:e.paymentIsActive,lastPayment:e.lastPayment,lastPaymentMillis:e.lastPaymentMillis,nextPayment:e.nextPayment,nextPaymentMillis:e.nextPaymentMillis,recurringPaymentId:e.recurringPaymentId,paymentStatus:e.paymentStatus,trial:e.trial}))};throw{response:c}},t.putPauseSubscription=async e=>{const{application:t,subscriptionId:n,authorization:o,serviceURL:i}=e,{data:a,error:s,response:c}=await(0,r.putRequest)({headers:{authorization:`Bearer ${o}`},url:`${i}/realms/subscription/${n}/pause`,application:t,name:"PauseRealmsSubscription"});if(!0===s&&null!=c&&404===c.status)return{status:c.status,data:{paused:!0}};if(!1===s&&a)return{status:c.status,data:{paused:a.paused}};throw{response:c}},t.putResumeSubscription=async e=>{const{application:t,subscriptionId:n,authorization:o,serviceURL:i}=e,{data:a,error:s,response:c}=await(0,r.putRequest)({headers:{authorization:`Bearer ${o}`},url:`${i}/realms/subscription/${n}/resume`,name:"ResumeRealmsSubscription",application:t});if(!1===s&&a)return{status:c.status,data:{resumed:a.resumed}};throw{response:c}},t.getGamerTagPicUrl=async({application:e,authorization:t,gamertag:n})=>{const o=new URL(`/users/gt(${n})/profile/settings?settings=AppDisplayPicRaw,IsXbox360Gamerpic`,"https://profile.xboxlive.com"),i=await(0,r.getRequest)({name:"GamertagPic",url:o.toString(),application:e,headers:{"x-xbl-contract-version":"3",authorization:t}});if(!1===i.error&&i.data){const e=i.data.profileUsers[0],t=e.settings.some(e=>"IsXbox360Gamerpic"===e.id&&"1"===e.value),n=e.settings.find(e=>"AppDisplayPicRaw"===e.id)?.value?.replace("Padding","Stretch");return{error:!1,data:n&&t?`${n}&w=100&h=100`:n,response:i.response}}return i},t.redeem15YearCape=({application:e,urlBase:t,authorization:n})=>{const o=new URL("/minecraft/cape/15year",t);return(0,r.postRequest)({name:"15_YEAR_JAVA_CAPE",url:o.toString(),application:e,headers:{authorization:`Bearer ${n}`},deserializeResponse:!1})}},673:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},736:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getRequest=function(e){return i("GET",e)},t.postRequest=function(e){return i("POST",e)},t.putRequest=function(e){return i("PUT",e)},t.deleteRequest=function(e){return i("DELETE",e)};const r=n(784),o=n(450);async function i(e,t){const{application:n,payload:i,headers:a,name:s,url:c,deserializeResponse:l=!0,globalResource:u,letFetchDetermineContentType:d,disablePreauthHeader:h}=t,g=d?{}:{"content-type":"application/json"};let p=a;if(!h){const e=(0,o.readCookie)(document.cookie,"mcsto-preauth");e&&(p={...a,"X-WEB-PREAUTH-SECRET":e})}const f={method:e,headers:{...g,...p}};let m;i&&(f.body=i);const y=Date.now();try{const e=await fetch(c,f);if(e.ok)if(l&&204!==e.status)try{m={data:await e.json(),error:!1,response:e}}catch(t){m={data:void 0,error:!0,response:e}}else m={error:!1,response:e};else m={data:void 0,error:!0,response:e}}catch(e){m={error:!0,data:void 0,response:null}}return(0,r.trackServiceApi)({apiUrl:c,application:n,endpointName:s,method:e,globalResource:u,httpStatusCode:null!=m.response?m.response.status:void 0,responseTimeMs:null!=m.response?Date.now()-y:void 0}),m}},745:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},749:(e,t)=>{var n,r;Object.defineProperty(t,"__esModule",{value:!0}),t.VOTE_TYPE=t.SORT_DIRECTION=void 0,function(e){e.BEST_MATCH="rel",e.ASC="asc",e.DESC="desc"}(n||(t.SORT_DIRECTION=n={})),function(e){e.UP="up",e.DOWN="down"}(r||(t.VOTE_TYPE=r={}))},784:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getGPCDataSharingOptIn=s,t.getUserConsentDetails=function(){return a.siteConsent?a.siteConsent.getConsent():void 0},t.initializeAnalytics=c,t.trackServiceApi=async function({application:e,endpointName:t,globalResource:n,apiUrl:r,method:a,httpStatusCode:s,responseTimeMs:l}){try{let u=new URL(window.location.href).pathname.replace(/\/([a-z]{2}-[a-z]{2})?\/?/,"");0===u.length&&(u="homepage"),await c(),i.track({name:o.ANALYTICS_API,data:{page:u,application:e,service:new URL(r).host,endpointName:t,globalResource:n,apiUrl:r,method:a,httpStatusCode:s,responseTimeMs:l}})}catch(e){console.error(e)}},t.trackBuyNowEvent=async function(e,t,n,r,a){await c(),i.track({name:o.ANALYTICS_BUYNOW_EVENT_NAME,data:{state:e,productId:n,path:t,errorCode:r,errorType:a}})},t.trackMSAAuthError=async function(e){await c();const{errorCode:t,errorMessage:n,subError:r}=e;i.track({name:o.ANALYTICS_API,data:{errorCode:t,errorMessage:n,subError:r}})};const r=n(216),o=n(875),i=new r.ApplicationInsights,a=window;async function s(){const e=a.optOutPromise||Promise.resolve(!0),t=await e;return!navigator.globalPrivacyControl&&"1"!==navigator.doNotTrack&&!t}async function c(e=o.INSTRUMENTATION_KEY){if(!i.isInitialized()){const t=await s();if(!i.isInitialized()){const n={instrumentationKey:e,propertyConfiguration:{userConsented:!1,gpcDataSharingOptIn:t,callback:{userConsentDetails:a.siteConsent?a.siteConsent.getConsent:void 0}},cookieCfg:{ignoreCookies:["MSCC"]}};i.initialize(n,[]),window.addEventListener("beforeunload",()=>{i.flush()})}}}},849:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getBedrockRealmInfoFromInvite=t.getLatestVersion=t.getDownloadLinks=t.subscribeNewsletter=t.getNewsletterCountryConfig=t.checkEntitlements=t.grantOffers=t.getMarketplacePassItems=t.getMarketplacePromotionDetails=t.getMarketplacePopular=t.getMarketplaceItem=t.getSearchResults=t.getRecentMarketplaceContent=void 0,t.getFlightAssignment=c,t.isFlightEnabled=l,t.loadActiveExperimentResources=async function({application:e,baseUrl:t,configBaseUrl:n,property:r="https://www.minecraft.net"}){const i=await(0,o.getExperimentConfig)({application:e,baseUrl:n});if(null!==i)for(const e of i.experiments)if((0,o.experimentMatches)(e.flights.targeting,window.location,r))for(const[n,r]of Object.entries(e.flights.setup))if(await l(n,t)){for(const e of r.js){const t=document.createElement("script");t.src=e,t.type="text/javascript",document.head.appendChild(t)}for(const e of r.css){const t=document.createElement("link");t.href=e,t.rel="stylesheet",t.type="text/css",document.head.appendChild(t)}}};const r=n(736),o=n(453),i=n(107);let a=null,s=!1;async function c(e){const t={sessionId:await(0,o.getSessionIdFromCookie)(),language:(0,o.getLanguage)(),platform:(0,o.getPlatform)(navigator.userAgent),region:(0,o.getRegion)(),browser:(0,o.getBrowser)(navigator.userAgent),deviceType:(0,o.getDeviceType)(),xuid:(0,o.getXuid)(),domain:(0,o.getDomain)(),deviceId:(0,o.getDeviceId)()};let n=(0,o.retrieveFlightAssignmentFromCache)(t);if(null===n&&(null===a&&(a=(0,o.fetchFlightAssignment)({baseUrl:e,flightParameters:t})),n=await a,a=null,s=!1,null!==n&&(0,o.storeFlightAssignmentToCache)(t,n)),null!==n&&!s)try{const e=window,t=n.flights;e.ExPMeta=t.map(e=>({experiment_Name:e})),document.dispatchEvent(new CustomEvent("ExPMetaExPTreatmentLoaded")),s=!0}catch{}return n}async function l(e,t){const n=new URLSearchParams(window.location.search);if("true"===n.get(i.DISABLE_ALL_FLIGHTS_PARAM))return!1;let r=(n.get(i.ENABLE_FLIGHTS_URL_PARAM)||"").split(",");const o=(n.get(i.DISABLE_FLIGHTS_URL_PARAM)||"").split(","),a=await c(t);return a?.flights&&(r=r.concat(a.flights)),r.indexOf(e)>-1&&o.indexOf(e)<0}function u(e,t){if(t)for(const{name:n,value:r}of t)e.set(`filter[${n}]`,r.toString())}const d=new Map;t.getRecentMarketplaceContent=({application:e,authorization:t,urlBase:n,lang:o,before:i,after:a,limit:s,query:c,filters:l})=>{const h=new URLSearchParams;i&&h.set("before",`${i.getUTCFullYear()}-${i.getUTCMonth()+1}-${i.getUTCDate()}`),a&&h.set("after",`${a.getUTCFullYear()}-${a.getUTCMonth()+1}-${a.getUTCDate()}`),s&&h.set("limit",s.toString()),c&&h.set("query",c),u(h,l);const g=new URL(`/api/v1.0/${o}/${t?"auth/":""}marketplace`,n);if(g.search=h.toString(),d.has(`${g.toString()}-${t}`))return d.get(`${g.toString()}-${t}`);const p={name:"MARKETPLACE_NEW",url:g.toString(),application:e};t&&(p.headers={authorization:`MCToken ${t}`});const f=(0,r.getRequest)(p);return d.set(`${g.toString()}-${t}`,f),f},t.getSearchResults=({application:e,authorization:t,urlBase:n,lang:o,query:i,author:a,productId:s,productIds:c,tag:l,category:d,filters:h,page:g,pageSize:p,sortType:f,countOnly:m,newSearch:y,newsOnly:v})=>{const C=new URLSearchParams;i&&C.set("query",i),a&&C.set("author",a),s?C.set("productId",s):c&&0!==c.length&&C.set("productId",c.join(",")),l&&C.set("tag",Array.isArray(l)?l.join():l),g&&C.set("page",g.toString()),p&&C.set("pageSize",p.toString()),f&&C.set("sortType",f),d&&C.set("category",d.toString()),m&&C.set("countOnly",m.toString()),y&&C.set("newSearch",y.toString()),v&&C.set("newsOnly",v.toString()),u(C,h);const w=new URL(`/api/v1.0/${o}/${t?"auth/":""}search`,n);w.search=C.toString();const I={name:"SITE_WIDE_SEARCH",url:w.toString(),application:e,globalResource:i};return t&&(I.headers={authorization:`MCToken ${t}`}),(0,r.getRequest)(I)},t.getMarketplaceItem=({application:e,authorization:t,urlBase:n,lang:o,productId:i})=>{const a=new URLSearchParams,s=new URL(`/api/v1.0/${o}/marketplace/${t?"auth/":""}item/${i}`,n);s.search=a.toString();const c={name:"MARKETPLACE_ITEM",url:s.toString(),application:e,globalResource:i};return t&&(c.headers={authorization:`MCToken ${t}`}),(0,r.getRequest)(c)};const h=new Map;t.getMarketplacePopular=({application:e,authorization:t,urlBase:n,lang:o})=>{const i=new URL(`/api/v1.0/${o}/marketplace/${t?"auth/":""}popular`,n);if(h.has(`${i.toString()}-${t}`))return h.get(`${i.toString()}-${t}`);const a={name:"MARKETPLACE_POPULAR",url:i.toString(),application:e};t&&(a.headers={authorization:`MCToken ${t}`});const s=(0,r.getRequest)(a);return h.set(`${i.toString()}-${t}`,s),s};const g=new Map;t.getMarketplacePromotionDetails=async({application:e,authorization:t,urlBase:n,lang:o,filters:i})=>{const a=new URLSearchParams,s=new URL(`/api/v1.0/${o}/marketplace/${t?"auth/":""}promotiondetails`,n);if(u(a,i),s.search=a.toString(),g.has(`${s.toString()}-${t}`))return g.get(`${s.toString()}-${t}`);const c={name:"MARKETPLACE_PROMO_DETAILS",url:s.toString(),application:e};t&&(c.headers={authorization:`MCToken ${t}`});const l=(0,r.getRequest)(c);return g.set(`${s.toString()}-${t}`,l),l};const p=new Map;t.getMarketplacePassItems=async({application:e,authorization:t,urlBase:n,lang:o,filters:i})=>{const a=new URLSearchParams,s=new URL(`/api/v1.0/${o}/marketplace/${t?"auth/":""}marketplace-pass`,n);if(u(a,i),s.search=a.toString(),p.has(`${s.toString()}-${t}`))return p.get(`${s.toString()}-${t}`);const c={name:"MARKETPLACE_PASS_ITEMS",url:s.toString(),application:e};t&&(c.headers={authorization:`MCToken ${t}`});const l=(0,r.getRequest)(c);return p.set(`${s.toString()}-${t}`,l),l},t.grantOffers=({application:e,authorization:t,urlBase:n,offers:o})=>{const i=new URLSearchParams;o.forEach(e=>{i.append("offer",e)});const a=new URL("/api/v1.0/grant/offer",n);return a.search=i.toString(),(0,r.putRequest)({name:"GRANT_OFFERS",url:a.toString(),headers:{authorization:`MCToken ${t}`},application:e,deserializeResponse:!1})},t.checkEntitlements=({application:e,authorization:t,urlBase:n,entitlements:o})=>{const i=new URLSearchParams;o.forEach(e=>{i.append("entitlement",e)});const a=new URL("/api/v1.0/grant/entitlement",n);return a.search=i.toString(),(0,r.getRequest)({name:"CHECK_ENTITLEMENTS",url:a.toString(),headers:{authorization:`MCToken ${t}`},application:e})},t.getNewsletterCountryConfig=({application:e,urlBase:t})=>{const n=new URL("/api/v1.0/newsletter",t);return(0,r.getRequest)({name:"NEWSLETTER_COUNTRY_CONFIG",url:n.toString(),application:e})},t.subscribeNewsletter=({application:e,urlBase:t,subscriptOptions:n})=>{const o=new URL("/api/v1.0/newsletter/subscribe",t);return(0,r.postRequest)({name:"SUBSCRIBE_NEWSLETTER",url:o.toString(),application:e,payload:JSON.stringify(n),deserializeResponse:!1})},t.getDownloadLinks=({application:e,urlBase:t})=>{const n=new URL("/api/v1.0/download/links",t);return(0,r.getRequest)({name:"DOWNLOAD_LINKS",url:n.toString(),application:e})},t.getLatestVersion=({application:e,urlBase:t})=>{const n=new URL("/api/v1.0/download/latest",t);return(0,r.getRequest)({name:"LATEST_VERSION",url:n.toString(),application:e})},t.getBedrockRealmInfoFromInvite=({application:e,urlBase:t,inviteId:n})=>{const o=new URL(`/api/v1.0/open/bedrock/realms/${n}`,t);return(0,r.getRequest)({name:"BEDROCK_REALM_INVITE",url:o.toString(),application:e})}},875:function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),o(n(990),t)},902:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getStatusSubscription=t.putRedeemSubscription=t.getUnreconciledSubscriptionsByPlatform=t.getRealmsSubscriptionByPlatform=void 0;const r=n(736);t.getRealmsSubscriptionByPlatform=async e=>{const{application:t,authorization:n,sessionId:o,marketplaceXBLToken:i,serviceURL:a,realmsProfileId:s,applicationType:c,mojangAuth:l}=e,{data:u,error:d,response:h}=await(0,r.getRequest)({application:t,url:`${a}/subscriptions/realms/nextavailable`,headers:{microsoftPurchasingToken:i,authorization:n,"X-MojangAuth":l,"Session-Id":o,realmsProfileId:s,applicationType:c},name:"NextAvailableRealms"});if(!1===d&&u)return{status:h.status,data:{result:{bigId:u.result.bigId,isTrial:u.result.isTrial},continuationToken:u.continuationToken,profileVersion:u.profileVersion}};throw{response:h}},t.getUnreconciledSubscriptionsByPlatform=async e=>{const{application:t,authorization:n,sessionId:o,marketplaceXBLToken:i,serviceURL:a,realmsProfileId:s,applicationType:c,mojangAuth:l}=e,{data:u,error:d,response:h}=await(0,r.getRequest)({application:t,url:`${a}/subscriptions/realms/check`,name:"CheckRealms",headers:{microsoftPurchasingToken:i,authorization:n,"X-MojangAuth":l,"Session-Id":o,applicationType:c,realmsProfileId:s}});if(!1===d&&u)return{status:h.status,data:{result:u.result.map(e=>({bigId:e.bigId,isTrial:e.isTrial})),continuationToken:u.continuationToken,profileVersion:u.profileVersion}};throw{response:h}},t.putRedeemSubscription=async e=>{const{application:t,authorization:n,sessionId:o,marketplaceXBLToken:i,bigId:a,profileId:s,serviceURL:c,subscriptionId:l,applicationType:u,mojangAuth:d}=e,{data:h,error:g,response:p}=await(0,r.putRequest)({application:t,url:`${c}/subscriptions/realms/redeem`,headers:{authorization:n,"Session-Id":o,"X-MojangAuth":d},name:"RealmsRedeem",payload:JSON.stringify({applicationType:u,microsoftPurchasingToken:i,platformStoreOfferId:a,realmsProfileId:s,subscriptionId:l})});if(!g&&h)return{status:p.status,data:{result:{subscriptionId:h.result.subscriptionId,productId:h.result.productId,createdDate:h.result.createdDate,lastUpdatedDate:h.result.lastUpdatedDate,world:h.result.world?{id:h.result.world.id,name:h.result.world.name,description:h.result.world.description,ownerId:h.result.world.ownerId,state:h.result.world.state,isExpired:h.result.world.isExpired,isExpiredTrial:h.result.world.isExpiredTrial,activeSlot:h.result.world.activeSlot}:h.result.world,continuationToken:h.result.continuationToken,profileVersion:h.result.profileVersion}}};throw{response:p}},t.getStatusSubscription=async e=>{const{application:t,authorization:n,sessionId:o,serviceURL:i,realmsProfileId:a,mojangAuth:s}=e,{data:c,error:l,response:u}=await(0,r.getRequest)({application:t,url:`${i}/java/public/subscriptions/${a}`,name:"RealmsStatus",headers:{authorization:n,"X-MojangAuth":s,"Session-Id":o}});if(!1===l&&c)return{status:u.status,data:{result:{subscriptions:c.result.subscriptions.map(e=>({id:e.id,ownerId:e.ownerId,status:e.status,createdDate:e.createdDate,expirationDate:e.expirationDate,friendlyId:e.friendlyId,canceledDate:e.canceledDate,lastUpdatedDate:e.lastUpdatedDate,store:e.store,world:e.world?{id:e.world.id,name:e.world.name,state:e.world.state,daysLeft:e.world.daysLeft}:void 0})),continuationToken:c.result.continuationToken}}};throw{response:u}}},928:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},946:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.cleanMap=void 0,t.cleanMap=(e,t)=>{const n="#$#HJKHJKHSFS#$@#@#D~~~~!";return e.map(e=>{try{return t(e)}catch(e){return n}}).filter(e=>e!==n)}},990:(e,t)=>{var n,r;Object.defineProperty(t,"__esModule",{value:!0}),t.MINECOIN_PRODUCTS=t.RealmState=t.RealmStatus=t.MAX_RETRY_ERROR=t.ANALYTICS_BUYNOW_EVENT_NAME=t.ANALYTICS_API=t.INSTRUMENTATION_KEY=void 0,t.INSTRUMENTATION_KEY="c0570cc3b05346d790b276b2c1355300-48dbf180-31ea-40ce-a720-e2d3c833be38-6824",t.ANALYTICS_API="Ms.Web.ApiPerf",t.ANALYTICS_BUYNOW_EVENT_NAME="Ms.Web.BuyNow",t.MAX_RETRY_ERROR="Max Retry Reached",function(e){e.Unknown="UNKNOWN",e.Submitted="SUBMITTED",e.Active="ACTIVE",e.Inactive="INACTIVE",e.Expired="EXPIRED",e.In_dunning="IN_DUNNING",e.Failed="FAILED",e.In_grace_period="IN_GRACE_PERIOD"}(n||(t.RealmStatus=n={})),function(e){e.Closed="CLOSED",e.Open="OPEN",e.Deleted="DELETED",e.Uninitialized="UNINITIALIZED",e.Admin_lock="ADMIN_LOCK"}(r||(t.RealmState=r={})),t.MINECOIN_PRODUCTS=["9PB7LFS57G9H","9NHGX9G9JF1X","9N775SDWXP16","9P3VJ3V5M2CJ","9NG4VZF0JVFN","9P99T94BKFQJ","9PD3R529P5XZ","9MZJ3BK78HL8","9N08WNFPR6VL","9P4QR54B9NJK","9P063P6X637H","9NWG528PMSWZ","9NTW937KZF1S","9NZHNGN2X7HD","9NDT7TBWP249","9MXMKZSKMSS9","9P9NZBLX5XD6","9P9SFZ7XDFMJ","9N0BB7V30636","9PC2T34ZJ10W","9P2XG2G6PPRC","9P75RG460Z9S","9NRZKN14V5JJ","9P32JPGBVC0B","9N077C6VCC05","9NFTJNMXK11S","9P20K98HNF0R","9P2G103MSHX1","9PKBVTH4HGT4","9PFP9CGSVWFS","9NTRLT7DPB2H","9P8VXGM808JD","9NVRV23X39GT","9NQ0L323LCV0","9PNVQ1JDPFCS","9PJ5V2N54SVZ","9PJ7XT0PHGWK","9N3RV917K2RG","9MSZP0B4RHTM","9NBMFGDX8QFM","9N822VCQ2XFZ","9MZW6637S1C4","9NRS2RQ5QF63","9P715Q0LW86V","9N8QX3D7XT0Q","9PN75C2JTHT5","9P7QLJSBD35B","9MXM6ZVD031W","9P8M1KSTCF69","9P2WNV39ZHQ5","9NJSBHH6FVRF","9NQGKTXR9BZF","9P3DH50CL5HW"]}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r].call(i.exports,i,i.exports,n),i.exports}n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};return(()=>{var e=r;Object.defineProperty(e,"__esModule",{value:!0}),e.polling=e.getUserVisitorLocation=e.RealmStatus=e.RealmState=e.DiscoveryServiceTypes=e.DiscoveryService=e.WebServiceTypes=e.WebService=e.AnalyticsService=e.MinecoinServiceTypes=e.MinecoinService=e.HttpServiceTypes=e.HttpService=e.NetServiceTypes=e.NetService=e.RealmsProfileServiceTypes=e.RealmsProfileService=e.RealmsSubscriptionServiceTypes=e.RealmsSubscriptionService=e.EntitlementServiceTypes=e.EntitlementService=e.ProductCatalogServiceTypes=e.ProductCatalogService=e.HelpServiceTypes=e.HelpService=void 0;const t=n(432);e.ProductCatalogService=t;const o=n(745);e.ProductCatalogServiceTypes=o;const i=n(402);e.EntitlementService=i;const a=n(521);e.EntitlementServiceTypes=a;const s=n(902);e.RealmsSubscriptionService=s;const c=n(673);e.RealmsSubscriptionServiceTypes=c;const l=n(664);e.RealmsProfileService=l;const u=n(57);e.RealmsProfileServiceTypes=u;const d=n(351);e.HelpService=d;const h=n(749);e.HelpServiceTypes=h;const g=n(849);e.NetService=g;const p=n(107);e.NetServiceTypes=p;const f=n(736);e.HttpService=f;const m=n(736);e.HttpServiceTypes=m;const y=n(452);e.MinecoinService=y;const v=n(928);e.MinecoinServiceTypes=v;const C=n(784);e.AnalyticsService=C;const w=n(66);e.WebService=w;const I=n(352);e.WebServiceTypes=I;const T=n(190);e.DiscoveryService=T;const A=n(184);e.DiscoveryServiceTypes=A;const k=n(875);Object.defineProperty(e,"RealmState",{enumerable:!0,get:function(){return k.RealmState}}),Object.defineProperty(e,"RealmStatus",{enumerable:!0,get:function(){return k.RealmStatus}});const S=n(450);Object.defineProperty(e,"getUserVisitorLocation",{enumerable:!0,get:function(){return S.getUserVisitorLocation}}),Object.defineProperty(e,"polling",{enumerable:!0,get:function(){return S.polling}})})(),r})(),e.exports=t()}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}(()=>{"use strict";var e;!function(e){e.light="light",e.dark="dark",e.highContrast="high-contrast"}(e||(e={}));var t=window,r="MinecraftNetWeb";document.addEventListener("DOMContentLoaded",function(){if(t.WcpConsent){var e=document.documentElement.getAttribute("lang"),n=e?e.toLowerCase():null;t.siteConsent=void 0,t.WcpConsent.init(n,"cookie-banner",function(e,n){if(void 0!==e)return e;t.siteConsent=n})}});var o="https://minecraftprivacy.microsoft.com",i=document.createElement("iframe");i.style.width="0",i.style.height="0",i.style.position="absolute",i.style.border="none",i.src=o+"/iframe.html",t.optOutPromise=new Promise(function(e){var t=function(n){if(n.origin===o&&n.data){var r=n.data["3PAdsOptOut"];void 0!==r&&e("1"===r),e(!1),removeEventListener("message",t),i.remove()}};addEventListener("message",t)}),window.addEventListener("DOMContentLoaded",function(){document.body.appendChild(i)});var a=function(e){return n=this,r=void 0,i=function(){var n,r,o,i,a;return function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}}(this,function(s){switch(s.label){case 0:return t.optOutPromise?[4,t.optOutPromise]:[3,2];case 1:if(s.sent()||navigator.globalPrivacyControl||"1"===navigator.doNotTrack||!e.Advertising||!e.Analytics||!e.Required||!e.SocialMedia){for(n=["AMCV_","AMCVS_","_clck","_clsk","_cs_c","_cs_cvars","_cs_id","_cs_s","_fbp","_tt_enable_cookie","_ttp","_uetvid","kndctr_","mbox","ttcsid","utag_main"],r=location.hostname,o=r.split("."),i=[],a=0;a<=o.length-2;a++)i.push(o.slice(a).join("."));document.cookie.split("; ").filter(function(e){return n.some(function(t){return e.startsWith(t)})}).map(function(e){return e.split("=")}).forEach(function(e){var t=e[0];i.forEach(function(e){document.cookie="".concat(t,"=; Max-Age=0; path=/; domain=").concat(e,"; expires=Thu, 01 Jan 1970 00:00:00 GMT")})})}s.label=2;case 2:return[2]}})},new((o=void 0)||(o=Promise))(function(e,t){function a(e){try{c(i.next(e))}catch(e){t(e)}}function s(e){try{c(i.throw(e))}catch(e){t(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o(function(e){e(n)})).then(a,s)}c((i=i.apply(n,r||[])).next())});var n,r,o,i},s=function(){t.siteConsent?a(t.siteConsent.getConsent()):t.WcpConsent&&t.WcpConsent.onInitCallback(function(e){a(e)})};s(),window.addEventListener("consentChanged",s);var c=n(253),l=function(){return l=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},l.apply(this,arguments)},u=function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,s)}c((r=r.apply(e,t||[])).next())})},d=function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},h=c.WebService.getAuthToken,g=c.WebServiceTypes.MinecraftAuthToken,p=function(e){var t=e.capes,n=e.capeId,o=e.bedrockUrlBase,i=e.bedrockEntitlementId;return u(this,void 0,void 0,function(){var e,a,s,l,u;return d(this,function(d){switch(d.label){case 0:return e=!1,[4,c.NetService.checkEntitlements({application:r,urlBase:o,authorization:h(g.MCToken),entitlements:[i]})];case 1:if(a=d.sent(),s=a.error,l=a.data,u=a.response,!1!==s||!l)throw u;return e=!0===l.result.entitlements[i],[2,[t.map(function(e){return e.id}).includes(n),e]]}})})},f=function(e,t,n){return void 0===t&&(t="en-us"),void 0===n&&(n="us"),u(this,void 0,void 0,function(){var o,i,a;return d(this,function(s){switch(s.label){case 0:return o={application:r,locale:t,market:n,mscv:"",productIds:e,serviceURL:"https://displaycatalog.mp.microsoft.com/v7/products"},null!==(i=h(g.Marketplace))&&(o=l(l({},o),{authorization:i})),[4,c.ProductCatalogService.getProductsCatalog(o)];case 1:return 200===(a=s.sent()).status&&void 0!==a.data?[2,a.data.Products.map(function(e){var t,n,r,o=!1,i=e.DisplaySkuAvailabilities.map(function(e){return e.Availabilities.filter(function(e){return e.Actions.includes("Purchase")})}).flat();if(i.length){var a=i.find(function(t){return t.SkuId===e.PreferredSkuId});if(t=(r=a?a.SkuId:i[0].SkuId)?i.find(function(e){return e.SkuId===r}):i[0])for(var s=0,c=e.DisplaySkuAvailabilities;s<c.length;s++){var l=c[s];if(n)break;for(var u=0,d=l.Availabilities;u<d.length;u++){var h=d[u];if(n)break;if(h.AvailabilityId===t.AvailabilityId)for(var g=0,p=l.HistoricalBestAvailabilities;g<p.length;g++){var f=p[g];if(f.AvailabilityId===t.AvailabilityId){n=f;break}}}}for(var m=0,y=e.DisplaySkuAvailabilities;m<y.length;m++){var v=y[m];if(o)break;for(var C=0,w=v.Availabilities;C<w.length;C++){var I=w[C];if(o)break;for(var T=0,A=I.Actions;T<A.length;T++)if("gift"===A[T].toLowerCase()){o=!0;break}}}}return{availability:t,historicalBestAvailability:n,hasGiftAvailability:o}})]:[2,[]]}})})},m=function(e){return c.NetService.loadActiveExperimentResources(l(l({},e),{application:r}))};u(void 0,void 0,void 0,function(){var e,n,r,o;return d(this,function(i){switch(i.label){case 0:return[4,(0,c.polling)(function(){return void 0!==t.mcConfig},25)];case 1:return i.sent()&&(e=new RegExp(".*help(-(ppe|dev))?\\.minecraft\\.net").test(window.parent.location.hostname)?"mcHelp":"mcNet",n=null===(o=t.mcConfig)||void 0===o?void 0:o.exp[(a=window.parent.location.hostname,-1!==a.indexOf("mc-dev.")?"dev":-1!==a.indexOf("mc-stage.")?"stage":-1!==a.indexOf("preview.")?"preview":"prod")],(r=null==n?void 0:n[e])&&r.getFlightAssignment&&m({baseUrl:n.serviceUrl,configBaseUrl:r.configBaseUrl})),[2]}var a})});var y={MinecraftAuthToken:g,getGamertag:c.WebService.getGamertag,getGamerTagPicUrl:function(e){return c.RealmsProfileService.getGamerTagPicUrl({application:r,authorization:h(g.Xbox),gamertag:e})},getAuthToken:h,logout:c.WebService.logout,getLoginUrl:c.WebService.getLoginUrl,isLoggedIn:c.WebService.isLoggedIn,getAvailabilitiesForProduct:function(e,t,n){var r,o,i,a;return void 0===t&&(t="en-us"),void 0===n&&(n="us"),u(this,void 0,void 0,function(){var s;return d(this,function(c){switch(c.label){case 0:return[4,f([e],t,n)];case 1:return s=c.sent(),[2,{hasGiftAvailability:null!==(o=null===(r=s[0])||void 0===r?void 0:r.hasGiftAvailability)&&void 0!==o&&o,availability:null===(i=s[0])||void 0===i?void 0:i.availability,historicalBestAvailability:null===(a=s[0])||void 0===a?void 0:a.historicalBestAvailability}]}})})},getAvailabilitiesForProducts:f,has15YearCapes:p,claim15YearCape:function(e){var t=e.javaUrlBase,n=e.capes,o=e.capeId,i=e.bedrockEntitlementOffer,a=e.bedrockEntitlementId,s=e.bedrockUrlBase;return u(this,void 0,void 0,function(){var e,l,u,f,m,y,v,C;return d(this,function(d){switch(d.label){case 0:return[4,p({capes:n,capeId:o,bedrockUrlBase:s,bedrockEntitlementId:a})];case 1:return e=d.sent(),l=e[0],u=e[1],l||(f=c.RealmsProfileService.redeem15YearCape({application:r,urlBase:t,authorization:h(g.Bearer)})),u||(m=c.NetService.grantOffers({application:r,authorization:h(g.MCToken),offers:[i],urlBase:s})),[4,Promise.all([f||Promise.resolve({error:!1}),m||Promise.resolve({error:!1})])];case 2:return y=d.sent(),v=y[0],C=y[1],[2,[v.error,C.error]]}})})},getEntitlements:function(e){var t=e.urlBase,n=e.requestId,o=new URL("/entitlements/license",t);return c.EntitlementService.getEntitlements({application:r,authorization:h(g.Bearer),serviceURL:o.toString(),requestId:n})},getFlightAssignment:c.NetService.getFlightAssignment,getProfile:function(e){var t=e.urlBase;return c.RealmsProfileService.getProfile({application:r,authorization:h(g.Bearer),serviceURL:t})},getRecentMarketplaceContent:function(e){return c.NetService.getRecentMarketplaceContent(l(l({},e),{application:r,authorization:h(g.MCToken)}))},search:function(e){return c.NetService.getSearchResults(l(l({},e),{authorization:h(g.MCToken),application:r}))},HttpService:c.HttpService,getMinecoinBalance:function(e){return c.MinecoinService.getMinecoinBalance(r,"".concat(c.WebServiceTypes.MinecraftAuthToken.MCToken," ").concat(c.WebService.getAuthToken(c.WebServiceTypes.MinecraftAuthToken.MCToken)),c.WebService.getAuthToken(c.WebServiceTypes.MinecraftAuthToken.Marketplace),e)},getNewsletterCountryConfig:function(e){return c.NetService.getNewsletterCountryConfig(l(l({},e),{application:r}))},subscribeNewsletter:function(e){return c.NetService.subscribeNewsletter(l(l({},e),{application:r}))},getMarketplaceItem:function(e){return c.NetService.getMarketplaceItem(l(l({},e),{application:r,authorization:h(g.MCToken)}))},getMarketplacePopular:function(e){return c.NetService.getMarketplacePopular(l(l({},e),{application:r,authorization:h(g.MCToken)}))},getMarketplacePromotionDetails:function(e){return c.NetService.getMarketplacePromotionDetails(l(l({},e),{application:r,authorization:h(g.MCToken)}))},getMarketplacePassItems:function(e){return c.NetService.getMarketplacePassItems(l(l({},e),{application:r,authorization:h(g.MCToken)}))},getMarketplaceEntitlements:function(e){return c.EntitlementService.getMarketplaceEntitlements(l(l({},e),{authorization:h(g.MCToken),application:r}))},isFlightEnabled:c.NetService.isFlightEnabled,getDownloadLinks:function(e){return c.NetService.getDownloadLinks(l(l({},e),{application:r}))},getBedrockRealmInfoFromInvite:function(e){return c.NetService.getBedrockRealmInfoFromInvite(l(l({},e),{application:r}))},purchaseProductWithMinecoin:function(e){return c.MinecoinService.purchaseProductWithMinecoin(l(l({},e),{application:r,authorization:h(g.MCToken)}))},getLatestVersion:function(e){return c.NetService.getLatestVersion(l(l({},e),{application:r}))},loadActiveExperimentResources:m,logIn:c.WebService.login,trySilentLogin:c.WebService.trySilentLogin,getUserVisitorLocation:c.getUserVisitorLocation};window.MinecraftUser=y,window.manageConsent=function(){t.siteConsent.manageConsent()}})()})();
//# sourceMappingURL=main.js.map
if (window.siteConsent && !window.siteConsent.isConsentRequired) {
    const elements = document.querySelectorAll('[data-manage-consent="true"]');
    elements.forEach(function(element) {
        element.remove();
    });
}
